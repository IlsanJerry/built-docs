<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Agent API
        | APM Real User Monitoring JavaScript Agent Reference [master]
      | Elastic
    </title><link rel="home" href="index.html" title="APM Real User Monitoring JavaScript Agent Reference [master]" /><link rel="up" href="api.html" title="API Reference" /><link rel="prev" href="api.html" title="API Reference" /><link rel="next" href="transaction-api.html" title="Transaction API" /><meta name="DC.type" content="Learn/Docs/APM Real User Monitoring JavaScript Agent/Reference/master" /><meta name="DC.subject" content="APM" /><meta name="DC.identifier" content="master" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">APM Real User Monitoring JavaScript Agent Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="api.html">API Reference</a></span> » <span class="breadcrumb-node"><code class="literal">Agent</code> API</span></div><div class="navheader"><span class="prev"><a href="api.html">
              « 
              API Reference</a>
           
        </span><span class="next">
           
          <a href="transaction-api.html"><code class="literal">Transaction</code> API
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="agent-api"></a><code class="literal">Agent</code> API<a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can access agent API after initializing the agent:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">var apm = require('@elastic/apm-rum').init(...)</pre></div><h4><a id="apm-init"></a><code class="literal">apm.init([config])</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Initializes the agent with the given <a class="link" href="configuration.html" title="Configuration">configuration</a> and returns itself. Under the hood init does the following</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Registers a global <code class="literal">error</code> listener to track JavaScript errors on the page.</li><li class="listitem">Adds a <code class="literal">onload</code> event listener to collect the page load metrics.</li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>When the agent is inactive, both <code class="literal">error</code> and <code class="literal">onload</code> listeners will not be registered on the page</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Both XHR and Fetch API are patched as soon as the agent script is executed on the page and does not get changed even if the agent is inactive. The reason is to allow users to initialize the agent asynchronously on the page.</p></div></div><h4><a id="apm-set-user-context"></a><code class="literal">apm.setUserContext()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.setUserContext(context)</pre></div><p>Call this method to enrich collected performance data and errors with information about the user.</p><p>The given <code class="literal">context</code> argument must be an object and can contain the following properties (all optional):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">id</code> - The users ID</li><li class="listitem"><code class="literal">username</code> - The users username</li><li class="listitem"><code class="literal">email</code> - The users e-mail</li></ul></div><p>The provided user context is stored under <code class="literal">context.user</code> in Elasticsearch on both errors and transactions.</p><p>It’s possible to call this function multiple times within the scope of the same active transaction.
For each call, the properties of the context argument are shallow merged with the context previously given.</p><h4><a id="apm-set-custom-context"></a><code class="literal">apm.setCustomContext()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.setCustomContext(context)</pre></div><p>Call this to enrich collected errors and transactions with any information that you think will help you debug performance issues or errors.</p><p>The provided custom context is stored under <code class="literal">context.custom</code> in Elasticsearch on both errors and transactions.</p><p>It’s possible to call this function multiple times within the scope of the same active transaction.
For each call, the properties of the context argument are shallow merged with the context previously given.</p><p>The given <code class="literal">context</code> argument must be an object and can contain any property that can be JSON encoded.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Before using custom context, ensure you understand the different types of
<a class="ulink" href="/guide/en/apm/get-started/current/metadata.html" target="_top">metadata</a> that are available.</p></div></div><h4><a id="apm-add-tags"></a><code class="literal">apm.addTags()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p><span class="Admonishment">
      [<span class="Admonishment-version u-mono u-strikethrough">4.1.x</span>]
      <span class="Admonishment-detail">Deprecated in 4.1.x. 
  Tags have been replaced with labels
</span></span>
, Please use <a class="link" href="agent-api.html#apm-add-labels" title="apm.addLabels()"><code class="literal">apm.addLabels()</code></a> instead</p><h4><a id="apm-add-labels"></a><code class="literal">apm.addLabels()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.addLabels({ [name]: value })</pre></div><p>Set labels on transactions and errors.</p><p>Labels are key/value pairs that are indexed by Elasticsearch and therefore searchable (as opposed to data set via <a class="link" href="agent-api.html#apm-set-custom-context" title="apm.setCustomContext()"><code class="literal">apm.setCustomContext()</code></a>). You can set multiple labels.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Before using custom labels, ensure you understand the different types of
<a class="ulink" href="/guide/en/apm/get-started/current/metadata.html" target="_top">metadata</a> that are available.</p></div></div><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">name</code> - Any string. All periods (.), asterisks (*), and double quotation marks (") will be replaced by underscores (_), as those characters have special meaning in Elasticsearch</li><li class="listitem"><code class="literal">value</code> - Any string. If a non-string data type is given, it’s converted to a string before being sent to the APM Server.</li></ul></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Avoid defining too many user-specified labels.
Defining too many unique fields in an index is a condition that can lead to a
<a class="ulink" href="/guide/en/elasticsearch/reference/current/mapping.html#mapping-limit-settings" target="_top">mapping explosion</a>.</p></div></div><h4><a id="apm-add-filter"></a><code class="literal">apm.addFilter()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>A filter can be used to modify the APM payload before it is sent to the apm-server.
This can be useful in for example redacting sensitive information from the payload:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.addFilter(function (payload) {
  if (payload.errors) {
    payload.errors.forEach(function (error) {
      error.exception.message = error.exception.message.replace('secret', '[REDACTED]')
    })
  }
  if (payload.transactions) {
    payload.transactions.forEach(function (tr) {
      tr.spans.forEach(function (span) {
        if (span.context &amp;&amp; span.context.http &amp;&amp; span.context.http.url) {
          var url = new URL(span.context.http.url)
          if (url.searchParams.get('token')) {
            url.searchParams.set('token', 'REDACTED')
          }
          span.context.http.url = url.toString()
        }
      })
    })
  }
  // Make sure to return the payload
  return payload
})</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The payload will be dropped if one of the filters return a falsy value.</p></div></div><h4><a id="apm-start-transaction"></a><code class="literal">apm.startTransaction()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.startTransaction(name, type)</pre></div><p>Starts and returns a new transaction.</p><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">name</code> - The name of the transaction (string). Defaults to <code class="literal">Unknown</code></li><li class="listitem"><code class="literal">type</code> - The type of the transaction (string). Defaults to <code class="literal">custom</code></li></ul></div><p>Use this method to create a custom transaction.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Calling this method would result in ending the current transaction and replacing it with the new transaction.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This method returns <code class="literal">undefined</code> if apm is disabled or if <a class="link" href="configuration.html#active" title="active">active</a> flag is set to <code class="literal">false</code> in the config.</p></div></div><h4><a id="apm-start-span"></a><code class="literal">apm.startSpan()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">var span = apm.startSpan(name, type)</pre></div><p>Starts and returns a new span on the current transaction.</p><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">name</code> - The name of the span (string). Defaults to <code class="literal">Unknown</code></li><li class="listitem"><code class="literal">type</code> - The type of the span (string). Defaults to <code class="literal">custom</code></li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This method returns <code class="literal">undefined</code> if apm is disabled or if <a class="link" href="configuration.html#active" title="active">active</a> flag is set to <code class="literal">false</code> in the config.</p></div></div><h4><a id="set-initial-page-load-name"></a><code class="literal">apm.setInitialPageLoadName()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.setInitialPageLoadName(name)</pre></div><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">name</code> - The name of the page-load transaction (string).</li></ul></div><p>Use this method to set the name of the <code class="literal">page-load</code> transaction that is sent automatically on page load event.
See the <a class="link" href="custom-transaction-name.html" title="Custom initial page load transaction names">custom initial page load transaction names</a> documentation for strategies on using this method.</p><h4><a id="get-current-transaction"></a><code class="literal">apm.getCurrentTransaction()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.getCurrentTransaction()</pre></div><p>Use this method to get the current active transaction. If there is no active transaction it will return <code class="literal">undefined</code>.</p><h4><a id="capture-error"></a><code class="literal">apm.captureError()</code><a href="https://github.com/elastic/apm-agent-rum-js/edit/master/docs/agent-api.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.captureError(error)</pre></div><p>Arguments:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">error</code> - An instance of <code class="literal">Error</code>.</li></ul></div><p>Use this method to manually send an error to APM Server:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">apm.captureError(new Error('&lt;error-message&gt;'))</pre></div></div><div class="navfooter"><span class="prev"><a href="api.html">
              « 
              API Reference</a>
           
        </span><span class="next">
           
          <a href="transaction-api.html"><code class="literal">Transaction</code> API
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
