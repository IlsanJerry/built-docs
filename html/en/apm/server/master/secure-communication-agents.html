<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Secure communication with APM Agents
        | APM Server Reference [master]
      | Elastic
    </title><link rel="home" href="index.html" title="APM Server Reference [master]" /><link rel="up" href="securing-apm-server.html" title="Securing APM Server" /><link rel="prev" href="securing-apm-server.html" title="Securing APM Server" /><link rel="next" href="securing-communication-elasticsearch.html" title="Secure communication with Elasticsearch" /><meta name="DC.type" content="Learn/Docs/APM Server/Reference/master" /><meta name="DC.subject" content="APM" /><meta name="DC.identifier" content="master" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">APM Server Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="securing-apm-server.html">Securing APM Server</a></span> » <span class="breadcrumb-node">Secure communication with APM Agents</span></div><div class="navheader"><span class="prev"><a href="securing-apm-server.html">
              « 
              Securing APM Server</a>
           
        </span><span class="next">
           
          <a href="securing-communication-elasticsearch.html">Secure communication with Elasticsearch
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="secure-communication-agents"></a>Secure communication with APM Agents<a href="https://github.com/elastic/apm-server/edit/master/docs/secure-communication-agents.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>To secure the communication between APM Agents and the APM Server:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><a class="link" href="secure-communication-agents.html#secret-token" title="Secret token">Set a secret token in your Agents and Server</a></li><li class="listitem"><a class="link" href="secure-communication-agents.html#ssl-setup" title="SSL/TLS communication in APM Server">Enable SSL/TLS in APM Server</a></li><li class="listitem"><a class="link" href="secure-communication-agents.html#https-in-agents" title="HTTPS communication in APM Agents">Enable HTTPS in your APM Agents</a></li></ol></div><h3><a id="secret-token"></a>Secret token<a href="https://github.com/elastic/apm-server/edit/master/docs/secure-communication-agents.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You can configure a secret token to authorize requests to the APM Server.
This ensures that only your agents are able to send data to your APM servers.
Both the agents and the APM servers have to be configured with the same secret token,
and secret tokens only provide security when used in combination with SSL/TLS.</p><p><span class="strong strong"><strong>APM Server configuration</strong></span></p><p>Here’s how you set the secret token in APM Server:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">apm-server.secret_token: &lt;secret-token&gt;</pre></div><p>We recommend saving the token in the APM Server <a class="xref" href="keystore.html" title="Secrets keystore for secure settings">Secrets keystore</a>.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Secret tokens are not applicable for the RUM Agent,
as there is no way to prevent them from being publicly exposed.</p></div></div><p><span class="strong strong"><strong>Agent specific configuration</strong></span></p><p>Each Agent has a configuration for setting the value of the secret token:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="strong strong"><strong>Go Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/go/current/configuration.html#config-secret-token" target="_top"><code class="literal">ELASTIC_APM_SECRET_TOKEN</code></a></li><li class="listitem"><span class="strong strong"><strong>Java Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/java/current/config-reporter.html#config-secret-token" target="_top"><code class="literal">secret_token</code></a></li><li class="listitem"><span class="strong strong"><strong>.NET Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/dotnet/current/config-reporter.html#config-secret-token" target="_top"><code class="literal">ELASTIC_APM_SECRET_TOKEN</code></a></li><li class="listitem"><span class="strong strong"><strong>Node.js Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/nodejs/current/configuration.html#secret-token" target="_top"><code class="literal">Secret Token</code></a></li><li class="listitem"><span class="strong strong"><strong>Python Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/python/current/configuration.html#config-secret-token" target="_top"><code class="literal">secret_token</code></a></li><li class="listitem"><span class="strong strong"><strong>Ruby Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/ruby/current/configuration.html#config-secret-token" target="_top"><code class="literal">secret_token</code></a></li></ul></div><h3><a id="ssl-setup"></a>SSL/TLS communication in APM Server<a href="https://github.com/elastic/apm-server/edit/master/docs/secure-communication-agents.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To enable SSL/TLS, you need to enable SSL and provide both a private key and a certificate
issued by a certificate authority (CA).
You can then specify the path to those files in your configuration properties.
This will make APM Server serve HTTPS requests instead of HTTP.</p><p>Here’s a basic APM Server SSL config with secure communication enabled:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">apm-server.ssl.enabled: true
apm-server.ssl.key: "/etc/pki/key.pem"
apm-server.ssl.certificate: "/etc/pki/client.pem"</pre></div><p>A full list of configuration options is available in <a class="xref" href="agent-server-ssl.html" title="SSL input settings">SSL input settings</a>.</p><h3><a id="https-in-agents"></a>HTTPS communication in APM Agents<a href="https://github.com/elastic/apm-server/edit/master/docs/secure-communication-agents.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To enable secure communication in your Agents, you need to update the configured server URL to use <code class="literal">HTTPS</code> instead of <code class="literal">HTTP</code>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="strong strong"><strong>Go Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/go/current/configuration.html#config-server-url" target="_top"><code class="literal">ELASTIC_APM_SERVER_URL</code></a></li><li class="listitem"><span class="strong strong"><strong>Java Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/java/current/config-reporter.html#config-server-urls" target="_top"><code class="literal">server_urls</code></a></li><li class="listitem"><span class="strong strong"><strong>.NET Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/dotnet/current/config-reporter.html#config-server-urls" target="_top"><code class="literal">ServerUrls</code></a></li><li class="listitem"><span class="strong strong"><strong>Node.js Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/nodejs/current/configuration.html#server-url" target="_top"><code class="literal">serverUrl</code></a></li><li class="listitem"><span class="strong strong"><strong>Python Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/python/current/" target="_top"><code class="literal">server_url</code></a></li><li class="listitem"><span class="strong strong"><strong>Ruby Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/ruby/current/configuration.html#config-server-url" target="_top"><code class="literal">server_url</code></a></li></ul></div><p>Some Agents also allow you to specify a custom certificate authority for connecting to APM Server.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="strong strong"><strong>Go Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/go/current/configuration.html#config-server-cert" target="_top"><code class="literal">ELASTIC_APM_SERVER_CERT</code></a></li><li class="listitem"><span class="strong strong"><strong>Python Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/python/current/configuration.html#config-server-cert" target="_top"><code class="literal">ELASTIC_APM_SERVER_CERT</code></a></li><li class="listitem"><span class="strong strong"><strong>Ruby Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/ruby/current/configuration.html#config-ssl-ca-cert" target="_top"><code class="literal">server_ca_certedit</code></a></li></ul></div><p>Most Agents that don’t allow you specify a custom certificate will allow you to
disable verification of the SSL certificate.
This ensures encryption, but does not verify that you are sending data to the correct APM Server.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="strong strong"><strong>Java Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/java/current/config-reporter.html#config-verify-server-cert" target="_top"><code class="literal">verify_server_cert</code></a></li><li class="listitem"><span class="strong strong"><strong>Node.js Agent</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/nodejs/current/configuration.html#validate-server-cert" target="_top"><code class="literal">verifyServerCert</code></a></li></ul></div></div><div class="navfooter"><span class="prev"><a href="securing-apm-server.html">
              « 
              Securing APM Server</a>
           
        </span><span class="next">
           
          <a href="securing-communication-elasticsearch.html">Secure communication with Elasticsearch
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
