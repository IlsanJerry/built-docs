<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Using Kibana with Shield
        | Shield Reference [2.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Shield Reference [2.1]" /><link rel="up" href="configuring-clients-integrations.html" title="Configuring Clients and Integrations" /><link rel="prev" href="marvel.html" title="Using Marvel with Shield" /><link rel="next" href="license-management.html" title="Managing Your License" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Legacy/Shield/Reference/2.1" /><meta name="DC.subject" content="Shield" /><meta name="DC.identifier" content="2.1" /><meta name="robots" content="noindex,nofollow" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">From version 5.0 onward, Shield is part of X-Pack. For more information, see
<a href=https://www.elastic.co/guide/en/elastic-stack-overview/current/elasticsearch-security.html>
    Securing the Elastic Stack</a>. 
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Shield Reference
      [2.1]
    </a></span> » <span class="breadcrumb-link"><a href="configuring-clients-integrations.html">Configuring Clients and Integrations</a></span> » <span class="breadcrumb-node">Using Kibana with Shield</span></div><div class="navheader"><span class="prev"><a href="marvel.html">
              « 
              Using Marvel with Shield</a>
           
        </span><span class="next">
           
          <a href="license-management.html">Managing Your License
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="kibana"></a>Using Kibana with Shield</h2></div></div></div><p>Shield supports both Kibana 3 and Kibana 4.0 and later. To set things up, you need to update your Kibana configuration and define and assign roles for your Kibana users in Shield. If you’re using Kibana 3, you also need to enable cross-origin resource sharing (CORS) in Elasticsearch.
If you’re using Kibana 4, you need to configure credentials for the Kibana server. The following sections provide step-by-step instructions for using <a class="link" href="kibana.html#using-kibana3-with-shield" title="Using Kibana 3 with Shield">Kibana 3</a> and <a class="link" href="kibana.html#using-kibana4-with-shield" title="Using Kibana 4 with Shield">Kibana 4</a> with Shield.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>With Shield installed, if you load a Kibana dashboard that accesses data in an index that you are not authorized to view, you get an error that indicates the index does not exist. Kibana and Shield do not currently provide a way to control which users can load which dashboards.</p></div></div><h4><a id="using-kibana3-with-shield"></a>Using Kibana 3 with Shield</h4><p>Kibana users have to authenticate when your cluster has Shield installed. You configure Shield roles for your Kibana users to control what data those users can access. In addition, you can encrypt communications between the browser and Elasticsearch.</p><p><a id="cors"></a>To use Kibana 3 with Shield:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Configure Kibana to use credentials when communicating with Elasticsearch. To do this, set <code class="literal">withCredentials</code> to <code class="literal">true</code> in the <code class="literal">elasticsearch</code> property in Kibana’s <code class="literal">config.js</code> file:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">elasticsearch: {server: "http://YOUR_ELASTICSEARCH_SERVER:9200", withCredentials: true}</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If SSL encryption is enabled in Shield, specify the HTTPS protocol in the Elasticsearch URL rather than HTTP.</p></div></div></li><li class="listitem"><p class="simpara">Enable CORS in Elasticsearch and allow credentialed requests. To do this, set the following properties in <code class="literal">elasticsearch.yml</code> on each node in your cluster and restart the nodes:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">http.cors.enabled: true <a id="CO19-1"></a><i class="conum" data-value="1"></i>
http.cors.allow-origin: "https://MYHOST:MYPORT" <a id="CO19-2"></a><i class="conum" data-value="2"></i>
http.cors.allow-credentials: true <a id="CO19-3"></a><i class="conum" data-value="3"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Enables CORS. For more information, see <a class="ulink" href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/modules-http.html" target="_top">HTTP</a> in the Elasticsearch Reference.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Specifies the webserver you are using for Kibana. Note that you must explicitly specify your server’s protocol, hostname, and port—​you cannot simply specify a wildcard <code class="literal">*</code> when using credentialed requests.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Sends authentication headers to the browser.</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If you are using a source build of Kibana 3, you might encounter authentication errors when trying to connect to Kibana 3 after deploying Shield and configuring the <code class="literal">http.cors.allow-credentials</code> property. If you do, simply clear your browser’s cache and reconnect.</p></div></div></li><li class="listitem"><p class="simpara">Derive Kibana 3 user roles from the default <a class="link" href="kibana.html#kibana3-user-role" title="Kibana 3 User Role"><code class="literal">kibana3</code> user role</a> and add them to <code class="literal">roles.yml</code> to control which indices your Kibana users can access. Kibana users need access to the indices that they will be working with and the <code class="literal">kibana-int</code> index where their dashboards are stored.  The default <code class="literal">kibana3</code> role grants read access to all indices and full access to the <code class="literal">kibana-int</code> index.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>We strongly recommend creating custom <code class="literal">kibana3</code> user roles
to limit access to specific indices according to your organization’s goals and policies. You can define as many different roles for your Kibana users as you need.</p></div></div><p class="simpara">To constrain Kibana’s access to specific indices, explicitly specify the index names in your role. When configuring a role for a Kibana user and granting access to a specific index, at a minimum the user needs the following privileges on the index:</p><pre class="screen">indices:admin/mappings/fields/get
indices:admin/validate/query
indices:data/read/search
indices:data/read/msearch
indices:admin/get</pre><p class="simpara">For example, the following <code class="literal">kibana3_monitoring</code> role only allows users to build dashboards using data in the <code class="literal">logstash-*</code> indices.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana3_monitoring:
  cluster:
      - cluster:monitor/nodes/info <a id="CO20-1"></a><i class="conum" data-value="1"></i>
  indices:
    'logstash-*':
      - indices:admin/mappings/fields/get
      - indices:admin/validate/query
      - indices:data/read/search
      - indices:data/read/msearch
      - indices:admin/get
    '.kibana-int': <a id="CO20-2"></a><i class="conum" data-value="2"></i>
      - indices:data/read/get
      - indices:data/read/search
      - indices:data/write/delete
      - indices:data/write/index
      - create_index</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Kibana 3 uses the cluster permission to access the <code class="literal">/_nodes</code> endpoint to check the node version.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>All Kibana users need access to the <code class="literal">kibana-int</code> index.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">Assign the appropriate roles to your Kibana users or groups of users:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">If you’re using the default <code class="literal">esusers</code> realm, you can assign roles when you <a class="link" href="managing-users.html#esusers-add" title="Adding Users">add a user</a>, or modify the role assignments with the <a class="link" href="managing-users.html#esusers-roles" title="Assigning Users to Roles"><code class="literal">roles</code></a> command. For example, the following command creates a user named <code class="literal">jacknich</code> and assigns the <code class="literal">kibana3_monitoring</code> role:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">esusers useradd jacknich -r kibana3_monitoring -p password</pre></div><div class="console_widget" data-snippet="snippets/4.console"></div></li><li class="listitem"><p class="simpara">If you are using an LDAP or Active Directory realm, you can either assign roles on a per user basis, or assign roles to groups of users. By default, role mappings are stored in <a class="link" href="mapping-roles.html" title="Mapping Users and Groups to Roles"><code class="literal">config/shield/role_mapping.yml</code></a>. For example, the following snippet assigns the <code class="literal">kibana3_monitoring</code> role to the group named <code class="literal">admins</code> and the user named Jack Nicholson:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana3_monitoring:
  - "cn=admins,dc=example,dc=com"
  - "cn=Jack Nicholson,dc=example,dc=com"</pre></div></li><li class="listitem"><p class="simpara">If you are using a PKI realm, you assign roles on a per user basis in the role mapping file.
For example, the following snippet assigns the <code class="literal">kibana3_monitoring</code> role to the users named <code class="literal">Jack Nicholson</code> and `Robert De Niro.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana3_monitoring:
  - "cn=Jack Nicholson,ou=example,o=com"
  - "cn=Robert De Niro,ou=example,o=com"</pre></div></li></ul></div></li><li class="listitem">If you have <a class="link" href="ssl-tls.html" title="Setting Up SSL/TLS on a Cluster">enabled SSL encryption</a> in Shield and are using your own Certificate Authority (CA) to sign certificates for your nodes, configure your browser or operating system to trust your CA. When you access Kibana, your browser verifies that the certificate received from the Elasticsearch node is trusted before sending a request to the node. Establishing this trust requires that either your browser or operating system trust the CA that signed the node’s certificate. Consult your local IT professional for information about the recommended procedure for adding trusted CAs in your organization.</li><li class="listitem">Access Kibana 3 from your browser and verify that you can sign in as a user. For example, you could log in as the <code class="literal">jacknich</code> user created in step 4.</li></ol></div><h4><a id="using-kibana4-with-shield"></a>Using Kibana 4 with Shield</h4><p>Kibana users have to authenticate when your cluster has Shield installed. You configure Shield roles for your Kibana users to control what data those users can access. Kibana 4 runs a webserver that makes requests to Elasticsearch on the client’s behalf, so you also need to configure credentials for the Kibana server so those requests can be authenticated. In addition, you can encrypt communications between the Kibana server and Elasticsearch.</p><p>To use Kibana 4 with Shield:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Configure credentials for the Kibana server. The Kibana server needs access to the cluster monitoring APIs and the <code class="literal">.kibana</code> index. The server does <span class="emphasis"><em>not</em></span> need access to user indexes.  The required privileges are specified in the <a class="link" href="kibana.html#kibana4-server-role" title="Kibana 4 Server Role">kibana4_server role</a>  provided in the default Shield <a class="link" href="defining-roles.html" title="Defining Roles"><code class="literal">roles.yml</code></a> file.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">Create a user account for the Kibana server and assign it the <code class="literal">kibana4_server</code> role. For example, if you’re using the default <code class="literal">esusers</code> realm, you can create a <code class="literal">kibana-server</code> user with the <a class="link" href="managing-users.html#esusers-add" title="Adding Users"><code class="literal">useradd</code></a> command:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">esusers useradd kibana4-server -r kibana4_server -p password</pre></div><div class="console_widget" data-snippet="snippets/5.console"></div><p class="simpara">If you are using an LDAP, Active Directory, or PKI realm, you need to create a user for the
Kibana server and map the user’s distinguished name to the <code class="literal">kibana4_server</code> role in the Shield <a class="link" href="mapping-roles.html" title="Mapping Users and Groups to Roles">role mapping</a> file. By default, role mappings are stored in <code class="literal">config/shield/role_mapping.yml</code>. For example, the following snippet assigns the <code class="literal">kibana4_server</code> role to an LDAP or Active Directory user named <code class="literal">kibana-server</code>:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana4_server:
  - "cn=kibana-server,cn=applications,dc=example,dc=com"</pre></div><p class="simpara">For PKI realms, you specify the user’s common name, organizational unit, and organization:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana4_server:
  - "cn=kibana-server,ou=example,o=com"</pre></div></li><li class="listitem"><p class="simpara">Specify the credentials for your Kibana server user in the Kibana configuration
file, <code class="literal">/config/kibana.yml</code>.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">elasticsearch.username: kibana4-server
elasticsearch.password: password</pre></div></li></ol></div></li><li class="listitem"><p class="simpara"><a id="kibana4-roles"></a> Derive Kibana 4 user roles from the default <a class="link" href="kibana.html#kibana4-user-role" title="Kibana 4 User Role"><code class="literal">kibana4</code> user role</a> and add them to <code class="literal">roles.yml</code> to control which indices your Kibana users can access. Kibana users need access to the indices that they will be working with and the <code class="literal">.kibana</code> index where their saved searches, visualizations, and dashboards are stored.  The default <code class="literal">kibana4</code> role grants read access to all indices and full access to the <code class="literal">.kibana</code> index.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>We strongly recommend creating custom <code class="literal">kibana4</code> user roles
to limit access to specific indices according to your organization’s goals and policies. You can define as many different roles for your Kibana 4 users as you need.</p></div></div><p class="simpara">To constrain Kibana’s access to specific indices, explicitly specify the index names in your role. When configuring a role for a Kibana user and granting access to a specific index, at a minimum the user needs the following privileges on the index:</p><pre class="screen">indices:admin/mappings/fields/get
indices:admin/validate/query
indices:data/read/search
indices:data/read/msearch
indices:admin/get</pre><p class="simpara">For example, the following <code class="literal">my_kibana_user</code> role only allows users to discover and visualize data in the <code class="literal">logstash-*</code> indices.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">my_kibana_user:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
  indices:
    'logstash-*':
      - indices:admin/mappings/fields/get
      - indices:admin/validate/query
      - indices:data/read/search
      - indices:data/read/msearch
      - indices:admin/get
    '.kibana': <a id="CO21-1"></a><i class="conum" data-value="1"></i>
      - indices:admin/create
      - indices:admin/exists
      - indices:admin/mapping/put
      - indices:admin/mappings/fields/get
      - indices:admin/refresh
      - indices:admin/validate/query
      - indices:data/read/get
      - indices:data/read/mget
      - indices:data/read/search
      - indices:data/write/delete
      - indices:data/write/index
      - indices:data/write/update</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>All Kibana users need access to the <code class="literal">.kibana</code> index.</p></td></tr></table></div></li><li class="listitem"><p class="simpara">Assign the appropriate roles to your Kibana users or groups of users:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">If you’re using the default <code class="literal">esusers</code> realm, you can assign roles when you <a class="link" href="managing-users.html#esusers-add" title="Adding Users">add a user</a>, or modify the role assignments with the <a class="link" href="managing-users.html#esusers-roles" title="Assigning Users to Roles"><code class="literal">roles</code></a> command. For example, the following command creates a user named <code class="literal">jacknich</code> and assigns the <code class="literal">kibana4_monitoring</code> role:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">esusers useradd jacknich -r kibana4_monitoring -p password</pre></div><div class="console_widget" data-snippet="snippets/6.console"></div></li><li class="listitem"><p class="simpara">If you are using an LDAP or Active Directory realm, you can either assign roles on a per user basis, or assign roles to groups of users. By default, role mappings are stored in <a class="link" href="mapping-roles.html" title="Mapping Users and Groups to Roles"><code class="literal">config/shield/role_mapping.yml</code></a>. For example, the following snippet assigns the <code class="literal">kibana4_monitoring</code> role to the group named <code class="literal">admins</code> and the user named Jack Nicholson:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana4_monitoring:
  - "cn=admins,dc=example,dc=com"
  - "cn=Jack Nicholson,dc=example,dc=com"</pre></div></li><li class="listitem"><p class="simpara">If you are using a PKI realm, you assign roles on a per user basis in the role mapping file.
For example, the following snippet assigns the <code class="literal">kibana4_monitoring</code> role to the users named <code class="literal">Jack Nicholson</code> and <code class="literal">Robert De Niro</code>.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana4_monitoring:
  - "cn=Jack Nicholson,ou=example,o=com"
  - "cn=Robert De Niro,ou=example,o=com"</pre></div></li></ul></div></li><li class="listitem"><p class="simpara">If you have enabled SSL encryption in Shield, configure Kibana 4 to connect to Elasticsearch via HTTPS. To do this:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">Specify the HTTPS protocol in the <code class="literal">elasticsearch.url</code> setting in the Kibana configuration file, <code class="literal">kibana.yml</code>:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">elasticsearch.url: "https://&lt;your_elasticsearch_host&gt;.com:9200"</pre></div></li><li class="listitem"><p class="simpara">If you are using your own CA to sign certificates for Elasticsearch, set the <code class="literal">elasticsearch.ssl.ca</code> setting in <code class="literal">kibana.yml</code> to specify the location of the PEM file.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">elasticsearch.ssl.ca: /path/to/your/cacert.pem</pre></div></li></ol></div></li><li class="listitem"><p class="simpara">Configure Kibana 4 to encrypt communications between the browser and the Kibana server. To do this, configure the <code class="literal">server.ssl.key</code> and <code class="literal">server.ssl.cert</code> properties in <code class="literal">kibana.yml</code>:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">server.ssl.key: /path/to/your/server.key
server.ssl.cert: /path/to/your/server.crt</pre></div><p class="simpara">Once you enable SSL encryption between the browser and the Kibana server, access Kibana via HTTPS. For example, <code class="literal">https://localhost:5601</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Enabling browser encryption is required to prevent passing user credentials in the clear.</p></div></div></li><li class="listitem"><p class="simpara">Restart Kibana and verify that you can sign in as a user. If you are running Kibana locally,
go to <code class="literal">localhost:5601</code> and enter the credentials for a user you’ve assigned a Kibana user role. For example, you could log in as the <code class="literal">jacknich</code> user created in step 3.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Sign in as a Kibana user—​the  Kibana server credentials should only be used internally by the Kibana server. The <code class="literal">kibana4_server</code> role doesn’t grant permission to create the <code class="literal">.kibana</code> index or access user indices.</p></div></div></li></ol></div><h4><a id="default-roles"></a>Default Roles for Kibana</h4><p>Default roles for Kibana 3 and Kibana 4 are provided in <code class="literal">roles.yml</code>.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>The default user roles grant read access to all indices. We strongly recommend deriving custom roles for your Kibana users that limit access to specific indices according to your organization’s goals and policies.</p></div></div><p><a id="kibana3-user-role"></a><strong>Kibana 3 User Role. </strong>
</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana3:
  cluster: cluster:monitor/nodes/info
  indices:
    '*': indices:data/read/search, indices:data/read/get, indices:admin/get
    'kibana-int': indices:data/read/search, indices:data/read/get, indices:data/write/delete, indices:data/write/index, create_index</pre></div><p>
</p><p><a id="kibana4-user-role"></a><strong>Kibana 4 User Role. </strong>
</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana4:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
  indices:
    '*':
      - indices:admin/mappings/fields/get
      - indices:admin/validate/query
      - indices:data/read/search
      - indices:data/read/msearch
      - indices:admin/get
    '.kibana':
      - indices:admin/exists
      - indices:admin/mapping/put
      - indices:admin/mappings/fields/get
      - indices:admin/refresh
      - indices:admin/validate/query
      - indices:data/read/get
      - indices:data/read/mget
      - indices:data/read/search
      - indices:data/write/delete
      - indices:data/write/index
      - indices:data/write/update
      - indices:admin/create</pre></div><p>
</p><p><a id="kibana4-server-role"></a><strong>Kibana 4 Server Role. </strong>
</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">kibana4_server:
  cluster:
      - cluster:monitor/nodes/info
      - cluster:monitor/health
  indices:
    '.kibana':
      - indices:admin/create
      - indices:admin/exists
      - indices:admin/mapping/put
      - indices:admin/mappings/fields/get
      - indices:admin/refresh
      - indices:admin/validate/query
      - indices:data/read/get
      - indices:data/read/mget
      - indices:data/read/search
      - indices:data/write/delete
      - indices:data/write/index
      - indices:data/write/update</pre></div><p>
</p></div><div class="navfooter"><span class="prev"><a href="marvel.html">
              « 
              Using Marvel with Shield</a>
           
        </span><span class="next">
           
          <a href="license-management.html">Managing Your License
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

      </section>
    </div>

    
<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
window.initial_state = {}
</script>

  </body>
</html>
