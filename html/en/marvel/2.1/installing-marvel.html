<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Installing Marvel
        | Marvel Documentation [2.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Marvel Documentation [2.1]" /><link rel="up" href="index.html" title="Marvel Documentation [2.1]" /><link rel="prev" href="getting-started.html" title="Getting Started" /><link rel="next" href="configuration.html" title="Configuring Marvel" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Legacy/Marvel/Reference/2.1" /><meta name="DC.subject" content="Marvel" /><meta name="DC.identifier" content="2.1" /><meta name="robots" content="noindex,nofollow" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">From version 5.0 onward, Marvel is part of X-Pack. For more information, see 
<a href=https://www.elastic.co/guide/en/elastic-stack-overview/current/xpack-monitoring.html>
    Monitoring the Elastic Stack</a>. </div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Marvel Documentation
      [2.1]
    </a></span> » <span class="breadcrumb-node">Installing Marvel</span></div><div class="navheader"><span class="prev"><a href="getting-started.html">
              « 
              Getting Started</a>
           
        </span><span class="next">
           
          <a href="configuration.html">Configuring Marvel
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="installing-marvel"></a>Installing Marvel</h1></div></div></div><p>To use Marvel, you need to install two components:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">An Elasticsearch plugin that collects data from each node in your cluster.
This plugin must be installed on every node.</li><li class="listitem">A Kibana app that provides the Marvel monitoring UI.</li></ul></div><p>By default, the Marvel plugin stores data in the same Elasticsearch cluster
where it is installed. If you are monitoring a production cluster we recommend
that you store the Marvel data in a separate monitoring cluster. Sending the Marvel
data to a monitoring cluster helps ensure that you can continue to monitor your
production cluster if it’s in an unhealthy state.</p><p>For basic installation instructions, see <a class="link" href="getting-started.html" title="Getting Started">Getting Started with Marvel</a>. For
information about storing Marvel data in a separate monitoring cluster, see <a class="link" href="installing-marvel.html#monitoring-cluster" title="Setting up a Separate Monitoring Cluster">Setting up a Separate Monitoring Cluster</a>.</p><h3><a id="marvel-prequisites"></a>Marvel Installation Prerequisites</h3><p>Marvel 2.1.2 requires:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Elasticsearch 2.1.2.</li><li class="listitem">Kibana 4.3.1.</li><li class="listitem">A modern web browser - <a class="ulink" href="http://www.elastic.co/subscriptions/matrix#matrix_browsers" target="_top">Supported
Browsers</a>.</li></ul></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>You must run the version of Marvel that matches the version of Elasticsearch you are running.</p></div></div><h3><a id="package-installation"></a>Installing the Marvel Agent on a DEB/RPM Package Installation</h3><p>If you use the DEB/RPM packages to install Elasticsearch, by default Elasticsearch is installed in
<code class="literal">/usr/share/elasticsearch</code> and the configuration files are stored in <code class="literal">/etc/elasticsearch</code>. (For the
complete list of default paths, see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/setup-dir-layout.html#_deb_and_rpm" target="_top">Directory Layout</a> in
the Elasticsearch Reference.)</p><p>To install the License plugin and Marvel agent on a DEB/RPM package installation, you need to run
<code class="literal">bin/plugin install</code> from the <code class="literal">/usr/share/elasticsearch</code> directory with superuser permissions:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">cd /usr/share/elasticsearch
sudo bin/plugin install license
sudo bin/plugin install marvel-agent</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If the configuration files are not in <code class="literal">/etc/elasticsearch</code> you need to specify the location of
the configuration files by including <code class="literal">-Des.path.conf</code>.</p></div></div><h3><a id="offline-installation"></a>Installing Marvel on Offline Machines</h3><p>The Elasticsearch <code class="literal">bin/plugin</code> script and <code class="literal">bin/kibana plugin</code> require Internet access to
download and install the License and Marvel plugins. If your server doesn’t have Internet access,
you can manually download and install the plugins.</p><p>To install Marvel on a machine that doesn’t have Internet access:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Manually download the License and Marvel binaries:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="ulink" href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.1.2/license-2.1.2.zip" target="_top">
https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/license/2.1.2/license-2.1.2.zip</a></li><li class="listitem"><a class="ulink" href="https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/marvel-agent/2.1.2/marvel-agent-2.1.2.zip" target="_top">https://download.elastic.co/elasticsearch/release/org/elasticsearch/plugin/marvel-agent/2.1.2/marvel-agent-2.1.2.zip</a></li><li class="listitem"><a class="ulink" href="https://download.elasticsearch.org/elasticsearch/marvel/marvel-2.1.2.tar.gz" target="_top">
https://download.elasticsearch.org/elasticsearch/marvel/marvel-2.1.2.tar.gz</a></li></ul></div></li><li class="listitem">Transfer the archive files to the offline machine.</li><li class="listitem"><p class="simpara">Specify the archive files when you run <code class="literal">bin/plugin</code> and <code class="literal">bin/kibana</code>. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/plugin install file:///path/to/file/license-2.1.2.zip
bin/plugin install file:///path/to/file/marvel-agent-2.1.2.zip
bin/kibana plugin --install marvel --url file:///path/to/file/marvel-2.1.2.tar.gz</pre></div></li></ol></div><h3><a id="monitoring-cluster"></a>Setting up a Separate Monitoring Cluster</h3><p>To store Marvel data in a separate monitoring cluster:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Set up the Elasticsearch cluster you want to use for monitoring and start Elasticsearch.
For example, you might set up a two host cluster with the nodes <code class="literal">es-mon-1</code> and <code class="literal">es-mon-2</code>.
You do not need to install the Marvel agent plugin on the nodes in the monitoring cluster, only
on the production nodes you’ll be monitoring. You can configure Shield on your
monitoring cluster to protect your monitoring data. For information about how to
set up Shield, see the <a class="ulink" href="https://www.elastic.co/guide/en/shield/current/getting-started.html" target="_top">Shield Reference</a>.</li><li class="listitem"><p class="simpara">Configure the nodes in your production cluster to send Marvel data to your monitoring cluster by
configuring an HTTP exporter in the <code class="literal">marvel.agent.exporters</code> settings in <code class="literal">elasticsearch.yml</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">marvel.agent.exporters:
  id1:
    type: http
    host: ["http://es-mon-1:9200", "http://es-mon2:9200"]</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If Shield is enabled on the monitoring cluster, you must also configure
credentials for the agent. If SSL is enabled, you must specify the truststore to use to
verify the identity of the nodes in the monitoring cluster. For more information,
see <a class="ulink" href="https://www.elastic.co/guide/en/shield/current/marvel.html" target="_top">Using Marvel with Shield</a>
in the Shield Reference.</p></div></div></li><li class="listitem"><p class="simpara">Install the Marvel agent and License plugins on the nodes in your production cluster:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/plugin install license
bin/plugin install marvel-agent</pre></div></li><li class="listitem"><p class="simpara">Restart Elasticsearch on the nodes in your production cluster</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>You may want to temporarily <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/modules-cluster.html" target="_top">disable shard
allocation</a> before you restart your nodes to avoid unnecessary shard
reallocation during the install process.</p></div></div></li><li class="listitem"><p class="simpara">Install the Marvel app into Kibana.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/kibana plugin --install elasticsearch/marvel/2.1.2</pre></div></li><li class="listitem"><p class="simpara">Configure Kibana to connect to your monitoring cluster by setting the <code class="literal">elasticsearch_url</code>
property in the <code class="literal">kibana.yml</code> configuration file. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">elasticsearch_url: "http://es-mon-1:9200"</pre></div></li><li class="listitem">Start Kibana by running <code class="literal">bin/kibana</code>.</li><li class="listitem"><p class="simpara">To verify your Marvel installation, point your web browser at your Kibana host, click the App Switcher icon in the Kibana menu bar, and select Marvel.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/marvel-app-switcher.jpg" alt="Kibana App Switcher" /></span></p><p class="simpara">Marvel should display a list of the clusters you are monitoring.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/marvel-clusters.jpg" alt="Cluster Overview" /></span></p></li></ol></div><h3><a id="using-marvel-with-shield"></a>Using Marvel with Shield</h3><p>If you are using Shield to secure your Elasticsearch cluster, you need to follow the instructions
in <a class="ulink" href="https://www.elastic.co/guide/en/shield/current/kibana.html#using-kibana4-with-shield" target="_top">Using
Kibana 4 with Shield</a> to set up user authentication and secure communications and then grant your
users the <code class="literal">marvel_users</code> role defined in <code class="literal">roles.yml</code>. If you are using a separate monitoring
cluster, you also need to configure credentials for the Marvel agent installed on each node of
the cluster being monitored. For more information, see <a class="ulink" href="https://www.elastic.co/guide/en/shield/current/marvel.html" target="_top">
Using Marvel with Shield</a> in the Shield Reference.</p><h3><a id="enabling-index-creation"></a>Enabling Marvel to Create Indices</h3><p>Marvel relies on Elasticsearch’s ability to automatically create new indices
when indexing documents. If you have disabled automatic index creation, you
need to configure the <code class="literal">action.auto_create_index</code> setting to allow the
creation of Marvel indices:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">action.auto_create_index: .marvel-*</pre></div><p>For more information see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/2.1/docs-index_.html#index-creation" target="_top">Index Creation</a> in the Elasticsearch
Reference.</p><h3><a id="upgrading"></a>Upgrading Marvel</h3><p>When upgrading Marvel, you must upgrade the Marvel agent on every node you are monitoring. You
do not need to fully shut down your production cluster to perform the upgrade, you
can perform a rolling upgrade.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>You must run the version of Marvel that matches the version of Elasticsearch you are running. For
example, Marvel 2.1.2 requires Elasticsearch 2.1.2.</p></div></div><p>To upgrade Marvel:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Disable shard reallocation on the nodes you are monitoring. While this is optional,
it enables a faster startup after cluster shutdown.  If you don’t disable shard reallocation,
the nodes immediately start trying to replicate shards to each other on startup and spend a
lot of time on wasted I/O. With shard reallocation disabled, the nodes join the cluster
with their indices intact and do not attempt to rebalance. After startup is complete,
you can turn reallocation back on.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">curl -XPUT localhost:9200/_cluster/settings -d '{
  "transient" : {
    "cluster.routing.allocation.enable" : "none"
  }
}'</pre></div></li><li class="listitem"><p class="simpara">Upgrade each node, one at a time:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Stop Elasticsearch.</li><li class="listitem"><p class="simpara">Remove the old version of the Marvel agent from Elasticsearch:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/plugin remove marvel-agent</pre></div></li><li class="listitem"><p class="simpara">Install the latest version of the Marvel agent:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/plugin install marvel-agent</pre></div></li><li class="listitem">If you are upgrading from Marvel 1.x and use a separate monitoring cluster,
update your exporter configuration in <code class="literal">elasticsearch.yml</code>. For more information,
see <a class="link" href="installing-marvel.html#monitoring-cluster" title="Setting up a Separate Monitoring Cluster">Setting up a Separate Monitoring Cluster</a>.</li><li class="listitem">Start Elasticsearch and confirm that the node rejoins the cluster and that there are no errors
in the logs.</li></ol></div></li><li class="listitem"><p class="simpara">When you’ve upgraded all of the nodes in the cluster, reenable shard allocation:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">curl -XPUT localhost:9200/_cluster/settings -d '{
  "transient" : {
      "cluster.routing.allocation.enable" : "all"
  }
}'</pre></div></li><li class="listitem"><p class="simpara">Upgrade the Marvel Kibana app:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Stop Kibana.</li><li class="listitem"><p class="simpara">Remove the old version of the Marvel app:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/kibana plugin --remove marvel</pre></div></li><li class="listitem"><p class="simpara">Install the new version of the Marvel app:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/kibana plugin --install elasticsearch/marvel/2.1.2</pre></div></li><li class="listitem">Restart Kibana by running <code class="literal">bin/kibana</code>.</li></ol></div></li></ol></div><h3><a id="uninstalling-marvel"></a>Uninstalling Marvel</h3><p>To uninstall Marvel:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Shut down Elasticsearch and Kibana.</li><li class="listitem"><p class="simpara">Remove the Marvel agent plugin from Elasticsearch:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">bin/plugin remove marvel-agent</pre></div></li><li class="listitem"><p class="simpara">Remove the Marvel Kibana app:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-shell">bin/kibana plugin --remove marvel</pre></div></li><li class="listitem">Restart Elasticsearch and Kibana.</li></ol></div></div><div class="navfooter"><span class="prev"><a href="getting-started.html">
              « 
              Getting Started</a>
           
        </span><span class="next">
           
          <a href="configuration.html">Configuring Marvel
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
