<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Secure your clusters with SAML
        | Elastic Cloud Enterprise Reference [2.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.2]" /><link rel="up" href="ece-securing-clusters.html" title="Secure your clusters" /><link rel="prev" href="ece-securing-clusters-ldap-ad-5x.html" title="Secure your 5.x and 6.x clusters with LDAP or Active Directory" /><link rel="next" href="ece-manage-kibana.html" title="Manage your Kibana instance" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.2" /><meta name="DC.subject" content="ECE" /><meta name="DC.identifier" content="2.2" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference
      [2.2]
    </a></span> » <span class="breadcrumb-link"><a href="ece-administering-deployments.html">Administering deployments</a></span> » <span class="breadcrumb-link"><a href="ece-securing-clusters.html">Secure your clusters</a></span> » <span class="breadcrumb-node">Secure your clusters with SAML</span></div><div class="navheader"><span class="prev"><a href="ece-securing-clusters-ldap-ad-5x.html">
              « 
              Secure your 5.x and 6.x clusters with LDAP or Active Directory</a>
           
        </span><span class="next">
           
          <a href="ece-manage-kibana.html">Manage your Kibana instance
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ece-securing-clusters-SAML"></a>Secure your clusters with SAML</h2></div></div></div><p>These steps show how you can secure your Elasticsearch clusters and Kibana instances in a deployment by using a Security Assertion Markup Language (SAML) identity provider (IdP) for cross-domain, single sign-on authentication.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The SAML credentials are valid against the deployment, not the ECE platform. You can try out our beta release of <a class="link" href="ece-configure-rbac.html" title="Configure role-based access control">role-based access control</a> for the platform.</p></div></div><h4><a id="ece-before_you_begin_23"></a>Before you begin</h4><p>ECE supports SAML with Elastic Stack version 6.4 and later.</p><p>The steps in this section require an understanding of SAML, specifically the SAML 2.0 Web Browser SSO Profile. To learn more about SAML, see:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Our blog post on <a class="ulink" href="https://www.elastic.co/blog/how-to-enable-saml-authentication-in-kibana-and-elasticsearch" target="_top">how to enable SAML authentication in Kibana and Elasticsearch</a>.
</li><li class="listitem">
Our documentation on  <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/master/saml-guide-authentication.html#saml-guide-authentication" target="_top">configuring Elasticsearch for SAML authentication</a>, especially the details on roles and attribute mappings.
</li></ul></div><h4><a id="ece-configure_your_7_x_cluster_to_use_saml"></a>Configure your 7.x cluster to use SAML</h4><p>You must edit your cluster configuration, sometimes also referred to as the deployment plan, to point to the SAML IdP before you can complete the configuration in Kibana.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Create or use an existing deployment that includes a Kibana instance version 6.4 or later.
</li><li class="listitem">
Copy the Kibana endpoint URL.
</li><li class="listitem"><p class="simpara">
<a id="step-3"></a><a class="link" href="ece-add-user-settings.html" title="Add Elasticsearch user settings">Update your Elasticsearch user settings</a> for the <code class="literal">saml</code> realm and specify your IdP provider configuration:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        saml: <a id="CO24-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
          saml1: <a id="CO24-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            order: 2
            attributes.principal: "nameid:persistent" <a id="CO24-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
            attributes.groups: "groups" <a id="CO24-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            idp.metadata.path: "&lt;check with your idp provider&gt;" <a id="CO24-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
            idp.entity_id: "&lt;check with your idp provider&gt;" <a id="CO24-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
            sp.entity_id: "KIBANA_ENDPOINT_URL/" <a id="CO24-7"></a><span><img src="images/icons/callouts/7.png" alt="" /></span>
            sp.acs: "KIBANA_ENDPOINT_URL/api/security/v1/saml"
            sp.logout: "KIBANA_ENDPOINT_URL/logout"</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Specifies the authentication realm service.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The SAML realm name. Note that <code class="literal">cloud-saml</code> is reserved for internal use only and you cannot use it. Choose a different name, such as the one shown in the example.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Defines the SAML attribute that is going to be mapped to the principal (username) of the authenticated user in Kibana. In this example, <code class="literal">nameid:persistent</code> maps the <code class="literal">NameID</code> with the <code class="literal">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</code> format from the Subject of the SAML Assertion. See <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/master/saml-guide-authentication.html#saml-attribute-mapping" target="_top">the attribute mapping documentation</a>
for details and available options.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Defines the SAML attribute used for role mapping when configured in Kibana. Common choices are <code class="literal">groups</code> or <code class="literal">roles</code>. The values for both <code class="literal">attributes.principal</code> and <code class="literal">attributes.groups</code> depend on the IdP provider, so be sure to review their documentation. See <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/master/saml-guide-authentication.html#saml-attribute-mapping" target="_top">the attribute mapping documentation</a> for details and available options.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The file path or the HTTPS URL where your IdP metadata is available, such as <code class="literal">https://idpurl.com/sso/saml/metadata</code>. If you configure a URL you need to make ensure that your Elasticsearch cluster can access it.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The SAML EntityID of your IdP. This can be read from the configuration page of the IdP, or its SAML metadata, such as <code class="literal">https://idpurl.com/entity_id</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-7"><span><img src="images/icons/callouts/7.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
Replace <code class="literal">KIBANA_ENDPOINT_URL</code> with the one noted in the previous step, such as <code class="literal">sp.entity_id: https://d1a45bf330b74c248d7cc2e0ead8e359.192.168.44.10.ip.es.io:9243/</code>, including the slash at the end.
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
By default, users authenticating via SAML have no roles assigned to them. For example, if you want all your users authenticating with SAML to get access to Kibana, issue the following request to Elasticsearch:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">POST /_xpack/security/role_mapping/SAML1_TO_KIBANAUSER <a id="CO25-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
   "enabled": true,
    "roles": [ "kibana_user" ], <a id="CO25-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "rules": { <a id="CO25-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        "field": { "realm.name": "saml1" }
    },
    "metadata": { "version": 1 }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The mapping name
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The Elastic Stack role to map to
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A rule specifying the SAML role to map from
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
Alternatively, if you want the users that belong to the group <code class="literal">elasticadmins</code> in your identity provider to be assigned the <code class="literal">superuser</code> role in your Elasticsearch cluster, issue the following request to Elasticsearch:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">POST /_xpack/security/role_mapping/SAML1_ELASTICADMIN_TO_SUPERUSER <a id="CO26-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
{
   "enabled": true,
    "roles": [ "superuser" ], <a id="CO26-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
    "rules": { "all" : [ <a id="CO26-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
        { "field": { "realm.name": "saml1" } },
        { "field": { "groups": "elasticadmins" } }
    ]},
    "metadata": { "version": 1 }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The mapping name
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The Elastic Stack role to map to
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
A rule specifying the SAML role to map from
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>In order to use the field <code class="literal">groups</code> in the mapping rule, you need to have mapped the SAML Attribute that conveys the group membership to <code class="literal">attributes.groups</code> in the previous step.</p></div></div></td></tr></table></div></li><li class="listitem"><p class="simpara">
Update Kibana in the
<a class="link" href="ece-manage-kibana-settings.html" title="Add Kibana user settings">user settings configuration</a>
to use SAML as the authentication provider:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">xpack.security.authProviders: [saml]
server.xsrf.whitelist: [/api/security/v1/saml]
xpack.security.public:
  protocol: https
  hostname: d1a45bf330b74c248d7cc2e0ead8e159.192.168.44.10.ip.es.io <a id="CO27-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
  port: 9243</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The hostname from your Kibana endpoint URL
</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>This configuration disables all other realms and only allows users to authenticate with SAML. If you wish to allow your native realm users to authenticate, you need to also enable the <code class="literal">basic</code> <code class="literal">authProvider</code> by setting <code class="literal">xpack.security.authProviders: [saml, basic]</code> in the configuration of Kibana.
You can then access the Kibana login screen at <code class="literal">https://d1a45bf330b74c248d7cc2e0ead8e159.192.168.44.10.ip.es.io:9243/login</code></p></div></div></td></tr></table></div></li><li class="listitem"><p class="simpara">
Optional: If your Identity Provider doesn’t publish its SAML metadata at an http URL, or if your Elasticsearch cluster cannot reach that URL, you can upload the SAML metadata as a file.
</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
Prepare a ZIP file with a
<a class="link" href="ece-add-plugins.html" title="Add plugins">custom bundle</a>
that contains your Identity Provider’s metadata (<code class="literal">metadata.xml</code>) inside of a <code class="literal">saml</code> folder.
</p><p class="simpara">This bundle allows all Elasticsearch containers to access the metadata file.</p></li><li class="listitem"><p class="simpara">
Update your Elasticsearch cluster configuration using the <a class="link" href="ece-advanced-configuration.html" title="Advanced cluster configuration">advanced configuration editor</a> to use the bundle you prepared in the previous step. You need to modify the <code class="literal">user_bundles</code> JSON attribute similar to the following example snippet:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">{
  "cluster_name": "REPLACE_WITH_YOUR_CLUSTER_NAME",
  "plan": {

    ...

    "elasticsearch": {
      "version": "6.4.1",
      "user_bundles": [
        {
          "name": "saml-metadata",
          "url": "https://www.MYURL.com/saml-metadata.zip",
          "elasticsearch_version": "6.4.1"
        }
      ]
    }
  }</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The URLs that point to the ZIP file containing the bundle must be accessible to the deployment.</p></div></div><p class="simpara">Custom bundles are unzipped under the path <code class="literal">/app/config/BUNDLE_DIRECTORY_STRUCTURE</code>, where <code class="literal">BUNDLE_DIRECTORY_STRUCTURE</code> is the directory structure in the ZIP file. Make sure to save the file location where custom bundles get unzipped, as you will need it in the next step.</p><p class="simpara">In our example, the SAML metadata file will be located in the path <code class="literal">/app/config/saml/metadata.xml</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">$ tree .
.
└── saml
      └── metadata.xml</pre></div></li><li class="listitem"><p class="simpara">
Adjust your <code class="literal">saml</code> realm configuration accordingly:
</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">    idp.metadata.path: /app/config/saml/metadata.xml <a id="CO28-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>
The path to the SAML metadata file that was uploaded
</p></td></tr></table></div></li></ol></div></li></ol></div><h3><a id="ece-6x-saml"></a>Configure your 6.x cluster to use SAML</h3><p>For 6.x deployments the configuration is slightly different. For <a class="link" href="ece-securing-clusters-SAML.html#step-3">step 3</a>, you must specify the realm name, then define the realm <code class="literal">type</code> using the following example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        cloud-saml:
          type: saml
            order: 2</pre></div><p>All of the other steps are the same.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ece-sign_outgoing_saml_message"></a>Sign Outgoing SAML Message</h3></div></div></div><p>If configured, Elastic Stack will sign outgoing SAML messages.</p><p>As a prerequisite, you need to generate a signing key and a self-signed
certificate. You need to share this certificate with your SAML Identity Provider
so that it can verify the received messages. The key needs to be unencrypted.
The exact procedure is system dependent, you can use for example <code class="literal">openssl</code></p><p>+</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">openssl req -new -x509 -days 3650 -nodes -sha256 -out saml-sign.crt -keyout saml-sign.key</pre></div><p>+
Place the files under <code class="literal">saml</code> folder and add them to the existing SAML bundle, or
create a new one as described above.</p><p>+
In our example, the certificate and the key will be located in the path
<code class="literal">/app/config/saml/saml-sign.{crt,key}</code>:</p><p>+</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">$ tree .
.
└── saml
    ├── saml-sign.crt
    └── saml-sign.key</pre></div><p>Make sure the bundle is included with your deployment (see above).</p><p>Adjust your realm configuration accordingly:</p><p>+</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">    signing.certificate: /app/config/saml/saml-sign.crt <a id="CO29-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    signing.key: /app/config/saml/saml-sign.key <a id="CO29-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><p>+
&lt;1&gt; The path to the SAML signing certificate that was uploaded.</p><p>+
&lt;2&gt; The path to the SAML signing key that was uploaded.</p><pre class="literallayout"> When configured with a
signing key and certificate, Elastic Stack will sign all outgoing messages (SAML
Authentication Requests, SAML Logout Requests, SAML Logout Responses) by
default. This behavior can be altered by configuring `signing.saml_messages`
appropriately with the comma separated list of messages to sign. Supported
values are `AuthnRequest`, `LogoutRequest` and `LogoutResponse` and the default
value is `*`.</pre><pre class="literallayout">For example</pre><pre class="literallayout">+</pre><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">xpack:
  security:
    authc:
      realms:
        saml1:
          type: saml
          order: 2
          ...
          signing.saml_messages: AuthnRequest <a id="CO29-3"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
          ...</pre></div><p>+
&lt;1&gt; This configuration will ensure that only SAML Authentication Requests will be sent signed to the Identity Provider</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ece-optional_settings"></a>Optional Settings</h3></div></div></div><p>Following optional realm settings are supported:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">force_authn</code> Specifies whether to set the <code class="literal">ForceAuthn</code> attribute when
  requesting that the IdP authenticate the current user. If set to <code class="literal">true</code>, the
  IdP is required to verify the user’s identity, irrespective of any existing
  sessions they might have. Defaults to <code class="literal">false</code>.
</li><li class="listitem">
<code class="literal">idp.use_single_logout</code> Indicates whether to utilise the Identity Provider’s
  <code class="literal">&lt;SingleLogoutService&gt;</code> (if one exists in the IdP metadata file). Defaults to
  <code class="literal">true</code>.
</li></ul></div><p>After completing these steps, you can log into Kibana by authenticating against your SAML IdP. If you encounter any issues with the configuration, please take a look at our [SAML troubleshooting page](<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/current/trb-security-saml.html" target="_top">https://www.elastic.co/guide/en/elastic-stack-overview/current/trb-security-saml.html</a>) which contains information about common issues and suggestions for their resolution.</p></div></div><div class="navfooter"><span class="prev"><a href="ece-securing-clusters-ldap-ad-5x.html">
              « 
              Secure your 5.x and 6.x clusters with LDAP or Active Directory</a>
           
        </span><span class="next">
           
          <a href="ece-manage-kibana.html">Manage your Kibana instance
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
