<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Manage your IP filtering rule sets
        | Elastic Cloud Enterprise Reference [2.1]
      | Elastic
    </title><link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.1]" /><link rel="up" href="ece-securing-ece.html" title="Securing your installation" /><link rel="prev" href="ece-manage-certificates.html" title="Manage security certificates" /><link rel="next" href="ece-retrieve-passwords.html" title="Retrieve user passwords" /><meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.1" /><meta name="DC.subject" content="ECE" /><meta name="DC.identifier" content="2.1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference
      [2.1]
    </a></span> » <span class="breadcrumb-link"><a href="ece-securing-ece.html">Securing your installation</a></span> » <span class="breadcrumb-node">Manage your IP filtering rule sets</span></div><div class="navheader"><span class="prev"><a href="ece-manage-certificates.html">
              « 
              Manage security certificates</a>
           
        </span><span class="next">
           
          <a href="ece-retrieve-passwords.html">Retrieve user passwords
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ece-manage-ip-traffic"></a>Manage your IP filtering rule sets</h2></div></div></div><p>Add another layer of security to your installation and deployments by restricting inbound IP address traffic to <span class="emphasis"><em>only</em></span> the sources that you trust. In the quickly changing world of spoofed IP addresses and security compromises, you can conveniently manage rule sets across multiple deployments with a change at the platform level — saving you time and enforcing more consistent security measures. You can test out rule sets before applying them to production deployments and then quickly add them where needed.</p><p>Elastic Cloud Enterprise supports IP filtering rules with IPv4, IPv6, or a range of addresses with Classless Inter-Domain Routing (CIDR) for HTTP and transport protocols. This feature is available for deployments at version 2.4.6 and newer.</p><p>You can create multiple rule sets; however, traffic is not filtered until the rule set with at least one rule is applied to the deployment. When the first rule is applied, it also enables the implicit Deny All rule for unwanted traffic.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>No need to worry about traffic between the instances in your deployment, that traffic is automatically allowed.</p></div></div><h3><a id="ece-before_you_begin_9"></a>Before you begin</h3><p>You must:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="link" href="ece-manage-elastic-stack.html" title="Manage Elastic Stack versions">Re-upload the Elastic Stack packs</a> to take advantage of IP filtering.
</li><li class="listitem">
Make sure your <a class="link" href="ece-load-balancers.html" title="Load balancers">load balancer</a> handles the <code class="literal">X-Forwarded-For</code> header appropriately for HTTP requests to prevent IP address spoofing. Make sure the proxy protocol is enabled for transport protocol (9343).
</li></ul></div><p>You should also be aware:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
IP filtering can be bypassed by users with permissions to create or modify watches in clusters in the same Elastic Cloud Enterprise environment.
</li><li class="listitem">
In 2.1.1, port 9343 (encrypted transport) traffic all appears to come from the IP address of the load balancer. In order to use IP traffic management, the load balancer must terminate TLS, add the proxy protocol header, and then route traffic to the 9300 port of the proxy.
</li></ul></div><h3><a id="ece-create-rule-set"></a>Create an IP filtering rule set</h3><p>You can combine any rules into a set, so we recommend that you group the rules according to what they allow, and make sure to label them accordingly. Since multiple sets can be applied to a deployment, you can be as granular in your sets as you feel is necessary.</p><p>To create a rule set:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<a class="link" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li><li class="listitem">
From the <span class="strong strong"><strong>Platform</strong></span> menu, select <span class="strong strong"><strong>Security</strong></span>.
</li><li class="listitem">
Create your rule set, providing a meaningful name and description.
</li><li class="listitem"><p class="simpara">
Add one or more rules using IPv4, IPv6, or a range of addresses with CIDR.
</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>DNS names are not supported in rules.</p></div></div></li></ol></div><p>The next step is to <a class="link" href="ece-filter-ip-traffic.html" title="Filter IP traffic">associate one or more rule sets</a> with your deployments.</p><h3><a id="ece-api-rule-set"></a>Use the RESTful API to add multiple rule sets</h3><p>You can add rules and rule sets in bulk through the RESTful API.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Add rule sets:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X POST -u $USERNAME:$PASSWORD<a id="CO9-1"></a><i class="conum" data-value="1"></i> https://$COORDINATOR_HOST<a id="CO9-2"></a><i class="conum" data-value="2"></i>:12443/api/v1/deployments/ip-filtering/rulesets -H 'content-type: application/json' -d '{
  "name": "RULE_SET_NAME<a id="CO9-3"></a><i class="conum" data-value="3"></i>",
  "description": "RULE_SET_DESCRIPTION<a id="CO9-4"></a><i class="conum" data-value="4"></i>",
  "rules": [
    {
      "description": "RULE_DESCRIPTION<a id="CO9-5"></a><i class="conum" data-value="5"></i>",
      "source": "192.0.2.0/241"
    },
    {
      "description": "RULE_DESCRIPTION",
      "source": "203.0.113.0/24"
    }
  ]
}'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">admin</code> user credentials
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
A host that you installed Elastic Cloud Enterprise on that holds the coordinator role, such as a host where you can log into the Cloud UI
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
The name of the rule set, used in the drop-down menu
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>
Details about the rule set (optional)
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-5"><i class="conum" data-value="5"></i></a> </p></td><td valign="top" align="left"><p>
Details about the IP address (optional)
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
Verify the rule sets:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X GET -u $USERNAME:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/deployments/ip-filtering/rulesets</pre></div></li></ol></div><h3><a id="ece-delete-rule-set"></a>Delete a rule set or rules</h3><p>If you need to remove a rule or rule set from the entire platform, you can do so in one place. However, if you need to remove a rule set, you must first remove associations with any deployments.</p><p>To delete a rule:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<a class="link" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.
</li><li class="listitem">
From the <span class="strong strong"><strong>Platform</strong></span> menu, select <span class="strong strong"><strong>Security</strong></span>.
</li><li class="listitem">
Expand the appropriate rule set and delete the rule.
</li></ol></div><p>If there are other rules in the set, the traffic that was allowed by the deleted rule is now blocked.</p><p>To delete a rule set and the rules within it:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<a class="link" href="ece-filter-ip-traffic.html#ece-remove-association" title="Remove an association">Remove any deployment associations</a>.
</li><li class="listitem"><p class="simpara">
Get the rule set ID:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X GET -u $USERNAME:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/deployments/ip-filtering/rulesets</pre></div></li><li class="listitem"><p class="simpara">
With the rule set ID returned from step 2, delete the rule set through the Cloud UI or use the API:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -X DELETE -u $USERNAME:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/deployments/ip-filtering/rulesets/RULE_SET_ID</pre></div></li></ol></div></div><div class="navfooter"><span class="prev"><a href="ece-manage-certificates.html">
              « 
              Manage security certificates</a>
           
        </span><span class="next">
           
          <a href="ece-retrieve-passwords.html">Retrieve user passwords
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
