<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Dipping a toe into platform automation: Generate a roles token
        | Elastic Cloud Enterprise Reference [2.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.3]" /><link rel="up" href="ece-restful-api-examples.html" title="API examples" /><link rel="prev" href="ece-restful-api-examples-add-kibana.html" title="Enable more stack features: Add Kibana to a deployment" /><link rel="next" href="ece-restful-api-examples-customize-deployment.html" title="Customize your deployment" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.3" /><meta name="DC.subject" content="ECE" /><meta name="DC.identifier" content="2.3" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference
      [2.3]
    </a></span> » <span class="breadcrumb-link"><a href="ece-restful-api.html">RESTful API</a></span> » <span class="breadcrumb-link"><a href="ece-restful-api-examples.html">API examples</a></span> » <span class="breadcrumb-node">Dipping a toe into platform automation: Generate a roles token</span></div><div class="navheader"><span class="prev"><a href="ece-restful-api-examples-add-kibana.html">
              « 
              Enable more stack features: Add Kibana to a deployment</a>
           
        </span><span class="next">
           
          <a href="ece-restful-api-examples-customize-deployment.html">Customize your deployment
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ece-restful-api-examples-generate-roles-token"></a>Dipping a toe into platform automation: Generate a roles token</h2></div></div></div><p>When you install Elastic Cloud Enterprise on additional hosts, you must specify a valid roles token. This requirement is a security feature designed to prevent unauthorized hosts from joining your ECE installation. In this example, we show how you can generate a roles token for allocators and use it to install ECE on an additional host.</p><h4><a id="ece-before_you_begin_29"></a>Before you begin</h4><p>To make it easier to use roles tokens, you automatically get several tokens after installation on the first host. If you revoke these tokens or no longer have access to them, you can use the RESTful API to generate a new token. With the new token, you can install ECE on additional hosts and add the right roles at the same time.</p><p>Additional documentation for roles tokens is available, including information on generating ephemeral tokens that expire after a set period. To learn more about how the process works, see <a class="link" href="ece-generate-roles-token.html" title="Generate roles tokens">Generate Roles Tokens</a>.</p><h4><a id="ece-steps_10"></a>Steps</h4><p>To generate a roles token:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Create a persistent token that can be used to assign the allocator role to hosts you install ECE on:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -k -H 'Content-Type: application/json' -u $USER<a id="CO52-1"></a><i class="conum" data-value="1"></i>:$PASSWORD<a id="CO52-2"></a><i class="conum" data-value="2"></i> https://$COORDINATOR_HOST<a id="CO52-3"></a><i class="conum" data-value="3"></i>:12443/api/v1/platform/configuration/security/enrollment-tokens -d '{ "persistent": true, "roles": [ "allocator"] }'
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI3YTRkYjVhMC1kMDViLTQzZjctODRhMy1jZGRiODFmNTI1NGYiLCJyb2xlcyI6WyJhbGxvY2F0b3IiXSwiaXNzIjoiY3VycmVudCIsInBlcnNpc3RlbnQiOnRydWV9.L4jb_2U26IjvxLtVjlYYAjCZDrokd14o9dFOb--9wlQ",
  "token_id": "7a4db5a0-d05b-43f7-84a3-cddb81f5254f"
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO52-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
A user with sufficient privileges, such as the <code class="literal">admin</code> user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO52-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
The password for the user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO52-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
A host that you installed Elastic Cloud Enterprise on that holds the coordinator role
</p></td></tr></table></div><p class="simpara">You are shown the new generated token only once, so make sure you keep it somewhere safe.</p></li><li class="listitem"><p class="simpara">
When installing ECE on the additional host, include the token and specify the allocator role:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">bash elastic-cloud-enterprise.sh install --coordinator-host COORDINATOR_HOST --roles-token 'ROLES_TOKEN'<a id="CO53-1"></a><i class="conum" data-value="1"></i> --roles "allocator"</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO53-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
The roles token you generated in Step 1
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
After installation completes, you can use the new host’s IP address, here <code class="literal">192.168.40.79</code>, to verify through the RESTful API that the new allocator is available (some output was omitted for brevity):
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -k -X GET -u $USER:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/platform/infrastructure/allocators
{
  "zones": [{
    ...
    "zone_id": "ece-region-1b",
    "allocators": [{
      "public_hostname": "192.168.40.79",
      "instances": [],
      "status": {
        "connected": true
      },
      "host_ip": "192.168.40.79",
      "allocator_id": "192.168.40.79",
      "capacity": {
        "memory": {
          "total": 12398,
          "used": 0
        }
      }
    }]
  }]
}</pre></div><p class="simpara">Alternatively, you can also check in the Cloud UI that the new allocator is available.</p></li></ol></div></div><div class="navfooter"><span class="prev"><a href="ece-restful-api-examples-add-kibana.html">
              « 
              Enable more stack features: Add Kibana to a deployment</a>
           
        </span><span class="next">
           
          <a href="ece-restful-api-examples-customize-deployment.html">Customize your deployment
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>
      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>

<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
