<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Applying a new plan: Resize and add high availability
        | Elastic Cloud Enterprise Reference [2.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.3]" /><link rel="up" href="ece-restful-api-examples.html" title="API examples" /><link rel="prev" href="ece-restful-api-examples-create-deployment-with-kibana.html" title="Create a Deployment: Elasticsearch Cluster and Kibana instance" /><link rel="next" href="ece-restful-api-examples-progress-checking.html" title="Applying a new plan: Checking on progress" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.3" /><meta name="DC.subject" content="ECE" /><meta name="DC.identifier" content="2.3" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference
      [2.3]
    </a></span> » <span class="breadcrumb-link"><a href="ece-restful-api.html">RESTful API</a></span> » <span class="breadcrumb-link"><a href="ece-restful-api-examples.html">API examples</a></span> » <span class="breadcrumb-node">Applying a new plan: Resize and add high availability</span></div><div class="navheader"><span class="prev"><a href="ece-restful-api-examples-create-deployment-with-kibana.html">
              « 
              Create a Deployment: Elasticsearch Cluster and Kibana instance</a>
           
        </span><span class="next">
           
          <a href="ece-restful-api-examples-progress-checking.html">Applying a new plan: Checking on progress
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ece-restful-api-examples-resize-and-ha"></a>Applying a new plan: Resize and add high availability</h2></div></div></div><p>In an earlier example, we created a simple deployment called <code class="literal">My First Deployment</code> that included only a small Elasticsearch cluster with a single node in a single availability zone. This Elasticsearch cluster in our deployment is very small with only 1024 MB of RAM. Any serious indexing activity will likely require more capacity, so let’s change <code class="literal">memory_per_node</code> to <code class="literal">4096</code>. To make the cluster in our deployment highly available, let’s also change the value of <code class="literal">zone_count</code> to <code class="literal">3</code>, which will create Elasticsearch nodes across three availability zones.</p><h4><a id="ece-before_you_begin_26"></a>Before you begin</h4><p>This example requires a deployment with an Elasticsearch cluster to work with that is not being used for anything important. If you don’t already have one, you can follow <a class="link" href="ece-restful-api-examples-create-deployment.html" title="Create a first deployment: Just an Elasticsearch cluster">our <code class="literal">My First Deployment</code> example</a> to create one.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>To make the cluster highly available, your Elastic Cloud Enterprise installation must include more than one availability zone, which is something you control with the <code class="literal">--availability-zone</code> parameter when you install Elastic Cloud Enterprise on additional hosts. If you don’t have additional availability zones to work with, you can perform just a resize operation.</p></div></div><h4><a id="ece-steps_7"></a>Steps</h4><p>To resize a deployment and add high availability:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
Obtain the existing configuration plan for <code class="literal">My First Deployment</code> and save the output to a file, here <code class="literal">my-first-deployment.json</code>:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -k -X GET -u $USER<a id="CO46-1"></a><i class="conum" data-value="1"></i>:$PASSWORD<a id="CO46-2"></a><i class="conum" data-value="2"></i> https://$COORDINATOR_HOST<a id="CO46-3"></a><i class="conum" data-value="3"></i>:12443/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID<a id="CO46-4"></a><i class="conum" data-value="4"></i>/plan &gt;my-first-deployment.json</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
A user with sufficient privileges, such as the <code class="literal">admin</code> user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
The password for the user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
A host that you installed Elastic Cloud Enterprise on that holds the coordinator role
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>
The Elasticsearch cluster ID as shown in the Cloud UI or obtained via the API
</p></td></tr></table></div></li><li class="listitem"><p class="simpara">
Edit the <code class="literal">my-first-deployment.json</code> file in your favorite editor and change the value of <code class="literal">memory_per_node</code> to <code class="literal">4096</code> and the value of <code class="literal">zone_count</code> to <code class="literal">3</code>:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">{
  "cluster_topology": [
      {
          "node_type": {
              "data": true,
              "master": true,
              "ingest": true
          },
          "instance_configuration_id": "data.default",
          "zone_count": 3,
          "size": {
              "resource": "memory",
              "value": 4096
          }
      }
  ],
  "elasticsearch": {
      "version": "6.5.4"
  }
}</pre></div></li><li class="listitem"><p class="simpara">
Apply the updated cluster configuration to the deployment with a POST request:
</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">curl -k -X POST -u $USER:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/plan -H 'content-type: application/json' -d @my-first-deployment.json</pre></div></li></ol></div><p>After the plan gets applied successfully, the Elasticsearch cluster in your deployment provides 4096 MB of memory and is highly available, which you can verify by checking in the Cloud UI or performing another GET request on the <code class="literal">/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/plan</code> endpoint.</p></div><div class="navfooter"><span class="prev"><a href="ece-restful-api-examples-create-deployment-with-kibana.html">
              « 
              Create a Deployment: Elasticsearch Cluster and Kibana instance</a>
           
        </span><span class="next">
           
          <a href="ece-restful-api-examples-progress-checking.html">Applying a new plan: Checking on progress
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>
      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>

<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
