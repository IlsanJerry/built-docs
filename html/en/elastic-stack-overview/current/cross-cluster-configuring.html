<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cross cluster search and security
        | Elastic Stack Overview [7.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [7.3]" /><link rel="up" href="ccs-clients-integrations.html" title="Cross cluster search, clients, and integrations" /><link rel="prev" href="ccs-clients-integrations.html" title="Cross cluster search, clients, and integrations" /><link rel="next" href="java-clients.html" title="Java Client and security" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/7.3" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="7.3" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [7.3]
    </a></span> » <span class="breadcrumb-link"><a href="elasticsearch-security.html">Securing the Elastic Stack</a></span> » <span class="breadcrumb-link"><a href="ccs-clients-integrations.html">Cross cluster search, clients, and integrations</a></span> » <span class="breadcrumb-node">Cross cluster search and security</span></div><div class="navheader"><span class="prev"><a href="ccs-clients-integrations.html">
              « 
              Cross cluster search, clients, and integrations</a>
           
        </span><span class="next">
           
          <a href="java-clients.html">Java Client and security
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="cross-cluster-configuring"></a>Cross cluster search and security<a href="https://github.com/elastic/elasticsearch/edit/7.3/x-pack/docs/en/security/ccs-clients-integrations/cross-cluster.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/modules-cross-cluster-search.html" target="_top">Cross cluster search</a> enables
federated search across multiple clusters. When using cross cluster search
with secured clusters, all clusters must have the Elasticsearch security features
enabled.</p><p>The local cluster (the cluster used to initiate cross cluster search) must be
allowed to connect to the remote clusters, which means that the CA used to
sign the SSL/TLS key of the local cluster must be trusted by the remote
clusters.</p><p>User authentication is performed on the local cluster and the user and user’s
roles are passed to the remote clusters. A remote cluster checks the user’s
roles against its local role definitions to determine which indices the user
is allowed to access.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This feature was added as Beta in Elasticsearch <code class="literal">v5.3</code> with further improvements made in
5.4 and 5.5. It requires gateway eligible nodes to be on <code class="literal">v5.5</code> onwards.</p></div></div><p>To use cross cluster search with secured clusters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Enable the Elasticsearch security features on every node in each connected cluster.
For more information about the <code class="literal">xpack.security.enabled</code> setting, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/security-settings.html" target="_top">Security Settings in Elasticsearch</a>.</li><li class="listitem">Enable encryption globally. To encrypt communications, you must enable
<a class="link" href="ssl-tls.html" title="Setting up TLS on a cluster">enable SSL/TLS</a> on every node.</li><li class="listitem"><p class="simpara">Enable a trust relationship between the cluster used for performing cross
cluster search (the local cluster) and all remote clusters.  This can be done
either by:</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">Using the same certificate authority to generate certificates for all
connected clusters, or</li><li class="listitem">Adding the CA certificate from the local cluster as a trusted CA in
each remote cluster (see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/security-settings.html#transport-tls-ssl-settings" target="_top">Transport TLS settings</a>).</li></ul></div></li><li class="listitem"><p class="simpara">Configure the local cluster to connect to remote clusters as described
in <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/modules-remote-clusters.html#configuring-remote-clusters" target="_top">Configuring Remote Clusters</a>.
For example, the following configuration adds two remote clusters
to the local cluster:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "cluster_one": {
          "seeds": [ "10.0.1.1:9300" ]
        },
        "cluster_two": {
          "seeds": [ "10.0.2.1:9300" ]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/33.console"></div></li><li class="listitem">On the local cluster, ensure that users are assigned to (at least) one role
that exists on the remote clusters.  On the remote clusters, use that role
to define which indices the user may access.  (See <a class="xref" href="authorization.html" title="User authorization"><em>User authorization</em></a>).</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_configuration_of_cross_cluster_search"></a>Example Configuration of Cross Cluster Search<a href="https://github.com/elastic/elasticsearch/edit/7.3/x-pack/docs/en/security/ccs-clients-integrations/cross-cluster.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In the following example, we will configure the user <code class="literal">alice</code> to have permissions
to search any index starting with <code class="literal">logs-</code> in cluster <code class="literal">two</code> from cluster <code class="literal">one</code>.</p><p>First, enable cluster <code class="literal">one</code> to perform cross cluster search on remote cluster
<code class="literal">two</code> by running the following request as the superuser on cluster <code class="literal">one</code>:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "cluster.remote.cluster_two.seeds": [ "10.0.2.1:9300" ]
  }
}</pre></div><div class="console_widget" data-snippet="snippets/34.console"></div><p>Next, set up a role called <code class="literal">cluster_two_logs</code> on both cluster <code class="literal">one</code> and
cluster <code class="literal">two</code>.</p><p>On cluster <code class="literal">one</code>, this role does not need any special privileges:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST /_security/role/cluster_two_logs
{
}</pre></div><div class="console_widget" data-snippet="snippets/35.console"></div><p>On cluster <code class="literal">two</code>, this role allows the user to query local indices called
<code class="literal">logs-</code> from a remote cluster:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST /_security/role/cluster_two_logs
{
  "cluster": [],
  "indices": [
    {
      "names": [
        "logs-*"
      ],
      "privileges": [
        "read",
        "read_cross_cluster"
      ]
    }
  ]
}</pre></div><div class="console_widget" data-snippet="snippets/36.console"></div><p>Finally, create a user on cluster <code class="literal">one</code> and apply the <code class="literal">cluster_two_logs</code> role:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST /_security/user/alice
{
  "password" : "somepassword",
  "roles" : [ "cluster_two_logs" ],
  "full_name" : "Alice",
  "email" : "alice@example.com",
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/37.console"></div><p>With all of the above setup, the user <code class="literal">alice</code> is able to search indices in
cluster <code class="literal">two</code> as follows:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET two:logs-2017.04/_search <a id="CO7-1"></a><i class="conum" data-value="1"></i>
{
  "query": {
    "match_all": {}
  }
}</pre></div><div class="console_widget" data-snippet="snippets/38.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="cross-cluster-kibana"></a>Cross-cluster search and Kibana<a href="https://github.com/elastic/kibana/edit/7.3/docs/security/cross-cluster-kibana.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When Kibana is used to search across multiple clusters, a two-step authorization
process determines whether or not the user can access indices on a remote
cluster:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">First, the local cluster determines if the user is authorized to access remote
clusters. (The local cluster is the cluster Kibana is connected to.)</li><li class="listitem">If they are, the remote cluster then determines if the user has access
to the specified indices.</li></ul></div><p>To grant Kibana users access to remote clusters, assign them a local role
with read privileges to indices on the remote clusters. You specify remote
cluster indices as <code class="literal">&lt;remote_cluster_name&gt;:&lt;index_name&gt;</code>.</p><p>To enable users to actually read the remote indices, you must create a matching
role on the remote clusters that grants the <code class="literal">read_cross_cluster</code> privilege
and access to the appropriate indices.</p><p>For example, if Kibana is connected to the cluster where you’re actively
indexing Logstash data (your <span class="emphasis"><em>local cluster</em></span>) and you’re periodically
offloading older time-based indices to an archive cluster
(your <span class="emphasis"><em>remote cluster</em></span>) and you want to enable Kibana users to search both
clusters:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">On the local cluster, create a <code class="literal">logstash_reader</code> role that grants
<code class="literal">read</code> and <code class="literal">view_index_metadata</code> privileges on the local <code class="literal">logstash-*</code> indices.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If you configure the local cluster as another remote in Elasticsearch, the
<code class="literal">logstash_reader</code> role on your local cluster also needs to grant the
<code class="literal">read_cross_cluster</code> privilege.</p></div></div></li><li class="listitem">Assign your Kibana users the <code class="literal">kibana_user</code> role and your <code class="literal">logstash_reader</code>
role.</li><li class="listitem">On the remote cluster, create a <code class="literal">logstash_reader</code> role that grants the
<code class="literal">read_cross_cluster</code> privilege and <code class="literal">read</code> and <code class="literal">view_index_metadata</code> privileges
for the <code class="literal">logstash-*</code> indices.</li></ol></div></div></div><div class="navfooter"><span class="prev"><a href="ccs-clients-integrations.html">
              « 
              Cross cluster search, clients, and integrations</a>
           
        </span><span class="next">
           
          <a href="java-clients.html">Java Client and security
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>
      </section>
    </div>

    
<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
window.initial_state = {}
</script>

  </body>
</html>
