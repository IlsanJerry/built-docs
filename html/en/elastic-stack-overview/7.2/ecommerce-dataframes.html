<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Transforming the eCommerce sample data
        | Elastic Stack Overview [7.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [7.2]" /><link rel="up" href="dataframe-examples.html" title="Data frame transform examples" /><link rel="prev" href="dataframe-examples.html" title="Data frame transform examples" /><link rel="next" href="example-best-customers.html" title="Finding your best customers" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/7.2" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="7.2" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [7.2]
    </a></span> » <span class="breadcrumb-link"><a href="ml-dataframes.html">Data frame transforms</a></span> » <span class="breadcrumb-link"><a href="dataframe-examples.html">Data frame transform examples</a></span> » <span class="breadcrumb-node">Transforming the eCommerce sample data</span></div><div class="navheader"><span class="prev"><a href="dataframe-examples.html">
              « 
              Data frame transform examples</a>
           
        </span><span class="next">
           
          <a href="example-best-customers.html">Finding your best customers
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="ecommerce-dataframes"></a>Transforming the eCommerce sample data<a href="https://github.com/elastic/stack-docs/edit/7.2/docs/en/stack/data-frames/ecommerce-example.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p></div></div><p><a class="link" href="ml-dataframes.html" title="Data frame transforms">Data frame transforms</a> enable you to retrieve information
from an Elasticsearch index, transform it, and store it in another index. Let’s use the
<a class="ulink" href="https://www.elastic.co/guide/en/kibana/7.2/add-sample-data.html" target="_top">Kibana sample data</a> to demonstrate how you can
pivot and summarize your data with data frame transforms.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">If the Elasticsearch security features are enabled, obtain a user ID with sufficient
privileges to complete these steps.</p><p class="simpara">You need <code class="literal">manage_data_frame_transforms</code> cluster privileges to preview and create
data frame transforms. Members of the built-in <code class="literal">data_frame_transforms_admin</code>
role have these privileges.</p><p class="simpara">You also need <code class="literal">read</code> and <code class="literal">view_index_metadata</code> index privileges on the source
index and <code class="literal">read</code>, <code class="literal">create_index</code>, and <code class="literal">index</code> privileges on the destination
index.</p><p class="simpara">For more information, see <a class="xref" href="security-privileges.html" title="Security privileges">Security privileges</a> and <a class="xref" href="built-in-roles.html" title="Built-in roles">Built-in roles</a>.</p></li><li class="listitem"><p class="simpara">Choose your <span class="emphasis"><em>source index</em></span>.</p><p class="simpara">In this example, we’ll use the eCommerce orders sample data. If you’re not
already familiar with the <code class="literal">kibana_sample_data_ecommerce</code> index, use the
<span class="strong strong"><strong>Revenue</strong></span> dashboard in Kibana to explore the data. Consider what insights you
might want to derive from this eCommerce data.</p></li><li class="listitem"><p class="simpara">Play with various options for grouping and aggregating the data.</p><p class="simpara">For example, you might want to group the data by product ID and calculate the
total number of sales for each product and its average price. Alternatively, you
might want to look at the behavior of individual customers and calculate how
much each customer spent in total and how many different categories of products
they purchased. Or you might want to take the currencies or geographies into
consideration. What are the most interesting ways you can transform and
interpret this data?</p><p class="simpara"><span class="emphasis"><em>Pivoting</em></span> your data involves using at least one field to group it and applying
at least one aggregation. You can preview what the transformed data will look
like, so go ahead and play with it!</p><p class="simpara">For example, go to <span class="strong strong"><strong>Machine Learning</strong></span> &gt; <span class="strong strong"><strong>Data Frames</strong></span> in Kibana and use the
wizard to create a data frame:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ecommerce-pivot1.jpg" alt="Creating a simple data frame in Kibana" /></div></div><p class="simpara">In this case, we grouped the data by customer ID and calculated the sum of
products each customer purchased.</p><p class="simpara">Let’s add some more aggregations to learn more about our customers' orders. For
example, let’s calculate the total sum of their purchases, the maximum number of
products that they purchased in a single order, and their total number of orders.
We’ll accomplish this by using the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/search-aggregations-metrics-sum-aggregation.html" target="_top"><code class="literal">sum</code> aggregation</a> on the
<code class="literal">taxless_total_price</code> field, the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/search-aggregations-metrics-max-aggregation.html" target="_top"><code class="literal">max</code> aggregation</a> on the
<code class="literal">total_quantity</code> field, and the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/search-aggregations-metrics-cardinality-aggregation.html" target="_top"><code class="literal">cardinality</code> aggregation</a>
on the <code class="literal">order_id</code> field:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ecommerce-pivot2.jpg" alt="Adding multiple aggregations to a data frame in Kibana" /></div></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>If you’re interested in a subset of the data, you can optionally include a
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/search-request-query.html" target="_top">query</a> element. In this example, we’ve filtered
the data so that we’re only looking at orders with a <code class="literal">currency</code> of <code class="literal">EUR</code>.
Alternatively, we could group the data by that field too. If you want to use
more complex queries, you can create your data frame from a
<a class="ulink" href="https://www.elastic.co/guide/en/kibana/7.2/save-open-search.html" target="_top">saved search</a>.</p></div></div><p class="simpara">If you prefer, you can use the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/preview-data-frame-transform.html" target="_top">preview data frame transforms API</a>:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST _data_frame/transforms/_preview
{
  "source": {
    "index": "kibana_sample_data_ecommerce",
    "query": {
      "bool": {
        "filter": {
          "term": {"currency": "EUR"}
        }
      }
    }
  },
  "pivot": {
    "group_by": {
      "customer_id": {
        "terms": {
          "field": "customer_id"
        }
      }
    },
    "aggregations": {
      "total_quantity.sum": {
        "sum": {
          "field": "total_quantity"
        }
      },
      "taxless_total_price.sum": {
        "sum": {
          "field": "taxless_total_price"
        }
      },
      "total_quantity.max": {
        "max": {
          "field": "total_quantity"
        }
      },
      "order_id.cardinality": {
        "cardinality": {
          "field": "order_id"
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/109.console"></div></li><li class="listitem"><p class="simpara">When you are satisfied with what you see in the preview, create the
data frame transform.</p><p class="simpara">Supply a job ID and the name of the target (or <span class="emphasis"><em>destination</em></span>) index. In Kibana,
you can choose to create and start the job, create it, or copy it to the
clipboard.</p><p class="simpara">If you prefer, you can use the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/put-data-frame-transform.html" target="_top">create data frame transforms API</a>. For
example:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _data_frame/transforms/ecommerce-customer-transform
{
  "source": {
    "index": [
      "kibana_sample_data_ecommerce"
    ],
    "query": {
      "bool": {
        "filter": {
          "term": {
            "currency": "EUR"
          }
        }
      }
    }
  },
  "dest": {
    "index": "ecommerce-customers"
  },
  "pivot": {
    "group_by": {
      "customer_id": {
        "terms": {
          "field": "customer_id"
        }
      }
    },
    "aggregations": {
      "total_quantity.sum": {
        "sum": {
          "field": "total_quantity"
        }
      },
      "taxless_total_price.sum": {
        "sum": {
          "field": "taxless_total_price"
        }
      },
      "total_quantity.max": {
        "max": {
          "field": "total_quantity"
        }
      },
      "order_id.cardinality": {
        "cardinality": {
          "field": "order_id"
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/110.console"></div></li><li class="listitem"><p class="simpara">Start the data frame transform.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Even though resource utilization is automatically adjusted based on the
cluster load, a data frame transform increases search and indexing load on your
cluster while it runs. When it reaches the end of the data in your index, it
stops automatically. If you’re experiencing an excessive load, however, you can
stop it sooner.</p></div></div><p class="simpara">You can start, stop, and manage data frame jobs in Kibana:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/dataframe-jobs.jpg" alt="Managing data frame jobs in Kibana" /></div></div><p class="simpara">Alternatively, you can use the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/start-data-frame-transform.html" target="_top">start data frame transforms</a> and
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/stop-data-frame-transform.html" target="_top">stop data frame transforms</a> APIs. For
example:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST _data_frame/transforms/ecommerce-customer-transform/_start</pre></div><div class="console_widget" data-snippet="snippets/111.console"></div></li><li class="listitem"><p class="simpara">Explore the data in your new index.</p><p class="simpara">For example, use the <span class="strong strong"><strong>Discover</strong></span> application in Kibana:</p><div class="screenshot informalfigure"><div class="mediaobject"><img src="images/ecommerce-results.jpg" alt="Exploring the new index in Kibana" /></div></div></li></ol></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>If you do not want to keep the data frame transform, you can delete it in
Kibana or use the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/delete-data-frame-transform.html" target="_top">delete data frame transform API</a>. When
you delete a data frame transform, its destination index remains.</p></div></div></div><div class="navfooter"><span class="prev"><a href="dataframe-examples.html">
              « 
              Data frame transform examples</a>
           
        </span><span class="next">
           
          <a href="example-best-customers.html">Finding your best customers
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>
      </section>
    </div>

    
<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>

<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
