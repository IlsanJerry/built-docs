<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Sorting by Distance
        | Elasticsearch: The Definitive Guide [master]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [master]" /><link rel="up" href="geopoints.html" title="Geo Points" /><link rel="prev" href="geo-distance.html" title="Geo Distance Filter" /><link rel="next" href="geohashes.html" title="Geohashes" /><meta name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" /><meta name="robots" content="noindex,nofollow" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">This information may not apply to the latest version of Elasticsearch.
For the most up to date information, see the current version of the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">
Elasticsearch Reference</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="geoloc.html">Geolocation</a></span> » <span class="breadcrumb-link"><a href="geopoints.html">Geo Points</a></span> » <span class="breadcrumb-node">Sorting by Distance</span></div><div class="navheader"><span class="prev"><a href="geo-distance.html">
              « 
              Geo Distance Filter</a>
           
        </span><span class="next">
           
          <a href="geohashes.html">Geohashes
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="sorting-by-distance"></a>Sorting by Distance<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/310_Geopoints/50_Sorting_by_distance.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Search results can be sorted by distance<a id="id-1.8.3.9.2.1" class="indexterm"></a>
<a id="id-1.8.3.9.2.2" class="indexterm"></a><a id="id-1.8.3.9.2.3" class="indexterm"></a>
<a id="id-1.8.3.9.2.4" class="indexterm"></a><a id="id-1.8.3.9.2.5" class="indexterm"></a>
<a id="id-1.8.3.9.2.6" class="indexterm"></a> from a point:</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>While you <span class="emphasis"><em>can</em></span> sort by distance, <a class="xref" href="sorting-by-distance.html#scoring-by-distance" title="Scoring by Distance">Scoring by Distance</a> is usually a
better solution.</p></div></div><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">GET /attractions/restaurant/_search
{
  "query": {
    "filtered": {
      "filter": {
        "geo_bounding_box": {
          "type":       "indexed",
          "location": {
            "top_left": {
              "lat":  40.8,
              "lon": -74.0
            },
            "bottom_right": {
              "lat":  40.4,
              "lon": -73.0
            }
          }
        }
      }
    }
  },
  "sort": [
    {
      "_geo_distance": {
        "location": { <a id="CO234-1"></a><i class="conum" data-value="1"></i>
          "lat":  40.715,
          "lon": -73.998
        },
        "order":         "asc",
        "unit":          "km", <a id="CO234-2"></a><i class="conum" data-value="2"></i>
        "distance_type": "plane" <a id="CO234-3"></a><i class="conum" data-value="3"></i>
      }
    }
  ]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO234-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
Calculate the distance between the specified <code class="literal">lat/lon</code> point and the
    geo-point in the <code class="literal">location</code> field of each document.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO234-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
Return the distance in <code class="literal">km</code> in the <code class="literal">sort</code> keys for each result.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO234-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
Use the faster but less accurate <code class="literal">plane</code> calculation.
</p></td></tr></table></div><p>You may ask yourself: why do we specify the distance <code class="literal">unit</code>? For sorting, it
doesn’t matter whether we compare distances in miles, kilometers, or light
years.  The reason is that the actual value used for sorting is returned with
each result, in the <code class="literal">sort</code> element:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">...
  "hits": [
     {
        "_index": "attractions",
        "_type": "restaurant",
        "_id": "2",
        "_score": null,
        "_source": {
           "name": "New Malaysia",
           "location": {
              "lat": 40.715,
              "lon": -73.997
           }
        },
        "sort": [
           0.08425653647614346 <a id="CO235-1"></a><i class="conum" data-value="1"></i>
        ]
     },
...</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO235-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
This restaurant is 0.084km from the location we specified.
</p></td></tr></table></div><p>You can set the <code class="literal">unit</code> to return these values in whatever form makes sense for
your application.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Geo-distance sorting can also handle multiple geo-points, both in the document
and in the sort parameters.  Use the <code class="literal">sort_mode</code> to specify whether it should
use the <code class="literal">min</code>, <code class="literal">max</code>, or <code class="literal">avg</code> distance between each combination of locations.
This can be used to return “friends nearest to my work and home locations.”</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="scoring-by-distance"></a>Scoring by Distance<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/310_Geopoints/50_Sorting_by_distance.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It may be that distance is the only important factor in deciding the order in
which results are returned, but more frequently we need to combine distance
with other factors, such as full-text relevance, popularity, and price.</p><p>In these situations, we should reach for the
<a class="link" href="function-score-query.html" title="function_score Query"><code class="literal">function_score</code> query</a> that allows us to blend all
of these factors into an overall score.  See <a class="xref" href="decay-functions.html" title="The Closer, The Better">The Closer, The Better</a> for an
example that uses geo-distance to influence scoring.</p><p>The other drawback of sorting by distance is performance: the distance has to
be calculated for all matching documents.  The <code class="literal">function_score</code> query, on the
other hand, can be executed during the <a class="link" href="_improving_performance.html#rescore-api" title="Rescoring Results"><code class="literal">rescore</code> phase</a>,
limiting the number of calculations to just the top <span class="emphasis"><em>n</em></span> results.</p></div></div><div class="navfooter"><span class="prev"><a href="geo-distance.html">
              « 
              Geo Distance Filter</a>
           
        </span><span class="next">
           
          <a href="geohashes.html">Geohashes
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
