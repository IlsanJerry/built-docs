<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Controlling Stemming
        | Elasticsearch: The Definitive Guide [1.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [1.x]" /><link rel="up" href="stemming.html" title="Reducing Words to Their Root Form" /><link rel="prev" href="choosing-a-stemmer.html" title="Choosing a Stemmer" /><link rel="next" href="stemming-in-situ.html" title="Stemming in situ" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/1.x" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="1.x" /><meta name="robots" content="noindex,nofollow" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">This information applies to version 1.x of Elasticsearch. For the
most up to date information, see the current version of the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">
Elasticsearch Reference</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [1.x]
    </a></span> » <span class="breadcrumb-link"><a href="languages.html">Dealing with Human Language</a></span> » <span class="breadcrumb-link"><a href="stemming.html">Reducing Words to Their Root Form</a></span> » <span class="breadcrumb-node">Controlling Stemming</span></div><div class="navheader"><span class="prev"><a href="choosing-a-stemmer.html">
              « 
              Choosing a Stemmer</a>
           
        </span><span class="next">
           
          <a href="stemming-in-situ.html">Stemming in situ
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="controlling-stemming"></a>Controlling Stemming<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/230_Stemming/50_Controlling_stemming.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Out-of-the-box stemming solutions are never perfect.<a id="id-1.6.6.16.2.1" class="indexterm"></a>
<a id="id-1.6.6.16.2.2" class="indexterm"></a>  Algorithmic stemmers,
especially, will blithely apply their rules to any words they encounter,
perhaps conflating words that you would prefer to keep separate.  Maybe, for
your use case, it is important to keep <code class="literal">skies</code> and <code class="literal">skiing</code> as distinct words
rather than stemming them both down to <code class="literal">ski</code> (as would happen with the
<code class="literal">english</code> analyzer).</p><p>The <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/analysis-keyword-marker-tokenfilter.html" target="_top"><code class="literal">keyword_marker</code></a> and
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/analysis-stemmer-override-tokenfilter.html" target="_top"><code class="literal">stemmer_override</code></a> token filters<a id="id-1.6.6.16.3.3" class="indexterm"></a><a id="id-1.6.6.16.3.4" class="indexterm"></a>
allow us to customize the stemming process.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="preventing-stemming"></a>Preventing Stemming<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/230_Stemming/50_Controlling_stemming.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <a class="link" href="configuring-language-analyzers.html#stem-exclusion"><code class="literal">stem_exclusion</code></a> parameter for language analyzers (see
<a class="xref" href="configuring-language-analyzers.html" title="Configuring Language Analyzers">Configuring Language Analyzers</a>) allowed <a id="id-1.6.6.16.4.2.3" class="indexterm"></a>
<a id="id-1.6.6.16.4.2.4" class="indexterm"></a>
<a id="id-1.6.6.16.4.2.5" class="indexterm"></a>us to specify a list of words that
should not be stemmed.  Internally, these language analyzers use the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/analysis-keyword-marker-tokenfilter.html" target="_top"><code class="literal">keyword_marker</code> token filter</a>
to mark the listed words as <span class="emphasis"><em>keywords</em></span>, which prevents subsequent stemming
token filters from touching those words.<a id="id-1.6.6.16.4.2.8" class="indexterm"></a>
<a id="id-1.6.6.16.4.2.9" class="indexterm"></a></p><p>For instance, we can create a simple custom analyzer that uses the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/analysis-porterstem-tokenfilter.html" target="_top"><code class="literal">porter_stem</code></a> token filter,
but prevents the word <code class="literal">skies</code> from<a id="id-1.6.6.16.4.3.3" class="indexterm"></a> being stemmed:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "no_stem": {
          "type": "keyword_marker",
          "keywords": [ "skies" ] <a id="CO161-1"></a><i class="conum" data-value="1"></i>
        }
      },
      "analyzer": {
        "my_english": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "no_stem",
            "porter_stem"
          ]
        }
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO161-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
They <code class="literal">keywords</code> parameter could accept multiple words.
</p></td></tr></table></div><p>Testing it with the <code class="literal">analyze</code> API shows that just the word <code class="literal">skies</code> has
been excluded from stemming:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">GET /my_index/_analyze?analyzer=my_english
sky skies skiing skis <a id="CO162-1"></a><i class="conum" data-value="1"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO162-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
Returns: <code class="literal">sky</code>, <code class="literal">skies</code>, <code class="literal">ski</code>, <code class="literal">ski</code>
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><a id="keyword-path"></a><p>While the language analyzers allow <a id="id-1.6.6.16.4.9.1.1" class="indexterm"></a>
<a id="id-1.6.6.16.4.9.1.2" class="indexterm"></a>us only to specify an array of words in the
<code class="literal">stem_exclusion</code> parameter, the <code class="literal">keyword_marker</code> token filter also accepts a
<code class="literal">keywords_path</code> parameter that allows us to store all of our keywords in a
file. <a id="id-1.6.6.16.4.9.1.6" class="indexterm"></a>
<a id="id-1.6.6.16.4.9.1.7" class="indexterm"></a>The file should contain one word per line, and must be present on every
node in the cluster. See <a class="xref" href="using-stopwords.html#updating-stopwords" title="Updating Stopwords">Updating Stopwords</a> for tips on how to update this
file.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="customizing-stemming"></a>Customizing Stemming<a href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/230_Stemming/50_Controlling_stemming.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In the preceding example, we prevented <code class="literal">skies</code> from being stemmed, but perhaps we
would prefer it to be stemmed to <code class="literal">sky</code> instead.<a id="id-1.6.6.16.5.2.3" class="indexterm"></a>
<a id="id-1.6.6.16.5.2.4" class="indexterm"></a>
<a id="id-1.6.6.16.5.2.5" class="indexterm"></a>  The
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/analysis-stemmer-override-tokenfilter.html" target="_top"><code class="literal">stemmer_override</code></a> token
filter allows us <a id="id-1.6.6.16.5.2.7" class="indexterm"></a>to specify our own custom stemming rules. At the same time,
we can handle some irregular forms like stemming <code class="literal">mice</code> to <code class="literal">mouse</code> and <code class="literal">feet</code>
to <code class="literal">foot</code>:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">PUT /my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "custom_stem": {
          "type": "stemmer_override",
          "rules": [ <a id="CO163-1"></a><i class="conum" data-value="1"></i>
            "skies=&gt;sky",
            "mice=&gt;mouse",
            "feet=&gt;foot"
          ]
        }
      },
      "analyzer": {
        "my_english": {
          "tokenizer": "standard",
          "filter": [
            "lowercase",
            "custom_stem", <a id="CO163-2"></a><i class="conum" data-value="2"></i>
            "porter_stem"
          ]
        }
      }
    }
  }
}

GET /my_index/_analyze?analyzer=my_english
The mice came down from the skies and ran over my feet <a id="CO163-3"></a><i class="conum" data-value="3"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO163-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
Rules take the form <code class="literal">original=&gt;stem</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO163-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
The <code class="literal">stemmer_override</code> filter must be placed before the stemmer.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO163-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
Returns <code class="literal">the</code>, <code class="literal">mouse</code>, <code class="literal">came</code>, <code class="literal">down</code>, <code class="literal">from</code>, <code class="literal">the</code>, <code class="literal">sky</code>,
    <code class="literal">and</code>, <code class="literal">ran</code>, <code class="literal">over</code>, <code class="literal">my</code>, <code class="literal">foot</code>.
</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Just as for the <code class="literal">keyword_marker</code> token filter, rules can be stored
in a file whose location should be specified with the <code class="literal">rules_path</code>
parameter.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="choosing-a-stemmer.html">
              « 
              Choosing a Stemmer</a>
           
        </span><span class="next">
           
          <a href="stemming-in-situ.html">Stemming in situ
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>
      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>

<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
