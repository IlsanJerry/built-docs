<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cascading support
        | Elasticsearch for Apache Hadoop [6.0]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [6.0]" /><link rel="up" href="reference.html" title="Elasticsearch for Apache Hadoop" /><link rel="prev" href="mapreduce.html" title="Map/Reduce integration" /><link rel="next" href="hive.html" title="Apache Hive integration" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Apache Hadoop/6.0" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="6.0" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [6.0]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Elasticsearch for Apache Hadoop</a></span> » <span class="breadcrumb-node">Cascading support</span></div><div class="navheader"><span class="prev"><a href="mapreduce.html">
              « 
              Map/Reduce integration</a>
           
        </span><span class="next">
           
          <a href="hive.html">Apache Hive integration
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cascading"></a>Cascading support<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://www.cascading.org/" target="_top">Cascading</a> is a data processing API and processing query planner used for defining, sharing, and executing data-processing workflows on a single computing node or distributed computing cluster.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Cascading website
</span></td></tr></table></div><p>Cascading abstracts the Map/Reduce API and focuses on <a class="ulink" href="http://docs.cascading.org/cascading/2.5/userguide/htmlsingle/#N201FA" target="_top">data processing</a>
in terms of <span class="emphasis"><em>tuples</em></span> <a class="ulink" href="http://docs.cascading.org/cascading/2.5/userguide/htmlsingle/#N20C4D" target="_top"><span class="emphasis"><em>flowing</em></span></a> through <a class="ulink" href="http://docs.cascading.org/cascading/2.5/userguide/htmlsingle/#N2024D" target="_top"><span class="emphasis"><em>pipes</em></span></a> between <a class="ulink" href="http://docs.cascading.org/cascading/2.5/userguide/htmlsingle/#N2087A" target="_top"><span class="emphasis"><em>taps</em></span></a>,
from input (called <code class="literal">SourceTap</code>) to output (named <code class="literal">SinkTap</code>). As the data flows, various operations are applied to the tuple; the whole system being transformed to Map/Reduce operations at runtime.
With elasticsearch-hadoop, Elasticsearch can be plugged into Cascading flows as a <code class="literal">SourceTap</code> or <code class="literal">SinkTap</code> through <code class="literal">EsTap</code>, data to/from Elasticsearch being transparently converted from/to Cascading `tuple`s.</p><div class="sidebar"><div class="titlepage"></div><p><strong>Local or Hadoop mode? </strong>Cascading supports two <span class="emphasis"><em>execution</em></span> modes or <a class="ulink" href="http://docs.cascading.org/cascading/2.5/userguide/htmlsingle/#N2081B" target="_top">platforms</a>:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Local</span></dt><dd>for unit testing and quick POCs. Everything runs only on the local machine and file-system.</dd><dt><span class="term">Hadoop</span></dt><dd>production mode - connects to a proper Hadoop (1.x or 2.x) cluster (as oppose to the <span class="emphasis"><em>local</em></span> mode which is running just on the local machine).</dd></dl></div><p>elasticsearch-hadoop supports <span class="strong strong"><strong>both</strong></span> platforms automatically. One does not have to choose between different classes, <code class="literal">EsTap</code> can be used as both <code class="literal">sink</code> or <code class="literal">source</code>, in both modes transparently.</p></div><h3><a id="_installation_2"></a>Installation<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Just like other libraries, elasticsearch-hadoop needs to be available in the jar classpath (either by being manually deployed in the cluster or shipped along with the Hadoop job).</p><h3><a id="_configuration_2"></a>Configuration<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><h4><a id="_global_configuration"></a>Global configuration<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Cascading is configured through a <code class="literal">Map&lt;Object, Object&gt;</code>, typically a <code class="literal">Properties</code> object which indicates the various Cascading settings and also the application jar:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Properties props = new Properties();
AppProps.setApplicationJarClass(props, Main.class);
FlowConnector flow = new HadoopFlowConnector(props);</pre></div><p>elasticsearch-hadoop options can be specified in the same way, these being picked up automatically by <span class="emphasis"><em>all</em></span> `EsTap`s down the flow:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Properties props = new Properties();
props.setProperty("es.index.auto.create", "false"); <a id="CO19-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
...
FlowConnector flow = new HadoopFlowConnector(props);</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>set elasticsearch-hadoop option</p></td></tr></table></div><p>This approach can be used for local and remote/Hadoop flows - simply use the appropriate <code class="literal">FlowConnector</code>.</p><h4><a id="_per_tap_configuration"></a>Per-<code class="literal">Tap</code> configuration<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>If a <code class="literal">flow</code> contains multiple Elasticsearch taps, the global approach does not work since the settings will clash with each other.  For these scenario, elasticsearch-hadoop allows using per-<code class="literal">Tap</code> configuration:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Tap books = new EsTap("es-server", 9200, "my-col/books", "?q=potter");
Tap movies = new EsTap("es-server", 9200, "my-col/movies", "?q=terminator");</pre></div><p>Note that the <code class="literal">Tap</code> configuration is merged with the global one so one can mix and match accordingly - for example specify the defaults in the global configuration and only declare the specifics on the <code class="literal">Tap</code> instance. Additionally, for maximum flexibility <code class="literal">EsTap</code> allows multiple arguments to be passed in, including a <code class="literal">Properties</code> object for the full range of options.</p><h3><a id="cascading-alias"></a>Mapping<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, elasticsearch-hadoop uses the Cascading tuple to map the data in Elasticsearch, using both the field names and types in the process. There are cases however when the field names cannot be used directly with Elasticsearch (a common case when working with an existing flow). For such cases, one can use the <code class="literal">es.mapping.names</code> setting which accepts a comma-separated list of mapped names in the following format: <code class="literal">Cascading field name</code>:<code class="literal">Elasticsearch field name</code></p><p>To wit:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Properties myTapCfg = new Properties();
myTapCfg.set("es.mapping.names", "date:@timestamp");	<a id="CO20-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
Tap myTap = new EsTap(..., myTapCfg);</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Maps Cascading field <code class="literal">date</code> in Elasticsearch to <code class="literal">@timestamp</code></p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Since elasticsearch-hadoop 2.1, the connector preserves the tuple names case sensitivity.</p></div></div><h3><a id="cascading-writing"></a>Writing data to Elasticsearch<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Simply hook <code class="literal">EsTap</code> into the Cascading flow:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Tap in = new Lfs(new TextDelimited(new Fields("id", "name", "url", "picture")),
                 "/resources/artists.dat");
Tap out = new EsTap("radio/artists", <a id="CO21-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                    new Fields("name", "url", "picture")); <a id="CO21-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
new HadoopFlowConnector().connect(in, out, new Pipe("write-to-Es")).complete();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>elasticsearch-hadoop resource (index and type)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Cascading tuple declaration</p></td></tr></table></div><p>For cases where the id (or other metadata fields like <code class="literal">ttl</code> or <code class="literal">timestamp</code>) of the document needs to be specified, one can do so by setting the appropriate <a class="link" href="configuration.html#cfg-mapping" title="Mapping (when writing to Elasticsearch)">mapping</a>, namely <code class="literal">es.mapping.id</code>. Following the previous example, to indicate to Elasticsearch to use the field <code class="literal">id</code> as the document id, update the <code class="literal">Tap</code> configuration:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Properties myTapCfg = new Properties();
myTapCfg.set("es.mapping.id", "id");</pre></div><h4><a id="_writing_existing_json_to_elasticsearch"></a>Writing existing JSON to Elasticsearch<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When the job input data is already in JSON, elasticsearch-hadoop allows direct indexing <span class="emphasis"><em>without</em></span> applying any transformation; the data is taken as is and sent directly to Elasticsearch. In such cases, one needs to indicate the json input by setting
the <code class="literal">es.input.json</code> parameter. As such, in this case elasticsearch-hadoop expects to receive a tuple with a single field (representing the JSON document); the library will recognize <code class="literal">Text</code> or <code class="literal">BytesWritable</code> types otherwise it just
calls <code class="literal">toString</code> to get a hold of the JSON content.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Make sure the data is properly encoded, in <code class="literal">UTF-8</code>. The job output is considered the final form of the document sent to Elasticsearch.</p></div></div><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Properties props = new Properties();
...
props.setProperty("es.input.json", "true");                                   <a id="CO22-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
Tap in = new Lfs(new TextLine(new Fields("line")),"/resources/artists.json"); <a id="CO22-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
Tap out = new EsTap("json-cascading-local/artists");
FlowConnector flow = new HadoopFlowConnector(props);
flow.connect(in, out, new Pipe("import-json")).complete();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Indicate the input is of type JSON</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Load the (JSON) data as a single field (<code class="literal">line</code>)</p></td></tr></table></div><h4><a id="_writing_to_dynamicmulti_resources"></a>Writing to dynamic/multi-resources<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>One can index the data to a different resource, depending on the tuple being read, by using patterns. Reusing the aforementioned <a class="link" href="configuration.html#cfg-multi-writes" title="Dynamic/multi resource writes">media example</a>, one could configure it as follows:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Tap out = new EsTap("my-collection-{media.type}/doc", <a id="CO23-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                    new Fields("name", "media.type", "year")); <a id="CO23-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Resource pattern using field <code class="literal">media.type</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Schema definition associated with the <code class="literal">Tap</code>. Any of the declared fields can be used (example uses <code class="literal">media.type</code>)</p></td></tr></table></div><p>For each tuple about to be written, elasticsearch-hadoop will extract the <code class="literal">media.type</code> entry and use its value to determine the target resource.</p><p>The functionality is available when dealing with raw JSON as well - in this case, the value will be extracted from the JSON document itself. Assuming the JSON source contains documents with the following structure:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
    "media_type":"book", <a id="CO24-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "title":"Harry Potter",
    "year":"2010"
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>field within the JSON document that will be used by the pattern</p></td></tr></table></div><p>the <code class="literal">Tap</code> declaration can be as follows:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">props.setProperty("es.input.json", "true");
Tap in = new Lfs(new TextLine(new Fields("line")),"/archives/collection.json");
Tap out = new EsTap("my-collection-{media_type}/doc", <a id="CO25-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                    new Fields("line")); <a id="CO25-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Resource pattern relying on fields <span class="emphasis"><em>within</em></span> the JSON document and <span class="emphasis"><em>not</em></span> on the <code class="literal">Tap</code> schema</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Schema declaration for the <code class="literal">Tap</code>. Since JSON input is used, the schema is simply a holder to the raw data</p></td></tr></table></div><h3><a id="_reading_data_from_elasticsearch"></a>Reading data from Elasticsearch<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Just the same, add <code class="literal">EsTap</code> on the other end of a pipe, to read (instead of writing) to it.</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Tap in = new EsTap("radio/artists/", <a id="CO26-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
                   "?q=me*"); <a id="CO26-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
Tap out = new StdOut(new TextLine());
new LocalFlowConnector().connect(in, out, new Pipe("read-from-Es")).complete();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>elasticsearch-hadoop resource (index and type)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>elasticsearch-hadoop query</p></td></tr></table></div><h3><a id="_type_conversion"></a>Type conversion<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Depending on the <a class="ulink" href="http://docs.cascading.org/cascading/2.1/userguide/htmlch03s04.html" target="_top">platform</a> used, Cascading can use internally either <code class="literal">Writable</code> or JDK types for its tuples. Elasticsearch handles both transparently
(see the Map/Reduce <a class="link" href="mapreduce.html#type-conversion-writable" title="Type conversion">conversion</a> section) though we recommend using the same types (if possible) in both cases to avoid the overhead of maintaining two different versions.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If automatic index creation is used, please review <a class="link" href="mapping.html#auto-mapping-type-loss">this</a> section for more information.</p></div></div><h3><a id="_cascading_lingual"></a>Cascading Lingual<a href="https://github.com/elastic/elasticsearch-hadoop/edit/6.0/docs/src/reference/asciidoc/core/cascading.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>elasticsearch-hadoop also provides integration with <a class="ulink" href="http://www.cascading.org/projects/lingual/" target="_top">Lingual</a>, a Cascading extension
that provides an ANSI SQL interface for Apache Hadoop. That is, one can execute in Hadoop, SQL queries directly on Elasticsearch.</p><p>Below is a quick setup of using elasticsearch-hadoop with Lingual (1.1) - for detailed information please refer to the Lingual <a class="ulink" href="http://docs.cascading.org/lingual/1.1/" target="_top">user guide</a>:</p><div class="pre_wrapper lang-bash"><pre class="programlisting prettyprint lang-bash">export LINGUAL_PLATFORM=hadoop
# register {es} as a provider
lingual catalog --init
lingual catalog --provider --add ./elasticsearch-hadoop-&lt;version&gt;.jar
# add a custom schema (called 'titles') for querying
lingual catalog --schema es-test --add
lingual catalog --schema es-test --stereotype titles -add \
    --columns emp_no,title,from_date,to_date --types int,string,date,date
lingual catalog --schema es-test --format es --add --provider es
lingual catalog --schema es-test --protocol es --add --provider es \
    --properties=host=es-server
lingual catalog --schema es-test --table titles --stereotype titles \
    -add employees/titles --format es --provider es --protocol es</pre></div><p>Once the desired catalog has been declared and elasticsearch-hadoop registered with it, one can start querying the data</p><div class="pre_wrapper lang-sql"><pre class="programlisting prettyprint lang-sql">lingual shell
(shell) select count(*) from "es-test"."titles" where "title" = 'Engineer';
115003</pre></div></div><div class="navfooter"><span class="prev"><a href="mapreduce.html">
              « 
              Map/Reduce integration</a>
           
        </span><span class="next">
           
          <a href="hive.html">Apache Hive integration
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>

  
            <script type="text/javascript" src="/guide/static/docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
