<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Apache Spark support
        | Elasticsearch for Apache Hadoop [2.0]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [2.0]" /><link rel="up" href="reference.html" title="Reference" /><link rel="prev" href="pig.html" title="Apache Pig support" /><link rel="next" href="mapping.html" title="Mapping and Types" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Apache Hadoop/2.0" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="2.0" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [2.0]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Reference</a></span> » <span class="breadcrumb-node">Apache Spark support</span></div><div class="navheader"><span class="prev"><a href="pig.html">
              « 
              Apache Pig support</a>
           
        </span><span class="next">
           
          <a href="mapping.html">Mapping and Types
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="spark"></a>Apache Spark support<a href="https://github.com/elastic/elasticsearch-hadoop/edit/2.0/docs/src/reference/asciidoc/core/spark.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p><a class="ulink" href="http://spark.apache.org" target="_top">Apache Spark</a> is a fast and general-purpose cluster computing system. It provides high-level APIs in Java, Scala and Python, and an optimized engine that supports general execution graphs.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Spark website
</span></td></tr></table></div><p>Spark provides fast iterative/functional-like capabilities over large data sets, typically by <span class="emphasis"><em>caching</em></span> data in memory. As opposed to the rest of the libraries mentioned in this documentation, Apache Spark is computing framework that is not tied to Map/Reduce itself however it does integrate with Hadoop, mainly to HDFS.</p><h3><a id="spark-installation"></a>Installation<a href="https://github.com/elastic/elasticsearch-hadoop/edit/2.0/docs/src/reference/asciidoc/core/spark.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Just like other libraries, elasticsearch-hadoop needs to be available in Spark’s classpath. As Spark has multiple deployment modes, this can translate to the target classpath, whether it is on only one node (as is the case with the local mode - which will be used through-out the documentation) or per-node depending on the desired infrastructure.</p><h3><a id="_configuration_3"></a>Configuration<a href="https://github.com/elastic/elasticsearch-hadoop/edit/2.0/docs/src/reference/asciidoc/core/spark.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Through elasticsearch-hadoop, Spark can integrate with Elasticsearch through its dedicated <code class="literal">InputFormat</code>, and in case of writing, through <code class="literal">OutputFormat</code>. These are described at length in the <a class="link" href="mapreduce.html" title="Map/Reduce integration">Map/Reduce</a> chapter so please refer to that for an in-depth explanation.</p><p>In short, one needs to setup a basic Hadoop <code class="literal">Configuration</code> object with the target Elasticsearch cluster and index, potentially a query, and she’s good to go.</p><p>From Spark’s perspective, they only thing required is setting up serialization - Spark relies by default on Java serialization which is convenient but fairly inefficient. This is the reason why Hadoop itself introduced its own serialization mechanism and its own types - namely <code class="literal">Writable</code>s. As such, <code class="literal">InputFormat</code> and <code class="literal">OutputFormat</code>s are required to return <code class="literal">Writables</code> which, out of the box, Spark does not understand.
The good news is, one can easily enable a different serialization (<a class="ulink" href="https://github.com/EsotericSoftware/kryo" target="_top">Kryo</a>) which handles the conversion automatically and also does this quite efficiently.</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">SparkConf sc = new SparkConf(); //.setMaster("local");
sc.set("spark.serializer", KryoSerializer.class.getName()); <a id="CO41-1"></a><i class="conum" data-value="1"></i>

// needed only when using the Java API
JavaSparkContext jsc = new JavaSparkContext(sc);</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO41-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Enable the Kryo serialization support with Spark</p></td></tr></table></div><p>Or if you prefer Scala</p><div class="pre_wrapper lang-scala"><pre class="programlisting prettyprint lang-scala">val sc = new SparkConf(...)
sc.set("spark.serializer", classOf[KryoSerializer].getName)    <a id="CO42-1"></a><i class="conum" data-value="1"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO42-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Enable the Kryo serialization support with Spark</p></td></tr></table></div><p>Note that the Kryo serialization is used as a work-around for dealing with <code class="literal">Writable</code> types; one can choose to convert the types directly (from <code class="literal">Writable</code> to <code class="literal">Serializable</code> types) - which is fine however for getting started, the one liner above seems to be the most effective.</p><h3><a id="_reading_data_from_elasticsearch_5"></a>Reading data from Elasticsearch<a href="https://github.com/elastic/elasticsearch-hadoop/edit/2.0/docs/src/reference/asciidoc/core/spark.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To read data, simply pass in the <code class="literal">org.elasticsearch.hadoop.mr.EsInputFormat</code> class - since it supports both the <code class="literal">old</code> and the <code class="literal">new</code> Map/Reduce APIs, you are free to use either method on <code class="literal">SparkContext</code>'s, <code class="literal">hadoopRDD</code> (which we recommend for conciseness reasons) or <code class="literal">newAPIHadoopRDD</code>. Which ever you chose, stick with it to avoid confusion and problems down the road.</p><h4><a id="_old_org_apache_hadoop_mapred_api_3"></a><span class="emphasis"><em>Old</em></span> (<code class="literal">org.apache.hadoop.mapred</code>) API<a href="https://github.com/elastic/elasticsearch-hadoop/edit/2.0/docs/src/reference/asciidoc/core/spark.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">JobConf conf = new JobConf();                   <a id="CO43-1"></a><i class="conum" data-value="1"></i>
conf.set("es.resource", "radio/artists");       <a id="CO43-2"></a><i class="conum" data-value="2"></i>
conf.set("es.query", "?q=me*");                 <a id="CO43-3"></a><i class="conum" data-value="3"></i>

JavaPairRDD esRDD = jsc.hadoopRDD(conf, EsInputFormat.class,
                                        Text.class, MapWritable.class); <a id="CO43-4"></a><i class="conum" data-value="4"></i>
long docCount = esRDD.count();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Create the Hadoop object (use the old API)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Configure the source (index)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Setup the query (optional)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>Create a Spark <code class="literal">RDD</code> on top of Elasticsearch through <code class="literal">EsInputFormat</code> - the key represent the doc id, the value the doc itself</p></td></tr></table></div><p>The Scala version is below:</p><div class="pre_wrapper lang-scala"><pre class="programlisting prettyprint lang-scala">val conf = new JobConf()                                <a id="CO44-1"></a><i class="conum" data-value="1"></i>
conf.set("es.resource", "radio/artists")                <a id="CO44-2"></a><i class="conum" data-value="2"></i>
conf.set("es.query", "?q=me*")                          <a id="CO44-3"></a><i class="conum" data-value="3"></i>
val esRDD = sc.hadoopRDD(conf, classOf[EsInputFormat[Text, MapWritable]],     <a id="CO44-4"></a><i class="conum" data-value="4"></i>
                               classOf[Text], classOf[MapWritable]))
val docCount = esRDD.count();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Create the Hadoop object (use the old API)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Configure the source (index)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Setup the query (optional)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>Create a Spark <code class="literal">RDD</code> on top of Elasticsearch through <code class="literal">EsInputFormat</code></p></td></tr></table></div><h4><a id="_new_org_apache_hadoop_mapreduce_api_3"></a><span class="emphasis"><em>New</em></span> (<code class="literal">org.apache.hadoop.mapreduce</code>) API<a href="https://github.com/elastic/elasticsearch-hadoop/edit/2.0/docs/src/reference/asciidoc/core/spark.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>As expected, the <code class="literal">mapreduce</code> API version is strikingly similar - replace <code class="literal">hadoopRDD</code> with <code class="literal">newAPIHadoopRDD</code> and <code class="literal">JobConf</code> with <code class="literal">Configuration</code>. That’s about it.</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">Configuration conf = new Configuration();                   <a id="CO45-1"></a><i class="conum" data-value="1"></i>
conf.set("es.resource", "radio/artists");       <a id="CO45-2"></a><i class="conum" data-value="2"></i>
conf.set("es.query", "?q=me*");                 <a id="CO45-3"></a><i class="conum" data-value="3"></i>

JavaPairRDD esRDD = jsc.newAPIHadoopRDD(conf, EsInputFormat.class,
                                              Text.class, MapWritable.class); <a id="CO45-4"></a><i class="conum" data-value="4"></i>
long docCount = esRDD.count();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Create the Hadoop object (use the new API)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Configure the source (index)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Setup the query (optional)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>Create a Spark <code class="literal">RDD</code> on top of Elasticsearch through <code class="literal">EsInputFormat</code> - the key represent the doc id, the value the doc itself</p></td></tr></table></div><p>The Scala version is below:</p><div class="pre_wrapper lang-scala"><pre class="programlisting prettyprint lang-scala">val conf = new Configuration()                          <a id="CO46-1"></a><i class="conum" data-value="1"></i>
conf.set("es.resource", "radio/artists")                <a id="CO46-2"></a><i class="conum" data-value="2"></i>
conf.set("es.query", "?q=me*")                          <a id="CO46-3"></a><i class="conum" data-value="3"></i>
val esRDD = sc.newAPIHadoopRDD(conf, classOf[EsInputFormat[Text, MapWritable]],     <a id="CO46-4"></a><i class="conum" data-value="4"></i>
                                  classOf[Text], classOf[MapWritable]))
val docCount = esRDD.count();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Create the Hadoop object (use the new API)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Configure the source (index)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Setup the query (optional)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>Create a Spark RDD on top of Elasticsearch through <code class="literal">EsInputFormat</code></p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="pig.html">
              « 
              Apache Pig support</a>
           
        </span><span class="next">
           
          <a href="mapping.html">Mapping and Types
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
