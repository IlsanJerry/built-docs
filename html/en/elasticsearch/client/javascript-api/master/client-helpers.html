<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>Client Helpers | Elasticsearch Node.js client [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Node.js client [master]"/>
<link rel="up" href="index.html" title="Elasticsearch Node.js client [master]"/>
<link rel="prev" href="extend-client.html" title="Extend the client"/>
<link rel="next" href="typescript.html" title="TypeScript support"/>
<meta name="DC.type" content="Learn/Docs/Clients/JavaScript/master"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Node.js client [master]</a></span>
»
<span class="breadcrumb-node">Client Helpers</span>
</div>
<div class="navheader">
<span class="prev">
<a href="extend-client.html">« Extend the client</a>
</span>
<span class="next">
<a href="typescript.html">TypeScript support »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="client-helpers"></a>Client Helpers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h1>
</div></div></div>
<p>The client comes with an handy collection of helpers to give you a more comfortable experience with some APIs.</p>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The client helpers are experimental, and the API may change in the next minor releases.
If you are using the client with Node.js v8 you should run your code with the <code class="literal">--harmony-async-iteration</code> argument.<br>
eg: <code class="literal">node --harmony-async-iteration index.js</code></p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_bulk_helper"></a>Bulk Helper<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h2>
</div></div></div>
<p>Running Bulk requests can be complex due to the shape of the API, this helper aims to provide a nicer developer experience around the Bulk API.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_usage"></a>Usage<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { createReadStream } = require('fs')
const split = require('split2')
const { Client } = require('@elastic/elasticsearch')

const client = new Client({ node: 'http://localhost:9200' })
const result = await client.helpers.bulk({
  datasource: createReadStream('./dataset.ndjson').pipe(split()),
  onDocument (doc) {
    return {
      index: { _index: 'my-index' }
    }
  }
})

console.log(result)
// {
//   total: number,
//   failed: number,
//   retry: number,
//   successful: number,
//   time: number,
//   bytes: number,
//   aborted: boolean
// }</pre>
</div>
<p>To create a new instance of the Bulk helper, you should access it as shown in the example above, the configuration options are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">datasource</code></p></td>
<td align="left" valign="top">
<p>An array, async generator or a readable stream with the data you need to index/create/update/delete.
It can be an array of strings or objects, but also a stream of json strings or JavaScript objects.<br>
If it is a stream, we recommend to use the <a href="https://www.npmjs.com/package/split2" class="ulink" target="_top"><code class="literal">split2</code></a> package, that will split the stream on new lines delimiters.<br>
This parameter is mandatory.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { createReadStream } = require('fs')
const split = require('split2')
const b = client.helpers.bulk({
  // if you just use split(), the data will be used as array of strings
  datasource: createReadStream('./dataset.ndjson').pipe(split())
  // if you need to manipulate the data, you can pass JSON.parse to split
  datasource: createReadStream('./dataset.ndjson').pipe(split(JSON.parse))
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">onDocument</code></p></td>
<td align="left" valign="top">
<p>A function that will be called for each document of the datasource. Inside this function you can manipulate the document and you must return the operation you want to execute with the document. Look at the <a href="/guide/en/elasticsearch/reference/master/docs-bulk.html" class="ulink" target="_top">Bulk API documentation</a> to see the supported operations.<br>
This parameter is mandatory.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  onDocument (doc) {
    return {
      index: { _index: 'my-index' }
    }
  }
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">onDrop</code></p></td>
<td align="left" valign="top">
<p>A function that will be called for everytime a document can&#8217;t be indexed and it has reached the maximum amount of retries.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  onDrop (doc) {
    console.log(doc)
  }
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">flushBytes</code></p></td>
<td align="left" valign="top">
<p>The size of the bulk body in bytes to reach before to send it. Default of 5MB.<br>
<em>Default:</em> <code class="literal">5000000</code></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  flushBytes: 1000000
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">concurrency</code></p></td>
<td align="left" valign="top">
<p>How many request will be executed at the same time.<br>
<em>Default:</em> <code class="literal">5</code></p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  concurrency: 10
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">retries</code></p></td>
<td align="left" valign="top">
<p>How many times a document will be retried before to call the <code class="literal">onDrop</code> callback.<br>
<em>Default:</em> Client max retries.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  retries: 3
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">wait</code></p></td>
<td align="left" valign="top">
<p>How much time to wait before retries in milliseconds.+
<em>Default:</em> 5000.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  wait: 3000
})</pre>
</div>
</td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">refreshOnCompletion</code></p></td>
<td align="left" valign="top">
<p>If <code class="literal">true</code>, at the end of the bulk operation it will run a refresh on all indices or on the specified indices.<br>
<em>Default:</em> false.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const b = client.helpers.bulk({
  refreshOnCompletion: true
  // or
  refreshOnCompletion: 'index-name'
})</pre>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_abort_a_bulk_operation"></a>Abort a bulk operation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h3>
</div></div></div>
<p>If needed, you can abort a bulk operation at any time. The bulk helper returns a <a href="https://promisesaplus.com/" class="ulink" target="_top">thenable</a>, which has an <code class="literal">abort</code> method.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The abort method will stop the execution of the bulk operation, but if you are using a concurrency higher than one, the operations that are already running will not be stopped.</p>
</div>
</div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { createReadStream } = require('fs')
const split = require('split2')
const { Client } = require('@elastic/elasticsearch')

const client = new Client({ node: 'http://localhost:9200' })
const b = client.helpers.bulk({
  datasource: createReadStream('./dataset.ndjson').pipe(split()),
  onDocument (doc) {
    return {
      index: { _index: 'my-index' }
    }
  },
  onDrop (doc) {
    b.abort()
  }
})

console.log(await b)</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_passing_custom_options_to_the_bulk_api"></a>Passing custom options to the Bulk API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h3>
</div></div></div>
<p>You can pass any option supported by the <a href="/guide/en/elasticsearch/reference/master/docs-bulk.html#docs-bulk-api-query-params" class="ulink" target="_top">Bulk API</a> to the helper, and the helper will use those options in conjuction with the Bulk
API call.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const result = await client.helpers.bulk({
  datasource: [...]
  onDocument (doc) {
    return {
      index: { _index: 'my-index' }
    }
  },
  pipeline: 'my-pipeline'
})</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_usage_with_an_async_generator"></a>Usage with an async generator<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h3>
</div></div></div>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const { Client } = require('@elastic/elasticsearch')

async function * generator () {
  const dataset = [
    { user: 'jon', age: 23 },
    { user: 'arya', age: 18 },
    { user: 'tyrion', age: 39 }
  ]
  for (const doc of dataset) {
    yield doc
  }
}

const client = new Client({ node: 'http://localhost:9200' })
const result = await client.helpers.bulk({
  datasource: generator(),
  onDocument (doc) {
    return {
      index: { _index: 'my-index' }
    }
  }
})

console.log(result)</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_search_helper"></a>Search Helper<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h2>
</div></div></div>
<p>A simple wrapper around the search API. Instead of returning the entire <code class="literal">result</code> object it will return only the search documents result.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const documents = await client.helpers.search({
  index: 'stackoverflow',
  body: {
    query: {
      match: {
        title: 'javascript'
      }
    }
  }
})

for (const doc of documents) {
  console.log(doc)
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_scroll_search_helper"></a>Scroll Search Helper<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h2>
</div></div></div>
<p>This helpers offers a simple and intuitive way to use the scroll search API. Once called, it returns an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await&#8230;&#8203;of" class="ulink" target="_top">async iterator</a> which can be used in conjuction with a for-await&#8230;&#8203;of.<br>
It handles automatically the <code class="literal">429</code> error and uses the client&#8217;s <code class="literal">maxRetries</code> option.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const scrollSearch = await client.helpers.scrollSearch({
  index: 'stackoverflow',
  body: {
    query: {
      match: {
        title: 'javascript'
      }
    }
  }
})

for await (const result of scrollSearch) {
  console.log(result)
}</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_clear_a_scroll_search"></a>Clear a scroll search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h3>
</div></div></div>
<p>If needed, you can clear a scroll search by calling <code class="literal">result.clear()</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">for await (const result of scrollSearch) {
  if (condition) {
    await result.clear()
  }
}</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_quickly_getting_the_documents"></a>Quickly getting the documents<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h3>
</div></div></div>
<p>If you only need the documents from the result of a scroll search, you can access them via <code class="literal">result.documents</code>:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">for await (const result of scrollSearch) {
  console.log(result.documents)
}</pre>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_scroll_documents_helper"></a>Scroll Documents Helper<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/master/docs/helpers.asciidoc">edit</a></h2>
</div></div></div>
<p>It works in the same way as the scroll search helper, but it returns only the documents instead. Note, every loop cycle will return you a single document, and you can&#8217;t use the <code class="literal">clear</code> method.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const scrollSearch = await client.helpers.scrollDocuments({
  index: 'stackoverflow',
  body: {
    query: {
      match: {
        title: 'javascript'
      }
    }
  }
})

for await (const doc of scrollSearch) {
  console.log(doc)
}</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="extend-client.html">« Extend the client</a>
</span>
<span class="next">
<a href="typescript.html">TypeScript support »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/cloud/elasticsearch-service/signup?baymax=default&elektra=docs&storm=top-video">Elasticsearch Service: Free Trial</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
