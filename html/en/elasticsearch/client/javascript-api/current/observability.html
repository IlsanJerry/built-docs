<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Observability
        | Elasticsearch Node.js client [7.x]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch Node.js client [7.x]" /><link rel="up" href="index.html" title="Elasticsearch Node.js client [7.x]" /><link rel="prev" href="auth-reference.html" title="Authentication" /><link rel="next" href="child-client.html" title="Creating a child client" /><meta name="DC.type" content="Learn/Docs/Clients/JavaScript/7.x" /><meta name="DC.subject" content="Clients" /><meta name="DC.identifier" content="7.x" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Node.js client
      [7.x]
    </a></span> » <span class="breadcrumb-node">Observability</span></div><div class="navheader"><span class="prev"><a href="auth-reference.html">
              « 
              Authentication</a>
           
        </span><span class="next">
           
          <a href="child-client.html">Creating a child client
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="observability"></a>Observability<a href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/observability.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><p>The client does not provide a default logger, but instead it offers an event emitter interfaces to hook into internal events, such as <code class="literal">request</code> and <code class="literal">response</code>.</p><p>Correlating those events can be quite hard, especially if your applications have a large codebase with many events happening at the same time.</p><p>To help you with this, the client offers you a correlation id system and other features, let’s see them in action.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_events"></a>Events<a href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/observability.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The client is an event emitter, this means that you can listen for its event and add additional logic to your code, without need to change the client internals or your normal usage.
You can find the events names by access the <code class="literal">events</code> key of the client.</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">const { events } = require('@elastic/elasticsearch')
console.log(events)</pre></div><p>The event emitter functionality can be useful if you want to log every request, response and error that is happening during the use of the client.</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">const logger = require('my-logger')()
const { Client } = require('@elastic/elasticsearch')
const client = new Client({ node: 'http://localhost:9200' })

client.on('response', (err, result) =&gt; {
  if (err) {
    logger.error(err)
  } else {
    logger.info(result)
  }
})</pre></div><p>The client emits the following events:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><tbody><tr><td align="left" valign="top"><p><code class="literal">request</code></p></td><td align="left" valign="top"><p>Emitted before sending the actual request to Elasticsearch <span class="emphasis"><em>(emitted multiple times in case of retries)</em></span>.</p>
<div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">client.on('request', (err, result) =&gt; {
  console.log(err, result)
})</pre></div></td></tr><tr><td align="left" valign="top"><p><code class="literal">response</code></p></td><td align="left" valign="top"><p>Emitted once Elasticsearch response has been received and parsed.</p>
<div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">client.on('response', (err, result) =&gt; {
  console.log(err, result)
})</pre></div></td></tr><tr><td align="left" valign="top"><p><code class="literal">sniff</code></p></td><td align="left" valign="top"><p>Emitted when the client ends a sniffing request.</p>
<div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">client.on('sniff', (err, result) =&gt; {
  console.log(err, result)
})</pre></div></td></tr><tr><td align="left" valign="top"><p><code class="literal">resurrect</code></p></td><td align="left" valign="top"><p>Emitted if the client is able to resurrect a dead node.</p>
<div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">client.on('resurrect', (err, result) =&gt; {
  console.log(err, result)
})</pre></div></td></tr></tbody></table></div><p>The values of <code class="literal">result</code> in <code class="literal">request</code>, <code class="literal">response</code> and <code class="literal">sniff</code> will be:</p><div class="pre_wrapper lang-ts"><pre class="programlisting prettyprint lang-ts">body: any;
statusCode: number | null;
headers: anyObject | null;
warnings: string[] | null;
meta: {
  context: any;
  name: string;
  request: {
    params: TransportRequestParams;
    options: TransportRequestOptions;
    id: any;
  };
  connection: Connection;
  attempts: number;
  aborted: boolean;
  sniff?: {
    hosts: any[];
    reason: string;
  };
};</pre></div><p>While the <code class="literal">result</code> value in <code class="literal">resurrect</code> will be:</p><div class="pre_wrapper lang-ts"><pre class="programlisting prettyprint lang-ts">strategy: string;
isAlive: boolean;
connection: Connection;
name: string;
request: {
  id: any;
};</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_correlation_id"></a>Correlation id<a href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/observability.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Correlating events can be quite hard, especially if there are many events at the same time. The client offers you an automatic (and configurable) system to help you handle this problem.</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">const { Client } = require('@elastic/elasticsearch')
const client = new Client({ node: 'http://localhost:9200' })

client.on('request', (err, result) =&gt; {
  const { id } = result.meta.request
  if (err) {
    console.log({ error: err, reqId: id })
  }
})

client.on('response', (err, result) =&gt; {
  const { id } = result.meta.request
  if (err) {
    console.log({ error: err, reqId: id })
  }
})

client.search({
  index: 'my-index',
  body: { foo: 'bar' }
}, (err, result) =&gt; {
  if (err) console.log(err)
})</pre></div><p>By default the id is an incremental integer, but you can easily configure that with the <code class="literal">generateRequestId</code> option:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">const { Client } = require('@elastic/elasticsearch')
const client = new Client({
  node: 'http://localhost:9200',
  // it takes two parameters, the request parameters and options
  generateRequestId: function (params, options) {
    // your id generation logic
    // must be syncronous
    return 'id'
  }
})</pre></div><p>You can also specify a custom id per request:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">client.search({
  index: 'my-index',
  body: { foo: 'bar' }
}, {
  id: 'custom-id'
}, (err, result) =&gt; {
  if (err) console.log(err)
})</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_context_object"></a>Context object<a href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/observability.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Sometimes, you might need to make some custom data available in your events, you can do that via the <code class="literal">context</code> option of a request:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">const { Client } = require('@elastic/elasticsearch')
const client = new Client({ node: 'http://localhost:9200' })

client.on('request', (err, result) =&gt; {
  const { id } = result.meta.request
  const { context } = result.meta
  if (err) {
    console.log({ error: err, reqId: id, context })
  }
})

client.on('response', (err, result) =&gt; {
  const { id } = result.meta.request
  const { winter } = result.meta.context
  if (err) {
    console.log({ error: err, reqId: id, winter })
  }
})

client.search({
  index: 'my-index',
  body: { foo: 'bar' }
}, {
  context: { winter: 'is coming' }
}, (err, result) =&gt; {
  if (err) console.log(err)
})</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_client_name"></a>Client name<a href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/observability.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>If you are using multiple instances of the client or if you are using multiple child clients <span class="emphasis"><em>(which is the recommended way to have multiple instances of the client)</em></span>, you might need to recognize which client you are using, the <code class="literal">name</code> options will help you in this regard:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">const { Client } = require('@elastic/elasticsearch')
const client = new Client({
  node: 'http://localhost:9200',
  name: 'parent-client' // default to 'elasticsearch-js'
})

const child = client.child({
  name: 'child-client'
})

console.log(client.name, child.name)

client.on('request', (err, result) =&gt; {
  const { id } = result.meta.request
  const { name } = result.meta
  if (err) {
    console.log({ error: err, reqId: id, name })
  }
})

client.on('response', (err, result) =&gt; {
  const { id } = result.meta.request
  const { name } = result.meta
  if (err) {
    console.log({ error: err, reqId: id, name })
  }
})

client.search({
  index: 'my-index',
  body: { foo: 'bar' }
}, (err, result) =&gt; {
  if (err) console.log(err)
})

child.search({
  index: 'my-index',
  body: { foo: 'bar' }
}, (err, result) =&gt; {
  if (err) console.log(err)
})</pre></div></div></div><div class="navfooter"><span class="prev"><a href="auth-reference.html">
              « 
              Authentication</a>
           
        </span><span class="next">
           
          <a href="child-client.html">Creating a child client
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
