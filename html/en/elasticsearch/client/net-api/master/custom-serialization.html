<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Custom Serialization
        | Elasticsearch.Net and NEST: the .NET clients [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch.Net and NEST: the .NET clients [master]" /><link rel="up" href="serialization.html" title="Serialization" /><link rel="prev" href="serialization.html" title="Serialization" /><link rel="next" href="extending-nest-types.html" title="Extending NEST types" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Clients/.Net/master" /><meta name="DC.subject" content="Clients" /><meta name="DC.identifier" content="master" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch.Net and NEST:  the .NET clients
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="nest.html">NEST - High level client</a></span> » <span class="breadcrumb-link"><a href="serialization.html">Serialization</a></span> » <span class="breadcrumb-node">Custom Serialization</span></div><div class="navheader"><span class="prev"><a href="serialization.html">
              « 
              Serialization</a>
           
        </span><span class="next">
           
          <a href="extending-nest-types.html">Extending NEST types
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="custom-serialization"></a>Custom Serialization<a href="https://github.com/elastic/elasticsearch-net/edit/master/docs/client-concepts/high-level/serialization/custom-serialization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>NEST 6.x ships with a <span class="emphasis"><em>shaded</em></span> Json.NET dependency, meaning that all of Json.NET’s types are
internalized and IL merged into the NEST assembly, and their namespace has been changed
from <code class="literal">Newtonsoft.Json</code> to <code class="literal">Nest.Json</code>.</p><p>Why would we do this, you may ask? Well, NEST has always isolated its dependency on Json.NET as best as it could,
but this meant that we had to mandate how certain things were in the client. For instance,
NEST heavily relied on the fact that the <code class="literal">IContractResolver</code> used by the configured serializer was
an instance of <code class="literal">ElasticContractResolver</code>, so if you wanted to deserialize your <code class="literal">_source</code> or <code class="literal">_fields</code>
using your own resolver, you were out of luck. In addition, continued improvements to NEST’s serialization pipeline
was stymied by this dependency and as client authors, we wanted to unhinder ourselves from this in order to explore the myriad
of exciting developments happening in the .NET ecosystem around performance with the likes of <code class="literal">Span&lt;T&gt;</code>,
<code class="literal">ArrayPool&lt;T&gt;</code> and a more compact UTF-8 string representation.</p><p>So what did we do in 6.x and how does it affect you?</p><p>The <code class="literal">NEST</code> nuget package from 6.0.0 onwards will use the internal Json.NET serializer and will in effect, behave the same
as it did in previous releases. If you previously relied on custom Json.NET serialization and configuration with custom
<code class="literal">JsonSerializerSettings</code> and <code class="literal">JsonConverter</code> types for example, things have changed a bit. The following section explains
how to continue working with these with NEST 6.x.</p><h4><a id="_injecting_a_new_serializer"></a>Injecting a new serializer<a href="https://github.com/elastic/elasticsearch-net/edit/master/docs/client-concepts/high-level/serialization/custom-serialization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Starting with NEST 6.x you can inject a serializer that is isolated to only be called
for the (de)serialization of <code class="literal">_source</code>, <code class="literal">_fields</code>, or wherever a user provided value is expected
to be written and returned.</p><p>Within NEST, we refer to this serializer as the <code class="literal">SourceSerializer</code>.</p><p>Another serializer also exists within NEST known as the <code class="literal">RequestResponseSerializer</code>. This serializer is internal
and is responsible for serializing the request and response types that are part of NEST.</p><p>If <code class="literal">SourceSerializer</code> is left unconfigured, the internal <code class="literal">RequestResponseSerializer</code> is the <code class="literal">SourceSerializer</code> as well.</p><p>Implementing <code class="literal">IElasticsearchSerializer</code> is technically enough to inject your own <code class="literal">SourceSerializer</code></p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">public class VanillaSerializer : IElasticsearchSerializer
{
    public T Deserialize&lt;T&gt;(Stream stream) =&gt; throw new NotImplementedException();

    public object Deserialize(Type type, Stream stream) =&gt; throw new NotImplementedException();

    public Task&lt;T&gt; DeserializeAsync&lt;T&gt;(Stream stream, CancellationToken cancellationToken = default(CancellationToken)) =&gt;
        throw new NotImplementedException();

    public Task&lt;object&gt; DeserializeAsync(Type type, Stream stream, CancellationToken cancellationToken = default(CancellationToken)) =&gt;
        throw new NotImplementedException();

    public void Serialize&lt;T&gt;(T data, Stream stream, SerializationFormatting formatting = SerializationFormatting.Indented) =&gt;
        throw new NotImplementedException();

    public Task SerializeAsync&lt;T&gt;(T data, Stream stream, SerializationFormatting formatting = SerializationFormatting.Indented,
        CancellationToken cancellationToken = default(CancellationToken)) =&gt;
        throw new NotImplementedException();
}</pre></div><p>Hooking up the serializer is performed in the <code class="literal">ConnectionSettings</code> constructor</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var pool = new SingleNodeConnectionPool(new Uri("http://localhost:9200"));
var connectionSettings = new ConnectionSettings(
    pool,
    sourceSerializer: (builtin, settings) =&gt; new VanillaSerializer()); <a id="CO39-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
var client = new ElasticClient(connectionSettings);</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>what the Func?</p></td></tr></table></div><p>If implementing <code class="literal">IElasticsearchSerializer</code> is enough, why do we need to provide an instance wrapped in a factory <code class="literal">Func</code>?</p><p>There are various cases where you might have a POCO type that contains a NEST type as one of its properties. For example,
consider if you want to use percolation; you need to store Elasticsearch queries as part of the <code class="literal">_source</code> of your document,
which means you need to have a POCO that looks something like this</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">public class MyPercolationDocument
{
    public QueryContainer Query { get; set; }
    public string Category { get; set; }
}</pre></div><p>A custom serializer would not know how to serialize <code class="literal">QueryContainer</code> or other NEST types that could appear as part of
the <code class="literal">_source</code> of a document, therefore a custom serializer needs to have a way to delegate serialization of NEST types
back to NEST’s built-in serializer.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_jsonnetserializer"></a>JsonNetSerializer<a href="https://github.com/elastic/elasticsearch-net/edit/master/docs/client-concepts/high-level/serialization/custom-serialization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>We ship a separate <a class="ulink" href="https://www.nuget.org/packages/NEST.JsonNetSerializer" target="_top">NEST.JsonNetSerializer</a> package that helps in composing a custom <code class="literal">SourceSerializer</code>
using <code class="literal">Json.NET</code>, that is smart enough to delegate the serialization of known NEST types back to the built-in
<code class="literal">RequestResponseSerializer</code>. This package is also useful if you want to control how your documents and values are stored
and retrieved from Elasticsearch using <code class="literal">Json.NET</code>, without interfering with the way NEST uses <code class="literal">Json.NET</code> internally.</p><p>The easiest way to hook this custom source serializer up is as follows</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var pool = new SingleNodeConnectionPool(new Uri("http://localhost:9200"));
var connectionSettings =
    new ConnectionSettings(pool, sourceSerializer: JsonNetSerializer.Default);
var client = new ElasticClient(connectionSettings);</pre></div><p><code class="literal">JsonNetSerializer.Default</code> is just syntactic sugar for passing a delegate like</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var pool = new SingleNodeConnectionPool(new Uri("http://localhost:9200"));
var connectionSettings = new ConnectionSettings(
    pool,
    sourceSerializer: (builtin, settings) =&gt; new JsonNetSerializer(builtin, settings));
var client = new ElasticClient(connectionSettings);</pre></div><p><code class="literal">JsonNetSerializer</code>'s constructor takes several methods that allow you to control the <code class="literal">JsonSerializerSettings</code> and modify
the contract resolver from <code class="literal">Json.NET</code>.</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var pool = new SingleNodeConnectionPool(new Uri("http://localhost:9200"));
var connectionSettings =
    new ConnectionSettings(pool, sourceSerializer: (builtin, settings) =&gt; new JsonNetSerializer(
        builtin, settings,
        () =&gt; new JsonSerializerSettings { NullValueHandling = NullValueHandling.Include },
        resolver =&gt; resolver.NamingStrategy = new SnakeCaseNamingStrategy()
    ));
var client = new ElasticClient(connectionSettings);</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_derived_serializers"></a>Derived serializers<a href="https://github.com/elastic/elasticsearch-net/edit/master/docs/client-concepts/high-level/serialization/custom-serialization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If you’d like to be more explicit, you can also derive from <code class="literal">ConnectionSettingsAwareSerializerBase</code>
and override the <code class="literal">CreateJsonSerializerSettings</code> and <code class="literal">ModifyContractResolver</code> methods</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">public class MyFirstCustomJsonNetSerializer : ConnectionSettingsAwareSerializerBase
{
    public MyFirstCustomJsonNetSerializer(IElasticsearchSerializer builtinSerializer, IConnectionSettingsValues connectionSettings)
        : base(builtinSerializer, connectionSettings) { }

    protected override JsonSerializerSettings CreateJsonSerializerSettings() =&gt;
        new JsonSerializerSettings
        {
            NullValueHandling = NullValueHandling.Include
        };

    protected override void ModifyContractResolver(ConnectionSettingsAwareContractResolver resolver) =&gt;
        resolver.NamingStrategy = new SnakeCaseNamingStrategy();
}</pre></div><p>Using <code class="literal">MyCustomJsonNetSerializer</code>, we can serialize using</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">a Json.NET <code class="literal">NamingStrategy</code> that snake cases property names</li><li class="listitem"><code class="literal">JsonSerializerSettings</code> that includes <code class="literal">null</code> properties</li></ul></div><p>without affecting how NEST’s own types are serialized. Furthermore, because this serializer is aware of
the built-in serializer, we can automatically inject a <code class="literal">JsonConverter</code> to handle
known NEST types that could appear as part of the source, such as the aformentioned <code class="literal">QueryContainer</code>.</p><p>Let’s demonstrate with an example document type</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">public class MyDocument
{
    public int Id { get; set; }

    public string Name { get; set; }

    public string FilePath { get; set; }

    public int OwnerId { get; set; }

    public IEnumerable&lt;MySubDocument&gt; SubDocuments { get; set; }
}

public class MySubDocument
{
    public string Name { get; set; }
}</pre></div><p>Hooking up the serializer and using it is as follows</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var pool = new SingleNodeConnectionPool(new Uri("http://localhost:9200"));
var connectionSettings = new ConnectionSettings(
    pool,
    connection: new InMemoryConnection(), <a id="CO40-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    sourceSerializer: (builtin, settings) =&gt; new MyFirstCustomJsonNetSerializer(builtin, settings))
    .DefaultIndex("my-index");

var client = new ElasticClient(connectionSettings);</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO40-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>an <span class="emphasis"><em>in-memory</em></span> connection is used here for example purposes. In your production application, you would use an <code class="literal">IConnection</code> implementation that actually sends a request.</p></td></tr></table></div><p>Now, if we index an instance of our document type</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var document = new MyDocument
{
    Id = 1,
    Name = "My first document",
    OwnerId = 2
};

var ndexResponse = client.IndexDocument(document);</pre></div><p>it serializes to</p><div class="pre_wrapper lang-javascript"><pre class="programlisting prettyprint lang-javascript">{
  "id": 1,
  "name": "My first document",
  "file_path": null,
  "owner_id": 2,
  "sub_documents": null
}</pre></div><p>which adheres to the conventions of our configured <code class="literal">MyCustomJsonNetSerializer</code> serializer.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_serializing_type_information"></a>Serializing Type Information<a href="https://github.com/elastic/elasticsearch-net/edit/master/docs/client-concepts/high-level/serialization/custom-serialization.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Here’s another example that implements a custom contract resolver. The custom contract resolver
will include the type name within the serialized JSON for the document, which can be useful when
returning covariant document types within a collection.</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">public class MySecondCustomContractResolver : ConnectionSettingsAwareContractResolver
{
    public MySecondCustomContractResolver(IConnectionSettingsValues connectionSettings)
        : base(connectionSettings) { }

    protected override JsonContract CreateContract(Type objectType)
    {
        var contract = base.CreateContract(objectType);
        if (contract is JsonContainerContract containerContract)
        {
            if (containerContract.ItemTypeNameHandling == null)
                containerContract.ItemTypeNameHandling = TypeNameHandling.None;
        }

        return contract;
    }
}

public class MySecondCustomJsonNetSerializer : ConnectionSettingsAwareSerializerBase
{
    public MySecondCustomJsonNetSerializer(IElasticsearchSerializer builtinSerializer, IConnectionSettingsValues connectionSettings)
        : base(builtinSerializer, connectionSettings) { }

    protected override JsonSerializerSettings CreateJsonSerializerSettings() =&gt;
        new JsonSerializerSettings
        {
            TypeNameHandling = TypeNameHandling.All,
            NullValueHandling = NullValueHandling.Ignore,
            TypeNameAssemblyFormatHandling = TypeNameAssemblyFormatHandling.Simple
        };

    protected override ConnectionSettingsAwareContractResolver CreateContractResolver() =&gt;
        new MySecondCustomContractResolver(ConnectionSettings); <a id="CO41-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO41-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>override the contract resolver</p></td></tr></table></div><p>Now, hooking up this serializer</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var pool = new SingleNodeConnectionPool(new Uri("http://localhost:9200"));
var connectionSettings = new ConnectionSettings(
        pool,
        connection: new InMemoryConnection(),
        sourceSerializer: (builtin, settings) =&gt; new MySecondCustomJsonNetSerializer(builtin, settings))
    .DefaultIndex("my-index");

var client = new ElasticClient(connectionSettings);</pre></div><p>and indexing an instance of our document type</p><div class="pre_wrapper lang-csharp"><pre class="programlisting prettyprint lang-csharp">var document = new MyDocument
{
    Id = 1,
    Name = "My first document",
    OwnerId = 2,
    SubDocuments = new []
    {
        new MySubDocument { Name = "my first sub document" },
        new MySubDocument { Name = "my second sub document" },
    }
};

var ndexResponse = client.IndexDocument(document);</pre></div><p>serializes to</p><div class="pre_wrapper lang-javascript"><pre class="programlisting prettyprint lang-javascript">{
  "$type": "Tests.ClientConcepts.HighLevel.Serialization.GettingStarted+MyDocument, Tests",
  "id": 1,
  "name": "My first document",
  "ownerId": 2,
  "subDocuments": [
    {
      "name": "my first sub document"
    },
    {
      "name": "my second sub document"
    }
  ]
}</pre></div><p>the type information is serialized for the outer <code class="literal">MyDocument</code> instance, but not for each
<code class="literal">MySubDocument</code> instance in the <code class="literal">SubDocuments</code> collection.</p><p>When implementing a custom contract resolver derived from <code class="literal">ConnectionSettingsAwareContractResolver</code>,
be careful not to change the behaviour of the resolver for NEST types; doing so will result in
unexpected behaviour.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Per the <a class="ulink" href="https://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_TypeNameHandling.htm" target="_top">Json.NET documentation on TypeNameHandling</a>,
it should be used with caution when your application deserializes JSON from an external source.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="serialization.html">
              « 
              Serialization</a>
           
        </span><span class="next">
           
          <a href="extending-nest-types.html">Extending NEST types
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>

  
            <script type="text/javascript" src="/guide/static/docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
