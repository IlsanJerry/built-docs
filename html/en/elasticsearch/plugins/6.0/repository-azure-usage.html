<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Azure Repository
        | Elasticsearch Plugins and Integrations [6.0]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Plugins and Integrations [6.0]" /><link rel="up" href="repository-azure.html" title="Azure Repository Plugin" /><link rel="prev" href="repository-azure.html" title="Azure Repository Plugin" /><link rel="next" href="repository-s3.html" title="S3 Repository Plugin" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Plugins/6.0" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="6.0" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Plugins and Integrations
      [6.0]
    </a></span> » <span class="breadcrumb-link"><a href="repository.html">Snapshot/Restore Repository Plugins</a></span> » <span class="breadcrumb-link"><a href="repository-azure.html">Azure Repository Plugin</a></span> » <span class="breadcrumb-node">Azure Repository</span></div><div class="navheader"><span class="prev"><a href="repository-azure.html">
              « 
              Azure Repository Plugin</a>
           
        </span><span class="next">
           
          <a href="repository-s3.html">S3 Repository Plugin
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="repository-azure-usage"></a>Azure Repository<a href="https://github.com/elastic/elasticsearch/edit/6.0/docs/plugins/repository-azure.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To enable Azure repositories, you have first to set your azure storage settings in <code class="literal">elasticsearch.yml</code> file:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">cloud:
    azure:
        storage:
            my_account:
                account: your_azure_storage_account
                key: your_azure_storage_key</pre></div><p>Note that you can also define more than one account:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">cloud:
    azure:
        storage:
            my_account1:
                account: your_azure_storage_account1
                key: your_azure_storage_key1
                default: true
            my_account2:
                account: your_azure_storage_account2
                key: your_azure_storage_key2</pre></div><p><code class="literal">my_account1</code> is the default account which will be used by a repository unless you set an explicit one.</p><p>You can set the client side timeout to use when making any single request. It can be defined globally, per account or both.
It’s not set by default which means that Elasticsearch is using the
<a class="ulink" href="http://azure.github.io/azure-storage-java/com/microsoft/azure/storage/RequestOptions.html#setTimeoutIntervalInMs(java.lang.Integer)" target="_top">default value</a>
set by the azure client (known as 5 minutes).</p><p><code class="literal">max_retries</code> can help to control the exponential backoff policy. It will fix the number of retries
in case of failures before considering the snapshot is failing. Defaults to <code class="literal">3</code> retries.
The initial backoff period is defined by Azure SDK as <code class="literal">30s</code>. Which means <code class="literal">30s</code> of wait time
before retrying after a first timeout or failure. The maximum backoff period is defined by Azure SDK as
<code class="literal">90s</code>.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">cloud:
    azure:
        storage:
            timeout: 10s
            my_account1:
                account: your_azure_storage_account1
                key: your_azure_storage_key1
                default: true
                max_retries: 7
            my_account2:
                account: your_azure_storage_account2
                key: your_azure_storage_key2
                timeout: 30s</pre></div><p>In this example, timeout will be <code class="literal">10s</code> per try for <code class="literal">my_account1</code> with <code class="literal">7</code> retries before failing
and <code class="literal">30s</code> per try for <code class="literal">my_account2</code> with <code class="literal">3</code> retries.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h3>Supported Azure Storage Account types</h3><p>The Azure Repository plugin works with all Standard storage accounts</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Standard Locally Redundant Storage - <code class="literal">Standard_LRS</code></li><li class="listitem">Standard Zone-Redundant Storage - <code class="literal">Standard_ZRS</code></li><li class="listitem">Standard Geo-Redundant Storage - <code class="literal">Standard_GRS</code></li><li class="listitem">Standard Read Access Geo-Redundant Storage - <code class="literal">Standard_RAGRS</code></li></ul></div><p><a class="ulink" href="https://azure.microsoft.com/en-gb/documentation/articles/storage-premium-storage" target="_top">Premium Locally Redundant Storage</a> (<code class="literal">Premium_LRS</code>) is <span class="strong strong"><strong>not supported</strong></span> as it is only usable as VM disk storage, not as general storage.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="repository-azure-repository-settings"></a>Repository settings<a href="https://github.com/elastic/elasticsearch/edit/6.0/docs/plugins/repository-azure.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Azure repository supports following settings:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">account</code></span></dt><dd>Azure account settings to use. Defaults to the only one if you set a single
account or to the one marked as <code class="literal">default</code> if you have more than one.</dd><dt><span class="term"><code class="literal">container</code></span></dt><dd>Container name. You must create the azure container before creating the repository.
Defaults to <code class="literal">elasticsearch-snapshots</code>.</dd><dt><span class="term"><code class="literal">base_path</code></span></dt><dd>Specifies the path within container to repository data. Defaults to empty
(root directory).</dd><dt><span class="term"><code class="literal">chunk_size</code></span></dt><dd>Big files can be broken down into chunks during snapshotting if needed.
The chunk size can be specified in bytes or by using size value notation,
i.e. <code class="literal">1g</code>, <code class="literal">10m</code>, <code class="literal">5k</code>. Defaults to <code class="literal">64m</code> (64m max)</dd><dt><span class="term"><code class="literal">compress</code></span></dt><dd>When set to <code class="literal">true</code> metadata files are stored in compressed format. This
setting doesn’t affect index files that are already compressed by default.
Defaults to <code class="literal">false</code>.</dd><dt><span class="term"><code class="literal">readonly</code></span></dt><dd>Makes repository read-only. Defaults to <code class="literal">false</code>.</dd><dt><span class="term"><code class="literal">location_mode</code></span></dt><dd><code class="literal">primary_only</code> or <code class="literal">secondary_only</code>. Defaults to <code class="literal">primary_only</code>. Note that if you set it
to <code class="literal">secondary_only</code>, it will force <code class="literal">readonly</code> to true.</dd></dl></div><p>Some examples, using scripts:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console"># The simpliest one
PUT _snapshot/my_backup1
{
    "type": "azure"
}

# With some settings
PUT _snapshot/my_backup2
{
    "type": "azure",
    "settings": {
        "container": "backup-container",
        "base_path": "backups",
        "chunk_size": "32m",
        "compress": true
    }
}


# With two accounts defined in elasticsearch.yml (my_account1 and my_account2)
PUT _snapshot/my_backup3
{
    "type": "azure",
    "settings": {
        "account": "my_account1"
    }
}
PUT _snapshot/my_backup4
{
    "type": "azure",
    "settings": {
        "account": "my_account2",
        "location_mode": "primary_only"
    }
}</pre></div><div class="console_widget" data-snippet="snippets/29.console"></div><p>Example using Java:</p><div class="pre_wrapper lang-java"><pre class="programlisting prettyprint lang-java">client.admin().cluster().preparePutRepository("my_backup_java1")
    .setType("azure").setSettings(Settings.builder()
        .put(Storage.CONTAINER, "backup-container")
        .put(Storage.CHUNK_SIZE, new ByteSizeValue(32, ByteSizeUnit.MB))
    ).get();</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="repository-azure-validation"></a>Repository validation rules<a href="https://github.com/elastic/elasticsearch/edit/6.0/docs/plugins/repository-azure.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>According to the <a class="ulink" href="http://msdn.microsoft.com/en-us/library/dd135715.aspx" target="_top">containers naming guide</a>, a container name must
be a valid DNS name, conforming to the following naming rules:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Container names must start with a letter or number, and can contain only letters, numbers, and the dash (-) character.</li><li class="listitem">Every dash (-) character must be immediately preceded and followed by a letter or number; consecutive dashes are not
permitted in container names.</li><li class="listitem">All letters in a container name must be lowercase.</li><li class="listitem">Container names must be from 3 through 63 characters long.</li></ul></div></div></div><div class="navfooter"><span class="prev"><a href="repository-azure.html">
              « 
              Azure Repository Plugin</a>
           
        </span><span class="next">
           
          <a href="repository-s3.html">S3 Repository Plugin
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>
      </section>
    </div>

    
<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>

<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
