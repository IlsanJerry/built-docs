<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<title>EQL search | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="prev" href="indexing-aggregation-results.html" title="Indexing aggregation results with transforms"/>
<link rel="next" href="eql-syntax.html" title="EQL syntax reference"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-node">EQL search</span>
</div>
<div class="navheader">
<span class="prev">
<a href="indexing-aggregation-results.html">« Indexing aggregation results with transforms</a>
</span>
<span class="next">
<a href="eql-syntax.html">EQL syntax reference »</a>
</span>
</div>
<div class="part xpack">
<div class="titlepage"><div><div>
<h1 class="title"><a id="eql"></a>EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h1>
</div></div></div>
<div class="openblock partintro">
<div class="content">

<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p><a href="https://eql.readthedocs.io/en/latest/query-guide/index.html" class="ulink" target="_top">Event Query Language (EQL)</a> is a query language for
event-based, time series data, such as logs.</p>
<h2><a id="eql-advantages"></a>Advantages of EQL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h2>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>EQL lets you express relationships between events.</strong></span><br>
Many query languages allow you to match only single events. EQL lets you match a
sequence of events across different event categories and time spans.
</li>
<li class="listitem">
<span class="strong strong"><strong>EQL has a low learning curve.</strong></span><br>
<a class="xref" href="eql-syntax.html" title="EQL syntax reference">EQL syntax</a> looks like other query languages. It lets you write
and read queries intuitively, which makes for quick, iterative searching.
</li>
<li class="listitem">
<span class="strong strong"><strong>We designed EQL for security use cases.</strong></span><br>
While you can use EQL for any event-based data, we created EQL for threat
hunting. EQL not only supports indicator of compromise (IOC) searching but
makes it easy to describe activity that goes beyond IOCs.
</li>
</ul>
</div>
<h2><a id="eql-required-fields"></a>Required fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h2>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>While no schema is required to use EQL in Elasticsearch, we recommend using the
<a href="/guide/en/ecs/1.6" class="ulink" target="_top">Elastic Common Schema (ECS)</a>. EQL search is designed to work
with core ECS fields by default.</p>
</div>
</div>
<p>EQL assumes each document in a data stream or index corresponds to an event. To
run an EQL search, each document must contain a <em>timestamp</em> and <em>event category</em>
field.</p>
<p>EQL uses the <code class="literal">@timestamp</code> and <code class="literal">event.category</code> fields from the <a href="/guide/en/ecs/1.6" class="ulink" target="_top">ECS</a> as
the default timestamp and event category fields. If your documents use a
different timestamp or event category field, you must specify it in the search
request. See <a class="xref" href="eql.html#specify-a-timestamp-or-event-category-field" title="Specify a timestamp or event category field">Specify a timestamp or event category field</a>.</p>
<h2><a id="run-an-eql-search"></a>Run an EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h2>
<p>You can use the <a class="xref" href="eql-search-api.html" title="EQL search API">EQL search API</a> to run an EQL search. For
supported query syntax, see <a class="xref" href="eql-syntax.html" title="EQL syntax reference"><em>Syntax reference</em></a>.</p>
<p>The following request searches <code class="literal">my-index-000001</code> for events with an
<code class="literal">event.category</code> of <code class="literal">process</code> and a <code class="literal">process.name</code> of <code class="literal">regsvr32.exe</code>. Each
document in <code class="literal">my-index-000001</code> includes a <code class="literal">@timestamp</code> and <code class="literal">event.category</code>
field.</p>
<a id="24d6cd42862d580073be00b31e03c469"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1202.console"></div>
<p>By default, EQL searches return only the top 10 matching hits. For basic EQL
queries, these hits are matching events and are included in the <code class="literal">hits.events</code>
property. Matching events are sorted by timestamp, converted to milliseconds
since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>, in ascending order.</p>
<a id="26701665ac4f1afbd1845031d36516d7"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "events": [
      {
        "_index": "my-index-000001",
        "_id": "OQmfCaduce8zoHT93o4H",
        "_source": {
          "@timestamp": "2099-12-07T11:07:09.000Z",
          "event": {
            "category": "process",
            "id": "aR3NWVOs",
            "sequence": 4
          },
          "process": {
            "pid": 2012,
            "name": "regsvr32.exe",
            "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
            "executable": "C:\\Windows\\System32\\regsvr32.exe"
          }
        }
      },
      {
        "_index": "my-index-000001",
        "_id": "xLkCaj4EujzdNSxfYLbO",
        "_source": {
          "@timestamp": "2099-12-07T11:07:10.000Z",
          "event": {
            "category": "process",
            "id": "GTSmSqgz0U",
            "sequence": 6,
            "type": "termination"
          },
          "process": {
            "pid": 2012,
            "name": "regsvr32.exe",
            "executable": "C:\\Windows\\System32\\regsvr32.exe"
          }
        }
      }
    ]
  }
}</pre>
</div>
<p>You can use the <code class="literal">size</code> request body parameter to get a larger or smaller set of
hits. For example, the following request retrieves up to <code class="literal">50</code> matching hits.</p>
<a id="53b6dbc345cff7c6a298afbaf1612524"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    process where process.name == "regsvr32.exe"
  """,
  "size": 50
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1203.console"></div>
<h3><a id="eql-search-sequence"></a>Search for a sequence of events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>You can use EQL&#8217;s <a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence syntax</a> to search for an ordered
series of events.</p>
<p>The following EQL search request matches a sequence that:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Starts with an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">process</code>
</li>
<li class="listitem">
A <code class="literal">process.name</code> of <code class="literal">regsvr32.exe</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Followed by an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">file</code>
</li>
<li class="listitem">
A <code class="literal">file.name</code> that contains the substring <code class="literal">scrobj.dll</code>
</li>
</ul>
</div>
</li>
</ol>
</div>
<a id="33988931024f255b9871c9d374d4fb32"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    sequence
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1204.console"></div>
<p>Matching sequences are returned in the <code class="literal">hits.sequences</code> property.</p>
<a id="d2d49da7ea86d9d47d1d274f6dc84a66"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "sequences": [
      {
        "events": [
          {
            "_index": "my-index-000001",
            "_id": "OQmfCaduce8zoHT93o4H",
            "_source": {
              "@timestamp": "2099-12-07T11:07:09.000Z",
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 4
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              }
            }
          },
          {
            "_index": "my-index-000001",
            "_id": "yDwnGIJouOYGBzP0ZE9n",
            "_source": {
              "@timestamp": "2099-12-07T11:07:10.000Z",
              "event": {
                "category": "file",
                "id": "tZ1NWVOs",
                "sequence": 5
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              },
              "file": {
                "path": "C:\\Windows\\System32\\scrobj.dll",
                "name": "scrobj.dll"
              }
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
<p>You can use the <a class="xref" href="eql-syntax.html#eql-with-maxspan-keywords" title="with maxspan keywords"><code class="literal">with maxspan</code> keywords</a> to
constrain a sequence to a specified timespan.</p>
<p>The following EQL search request adds <code class="literal">with maxspan=1h</code> to the previous query.
This ensures all events in a matching sequence occur within <code class="literal">1h</code> (one hour) of
the first event&#8217;s timestamp.</p>
<a id="e7e60b3b1e1d7747359bcf6930f6ecdb"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    sequence with maxspan=1h
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1205.console"></div>
<p>You can further constrain matching event sequences using the
<a class="xref" href="eql-syntax.html#eql-by-keyword" title="by keyword"><code class="literal">by</code> keyword</a>.</p>
<p>The following EQL search request adds <code class="literal">by process.pid</code> to each event item. This
ensures events matching the sequence share the same <code class="literal">process.pid</code> field value.</p>
<a id="bcc810b79baf78b3c578de597952101f"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    sequence with maxspan=1h
      [ process where process.name == "regsvr32.exe" ] by process.pid
      [ file where stringContains(file.name, "scrobj.dll") ] by process.pid
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1206.console"></div>
<p>Because the <code class="literal">process.pid</code> field is shared across all events in the sequence, it
can be included using <code class="literal">sequence by</code>. The following query is equivalent to the
previous one.</p>
<a id="308d046c85f7e2524b52bcfa71caa8c9"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    sequence by process.pid with maxspan=1h
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1207.console"></div>
<p>The API returns the following response. The <code class="literal">hits.sequences.join_keys</code> property
contains the shared <code class="literal">process.pid</code> value for each matching event.</p>
<a id="52e7e55265ede700c0e643db567bec59"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "sequences": [
      {
        "join_keys": [
          2012
        ],
        "events": [
          {
            "_index": "my-index-000001",
            "_id": "OQmfCaduce8zoHT93o4H",
            "_source": {
              "@timestamp": "2099-12-07T11:07:09.000Z",
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 4
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              }
            }
          },
          {
            "_index": "my-index-000001",
            "_id": "yDwnGIJouOYGBzP0ZE9n",
            "_source": {
              "@timestamp": "2099-12-07T11:07:10.000Z",
              "event": {
                "category": "file",
                "id": "tZ1NWVOs",
                "sequence": 5
              },
              "process": {
                "pid": 2012,
                "name": "regsvr32.exe",
                "executable": "C:\\Windows\\System32\\regsvr32.exe"
              },
              "file": {
                "path": "C:\\Windows\\System32\\scrobj.dll",
                "name": "scrobj.dll"
              }
            }
          }
        ]
      }
    ]
  }
}</pre>
</div>
<p>You can use the <a class="xref" href="eql-syntax.html#eql-until-keyword" title="until keyword"><code class="literal">until</code> keyword</a> to specify an expiration
event for sequences. Matching sequences must end before this event.</p>
<p>The following request adds <code class="literal">until [ process where event.type == "termination" ]</code>
to the previous query. This ensures matching sequences end before a <code class="literal">process</code>
event with an <code class="literal">event.type</code> of <code class="literal">termination</code>.</p>
<a id="ef84b8e070d84d152f3ac4202039b315"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "query": """
    sequence by process.pid with maxspan=1h
      [ process where process.name == "regsvr32.exe" ]
      [ file where stringContains(file.name, "scrobj.dll") ]
    until [ process where event.type == "termination" ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1208.console"></div>
<h3><a id="specify-a-timestamp-or-event-category-field"></a>Specify a timestamp or event category field<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>To run an EQL search, each searched document must contain a timestamp and event
category field. The EQL search API uses the <code class="literal">@timestamp</code> and <code class="literal">event.category</code>
fields from the <a href="/guide/en/ecs/1.6" class="ulink" target="_top">Elastic Common Schema (ECS)</a> by default. If your
documents use a different timestamp or event category field, you must specify it
in the search request using the <code class="literal">timestamp_field</code> or <code class="literal">event_category_field</code>
parameters.</p>
<p>The event category field is typically mapped as a field type in the
<a class="xref" href="keyword.html" title="Keyword type family"><code class="literal">keyword</code></a> family. The timestamp field is typically mapped as a
<a class="xref" href="date.html" title="Date field type"><code class="literal">date</code></a> or <a class="xref" href="date_nanos.html" title="Date nanoseconds field type"><code class="literal">date_nanos</code></a> field.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You cannot use a <a class="xref" href="nested.html" title="Nested field type"><code class="literal">nested</code></a> field or the sub-fields of a <code class="literal">nested</code>
field as the timestamp or event category field. See <a class="xref" href="eql-syntax.html#eql-nested-fields" title="EQL search on nested fields">EQL search on nested fields</a>.</p>
</div>
</div>
<p>The following request uses the <code class="literal">timestamp_field</code> parameter to specify
<code class="literal">file.accessed</code> as the timestamp field. The request also uses the
<code class="literal">event_category_field</code> parameter to specify <code class="literal">file.type</code> as the event category
field.</p>
<a id="42a304265678723c3b24d3793c1a1f81"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "timestamp_field": "file.accessed",
  "event_category_field": "file.type",
  "query": """
    file where (file.size &gt; 1 and file.type == "file")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1209.console"></div>
<h3><a id="eql-search-specify-a-sort-tiebreaker"></a>Specify a sort tiebreaker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, the EQL search API sorts matching hits in the search response by
timestamp. However, if two or more events share the same timestamp, you can use
a tiebreaker field to sort the events in ascending, lexicographic order.</p>
<p>The EQL search API uses <code class="literal">event.sequence</code> as the default tiebreaker field. You
can use the <code class="literal">tiebreaker_field</code> parameter to specify another field.</p>
<p>The following request specifies <code class="literal">event.id</code> as the tiebreaker field.</p>
<a id="8d30bbaa5cda748380d87cc2e84243f1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "tiebreaker_field": "event.id",
  "query": """
    process where process.name == "cmd.exe" and stringContains(process.executable, "System32")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1210.console"></div>
<h3><a id="eql-search-filter-query-dsl"></a>Filter using query DSL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>You can use the <code class="literal">filter</code> parameter to specify an additional query using
<a class="xref" href="query-dsl.html" title="Query DSL">query DSL</a>. This query filters the documents on which the EQL query
runs.</p>
<p>The following request uses a <code class="literal">range</code> query to filter <code class="literal">my-index-000001</code> to only
documents with a <code class="literal">file.size</code> value greater than <code class="literal">1</code> but less than <code class="literal">1000000</code>
bytes. The EQL query in <code class="literal">query</code> parameter then runs on these filtered documents.</p>
<a id="e5d13fbbe5bf8e7fbc04c360be3c67a5"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "filter": {
    "range" : {
      "file.size" : {
        "gte" : 1,
        "lte" : 1000000
      }
    }
  },
  "query": """
    file where (file.type == "file" and file.name == "cmd.exe")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1211.console"></div>
<h3><a id="eql-search-case-sensitive"></a>Run a case-sensitive EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, matching for EQL queries is case-insensitive. You can use the
<code class="literal">case_sensitive</code> parameter to toggle case sensitivity on or off.</p>
<p>The following search request contains a query that matches <code class="literal">process</code> events
with a <code class="literal">process.executable</code> containing <code class="literal">System32</code>.</p>
<p>Because <code class="literal">case_sensitive</code> is <code class="literal">true</code>, this query only matches <code class="literal">process.executable</code>
values containing <code class="literal">System32</code> with the exact same capitalization. A
<code class="literal">process.executable</code> value containing <code class="literal">system32</code> or <code class="literal">SYSTEM32</code> would not match
this query.</p>
<a id="75f98b142517f8e9c70cc59f434de0e1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "keep_on_completion": true,
  "case_sensitive": true,
  "query": """
    process where stringContains(process.executable, "System32")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1212.console"></div>
<h3><a id="eql-search-async"></a>Run an async EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>EQL searches are designed to run on large volumes of data quickly, often
returning results in milliseconds. For this reason, EQL searches are
<em>synchronous</em> by default. The search request waits for complete results before
returning a response.</p>
<p>However, complete results can take longer for searches across:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="frozen-indices.html" title="Frozen indices">Frozen indices</a>
</li>
<li class="listitem">
<a class="xref" href="modules-cross-cluster-search.html" title="Search across clusters">Multiple clusters</a>
</li>
<li class="listitem">
Many shards
</li>
</ul>
</div>
<p>To avoid long waits, you can use the <code class="literal">wait_for_completion_timeout</code> parameter to
run an <em>asynchronous</em>, or <em>async</em>, EQL search.</p>
<p>Set <code class="literal">wait_for_completion_timeout</code> to a duration you&#8217;d like to wait
for complete search results. If the search request does not finish within this
period, the search becomes async and returns a response that includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A search ID, which can be used to monitor the progress of the async search.
</li>
<li class="listitem">
An <code class="literal">is_partial</code> value of <code class="literal">true</code>, meaning the response does not contain
complete search results.
</li>
<li class="listitem">
An <code class="literal">is_running</code> value of <code class="literal">true</code>, meaning the search is async and ongoing.
</li>
</ul>
</div>
<p>The async search continues to run in the background without blocking
other requests.</p>
<p>The following request searches the <code class="literal">frozen-my-index-000001</code> index, which has been
<a class="xref" href="frozen-indices.html" title="Frozen indices">frozen</a> for storage and is rarely searched.</p>
<p>Because searches on frozen indices are expected to take longer to complete, the
request contains a <code class="literal">wait_for_completion_timeout</code> parameter value of <code class="literal">2s</code> (two
seconds). If the request does not return complete results in two seconds, the
search becomes async and returns a search ID.</p>
<a id="4d6a199e674a7c8f375e6fcab6ed2909"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /frozen-my-index-000001/_eql/search
{
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1213.console"></div>
<p>After two seconds, the request returns the following response. Note <code class="literal">is_partial</code>
and <code class="literal">is_running</code> properties are <code class="literal">true</code>, indicating an async search.</p>
<a id="109c26a2fc0d07c401f5a94feab0fe39"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_partial": true,
  "is_running": true,
  "took": 2000,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<p>You can use the the search ID and the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL
search API</a> to check the progress of an async search.</p>
<p>The get async EQL search API also accepts a <code class="literal">wait_for_completion_timeout</code>
parameter. If ongoing search does not complete during this period, the response
returns an <code class="literal">is_partial</code> value of <code class="literal">true</code> and no search results.</p>
<p>The following get async EQL search API request checks the progress of the
previous async EQL search. The request specifies a <code class="literal">wait_for_completion_timeout</code>
query parameter value of <code class="literal">2s</code> (two seconds).</p>
<a id="1cca4bb2f0ea7e43181be8bd965149d4"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?wait_for_completion_timeout=2s</pre>
</div>
<div class="console_widget" data-snippet="snippets/1214.console"></div>
<p>The request returns the following response. Note <code class="literal">is_partial</code> and <code class="literal">is_running</code>
are <code class="literal">false</code>, indicating the async search has finished and the search results
in the <code class="literal">hits</code> property are complete.</p>
<a id="35f8ce328a42fecfb979e43fdc246516"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_partial": false,
  "is_running": false,
  "took": 2000,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<h3><a id="eql-search-store-async-eql-search"></a>Change the search retention period<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, the EQL search API stores async searches for five days. After this
period, any searches and their results are deleted. You can use the <code class="literal">keep_alive</code>
parameter to change this retention period.</p>
<p>In the following EQL search request, the <code class="literal">keep_alive</code> parameter is <code class="literal">2d</code> (two
days). If the search becomes async, its results
are stored on the cluster for two days. After two days, the async
search and its results are deleted, even if it&#8217;s still ongoing.</p>
<a id="54b108acca26f88c2762af09b3fdf720"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "keep_alive": "2d",
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1215.console"></div>
<p>You can use the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL search API</a>'s
`keep_alive`parameter to later change the retention period. The new
retention period starts after the get request executes.</p>
<p>The following request sets the <code class="literal">keep_alive</code> query parameter to <code class="literal">5d</code> (five days).
The async search and its results are deleted five days after the get request
executes.</p>
<a id="6693f0ffa0de3229b5dedda197810e70"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?keep_alive=5d</pre>
</div>
<div class="console_widget" data-snippet="snippets/1216.console"></div>
<p>You can use the <a class="xref" href="delete-async-eql-search-api.html" title="Delete async EQL search API">delete async EQL search API</a> to
manually delete an async EQL search before the <code class="literal">keep_alive</code> period ends. If the
search is still ongoing, this cancels the search request.</p>
<p>The following request deletes an async EQL search and its results.</p>
<a id="636e5683c31983de60a48599ede620f9"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?keep_alive=5d</pre>
</div>
<div class="console_widget" data-snippet="snippets/1217.console"></div>
<h3><a id="eql-search-store-sync-eql-search"></a>Store synchronous EQL searches<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/eql/eql.asciidoc">edit</a></h3>
<p>By default, the EQL search API only stores async searches that cannot be
completed within the period set by <code class="literal">wait_for_completion_timeout</code>.</p>
<p>To save the results of searches that complete during this period, set the
<code class="literal">keep_on_completion</code> parameter to <code class="literal">true</code>.</p>
<p>In the following search request, <code class="literal">keep_on_completion</code> is <code class="literal">true</code>. This means the
search results are stored on the cluster, even if the search completes within
the <code class="literal">2s</code> (two-second) period set by the <code class="literal">wait_for_completion_timeout</code> parameter.</p>
<a id="9ce31bb0b24362f35476fd9a43a201a7"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index-000001/_eql/search
{
  "keep_on_completion": true,
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1218.console"></div>
<p>The API returns the following response. A search ID is provided in the <code class="literal">id</code>
property. <code class="literal">is_partial</code> and <code class="literal">is_running</code> are <code class="literal">false</code>, indicating the EQL search
was synchronous and returned complete results in <code class="literal">hits</code>.</p>
<a id="d6afd0b695bfaba91e3b1bf71c1f9c9d"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY=",
  "is_partial": false,
  "is_running": false,
  "took": 52,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<p>You can use the search ID and the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL
search API</a> to retrieve the same results later.</p>
<a id="a669e9d56e34c95ef4c780e92ed307f1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY=</pre>
</div>
<div class="console_widget" data-snippet="snippets/1219.console"></div>
<p>Saved synchronous searches are still subject to the retention period set by the
<code class="literal">keep_alive</code> parameter. After this period, the search and its results are
deleted.</p>
<p>You can also manually delete saved synchronous searches using the
<a class="xref" href="delete-async-eql-search-api.html" title="Delete async EQL search API">delete async EQL search API</a>.</p>
</div>
</div>




</div>
<div class="navfooter">
<span class="prev">
<a href="indexing-aggregation-results.html">« Indexing aggregation results with transforms</a>
</span>
<span class="next">
<a href="eql-syntax.html">EQL syntax reference »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true},"go":{"hasAny":true},"js":{"hasAny":true}}}}</script>
  </body>
</html>
