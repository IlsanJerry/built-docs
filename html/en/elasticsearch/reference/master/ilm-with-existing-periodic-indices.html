<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Managing existing periodic indices with ILM
        | Elasticsearch Reference [master]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="ilm-with-existing-indices.html" title="Using ILM with existing indices" /><link rel="prev" href="ilm-with-existing-indices.html" title="Using ILM with existing indices" /><link rel="next" href="ilm-reindexing-into-rollover.html" title="Reindexing via ILM" /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="index-lifecycle-management.html">Managing the index lifecycle</a></span> » <span class="breadcrumb-link"><a href="ilm-with-existing-indices.html">Using ILM with existing indices</a></span> » <span class="breadcrumb-node">Managing existing periodic indices with ILM</span></div><div class="navheader"><span class="prev"><a href="ilm-with-existing-indices.html">
              « 
              Using ILM with existing indices</a>
           
        </span><span class="next">
           
          <a href="ilm-reindexing-into-rollover.html">Reindexing via ILM
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ilm-with-existing-periodic-indices"></a>Managing existing periodic indices with ILM<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/ilm-with-existing-indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The examples in this section assume daily indices as set up in
<a class="link" href="ilm-with-existing-indices.html" title="Using ILM with existing indices">the previous section</a>.</p></div></div><p>The simplest way to manage existing indices while transitioning to fully
ILM-managed indices is to allow all new indices to be fully managed by
ILM before attaching ILM policies to existing indices. To do this,
all new documents should be directed to ILM-managed indices - if you are
using Beats or Logstash data shippers, upgrading all of those shippers to
version 7.0.0 or higher will take care of that part for you. If you are not
using Beats or Logstash, you may need to set up ILM for new indices yourself as
demonstrated in the <a class="link" href="getting-started-index-lifecycle-management.html" title="Getting started with index lifecycle management">getting started
guide</a>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If you are using Beats through Logstash, you may need to change your
Logstash output configuration and invoke the Beats setup to use ILM for new
data.</p></div></div><p>Once all new documents are being written to fully ILM-managed indices, it
is easy to add an ILM policy to existing indices. However, there are two
things to keep in mind when doing this, and a trick that makes those two things
much easier to handle.</p><p>The two biggest things to keep in mind are:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Existing periodic indices shouldn’t use policies with rollover, because
rollover is used to manage where new data goes. Since existing indices should no
longer be receiving new documents, there is no point to using rollover for them.</li><li class="listitem">ILM policies attached to existing indices will compare the <code class="literal">min_age</code>
for each phase to the original creation date of the index, and so might proceed
through multiple phases immediately.</li></ol></div><p>The first one is the most important, because it makes it difficult to use the
same policy for new and existing periodic indices. But that’s easy to solve
with one simple trick: Create a second policy for existing indices, in addition
to the one for new indices. ILM policies are cheap to create, so don’t be
afraid to have more than one. Modifying a policy designed for new indices to be
used on existing indices is generally very simple: just remove the <code class="literal">rollover</code>
action.</p><p>For example, if you created a policy for your new indices with each phase
like so:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/mylogs_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "25GB"
          }
        }
      },
      "warm": {
        "min_age": "1d",
        "actions": {
          "forcemerge": {
            "max_num_segments": 1
          }
        }
      },
      "cold": {
        "min_age": "7d",
        "actions": {
          "freeze": {}
        }
      },
      "delete": {
        "min_age": "30d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/965.console"></div><p>You can create a policy for pre-existing indices by removing the <code class="literal">rollover</code>
action, and in this case, the <code class="literal">hot</code> phase is now empty so we can remove that
too:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/mylogs_policy_existing
{
  "policy": {
    "phases": {
      "warm": {
        "min_age": "1d",
        "actions": {
          "forcemerge": {
            "max_num_segments": 1
          }
        }
      },
      "cold": {
        "min_age": "7d",
        "actions": {
          "freeze": {}
        }
      },
      "delete": {
        "min_age": "30d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/966.console"></div><p>Creating a separate policy for existing indices will also allow using different
<code class="literal">min_age</code> values. You may want to use higher values to prevent many indices from
running through the policy at once, which may be important if your policy
includes potentially resource-intensive operations like force merge.</p><p>You can configure the lifecycle for many indices at once by using wildcards in
the index name when calling the <a class="link" href="indices-update-settings.html" title="Update index settings API">Update Settings API</a>
to set the policy name, but be careful that you don’t include any indices that
you don’t want to change the policy for:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT mylogs-pre-ilm*/_settings <a id="CO312-1"></a><i class="conum" data-value="1"></i>
{
  "index": {
    "lifecycle": {
      "name": "mylogs_policy_existing"
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/967.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO312-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This pattern will match all indices with names that start with
<code class="literal">mylogs-pre-ilm</code></p></td></tr></table></div><p>Once all pre-ILM indices have aged out and been deleted, the policy for
older periodic indices can be deleted.</p></div><div class="navfooter"><span class="prev"><a href="ilm-with-existing-indices.html">
              « 
              Using ILM with existing indices</a>
           
        </span><span class="next">
           
          <a href="ilm-reindexing-into-rollover.html">Reindexing via ILM
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {"alternatives":{"console":{"php":{"hasAny":true},"csharp":{"hasAny":true},"python":{"hasAny":true},"ruby":{"hasAny":true}}}}</script>
  </body>
</html>
