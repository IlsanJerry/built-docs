<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Actions
        | Elasticsearch Reference [7.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [7.4]" /><link rel="up" href="ilm-policy-definition.html" title="Policy phases and actions" /><link rel="prev" href="_phase_execution.html" title="Phase Execution" /><link rel="next" href="_full_policy.html" title="Full Policy" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.4" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="7.4" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.4]
    </a></span> » <span class="breadcrumb-link"><a href="index-lifecycle-management.html">Managing the index lifecycle</a></span> » <span class="breadcrumb-link"><a href="ilm-policy-definition.html">Policy phases and actions</a></span> » <span class="breadcrumb-node">Actions</span></div><div class="navheader"><span class="prev"><a href="_phase_execution.html">
              « 
              Phase Execution</a>
           
        </span><span class="next">
           
          <a href="_full_policy.html">Full Policy
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_actions"></a>Actions<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The below list shows the actions which are available in each phase.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The order that configured actions are performed in within each phase is
determined by automatically by ILM, and cannot be changed by changing the
policy definition.</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">Hot</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><a class="link" href="_actions.html#ilm-set-priority-action" title="Set Priority">Set Priority</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-unfollow-action" title="Unfollow">Unfollow</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-rollover-action" title="Rollover">Rollover</a></li></ul></div></li><li class="listitem"><p class="simpara">Warm</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><a class="link" href="_actions.html#ilm-set-priority-action" title="Set Priority">Set Priority</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-unfollow-action" title="Unfollow">Unfollow</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-readonly-action" title="Read-Only">Read-Only</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-allocate-action" title="Allocate">Allocate</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-shrink-action" title="Shrink">Shrink</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-forcemerge-action" title="Force Merge">Force Merge</a></li></ul></div></li><li class="listitem"><p class="simpara">Cold</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><a class="link" href="_actions.html#ilm-set-priority-action" title="Set Priority">Set Priority</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-unfollow-action" title="Unfollow">Unfollow</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-allocate-action" title="Allocate">Allocate</a></li><li class="listitem"><a class="link" href="_actions.html#ilm-freeze-action" title="Freeze">Freeze</a></li></ul></div></li><li class="listitem"><p class="simpara">Delete</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><a class="link" href="_actions.html#ilm-delete-action" title="Delete">Delete</a></li></ul></div></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-allocate-action"></a>Allocate<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: warm, cold.</p><p>The Allocate action allows you to specify which nodes are allowed to host the
shards of the index and set the number of replicas.
Behind the scenes, it is modifying the index settings
for shard filtering and/or replica counts. When updating the number of replicas,
configuring allocation rules is optional. When configuring allocation rules,
setting number of replicas is optional. Although this action can be treated as
two separate index settings updates, both can be configured at once.</p><p>For more information about how Elasticsearch uses replicas for scaling, see
<a class="xref" href="scalability.html" title="Scalability and resilience: clusters, nodes, and shards"><em>Scalability and resilience</em></a>. See <a class="xref" href="shard-allocation-filtering.html" title="Index-level shard allocation filtering">Index-level shard allocation filtering</a> for more information about
controlling where Elasticsearch allocates shards of a particular index.</p><div class="table"><a id="ilm-allocate-options"></a><p class="title"><strong>Table 67. Allocate Options</strong></p><div class="table-contents"><table summary="Allocate Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Required</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">number_of_replicas</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The number of replicas to
                                                   assign to the index</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">include</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>assigns an index to nodes
                                                   having at least <span class="emphasis"><em>one</em></span> of the attributes</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">exclude</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>assigns an index to nodes having
                                                   <span class="emphasis"><em>none</em></span> of the attributes</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">require</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>assigns an index to nodes having
                                                   <span class="emphasis"><em>all</em></span> of the attributes</p></td></tr></tbody></table></div></div><p>If <code class="literal">number_of_replicas</code> is not configured, then at least one of <code class="literal">include</code>,
<code class="literal">exclude</code>, and <code class="literal">require</code> is required. An empty Allocate Action with no configuration
is invalid.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_change_number_of_replicas"></a>Example: Change number of replicas<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>In this example, the index’s number of replicas is changed to <code class="literal">2</code>, while allocation
rules are unchanged.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "allocate" : {
            "number_of_replicas" : 2
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/950.console"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_assign_index_to_node_with_specific_box_type_attribute"></a>Example: Assign index to node with specific "box_type" attribute<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This example assigns the index to nodes with <code class="literal">box_type</code> attribute of "hot" or "warm".</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "allocate" : {
            "include" : {
              "box_type": "hot,warm"
            }
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/951.console"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_assign_index_to_a_specific_node_and_update_replica_settings"></a>Example: Assign index to a specific node and update replica settings<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This example updates the index to have one replica per shard and be allocated
to nodes with a <code class="literal">box_type</code> attribute of "cold".</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "allocate" : {
            "number_of_replicas": 1,
            "require" : {
              "box_type": "cold"
            }
        }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/952.console"></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-delete-action"></a>Delete<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: delete.</p><p>The Delete Action does just that, it deletes the index.</p><p>This action does not have any options associated with it.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "delete": {
        "actions": {
          "delete" : { }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/953.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-forcemerge-action"></a>Force Merge<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: warm.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Index will be be made read-only when this action is run
(see: <a class="link" href="index-modules.html#dynamic-index-settings" title="Dynamic index settings">index.blocks.write</a>)</p></div></div><p>The Force Merge Action <a class="link" href="indices-forcemerge.html" title="Force merge API">force merges</a> the index into at
most a specific number of <a class="link" href="indices-segments.html" title="Index segments API">segments</a>.</p><div class="table"><a id="ilm-forcemerge-options"></a><p class="title"><strong>Table 68. Force Merge Options</strong></p><div class="table-contents"><table summary="Force Merge Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Required</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">max_num_segments</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The number of
                                                           segments to merge to.
                                                           To fully merge the
                                                           index, set it to <code class="literal">1</code></p></td></tr></tbody></table></div></div><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "forcemerge" : {
            "max_num_segments": 1
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/954.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-freeze-action"></a>Freeze<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: cold.</p><p>This action will <a class="link" href="frozen-indices.html" title="Frozen indices">freeze</a> the index
by calling the <a class="link" href="freeze-index-api.html" title="Freeze index API">Freeze Index API</a>.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "cold": {
        "actions": {
          "freeze" : { }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/955.console"></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><pre class="literallayout">Freezing an index will close the index and reopen it within the same API call.
This causes primaries to not be allocated for a short amount of time and
causes the cluster to go red until the primaries are allocated again.
This limitation might be removed in the future.</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-readonly-action"></a>Read-Only<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: warm.</p><p>This action will set the index to be read-only
(see: <a class="link" href="index-modules.html#dynamic-index-settings" title="Dynamic index settings">index.blocks.write</a>)</p><p>This action does not have any options associated with it.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "readonly" : { }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/956.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-rollover-action"></a>Rollover<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: hot.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>index format must match pattern <span class="emphasis"><em>^.*-\\d+$</em></span>, for example (<code class="literal">logs-000001</code>).</p></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>The managed index must set <code class="literal">index.lifecycle.rollover_alias</code> as the
alias to rollover. The index must also be the write index for the alias.</p></div></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If a policy using the Rollover action is used on a <a class="link" href="ccr-put-follow.html" title="Create follower API">follower
index</a>, policy execution will wait until the leader index rolls over (or has
<a class="link" href="skipping-rollover.html" title="Skipping Rollover">otherwise been marked as complete</a>), then convert the
follower index into a regular index as if <a class="link" href="_actions.html#ilm-unfollow-action" title="Unfollow">the Unfollow
action</a> had been used instead of rolling over.</p></div></div><p>For example, if an index to be managed has an alias <code class="literal">my_data</code>. The managed
index "my_index" must be the write index for the alias. For more information, read
<a class="link" href="indices-rollover-index.html#indices-rollover-is-write-index" title="Write Index Alias Behavior">Write Index Alias Behavior</a>.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT my_index
{
  "settings": {
    "index.lifecycle.name": "my_policy",
    "index.lifecycle.rollover_alias": "my_data"
  },
  "aliases": {
    "my_data": {
      "is_write_index": true
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/957.console"></div><p>The Rollover Action rolls an alias over to a new index when the
existing index meets one of the rollover conditions.</p><div class="table"><a id="ilm-rollover-options"></a><p class="title"><strong>Table 69. Rollover Options</strong></p><div class="table-contents"><table summary="Rollover Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Required</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">max_size</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>max primary shard index storage size.
                                                 See <a class="link" href="common-options.html#byte-units" title="Byte size units">Byte Units</a>
                                                 for formatting</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_docs</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>max number of documents an
                                                 index is to contain before
                                                 rolling over.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">max_age</code></p></td><td align="left" valign="top"><p>no</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>max time elapsed from index
                                                 creation. See
                                                 <a class="link" href="common-options.html#time-units" title="Time units">Time Units</a>
                                                 for formatting</p></td></tr></tbody></table></div></div><p>At least one of <code class="literal">max_size</code>, <code class="literal">max_docs</code>, <code class="literal">max_age</code> or any combinations of the
three are required to be specified.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_rollover_when_index_is_too_large"></a>Example: Rollover when index is too large<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This example rolls the index over when it is at least 100 gigabytes.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_size": "100GB"
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/958.console"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_rollover_when_index_has_too_many_documents"></a>Example: Rollover when index has too many documents<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This example rolls the index over when it contains at least
100000000 documents.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_docs": 100000000
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/959.console"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_rollover_when_index_is_too_old"></a>Example: Rollover when index is too old<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This example rolls the index over when it has been created at least
7 days ago.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_age": "7d"
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/960.console"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_rollover_when_index_is_too_old_or_too_large"></a>Example: Rollover when index is too old or too large<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This example rolls the index over when it has been created at least
7 days ago or it is at least 100 gigabytes. In this case, the index will be
rolled over when any of the conditions is met.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover" : {
            "max_age": "7d",
            "max_size": "100GB"
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/961.console"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_rollover_condition_stalls_phase_transition"></a>Example: Rollover condition stalls phase transition<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The Rollover action will only complete once one of its conditions is
met. This means that any proceeding phases will be blocked until Rollover
succeeds.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_ilm/policy/rollover_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "50G"
          }
        }
      },
      "delete": {
        "min_age": "1d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/962.console"></div><p>The above example illustrates a policy which attempts to delete an
index one day after the index has been rolled over. It does not
delete the index one day after it has been created.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-set-priority-action"></a>Set Priority<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Phases allowed: hot, warm, cold.</p><p>This action sets the <a class="link" href="recovery-prioritization.html" title="Index recovery prioritization">index priority</a> on the index as
soon as the policy enters the hot, warm, or cold phase. Indices with a higher
priority will be recovered before indices with lower priorities following a node
restart. Generally, indexes in the hot phase should have the highest value and
indexes in the cold phase should have the lowest values. For example:
100 for the hot phase, 50 for the warm phase, and 0 for the cold phase.
Indicies that don’t set this value have an implicit default priority of 1.</p><div class="table"><a id="ilm-set-priority-options"></a><p class="title"><strong>Table 70. Set Priority Options</strong></p><div class="table-contents"><table summary="Set Priority Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Required</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">priority</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The priority for the index. Must be 0 or greater.
                                           The value may also be set to null to remove the priority.</p></td></tr></tbody></table></div></div><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "set_priority" : {
            "priority": 50
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/963.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-shrink-action"></a>Shrink<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Index will be be made read-only when this action is run
(see: <a class="link" href="index-modules.html#dynamic-index-settings" title="Dynamic index settings">index.blocks.write</a>)</p></div></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>If a policy using the Shrink action is used on a <a class="link" href="ccr-put-follow.html" title="Create follower API">follower
index</a>, policy execution will wait until the leader index rolls over (or has
<a class="link" href="skipping-rollover.html" title="Skipping Rollover">otherwise been marked as complete</a>), then convert the
follower index into a regular index as if <a class="link" href="_actions.html#ilm-unfollow-action" title="Unfollow">the Unfollow
action</a> had been used before shrink is applied, as shrink cannot be safely
applied to follower indices.</p></div></div><p>This action shrinks an existing index into a new index with fewer primary
shards. It calls the <a class="link" href="indices-shrink-index.html" title="Shrink Index">Shrink API</a> to shrink the index.
Since allocating all the primary shards of the index to one node is a
prerequisite, this action will first allocate the primary shards to a valid
node. After shrinking, it will swap aliases pointing to the original index
into the new shrunken index. The new index will also have a new name:
"shrink-&lt;origin-index-name&gt;". So if the original index was called "logs",
then the new index will be named "shrink-logs".</p><div class="table"><a id="ilm-shrink-options"></a><p class="title"><strong>Table 71. Shrink Options</strong></p><div class="table-contents"><table summary="Shrink Options" cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Required</th><th align="left" valign="top">Default</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">number_of_shards</code></p></td><td align="left" valign="top"><p>yes</p></td><td align="left" valign="top"><p>-</p></td><td align="left" valign="top"><p>The number of shards
                                                         to shrink to. must be
                                                         a factor of the number
                                                         of shards in the
                                                         source index.</p></td></tr></tbody></table></div></div><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "shrink" : {
            "number_of_shards": 1
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/964.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ilm-unfollow-action"></a>Unfollow<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/ilm/policy-definitions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>This action may be used explicitly, as shown below, but this action is also run
before <a class="link" href="_actions.html#ilm-rollover-action" title="Rollover">the Rollover action</a> and <a class="link" href="_actions.html#ilm-shrink-action" title="Shrink">the
Shrink action</a> as described in the documentation for those actions.</p></div></div><p>This action turns a <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.4/ccr-apis.html" target="_top">ccr</a> follower index
into a regular index. This can be desired when moving follower
indices into the next phase. Also certain actions like shrink
and rollover can then be performed safely on follower indices.</p><p>This action will wait until is it safe to convert a follower index into a
regular index. In particular, the following conditions must be met:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">The leader index must have <code class="literal">index.lifecycle.indexing_complete</code> set to <code class="literal">true</code>.
This happens automatically if the leader index is rolled over using
<a class="link" href="_actions.html#ilm-rollover-action" title="Rollover">the Rollover action</a>, or may be set manually using
the <a class="link" href="indices-update-settings.html" title="Update index settings API">Index Settings API</a>.</li><li class="listitem">All operations performed on the leader index must have been replicated to the
follower index. This ensures that no operations will be lost when the index is
converted into a regular index.</li></ul></div><p>If the unfollow action encounters a follower index then
the following operations will be performed on it:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Pauses indexing following for the follower index.</li><li class="listitem">Closes the follower index.</li><li class="listitem">Unfollows the follower index.</li><li class="listitem">Opens the follower index (which is at this point is a regular index).</li></ul></div><p>The unfollow action does not have any options and
if it encounters a non follower index, then the
unfollow action leaves that index untouched and
lets the next action operate on this index.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "unfollow" : {}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/965.console"></div></div></div><div class="navfooter"><span class="prev"><a href="_phase_execution.html">
              « 
              Phase Execution</a>
           
        </span><span class="next">
           
          <a href="_full_policy.html">Full Policy
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
window.initial_state = {}</script>
  </body>
</html>
