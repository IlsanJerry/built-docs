<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Scripting and security
        | Elasticsearch Reference [5.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [5.4]" /><link rel="up" href="modules-scripting.html" title="Scripting" /><link rel="prev" href="modules-scripting-fields.html" title="Accessing document fields and special variables" /><link rel="next" href="modules-scripting-groovy.html" title="Groovy Scripting Language" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/5.4" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="5.4" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [5.4]
    </a></span> » <span class="breadcrumb-link"><a href="modules.html">Modules</a></span> » <span class="breadcrumb-link"><a href="modules-scripting.html">Scripting</a></span> » <span class="breadcrumb-node">Scripting and security</span></div><div class="navheader"><span class="prev"><a href="modules-scripting-fields.html">
              « 
              Accessing document fields and special variables</a>
           
        </span><span class="next">
           
          <a href="modules-scripting-groovy.html">Groovy Scripting Language
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-scripting-security"></a>Scripting and security<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>While Elasticsearch contributors make every effort to prevent scripts from
running amok, security is something best done in
<a class="ulink" href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)" target="_top">layers</a> because
all software has bugs and it is important to minimize the risk of failure in
any security layer. Find below rules of thumb for how to keep Elasticsearch
from being a vulnerability.</p><h3><a id="_do_not_run_as_root"></a>Do not run as root<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>First and foremost, never run Elasticsearch as the <code class="literal">root</code> user as this would
allow any successful effort to circumvent the other security layers to do
<span class="strong strong"><strong>anything</strong></span> on your server. Elasticsearch will refuse to start if it detects
that it is running as <code class="literal">root</code> but this is so important that it is worth double
and triple checking.</p><h3><a id="_do_not_expose_elasticsearch_directly_to_users"></a>Do not expose Elasticsearch directly to users<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Do not expose Elasticsearch directly to users, instead have an application
make requests on behalf of users. If this is not possible, have an application
to sanitize requests from users. If <span class="strong strong"><strong>that</strong></span> is not possible then have some
mechanism to track which users did what. Understand that it is quite possible
to write a <a class="link" href="search.html" title="Search APIs"><code class="literal">_search</code></a> that overwhelms Elasticsearch and brings down
the cluster. All such searches should be considered bugs and the Elasticsearch
contributors make an effort to prevent this but they are still possible.</p><h3><a id="_do_not_expose_elasticsearch_directly_to_the_internet"></a>Do not expose Elasticsearch directly to the Internet<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Do not expose Elasticsearch to the Internet, instead have an application
make requests on behalf of the Internet. Do not entertain the thought of having
an application "sanitize" requests to Elasticsearch. Understand that it is
possible for a sufficiently determined malicious user to write searches that
overwhelm the Elasticsearch cluster and bring it down. For example:</p><p>Good:
* Users type text into a search box and the text is sent directly to a
<a class="xref" href="query-dsl-match-query.html" title="Match Query">Match Query</a>, <a class="xref" href="query-dsl-match-query-phrase.html" title="Match Phrase Query">Match Phrase Query</a>,
<a class="xref" href="query-dsl-simple-query-string-query.html" title="Simple Query String Query">Simple Query String Query</a>, or any of the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a>.
* Running a script with any of the above queries that was written as part of
the application development process.
* Running a script with <code class="literal">params</code> provided by users.
* User actions makes documents with a fixed structure.</p><p>Bad:
* Users can write arbitrary scripts, queries, <code class="literal">_search</code> requests.
* User actions make documents with structure defined by users.</p><h3><a id="modules-scripting-security-do-no-weaken"></a>Do not weaken script security settings<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default Elasticsearch will run inline, stored, and filesystem scripts for
sandboxed languages, namely the scripting language Painless, the template
language Mustache, and the expression language Expressions. These <span class="strong strong"><strong>ought</strong></span> to be
safe to expose to trusted users and to your application servers because they
have strong security sandboxes. By default Elasticsearch will only run
filesystem scripts for non-sandboxed languages and enabling them is a poor
choice because:
1. This drops a layer of security, leaving only Elasticsearch’s builtin
<a class="link" href="modules-scripting-security.html#modules-scripting-other-layers" title="Other security layers">security layers</a>.
2. Non-sandboxed scripts have unchecked access to Elasticsearch’s internals and
can cause all kinds of trouble if misused.</p><h3><a id="modules-scripting-other-layers"></a>Other security layers<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In addition to user privileges and script sandboxing Elasticsearch uses the
<a class="ulink" href="http://www.oracle.com/technetwork/java/seccodeguide-139067.html" target="_top">Java Security Manager</a>
and native security tools as additional layers of security.</p><p>As part of its startup sequence Elasticsearch enables the Java Security Manager
which limits the actions that can be taken by portions of the code. Painless
uses this to limit the actions that generated Painless scripts can take,
preventing them from being able to do things like write files and listen to
sockets.</p><p>Elasticsearch uses
<a class="ulink" href="https://en.wikipedia.org/wiki/Seccomp" target="_top">seccomp</a> in Linux,
<a class="ulink" href="https://www.chromium.org/developers/design-documents/sandbox/osx-sandboxing-design" target="_top">Seatbelt</a>
in macOS, and
<a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms684147" target="_top">ActiveProcessLimit</a>
on Windows to prevent Elasticsearch from forking or executing other processes.</p><p>Below this we describe the security settings for scripts and how you can
change from the defaults described above. You should be very, very careful
when allowing more than the defaults. Any extra permissions weakens the total
security of the Elasticsearch deployment.</p><h3><a id="security-script-source"></a>Script source settings<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Which scripts Elasticsearch will execute where is controlled by settings
starting with <code class="literal">scripts.</code>. The simplest settings allow scripts to be enabled
or disabled based on where they are stored. For example:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">script.inline: false  <a id="CO301-1"></a><i class="conum" data-value="1"></i>
script.stored: false  <a id="CO301-2"></a><i class="conum" data-value="2"></i>
script.file:   true   <a id="CO301-3"></a><i class="conum" data-value="3"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO301-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Refuse to run scripts provided inline in the API.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO301-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Refuse to run scripts stored using the API.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO301-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Run scripts found on the filesystem in <code class="literal">/etc/elasticsearch/scripts</code>
(rpm or deb) or <code class="literal">config/scripts</code> (zip or tar).</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>These settings override the defaults mentioned
<a class="link" href="modules-scripting-security.html#modules-scripting-security-do-no-weaken" title="Do not weaken script security settings">above</a>. Recreating the defaults
requires more fine grained settings described <a class="link" href="modules-scripting-security.html#security-script-fine" title="Fine-grained script settings">below</a>.</p></div></div><h3><a id="security-script-context"></a>Script context settings<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Scripting may also be enabled or disabled in different contexts in the
Elasticsearch API. The supported contexts are:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">aggs</code></p>
</td><td valign="top">
<p>Aggregations</p>
</td></tr><tr><td valign="top">
<p><code class="literal">search</code></p>
</td><td valign="top">
<p>Search api, Percolator API and Suggester API</p>
</td></tr><tr><td valign="top">
<p><code class="literal">update</code></p>
</td><td valign="top">
<p>Update api</p>
</td></tr><tr><td valign="top">
<p><code class="literal">plugin</code></p>
</td><td valign="top">
<p>Any plugin that makes use of scripts under the generic <code class="literal">plugin</code> category</p>
</td></tr></tbody></table></div><p>Plugins can also define custom operations that they use scripts for instead
of using the generic <code class="literal">plugin</code> category. Those operations can be referred to
in the following form: <code class="literal">${pluginName}_${operation}</code>.</p><p>The following example disables scripting for <code class="literal">update</code> and <code class="literal">plugin</code> operations,
regardless of the script source or language. Scripts can still be executed
from sandboxed languages as part of <code class="literal">aggregations</code>, <code class="literal">search</code> and plugins
execution though, as the above defaults still get applied.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">script.update: false
script.plugin: false</pre></div><h3><a id="security-script-fine"></a>Fine-grained script settings<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>First, the high-level script settings described above are applied in order
(context settings have precedence over source settings). Then fine-grained
settings which include the script language take precedence over any high-level
settings. They have two forms:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">script.engine.{lang}.{inline|file|stored}.{context}: true|false</pre></div><p>And</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">script.engine.{lang}.{inline|file|stored}: true|false</pre></div><p>For example:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">script.inline: false <a id="CO302-1"></a><i class="conum" data-value="1"></i>
script.stored: false <a id="CO302-2"></a><i class="conum" data-value="2"></i>
script.file:   false <a id="CO302-3"></a><i class="conum" data-value="3"></i>

script.engine.painless.inline:          true <a id="CO302-4"></a><i class="conum" data-value="4"></i>
script.engine.painless.stored.search:   true <a id="CO302-5"></a><i class="conum" data-value="5"></i>
script.engine.painless.stored.aggs:     true <a id="CO302-6"></a><i class="conum" data-value="6"></i>

script.engine.mustache.stored.search:   true <a id="CO302-7"></a><i class="conum" data-value="7"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO302-1"><i class="conum" data-value="1"></i></a> <a href="#CO302-2"><i class="conum" data-value="2"></i></a> <a href="#CO302-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>Disable all scripting from any source.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO302-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>Allow inline Painless scripts for all operations.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO302-5"><i class="conum" data-value="5"></i></a> <a href="#CO302-6"><i class="conum" data-value="6"></i></a> </p></td><td valign="top" align="left"><p>Allow stored Painless scripts to be used for search and aggregations.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO302-7"><i class="conum" data-value="7"></i></a> </p></td><td valign="top" align="left"><p>Allow stored Mustache templates to be used for search.</p></td></tr></table></div><h3><a id="java-security-manager"></a>Java Security Manager<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>As mentioned above, Elasticsearch runs with the <a class="ulink" href="https://docs.oracle.com/javase/tutorial/essential/environment/security.html" target="_top">Java Security Manager</a>
enabled by default. The security policy in Elasticsearch locks down the
permissions granted to each class to the bare minimum required to operate.
The benefit of doing this is that it severely limits the attack vectors
available to a hacker.</p><p>Restricting permissions is particularly important for non-sandboxed scripting
languages like Groovy and Javascript which are designed to do anything that can
be done in Java itself, including writing to the file system, opening sockets
to remote servers, etc.</p><h3><a id="_script_classloader_whitelist"></a>Script Classloader Whitelist<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Groovy makes an effort to prevent loading classes which do not appear in a
hardcoded whitelist that can be found in
<a class="ulink" href="https://github.com/elastic/elasticsearch/blob/5.4/core/src/main/java/org/elasticsearch/script/ClassPermission.java" target="_top"><code class="literal">org.elasticsearch.script.ClassPermission</code></a>.</p><p>In a script, attempting to load a class that does not appear in the whitelist
<span class="emphasis"><em>may</em></span> result in a <code class="literal">ClassNotFoundException</code>, for instance this script:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET _search
{
  "script_fields": {
    "the_hour": {
      "script": "use(java.math.BigInteger); new BigInteger(1)"
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/1010.console"></div><p>will return the following exception:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
  "reason": {
    "type": "script_exception",
    "reason": "failed to run inline script [use(java.math.BigInteger); new BigInteger(1)] using lang [groovy]",
    "caused_by": {
      "type": "no_class_def_found_error",
      "reason": "java/math/BigInteger",
      "caused_by": {
        "type": "class_not_found_exception",
        "reason": "java.math.BigInteger"
      }
    }
  }
}</pre></div><p>However, classloader issues may also result in more difficult to interpret
exceptions.  For instance, this script:</p><div class="pre_wrapper lang-groovy"><pre class="programlisting prettyprint lang-groovy">use(groovy.time.TimeCategory); new Date(123456789).format('HH')</pre></div><p>Returns the following exception:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
  "reason": {
    "type": "script_exception",
    "reason": "failed to run inline script [use(groovy.time.TimeCategory); new Date(123456789).format('HH')] using lang [groovy]",
    "caused_by": {
      "type": "missing_property_exception",
      "reason": "No such property: groovy for class: 8d45f5c1a07a1ab5dda953234863e283a7586240"
    }
  }
}</pre></div><h2><a id="_dealing_with_java_security_manager_issues"></a>Dealing with Java Security Manager issues<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>If you encounter issues with the Java Security Manager, you have two options
for resolving these issues:</p><h3><a id="_fix_the_security_problem"></a>Fix the security problem<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The safest and most secure long term solution is to change the code causing
the security issue.  We recognise that this may take time to do correctly and
so we provide the following two alternatives.</p><h3><a id="_customising_the_classloader_whitelist"></a>Customising the classloader whitelist<a href="https://github.com/elastic/elasticsearch/edit/5.4/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The classloader whitelist can be customised by tweaking the local Java
Security Policy either:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">system wide: <code class="literal">$JAVA_HOME/lib/security/java.policy</code>,</li><li class="listitem">for just the <code class="literal">elasticsearch</code> user: <code class="literal">/home/elasticsearch/.java.policy</code></li><li class="listitem">by adding a system property to the <a class="link" href="setting-system-settings.html#jvm-options" title="Setting JVM options">jvm.options</a> configuration: <code class="literal">-Djava.security.policy=someURL</code>, or</li><li class="listitem"><p class="simpara">via the <code class="literal">ES_JAVA_OPTS</code> environment variable with <code class="literal">-Djava.security.policy=someURL</code>:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">export ES_JAVA_OPTS="${ES_JAVA_OPTS} -Djava.security.policy=file:///path/to/my.policy`
./bin/elasticsearch</pre></div></li></ul></div><p>Permissions may be granted at the class, package, or global level.  For instance:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">grant {
    permission org.elasticsearch.script.ClassPermission "java.util.Base64"; // allow class
    permission org.elasticsearch.script.ClassPermission "java.util.*"; // allow package
    permission org.elasticsearch.script.ClassPermission "*"; // allow all (disables filtering basically)
};</pre></div><p>Here is an example of how to enable the <code class="literal">groovy.time.TimeCategory</code> class:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">grant {
    permission org.elasticsearch.script.ClassPermission "java.lang.Class";
    permission org.elasticsearch.script.ClassPermission "groovy.time.TimeCategory";
};</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>Before adding classes to the whitelist, consider the security impact that it
will have on Elasticsearch. Do you really need an extra class or can your code
be rewritten in a more secure way?</p><p>It is quite possible that we have not whitelisted a generically useful and
safe class. If you have a class that you think should be whitelisted by
default, please open an issue on GitHub and we will consider the impact of
doing so.</p></div></div><p>See <a class="ulink" href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html" target="_top">http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html</a> for more information.</p></div><div class="navfooter"><span class="prev"><a href="modules-scripting-fields.html">
              « 
              Accessing document fields and special variables</a>
           
        </span><span class="next">
           
          <a href="modules-scripting-groovy.html">Groovy Scripting Language
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>

  
            <script type="text/javascript">
window.initial_state = {}
</script>
<script type="text/javascript" src="/guide/static/docs.js"></script>

            </body>
        
</html>
