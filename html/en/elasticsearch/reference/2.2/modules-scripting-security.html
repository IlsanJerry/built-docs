<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Scripting and the Java Security Manager
        | Elasticsearch Reference [2.2]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch Reference [2.2]" /><link rel="up" href="modules-scripting.html" title="Scripting" /><link rel="prev" href="modules-advanced-scripting.html" title="Text scoring in scripts" /><link rel="next" href="modules-snapshots.html" title="Snapshot And Restore" /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/2.2" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="2.2" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [2.2]
    </a></span> » <span class="breadcrumb-link"><a href="modules.html">Modules</a></span> » <span class="breadcrumb-link"><a href="modules-scripting.html">Scripting</a></span> » <span class="breadcrumb-node">Scripting and the Java Security Manager</span></div><div class="navheader"><span class="prev"><a href="modules-advanced-scripting.html">
              « 
              Text scoring in scripts</a>
           
        </span><span class="next">
           
          <a href="modules-snapshots.html">Snapshot And Restore
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="modules-scripting-security"></a>Scripting and the Java Security Manager<a href="https://github.com/elastic/elasticsearch/edit/2.2/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch runs with the <a class="ulink" href="https://docs.oracle.com/javase/tutorial/essential/environment/security.html" target="_top">Java Security Manager</a>
enabled by default.  The security policy in Elasticsearch locks down the
permissions granted to each class to the bare minimum required to operate.
The benefit of doing this is that it severely limits the attack vectors
available to a hacker.</p><p>Restricting permissions is particularly important with scripting languages
like Groovy and Javascript which are designed to do anything that can be done
in Java itself, including writing to the file system, opening sockets to
remote servers, etc.</p><h3><a id="_script_classloader_whitelist"></a>Script Classloader Whitelist<a href="https://github.com/elastic/elasticsearch/edit/2.2/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Scripting languages are only allowed to load classes which appear in a
hardcoded whitelist that can be found in
<a class="ulink" href="https://github.com/elastic/elasticsearch/blob/2.2/core/src/main/java/org/elasticsearch/script/ClassPermission.java" target="_top"><code class="literal">org.elasticsearch.script.ClassPermission</code></a>.</p><p>In a script, attempting to load a class that does not appear in the whitelist
<span class="emphasis"><em>may</em></span> result in a <code class="literal">ClassNotFoundException</code>, for instance this script:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">GET _search
{
  "script_fields": {
    "the_hour": {
      "script": "use(java.math.BigInteger); new BigInteger(1)"
    }
  }
}</pre></div><p>will return the following exception:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">{
  "reason": {
    "type": "script_exception",
    "reason": "failed to run inline script [use(java.math.BigInteger); new BigInteger(1)] using lang [groovy]",
    "caused_by": {
      "type": "no_class_def_found_error",
      "reason": "java/math/BigInteger",
      "caused_by": {
        "type": "class_not_found_exception",
        "reason": "java.math.BigInteger"
      }
    }
  }
}</pre></div><p>However, classloader issues may also result in more difficult to interpret
exceptions.  For instance, this script:</p><div class="pre_wrapper lang-groovy"><pre class="programlisting prettyprint lang-groovy">use(groovy.time.TimeCategory); new Date(123456789).format('HH')</pre></div><p>Returns the following exception:</p><div class="pre_wrapper lang-json"><pre class="programlisting prettyprint lang-json">{
  "reason": {
    "type": "script_exception",
    "reason": "failed to run inline script [use(groovy.time.TimeCategory); new Date(123456789).format('HH')] using lang [groovy]",
    "caused_by": {
      "type": "missing_property_exception",
      "reason": "No such property: groovy for class: 8d45f5c1a07a1ab5dda953234863e283a7586240"
    }
  }
}</pre></div><h2><a id="_dealing_with_java_security_manager_issues"></a>Dealing with Java Security Manager issues<a href="https://github.com/elastic/elasticsearch/edit/2.2/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>If you encounter issues with the Java Security Manager, you have three options
for resolving these issues:</p><h3><a id="_fix_the_security_problem"></a>Fix the security problem<a href="https://github.com/elastic/elasticsearch/edit/2.2/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The safest and most secure long term solution is to change the code causing
the security issue.  We recognise that this may take time to do correctly and
so we provide the following two alternatives.</p><h3><a id="_disable_the_java_security_manager"></a>Disable the Java Security Manager<a href="https://github.com/elastic/elasticsearch/edit/2.2/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="warning admon"><div class="icon"></div><div class="admon_content"><h3>Deprecated in 2.2.0. </h3><p>The ability to disable the Java Security Manager will be removed in a future version</p></div></div><p>You can disable the Java Security Manager entirely with the
<code class="literal">security.manager.enabled</code> command line flag:</p><div class="pre_wrapper lang-sh"><pre class="programlisting prettyprint lang-sh">./bin/elasticsearch --security.manager.enabled false</pre></div><div class="warning admon"><div class="icon"></div><div class="admon_content"><p>This disables the Security Manager entirely and makes Elasticsearch
much more vulnerable to attacks! It is an option that should only be used in
the most urgent of situations and for the shortest amount of time possible.
Optional security is not secure at all because it <span class="strong strong"><strong>will</strong></span> be disabled and
leave the system vulnerable.  This option will be removed in a future version.</p></div></div><h3><a id="_customising_the_classloader_whitelist"></a>Customising the classloader whitelist<a href="https://github.com/elastic/elasticsearch/edit/2.2/docs/reference/modules/scripting/security.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The classloader whitelist can be customised by tweaking the local Java
Security Policy either:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">system wide: <code class="literal">$JAVA_HOME/lib/security/java.policy</code>,</li><li class="listitem">for just the <code class="literal">elasticsearch</code> user: <code class="literal">/home/elasticsearch/.java.policy</code>, or</li><li class="listitem"><p class="simpara">from a file specified in the <code class="literal">JAVA_OPTS</code> environment variable with <code class="literal">-Djava.security.policy=someURL</code>:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">export JAVA_OPTS="${JAVA_OPTS} -Djava.security.policy=file:///path/to/my.policy`
./bin/elasticsearch</pre></div></li></ul></div><p>Permissions may be granted at the class, package, or global level.  For instance:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">grant {
    permission org.elasticsearch.script.ClassPermission "java.util.Base64"; // allow class
    permission org.elasticsearch.script.ClassPermission "java.util.*"; // allow package
    permission org.elasticsearch.script.ClassPermission "*"; // allow all (disables filtering basically)
};</pre></div><p>Here is an example of how to enable the <code class="literal">groovy.time.TimeCategory</code> class:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">grant {
    permission org.elasticsearch.script.ClassPermission "java.lang.Class";
    permission org.elasticsearch.script.ClassPermission "groovy.time.TimeCategory";
};</pre></div><div class="tip admon"><div class="icon"></div><div class="admon_content"><p>Before adding classes to the whitelist, consider the security impact that it
will have on Elasticsearch. Do you really need an extra class or can your code
be rewritten in a more secure way?</p><p>It is quite possible that we have not whitelisted a generically useful and
safe class. If you have a class that you think should be whitelisted by
default, please open an issue on GitHub and we will consider the impact of
doing so.</p></div></div><p>See <a class="ulink" href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html" target="_top">http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html</a> for more information.</p></div><div class="navfooter"><span class="prev"><a href="modules-advanced-scripting.html">
              « 
              Text scoring in scripts</a>
           
        </span><span class="next">
           
          <a href="modules-snapshots.html">Snapshot And Restore
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
