<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configuring an LDAP realm
        | Elasticsearch Reference [7.2]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch Reference [7.2]" /><link rel="up" href="configuring-security.html" title="Configuring security in Elasticsearch" /><link rel="prev" href="configuring-file-realm.html" title="Configuring a file realm" /><link rel="next" href="configuring-native-realm.html" title="Configuring a native realm" /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.2" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="7.2" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.2]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span> » <span class="breadcrumb-link"><a href="configuring-security.html">Configuring security in Elasticsearch</a></span> » <span class="breadcrumb-node">Configuring an LDAP realm</span></div><div class="navheader"><span class="prev"><a href="configuring-file-realm.html">
              « 
              Configuring a file realm</a>
           
        </span><span class="next">
           
          <a href="configuring-native-realm.html">Configuring a native realm
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-ldap-realm"></a>Configuring an LDAP realm<a href="https://github.com/elastic/elasticsearch/edit/7.2/x-pack/docs/en/security/authentication/configuring-ldap-realm.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><p>You can configure Elasticsearch to authenticate users by communicating with a Lightweight
Directory Access Protocol (LDAP) server. To integrate with LDAP, you configure
an <code class="literal">ldap</code> realm and map LDAP groups to user roles.</p><p>For more information about LDAP realms, see
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/ldap-realm.html" target="_top">LDAP User Authentication</a>.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Determine which mode you want to use. The <code class="literal">ldap</code> realm supports two modes of
operation, a user search mode and a mode with specific templates for user DNs.</p><p class="simpara">LDAP user search is the most common mode of operation. In this mode, a specific
user with permission to search the LDAP directory is used to search for the DN
of the authenticating user based on the provided username and an LDAP attribute.
Once found, the user is authenticated by attempting to bind to the LDAP server
using the found DN and the provided password.</p><p class="simpara">If your LDAP environment uses a few specific standard naming conditions for
users, you can use user DN templates to configure the realm. The advantage of
this method is that a search does not have to be performed to find the user DN.
However, multiple bind operations might be needed to find the correct user DN.</p></li><li class="listitem"><p class="simpara">To configure an <code class="literal">ldap</code> realm with user search:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">Add a realm configuration of to <code class="literal">elasticsearch.yml</code> under the
<code class="literal">xpack.security.authc.realms.ldap</code> namespace. At a minimum, you must specify
the <code class="literal">url</code> of the LDAP server, and set <code class="literal">user_search.base_dn</code> to the container DN
where the users are searched for.
If you are configuring multiple realms, you should also explicitly set the
<code class="literal">order</code> attribute to control the order in which the realms are consulted during
authentication. See <a class="xref" href="security-settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP realm settings</a> for all of the options you can set for
an <code class="literal">ldap</code> realm.</p><p class="simpara">For example, the following snippet shows an LDAP realm configured with a user search:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            order: 0
            url: "ldaps://ldap.example.com:636"
            bind_dn: "cn=ldapuser, ou=users, o=services, dc=example, dc=com"
            user_search:
              base_dn: "dc=example,dc=com"
              filter: "(cn={0})"
            group_search:
              base_dn: "dc=example,dc=com"
            files:
              role_mapping: "ES_PATH_CONF/role_mapping.yml"
            unmapped_groups_as_roles: false</pre></div><p class="simpara">The password for the <code class="literal">bind_dn</code> user should be configured by adding the appropriate
<code class="literal">secure_bind_password</code> setting to the Elasticsearch keystore.
For example, the following command adds the password for the example realm above:</p><div class="pre_wrapper lang-shell"><pre class="programlisting prettyprint lang-shell">bin/elasticsearch-keystore add \
xpack.security.authc.realms.ldap.ldap1.secure_bind_password</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>When you configure realms in <code class="literal">elasticsearch.yml</code>, only the
realms you specify are used for authentication. If you also want to use the
<code class="literal">native</code> or <code class="literal">file</code> realms, you must include them in the realm chain.</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">To configure an <code class="literal">ldap</code> realm with user DN templates:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">Add a realm configuration to <code class="literal">elasticsearch.yml</code> in the
<code class="literal">xpack.security.authc.realms.ldap</code> namespace. At a minimum, you must specify
the <code class="literal">url</code> of the LDAP server, and specify at least one template with the
<code class="literal">user_dn_templates</code> option. If you are configuring multiple realms, you should
also explicitly set the <code class="literal">order</code> attribute to control the order in which the
realms are consulted during authentication.
See <a class="xref" href="security-settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP realm settings</a> for all of the options you can set for an <code class="literal">ldap</code> realm.</p><p class="simpara">For example, the following snippet shows an LDAP realm configured with user DN
templates:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            order: 0
            url: "ldaps://ldap.example.com:636"
            user_dn_templates:
              - "cn={0}, ou=users, o=marketing, dc=example, dc=com"
              - "cn={0}, ou=users, o=engineering, dc=example, dc=com"
            group_search:
              base_dn: "dc=example,dc=com"
            files:
              role_mapping: "/mnt/elasticsearch/group_to_role_mapping.yml"
            unmapped_groups_as_roles: false</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>The <code class="literal">bind_dn</code> setting is not used in template mode.
All LDAP operations run as the authenticating user.</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">(Optional) Configure how the security features interact with multiple LDAP
servers.</p><p class="simpara">The <code class="literal">load_balance.type</code> setting can be used at the realm level. The Elasticsearch
security features support both failover and load balancing modes of operation.
See <a class="xref" href="security-settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP realm settings</a>.</p></li><li class="listitem">(Optional) To protect passwords,
<a class="link" href="configuring-tls.html#tls-ldap" title="Encrypting communications between Elasticsearch and LDAP">encrypt communications between Elasticsearch and the LDAP server</a>.</li><li class="listitem">Restart Elasticsearch.</li><li class="listitem"><p class="simpara">Map LDAP groups to roles.</p><p class="simpara">The <code class="literal">ldap</code> realm enables you to map LDAP users to roles via their LDAP
groups, or other metadata. This role mapping can be configured via the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/security-api-put-role-mapping.html" target="_top">add role mapping API</a> or by using a file stored
on each node. When a user authenticates with LDAP, the privileges
for that user are the union of all privileges defined by the roles to which
the user is mapped.</p><p class="simpara">Within a mapping definition, you specify groups using their distinguished
names. For example, the following mapping configuration maps the LDAP
<code class="literal">admins</code> group to both the <code class="literal">monitoring</code> and <code class="literal">user</code> roles, and maps the
<code class="literal">users</code> group to the <code class="literal">user</code> role.</p><p class="simpara">Configured via the role-mapping API:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_security/role_mapping/admins
{
  "roles" : [ "monitoring" , "user" ],
  "rules" : { "field" : {
    "groups" : "cn=admins,dc=example,dc=com" <a id="CO31-1"></a><i class="conum" data-value="1"></i>
  } },
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/30.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">admins</code> group.</p></td></tr></table></div><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_security/role_mapping/basic_users
{
  "roles" : [ "user" ],
  "rules" : { "field" : {
    "groups" : "cn=users,dc=example,dc=com" <a id="CO32-1"></a><i class="conum" data-value="1"></i>
  } },
  "enabled": true
}</pre></div><div class="console_widget" data-snippet="snippets/31.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">users</code> group.</p></td></tr></table></div><p class="simpara">Or, alternatively, configured via the role-mapping file:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">monitoring: <a id="CO33-1"></a><i class="conum" data-value="1"></i>
  - "cn=admins,dc=example,dc=com" <a id="CO33-2"></a><i class="conum" data-value="2"></i>
user:
  - "cn=users,dc=example,dc=com" <a id="CO33-3"></a><i class="conum" data-value="3"></i>
  - "cn=admins,dc=example,dc=com"</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The name of the mapped role.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">admins</code> group.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">users</code> group.</p></td></tr></table></div><p class="simpara">For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/ldap-realm.html#mapping-roles-ldap" target="_top">Mapping LDAP Groups to Roles</a>
and
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/mapping-roles.html" target="_top">Mapping Users and Groups to Roles</a>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The LDAP realm supports
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/realm-chains.html#authorization_realms" target="_top">authorization realms</a> as an
alternative to role mapping.</p></div></div></li><li class="listitem"><p class="simpara">(Optional) Configure the <code class="literal">metadata</code> setting on the LDAP realm to include extra
fields in the user’s metadata.</p><p class="simpara">By default, <code class="literal">ldap_dn</code> and <code class="literal">ldap_groups</code> are populated in the user’s metadata.
For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/ldap-realm.html#ldap-user-metadata" target="_top">User Metadata in LDAP Realms</a>.</p><p class="simpara">The example below includes the user’s common name (<code class="literal">cn</code>) as an additional
field in their metadata.</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            metadata: cn</pre></div></li></ol></div></div><div class="navfooter"><span class="prev"><a href="configuring-file-realm.html">
              « 
              Configuring a file realm</a>
           
        </span><span class="next">
           
          <a href="configuring-native-realm.html">Configuring a native realm
               »
            </a></span></div>
                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
