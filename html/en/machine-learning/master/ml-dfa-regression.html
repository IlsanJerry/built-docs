<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="An introduction to machine learning regression, which enables you to predict numerical values in a data set.">
<meta name="keywords" content="ML, Elastic Stack, data frame analytics, regression">
<title>Predicting numerical values with regression | Machine Learning in the Elastic Stack [master] | Elastic</title>
<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [master]"/>
<link rel="up" href="ml-dfanalytics.html" title="Data frame analytics"/>
<link rel="prev" href="ml-dfa-finding-outliers.html" title="Finding outliers"/>
<link rel="next" href="ml-dfa-classification.html" title="Predicting classes with classification"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine Learning/master"/>
<meta name="DC.subject" content="Machine Learning"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2021 Elasticsearch B.V. Copying, publishing and/or distributing without written permission is strictly prohibited.-->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [master]</a></span>
»
<span class="breadcrumb-link"><a href="ml-dfanalytics.html">Data frame analytics</a></span>
»
<span class="breadcrumb-node">Predicting numerical values with regression</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-dfa-finding-outliers.html">« Finding outliers</a>
</span>
<span class="next">
<a href="ml-dfa-classification.html">Predicting classes with classification »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-dfa-regression"></a>Predicting numerical values with regression<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>This page contains a conceptual overview of classification in the Elastic Stack and
a simple <a class="xref" href="ml-dfa-regression.html#performing-regression" title="Performing regression analysis in the sample flight data set">example</a> of how to use it.</p>
<h3><a id="dfa-regression"></a>Regression<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h3>
<p>Regression analysis is a machine learning process for estimating the relationships among
different fields in your data, then making further predictions based on these
relationships.</p>
<p>For example, suppose we are interested in finding the relationship between
apartment size and monthly rent in a city. Our imaginary data set consists of
three data points:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
</colgroup>
<tbody>
<tr>
<td align="left" valign="top"><p>Size (m2)</p></td>
<td align="left" valign="top"><p>Monthly rent</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>44</p></td>
<td align="left" valign="top"><p>1600</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>24</p></td>
<td align="left" valign="top"><p>1055</p></td>
</tr>
<tr>
<td align="left" valign="top"><p>63</p></td>
<td align="left" valign="top"><p>2300</p></td>
</tr>
</tbody>
</table>
</div>
<p>After the model determines the relationship between the apartment size and the
rent, it can make predictions such as the monthly rent of a hundred square
meter-size apartment.</p>
<p>This is a simple example. Usually regression problems are multi-dimensional,
so the relationships that regression analysis tries to find are between multiple
fields. To extend our example, a more complex regression analysis could take into
account additional factors such as the location of the apartment in the city, on
which floor it is, and whether the apartment has a riverside view or not, and so
on. All of these factors can be considered <em>features</em>; they are measurable
properties or characteristics of the phenomenon we&#8217;re studying.</p>
<h4><a id="dfa-regression-features"></a>Feature variables<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>When you perform regression analysis, you must identify a subset of fields that you
want to use to create a model for predicting other fields. We refer to these
fields as <em>feature variables</em> and <em>dependent variables</em>, respectively.
Feature variables are the values that the dependent variable value depends on. If one or
more of the feature variables changes, the dependent variable value also changes. There are
three different types of feature variables that you can use with our regression
algorithm:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Numerical. In our example, the size of the apartment was a
numerical feature variable.
</li>
<li class="listitem">
Categorical. A variable that can have one value from a set of values. The
value set has a fixed and limited number of possible items. In the example,
the location of the apartment in the city (borough) is a categorical variable.
</li>
<li class="listitem">
Boolean. The riverside view in the example is a boolean value because an
  apartment either has a riverside view or doesn&#8217;t have one.
Arrays are not supported.
</li>
</ul>
</div>
<h4><a id="dfa-regression-supervised"></a>Training the regression model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>Regression is a supervised machine learning method, which means that you need to
supply a labeled training data set that has some feature variables and a dependent variable.
The regression algorithm identifies the relationships between the
feature variables and the dependent variable. Once you&#8217;ve trained the model on your training
data set, you can reuse the knowledge that the model has learned to make
inferences about new data.</p>
<p>The relationships between the feature variables and the dependent variable are described as a
mathematical function. Regression analysis tries to find the best prediction for
the dependent variable by combining the predictions from multiple base learners –
algorithms that generalize from the data set. The performance of an ensemble is
usually better than the performance of each individual base learner because the
individual learners will make different errors. These average out when their
predictions are combined.</p>
<p>Regression works as a batch analysis. If new data comes into your index,
you must restart the data frame analytics job.</p>
<h5><a id="dfa-regression-algorithm"></a>Regression algorithms<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p>The ensemble learning technique that we use in the Elastic Stack is a type of boosting
called extreme gradient boost (XGboost) which combines decision trees with
gradient boosting methodologies.</p>
<h5><a id="dfa-regression-lossfunction"></a>Loss functions for regression analyses<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p>A loss function measures how well a given machine learning model fits the specific data set.
It boils down all the different under- and overestimations of the model to a
single number, known as the prediction error. The bigger the difference between
the prediction and the ground truth, the higher the value of the loss function.
Loss functions are used automatically in the background during
<a class="xref" href="hyperparameters.html" title="Hyperparameter optimization">hyperparameter optimization</a> and when training the decision
trees to compare the performance of various iterations of the model.</p>
<p>In the Elastic Stack, there are three different types of loss function:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://en.wikipedia.org/wiki/Mean_squared_error" class="ulink" target="_top">mean squared error (<code class="literal">mse</code>)</a>:
It is the default choice when no additional information about the data set is
available.
</li>
<li class="listitem">
mean squared logarithmic error (<code class="literal">msle</code>; a variation of <code class="literal">mse</code>): It is for
cases where the target values are all positive with a long tail distribution
(for example, prices or population).
</li>
<li class="listitem">
<a href="https://en.wikipedia.org/wiki/Huber_loss#Pseudo-Huber_loss_function" class="ulink" target="_top">Pseudo-Huber loss (<code class="literal">huber</code>)</a>:
Use it when you want to prevent the model trying to fit the outliers instead of
regular data.
</li>
</ul>
</div>
<p>The various types of loss function calculate the prediction error differently.
The appropriate loss function for your use case depends on the target
distribution in your data set, the problem that you want to model, the number of
outliers in the data, and so on.</p>
<p>You can specify the loss function to be used during regression analysis when you
create the data frame analytics job. The default is mean squared error (<code class="literal">mse</code>). If you
choose <code class="literal">msle</code> or <code class="literal">huber</code>, you can also set up a parameter for the loss function.
With the parameter, you can further refine the behavior of the chosen functions.</p>
<p>Consult
<a href="https://github.com/elastic/examples/tree/master/Machine%20Learning/Regression%20Loss%20Functions" class="ulink" target="_top">the Jupyter notebook on regression loss functions</a>
to learn more.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The default loss function parameter values work fine for most of the cases.
It is highly recommended to use the default values, unless you fully understand
the impact of the different loss function parameters.</p>
</div>
</div>
<h4><a id="dfa-regression-deploy"></a>Deploying the model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>The model that you created is stored as Elasticsearch documents in internal indices. In
other words, the characteristics of your trained model are saved and ready to be
deployed and used as functions. The <a class="xref" href="ml-dfa-regression.html#ml-inference-reg" title="Inference">inference</a> feature enables
you to use your model in a preprocessor of an ingest pipeline or in a pipeline
aggregation of a search query to make predictions about your data.</p>
<h5><a id="ml-inference-reg"></a>Inference<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p>Inference is a machine learning feature that enables you to use supervised machine learning processes
– like regression or classification – not only as a batch analysis but in a
continuous fashion. This means that inference makes it possible to use
<a class="xref" href="ml-trained-models.html" title="Trained models">trained machine learning models</a> against incoming data.</p>
<p>For instance, suppose you have an online service and you would like to predict
whether a customer is likely to churn. You have an index with historical data –
information on the customer behavior throughout the years in your business – and
a classification model that is trained on this data. The new information comes
into a destination index of a continuous transform. With inference, you can perform the
classification analysis against the new data with the same input fields that you&#8217;ve
trained the model on, and get a prediction.</p>
<h6><a id="ml-inference-processor-reg"></a>Inference processor<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h6>
<p>Inference can be used as a processor specified in an
<a href="/guide/en/elasticsearch/reference/master/pipeline.html" class="ulink" target="_top">ingest pipeline</a>. It uses a trained model to infer against
the data that is being ingested in the pipeline. The model is used on the
<a href="/guide/en/elasticsearch/reference/master/ingest.html" class="ulink" target="_top">ingest node</a>. Inference pre-processes the data by using the
model and provides a prediction. After the process, the pipeline continues
executing (if there is any other processor in the pipeline), finally the new
data together with the results are indexed into the destination index.</p>
<p>Check the <a href="/guide/en/elasticsearch/reference/master/inference-processor.html" class="ulink" target="_top">inference processor</a> and
<a href="/guide/en/elasticsearch/reference/master/ml-df-analytics-apis.html" class="ulink" target="_top">the machine learning data frame analytics API documentation</a> to
learn more about the feature.</p>
<h6><a id="ml-inference-aggregation-reg"></a>Inference aggregation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h6>
<p>Inference can also be used as a pipeline aggregation. You can reference a
trained model in the aggregation to infer on the result field of the parent
bucket aggregation. The inference aggregation uses the model on the results to
provide a prediction. This aggregation enables you to run classification or
regression analysis at search time. If you want to perform the analysis on a small set
of data, this aggregation enables you to generate predictions without the need
to set up a processor in the ingest pipeline.</p>
<p>Check the
<a href="/guide/en/elasticsearch/reference/master/search-aggregations-pipeline-inference-bucket-aggregation.html" class="ulink" target="_top">inference bucket aggregation</a>
and <a href="/guide/en/elasticsearch/reference/master/ml-df-analytics-apis.html" class="ulink" target="_top">the machine learning data frame analytics API documentation</a> to
learn more about the feature.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you use trained model aliases to reference your trained model in an
inference processor or inference aggregation, you can replace your trained model
with a new one without the need of updating the processor or the aggregation.
Reassign the alias you used to a new trained model ID by using the
<a href="/guide/en/elasticsearch/reference/master/put-trained-models-aliases.html" class="ulink" target="_top">Create or update trained model aliases API</a>.
The new trained model needs to use the same type of data frame analytics as the old
one.</p>
</div>
</div>
<h4><a id="dfa-regression-feature-importance"></a>Feature importance<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>Feature importance provides further information about the results of an analysis and
helps to interpret the results in a more subtle way. If you want to learn more
about feature importance, <a class="xref" href="ml-feature-importance.html" title="Feature importance">click here</a>.</p>
<h4><a id="dfa-regression-evaluation"></a>Measuring model performance<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>You can measure how well the model has performed on your training data set by
using the <code class="literal">regression</code> evaluation type of the
<a href="/guide/en/elasticsearch/reference/master/evaluate-dfanalytics.html" class="ulink" target="_top">evaluate data frame analytics API</a>. The mean squared
error (MSE) value that the evaluation provides you on the training data set is
the <em>training error</em>. Training the regression model means finding the
combination of model parameters that produces the lowest possible training
error.</p>
<p>Another crucial measurement is how well your model performs on unseen
data points. To assess how well the trained model will perform on data it has
never seen before, you must set aside a proportion of the training data set for
testing. This split of the data set is the testing data set. Once the model has
been trained, you can let the model
predict the value of the data points it has never seen before and compare the
prediction to the actual value. This test provides an estimate of a quantity
known as the <em>model generalization error</em>.</p>
<p>Two concepts describe how well the regression algorithm was able to learn the
relationship between the feature variables and the dependent variable. <em>Underfitting</em> is when
the model cannot capture the complexity of the data set. <em>Overfitting</em> is when
the model is too specific to the training data set and is capturing details
which do not generalize to new data. A model that overfits the data has a
low MSE value on the training data set and a high MSE value on the testing
data set. For more information about the evaluation metrics, see
<a class="xref" href="ml-dfa-regression.html#ml-dfanalytics-regression-evaluation" title="Regression evaluation">Regression evaluation</a>.</p>
<h4><a id="dfa-regression-readings"></a>Further readings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="https://github.com/elastic/examples/tree/master/Machine%20Learning/Feature%20Importance" class="ulink" target="_top">Feature importance for data frame analytics (Jupyter notebook)</a>
</li>
<li class="listitem">
<a href="https://github.com/elastic/examples/tree/master/Machine%20Learning/Regression%20Loss%20Functions" class="ulink" target="_top">Regression loss functions (Jupyter notebook)</a>
</li>
</ul>
</div>
<h4><a id="ml-dfanalytics-regression-evaluation"></a>Regression evaluation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>Using the data frame analytics features to gain insights from a data set is an
iterative process. After you defined the problem you want to solve, and chose
the analytics type that can help you to do so, you need to produce a
high-quality data set and create the appropriate data frame analytics job. You might
need to experiment with different configurations, parameters, and ways to
transform data before you arrive at a result that satisfies your use case. A
valuable companion to this process is the
<a href="/guide/en/elasticsearch/reference/master/evaluate-dfanalytics.html" class="ulink" target="_top">evaluate data frame analytics API</a>, which enables you to evaluate
the data frame analytics performance. It helps you understand error distributions and
identifies the points where the data frame analytics model performs well or less
trustworthily.</p>
<p>To evaluate the analysis with this API, you need to annotate your index that
contains the results of the analysis with a field that marks each document with
the ground truth. The evaluate data frame analytics API evaluates the performance of the
data frame analytics against this manually provided ground truth.</p>
<p>This evaluation type is suitable for evaluating regression models. The
regression evaluation type offers the following metrics to evaluate the model
performance:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Mean squared error (MSE)
</li>
<li class="listitem">
R-squared (R<sup>2</sup>)
</li>
<li class="listitem">
Pseudo-Huber loss
</li>
<li class="listitem">
Mean squared logarithmic error (MSLE)
</li>
</ul>
</div>
<h5><a id="ml-dfanalytics-mse"></a>Mean squared error<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p>The API provides a MSE by computing the average squared sum of the difference
between the true value and the value that the regression model predicted.
(Avg (predicted value-actual value)<sup>2</sup>). You can use the MSE to measure how well
the regression analysis model is performing.</p>
<h5><a id="ml-dfanalytics-r-sqared"></a>R-squared<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p>Another evaluation metric for regression analysis is R-squared (R<sup>2</sup>). It represents
the goodness of fit and measures how much of the variation in the data the
predictions are able to explain. The value of R<sup>2</sup> are less than or equal to 1,
where 1 indicates that the predictions and true values are equal. A value of 0
is obtained when all the predictions are set to the mean of the true values. A
value of 0.5 for R<sup>2</sup> would indicate that, the predictions are 1 - 0.5<sup>(1/2)</sup>
(about 30%) closer to true values than their mean.</p>
<h5><a id="ml-dfanalytics-huber"></a>Pseudo-Huber loss<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p><a href="https://en.wikipedia.org/wiki/Huber_loss#Pseudo-Huber_loss_function" class="ulink" target="_top">Pseudo-Huber loss metric</a>
behaves as mean absolute error (MAE) for errors larger than a predefined value
(defaults to <code class="literal">1</code>) and as mean squared error (MSE) for errors smaller than the
predefined value. This loss function uses the <code class="literal">delta</code> parameter to define the
transition point between MAE and MSE. Consult the
<a class="xref" href="ml-dfa-regression.html#dfa-regression-lossfunction" title="Loss functions for regression analyses">Loss functions for regression analyses</a> page to learn more about loss functions.</p>
<h5><a id="ml-dfanalytics-msle"></a>Mean squared logarithmic error<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h5>
<p>This evaluation metric is a variation of mean squared error. It can be used for
cases when the target values are positive and distributed with a long tail such
as data on prices or population. Consult the <a class="xref" href="ml-dfa-regression.html#dfa-regression-lossfunction" title="Loss functions for regression analyses">Loss functions for regression analyses</a>
page to learn more about loss functions.</p>
<h3><a id="performing-regression"></a>Performing regression analysis in the sample flight data set<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h3>
<p>Let&#8217;s try to predict flight delays by using the
<a href="/guide/en/kibana/master/get-started.html#gs-get-data-into-kibana" class="ulink" target="_top">sample flight data</a>. The data set contains
information such as weather conditions, flight destinations and origins, flight
distances, carriers, and the number of minutes each flight was delayed. When you
create a data frame analytics job for regression analysis, it learns the relationships
between the fields in your data in order to predict the value of a
<em>dependent variable</em>, which in this case is the numeric <code class="literal">FlightDelayMins</code> field.
For an overview of these concepts, see <a class="xref" href="ml-dfa-regression.html#dfa-regression" title="Regression">Regression</a> and
<a class="xref" href="ml-dfa-overview.html#ml-supervised-workflow" title="Introduction to supervised learning">Introduction to supervised learning</a>.</p>
<h4><a id="flightdata-regression-data"></a>Preparing your data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>Each document in the data set contains details for a single flight, so this data
is ready for analysis; it is already in a two-dimensional entity-based data
structure. In general, you often need to
<a href="/guide/en/elasticsearch/reference/master/transforms.html" class="ulink" target="_top">transform</a> the data into an entity-centric index before
you analyze the data.</p>
<p>In order to be analyzed, a document must contain at least one field with a
supported data type (<code class="literal">numeric</code>, <code class="literal">boolean</code>, <code class="literal">text</code>, <code class="literal">keyword</code> or <code class="literal">ip</code>) and must
not contain arrays with more than one item. If your source data consists of some
documents that contain the dependent variable and some that do not, the model is
trained on the subset of the documents that contain it.</p>
<details>
<summary class="title">Example source document</summary>
<div class="content">
<pre class="screen">{
  "_index": "kibana_sample_data_flights",
  "_type": "_doc",
  "_id": "S-JS1W0BJ7wufFIaPAHe",
  "_version": 1,
  "_seq_no": 3356,
  "_primary_term": 1,
  "found": true,
  "_source": {
    "FlightNum": "N32FE9T",
    "DestCountry": "JP",
    "OriginWeather": "Thunder &amp; Lightning",
    "OriginCityName": "Adelaide",
    "AvgTicketPrice": 499.08518599798685,
    "DistanceMiles": 4802.864932998549,
    "FlightDelay": false,
    "DestWeather": "Sunny",
    "Dest": "Chubu Centrair International Airport",
    "FlightDelayType": "No Delay",
    "OriginCountry": "AU",
    "dayOfWeek": 3,
    "DistanceKilometers": 7729.461862731618,
    "timestamp": "2019-10-17T11:12:29",
    "DestLocation": {
      "lat": "34.85839844",
      "lon": "136.8049927"
    },
    "DestAirportID": "NGO",
    "Carrier": "ES-Air",
    "Cancelled": false,
    "FlightTimeMin": 454.6742272195069,
    "Origin": "Adelaide International Airport",
    "OriginLocation": {
      "lat": "-34.945",
      "lon": "138.531006"
    },
    "DestRegion": "SE-BD",
    "OriginAirportID": "ADL",
    "OriginRegion": "SE-BD",
    "DestCityName": "Tokoname",
    "FlightTimeHour": 7.577903786991782,
    "FlightDelayMin": 0
  }
}</pre>
</div>
</details>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>The sample flight data is used in this example because it is easily
accessible. However, the data has been manually created and contains some
inconsistencies. For example, a flight can be both delayed and canceled. This is
a good reminder that the quality of your input data affects the quality of your
results.</p>
</div>
</div>
<h4><a id="flightdata-regression-model"></a>Creating a regression model<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>To predict the number of minutes delayed for each flight:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Verify that your environment is set up properly to use machine learning features. If the
Elastic Stack security features are enabled, you need a user that has authority
to create and manage data frame analytics jobs. See <a class="xref" href="setup.html" title="Set up machine learning features"><em>Setup and security</em></a>.
</li>
<li class="listitem">
<p>Create a data frame analytics job.</p>
<p>You can use the wizard on the <span class="strong strong"><strong>Machine Learning</strong></span> &gt; <span class="strong strong"><strong>Data Frame Analytics</strong></span> tab
in Kibana or the <a href="/guide/en/elasticsearch/reference/master/put-dfanalytics.html" class="ulink" target="_top">create data frame analytics jobs</a> API.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flights-regression-job-1.jpg" alt="Creating a data frame analytics job in Kibana">
</div>
</div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Choose <code class="literal">kibana_sample_data_flights</code> as the source index.
</li>
<li class="listitem">
Choose <code class="literal">regression</code> as the job type.
</li>
<li class="listitem">
Optionally improve the quality of the analysis by adding a query that removes erroneous data. In this case, we omit flights with a distance of 0 kilometers or less.
</li>
<li class="listitem">
Choose <code class="literal">FlightDelayMin</code> as the dependent variable, which is the field that we
want to predict with the regression analysis.
</li>
<li class="listitem">
<p>Add <code class="literal">Cancelled</code>, <code class="literal">FlightDelay</code>, and <code class="literal">FlightDelayType</code> to the list of excluded
fields. These fields will be excluded from the analysis. It is recommended to
exclude fields that either contain erroneous data or describe the
<code class="literal">dependent_variable</code>.</p>
<p>The wizard includes a scatterplot matrix, which enables you to explore the
relationships between the numeric fields. The color of each point is affected by
the value of the dependent variable for that document, as shown in the legend.
You can use this matrix to help you decide which fields to include or exclude
from the analysis.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flightdata-regression-scatterplot.png" alt="A scatterplot matrix for three fields in Kibana">
</div>
</div>
<p>If you want these charts to represent data from a larger sample size or from a
randomized selection of documents, you can change the default behavior. However,
a larger sample size might slow down the performance of the matrix and a
randomized selection might put more load on the cluster due to the more
intensive query.</p>
</li>
<li class="listitem">
Choose a training percent of <code class="literal">90</code> which means it randomly selects 90% of the
source data for training.
</li>
<li class="listitem">
If you want to experiment with <a class="xref" href="ml-feature-importance.html" title="Feature importance">feature importance</a>, specify
a value in the advanced configuration options. In this example, we choose to
return a maximum of 5 feature importance values per document. This option affects the
speed of the analysis, so by default it is disabled.
</li>
<li class="listitem">
Use a model memory limit of at least 50 MB. If the job requires more than
this amount of memory, it fails to start. If the available memory on the node is
limited, this setting makes it possible to prevent job execution.
</li>
<li class="listitem">
Add a job ID (such as <code class="literal">model-flight-delay-regression</code>) and optionally a job description.
</li>
<li class="listitem">
<p>Add the name of the destination index that will contain the results of the
analysis. In Kibana, the index name matches the job ID by default. It will
contain a copy of the source index data where each document is annotated with
the results. If the index does not exist, it will be created automatically.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/model-flight-delays-regression
{
  "source": {
    "index": [
      "kibana_sample_data_flights"
    ],
    "query": {
      "range": {
        "DistanceKilometers": {
          "gt": 0
        }
      }
    }
  },
  "dest": {
    "index": "model-flight-delays-regression"
  },
  "analysis": {
    "regression": {
      "dependent_variable": "FlightDelayMin",
      "training_percent": 90
    }
  },
  "analyzed_fields": {
    "includes": [],
    "excludes": [
      "Cancelled",
      "FlightDelay",
      "FlightDelayType"
    ]
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/48.console"></div>
</div>
</details>
<p>After you configured your job, the configuration details are automatically
validated. If the checks are successful, you can proceed and start the job. A
warning message is shown if the configuration is invalid. The message contains a
suggestion to improve the configuration to be validated.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Start the job in Kibana or use the
<a href="/guide/en/elasticsearch/reference/master/start-dfanalytics.html" class="ulink" target="_top">start data frame analytics jobs</a> API.</p>
<p>The job takes a few minutes to run. Runtime depends on the local hardware and
also on the number of documents and fields that are analyzed. The more fields
and documents, the longer the job runs. It stops automatically when the analysis
is complete.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/analytics/model-flight-delays-regression/_start</pre>
</div>
<div class="console_widget" data-snippet="snippets/49.console"></div>
</div>
</details>
</li>
<li class="listitem">
<p>Check the job stats to follow the progress in Kibana or use the
<a href="/guide/en/elasticsearch/reference/master/get-dfanalytics-stats.html" class="ulink" target="_top">get data frame analytics jobs statistics API</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flights-regression-details.jpg" alt="Statistics for a data frame analytics job in Kibana">
</div>
</div>
<p>When the job stops, the results are ready to view and evaluate. To learn more
about the job phases, see <a class="xref" href="ml-dfa-phases.html" title="How a data frame analytics job works">How data frame analytics jobs work</a>.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/data_frame/analytics/model-flight-delays-regression/_stats</pre>
</div>
<div class="console_widget" data-snippet="snippets/50.console"></div>
<p>The API call returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count" : 1,
  "data_frame_analytics" : [
    {
      "id" : "model-flight-delays-regression",
      "state" : "stopped",
      "progress" : [
        {
          "phase" : "reindexing",
          "progress_percent" : 100
        },
        {
          "phase" : "loading_data",
          "progress_percent" : 100
        },
        {
          "phase" : "feature_selection",
          "progress_percent" : 100
        },
        {
          "phase" : "coarse_parameter_search",
          "progress_percent" : 100
        },
        {
          "phase" : "fine_tuning_parameters",
          "progress_percent" : 100
        },
        {
          "phase" : "final_training",
          "progress_percent" : 100
        },
        {
          "phase" : "writing_results",
          "progress_percent" : 100
        },
        {
          "phase" : "inference",
          "progress_percent" : 100
        }
      ],
      "data_counts" : {
        "training_docs_count" : 11210,
        "test_docs_count" : 1246,
        "skipped_docs_count" : 0
      },
      "memory_usage" : {
        "timestamp" : 1599773614155,
        "peak_usage_bytes" : 50156565,
        "status" : "ok"
      },
      "analysis_stats" : {
        "regression_stats" : {
          "timestamp" : 1599773614155,
          "iteration" : 18,
          "hyperparameters" : {
            "alpha" : 19042.721566629778,
            "downsample_factor" : 0.911884068909842,
            "eta" : 0.02331774683318904,
            "eta_growth_rate_per_tree" : 1.0143154178910303,
            "feature_bag_fraction" : 0.5504020748926737,
            "gamma" : 53.373570122718846,
            "lambda" : 2.94058933878574,
            "max_attempts_to_add_tree" : 3,
            "max_optimization_rounds_per_hyperparameter" : 2,
            "max_trees" : 894,
            "num_folds" : 4,
            "num_splits_per_feature" : 75,
            "soft_tree_depth_limit" : 2.945317520946171,
            "soft_tree_depth_tolerance" : 0.13448633124842999
          },
          "timing_stats" : {
            "elapsed_time" : 302959,
            "iteration_time" : 13075
          },
          "validation_loss" : {
            "loss_type" : "mse"
          }
        }
      }
    }
  ]
}</pre>
</div>
</div>
</details>
</li>
</ol>
</div>
<h4><a id="flightdata-regression-results"></a>Viewing regression results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>Now you have a new index that contains a copy of your source data with
predictions for your dependent variable.</p>
<p>When you view the regression results in Kibana, it shows the contents of the
destination index in a tabular format. It also provides information about the
analysis details, model evaluation metrics, total feature importance values, and
a scatterplot matrix. Let’s start by looking at the results table:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flights-regression-results.jpg" alt="Results for a data frame analytics job in Kibana">
</div>
</div>
<p>In this example, the table shows a column for the dependent variable
(<code class="literal">FlightDelayMin</code>), which contains the ground truth values that we are trying to
predict with the regression analysis. It also shows a column for the prediction values
(<code class="literal">ml.FlightDelayMin_prediction</code>) and a column that indicates whether the
document was used in the training set (<code class="literal">ml.is_training</code>). You can filter the
table to show only testing or training data and you can select which fields are
shown in the table. You can also enable histogram charts to get a better
understanding of the distribution of values in your data.</p>
<p>If you chose to calculate feature importance, the destination index also contains
<code class="literal">ml.feature_importance</code> objects. Every field that is included in the
regression analysis (known as a <em>feature</em> of the data point) is assigned a feature importance
value. This value has both a magnitude and a direction (positive or negative),
which indicates how each field affects a particular prediction. Only the most
significant values (in this case, the top 5) are stored in the index. However,
the trained model metadata also contains the average magnitude of the feature importance
values for each field across all the training data. You can view this
summarized information in Kibana:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flights-regression-total-importance.jpg" alt="Total feature importance values in Kibana">
</div>
</div>
<p>You can also see the feature importance values for each individual prediction in the
form of a decision plot:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flights-regression-importance.png" alt="A decision plot for feature importance values in Kibana">
</div>
</div>
<p>The decision path starts at a baseline, which is the average of the predictions
for all the data points in the training data set. From there, the feature
importance values are added to the decision path until it arrives at its final
prediction. The features with the most significant positive or negative impact
appear at the top. Thus in this example, the features related to the flight
distance had the most significant influence on this particular predicted flight
delay. This type of information can help you to understand how models arrive at
their predictions. It can also indicate which aspects of your data set are most
influential or least useful when you are training and tuning your model.</p>
<p>If you do not use Kibana, you can see summarized feature importance values by using the
<a href="/guide/en/elasticsearch/reference/master/get-inference.html" class="ulink" target="_top">get trained model API</a> and the individual values by
searching the destination index.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _ml/inference/model-flight-delays-regression*?include=total_feature_importance,feature_importance_baseline</pre>
</div>
<div class="console_widget" data-snippet="snippets/51.console"></div>
<p>The snippet below shows an example of the total feature importance details in
the trained model metadata:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "count" : 1,
  "trained_model_configs" : [
    {
      "model_id" : "model-flight-delays-regression-1601312043770",
      ...
      "metadata" : {
        ...
        "feature_importance_baseline" : {
          "baseline" : 47.43643652716527 <a id="CO18-1"></a><i class="conum" data-value="1"></i>
        },
        "total_feature_importance" : [
          {
            "feature_name" : "dayOfWeek",
            "importance" : {
              "mean_magnitude" : 0.38674590521018903, <a id="CO18-2"></a><i class="conum" data-value="2"></i>
              "min" : -9.42823116446923, <a id="CO18-3"></a><i class="conum" data-value="3"></i>
              "max" : 8.707461689065173 <a id="CO18-4"></a><i class="conum" data-value="4"></i>
            }
          },
          {
            "feature_name" : "OriginWeather",
            "importance" : {
            "mean_magnitude" : 0.18548393012368913,
            "min" : -9.079576266629092,
            "max" : 5.142479101907649
          }
          ...</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>This value is the baseline for the feature importance decision path. It is the
average of the prediction values across all the training data.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>This value is the average of the absolute feature importance values for the
<code class="literal">dayOfWeek</code> field across all the training data.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>This value is the minimum feature importance value across all the training data for
this field.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO18-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>This value is the maximum feature importance value across all the training data for
this field.</p>
</td>
</tr>
</table>
</div>
<p>To see the top feature importance values for each prediction, search the destination
index. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET model-flight-delays-regression/_search</pre>
</div>
<div class="console_widget" data-snippet="snippets/52.console"></div>
<p>The snippet below shows a part of a document with the annotated results:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">          ...
          "DestCountry" : "CH",
          "DestRegion" : "CH-ZH",
          "OriginAirportID" : "VIE",
          "DestCityName" : "Zurich",
          "ml": {
            "FlightDelayMin_prediction": 277.5392150878906,
            "feature_importance": [
            {
              "feature_name": "DestCityName",
              "importance": 0.6285966753441136
            },
            {
              "feature_name": "DistanceKilometers",
              "importance": 84.4982943868267
            },
            {
              "feature_name": "DistanceMiles",
              "importance": 103.90011847132116
            },
            {
              "feature_name": "FlightTimeHour",
              "importance": 3.7119156097309345
            },
            {
              "feature_name": "FlightTimeMin",
              "importance": 38.700587425831365
            }
            ],
            "is_training": true
          }
          ...</pre>
</div>
</div>
</details>
<p>Lastly, Kibana provides a scatterplot matrix in the results. It has the same
functionality as the matrix that you saw in the job wizard. Its purpose is to
likewise help you visualize and explore the relationships between the numeric
fields and the dependent variable in your data.</p>
<h4><a id="flightdata-regression-evaluate"></a>Evaluating regression results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/df-analytics/ml-dfa-regression.asciidoc">edit</a></h4>
<p>Though you can look at individual results and compare the predicted value
(<code class="literal">ml.FlightDelayMin_prediction</code>) to the actual value (<code class="literal">FlightDelayMins</code>), you
typically need to evaluate the success of the regression model as a whole.</p>
<p>Kibana provides <em>training error</em> metrics, which represent how well the model
performed on the training data set. It also provides <em>generalization error</em>
metrics, which represent how well the model performed on testing data.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/flights-regression-evaluation.jpg" alt="Evaluating regression analysis results in Kibana">
</div>
</div>
<p>A mean squared error (MSE) of zero means that the models predicts the dependent
variable with perfect accuracy. This is the ideal, but is typically not possible.
Likewise, an R-squared value of 1 indicates that all of the variance in the
dependent variable can be explained by the feature variables. Typically, you
compare the MSE and R-squared values from multiple regression models to find
the best balance or fit for your data.</p>
<p>For more information about the interpreting the evaluation metrics, see
<a class="xref" href="ml-dfa-regression.html#ml-dfanalytics-regression-evaluation" title="Regression evaluation">Regression evaluation</a>.</p>
<p>You can alternatively generate these metrics with the
<a href="/guide/en/elasticsearch/reference/master/evaluate-dfanalytics.html" class="ulink" target="_top">data frame analytics evaluate API</a>.</p>
<details>
<summary class="title">API example</summary>
<div class="content">
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
 "index": "model-flight-delays-regression",
  "query": {
      "bool": {
        "filter": [{ "term":  { "ml.is_training": true } }]  <a id="CO19-1"></a><i class="conum" data-value="1"></i>
      }
    },
 "evaluation": {
   "regression": {
     "actual_field": "FlightDelayMin",   <a id="CO19-2"></a><i class="conum" data-value="2"></i>
     "predicted_field": "ml.FlightDelayMin_prediction", <a id="CO19-3"></a><i class="conum" data-value="3"></i>
     "metrics": {
       "r_squared": {},
       "mse": {},
       "msle": {},
       "huber": {}
     }
   }
 }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/53.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO19-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Calculate the training error by evaluating only the training data.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO19-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the actual (ground truth) value.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO19-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The field that contains the predicted value.</p>
</td>
</tr>
</table>
</div>
<p>The API returns a response like this:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "regression" : {
    "huber" : {
      "value" : 30.216037330465102
    },
    "mse" : {
      "value" : 2847.2211476422967
    },
    "msle" : {
      "value" : "NaN"
    },
    "r_squared" : {
      "value" : 0.6956530017255125
    }
  }
}</pre>
</div>
<p>Next, we calculate the generalization error:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/data_frame/_evaluate
{
 "index": "model-flight-delays-regression",
  "query": {
      "bool": {
        "filter": [{ "term":  { "ml.is_training": false } }] <a id="CO20-1"></a><i class="conum" data-value="1"></i>
      }
    },
 "evaluation": {
   "regression": {
     "actual_field": "FlightDelayMin",
     "predicted_field": "ml.FlightDelayMin_prediction",
     "metrics": {
       "r_squared": {},
       "mse": {},
       "msle": {},
       "huber": {}
     }
   }
 }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/54.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO20-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Evaluate only the documents that are not part of the training data.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<p>When you have trained a satisfactory model, you can deploy it to make predictions
about new data.</p>
<p>If you don&#8217;t want to keep the data frame analytics job, you can delete it. For example,
use Kibana or the <a href="/guide/en/elasticsearch/reference/master/delete-dfanalytics.html" class="ulink" target="_top">delete data frame analytics job API</a>.
When you delete data frame analytics jobs in Kibana, you have the option to also remove
the destination indices and index patterns.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ml-dfa-finding-outliers.html">« Finding outliers</a>
</span>
<span class="next">
<a href="ml-dfa-classification.html">Predicting classes with classification »</a>
</span>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
