<!DOCTYPE html>
<html lang="en-us">
  <head>
    
<meta charset="UTF-8">
<meta name="description" content="An introduction to machine learning anomaly detection, which analyzes time series data to identify and predict anomalous patterns in your data.">
<meta name="keywords" content="ML, Elastic Stack, anomaly detection, overview">
<title>Finding anomalies in time series data | Machine Learning in the Elastic Stack [master] | Elastic</title>
<link rel="home" href="index.html" title="Machine Learning in the Elastic Stack [master]"/>
<link rel="up" href="ml-ad-overview.html" title="Anomaly detection"/>
<link rel="prev" href="ml-model-snapshots.html" title="Model snapshots"/>
<link rel="next" href="ml-ad-concepts.html" title="Advanced concepts"/>
<meta name="DC.type" content="Learn/Docs/Elastic Stack/Machine Learning/master"/>
<meta name="DC.subject" content="Machine Learning"/>
<meta name="DC.identifier" content="master"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.optimizely.com/js/18132920325.js"></script>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <meta name="localized" content="true" />
    <meta name="st:robots" content="follow,index" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/guide/static/styles.css" />
  </head>

  <!--© 2015-2021 Elasticsearch B.V. Copying, publishing and/or distributing without written permission is strictly prohibited.-->

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>

    <!--BEGIN QUALTRICS WEBSITE FEEDBACK SNIPPET-->
    <script type='text/javascript'>
      (function(){var g=function(e,h,f,g){
      this.get=function(a){for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){for(var d=c[b];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
      this.set=function(a,c){var b="",b=new Date;b.setTime(b.getTime()+6048E5);b="; expires="+b.toGMTString();document.cookie=a+"="+c+b+"; path=/; "};
      this.check=function(){var a=this.get(f);if(a)a=a.split(":");else if(100!=e)"v"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(":"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case "v":return!1;case "r":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c}return!0};
      this.go=function(){if(this.check()){var a=document.createElement("script");a.type="text/javascript";a.src=g;document.body&&document.body.appendChild(a)}};
      this.start=function(){var a=this;window.addEventListener?window.addEventListener("load",function(){a.go()},!1):window.attachEvent&&window.attachEvent("onload",function(){a.go()})}};
      try{(new g(100,"r","QSI_S_ZN_emkP0oSe9Qrn7kF","https://znemkp0ose9qrn7kf-elastic.siteintercept.qualtrics.com/WRSiteInterceptEngine/?Q_ZID=ZN_emkP0oSe9Qrn7kF")).start()}catch(i){}})();
    </script><div id='ZN_emkP0oSe9Qrn7kF'><!--DO NOT REMOVE-CONTENTS PLACED HERE--></div>
    <!--END WEBSITE FEEDBACK SNIPPET-->

    <div id='elastic-nav' style="display:none;"></div>
    <script src='https://www.elastic.co/elastic-nav.js'></script>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                  <!-- start body -->
                  <div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Machine Learning in the Elastic Stack [master]</a></span>
»
<span class="breadcrumb-link"><a href="ml-ad-overview.html">Anomaly detection</a></span>
»
<span class="breadcrumb-node">Finding anomalies in time series data</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ml-model-snapshots.html">« Model snapshots</a>
</span>
<span class="next">
<a href="ml-ad-concepts.html">Advanced concepts »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-ad-finding-anomalies"></a>Finding anomalies in time series data<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>

<p>The machine learning features automate the analysis of time series data by creating
accurate baselines of normal behavior in the data and identifying anomalous
patterns in that data.</p>
<p>Using <a class="xref" href="ml-ad-finding-anomalies.html#ml-ad-algorithms" title="Anomaly detection algorithms">proprietary machine learning algorithms</a>, the following
circumstances are detected, scored, and linked with statistically significant
influencers in the data:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Anomalies related to temporal deviations in values, counts, or frequencies
</li>
<li class="listitem">
Statistical rarity
</li>
<li class="listitem">
Unusual behaviors for a member of a population
</li>
</ul>
</div>
<p>Automated periodicity detection and quick adaptation to changing data ensure
that you don’t need to specify algorithms, models, or other data science-related
configurations in order to get the benefits of machine learning.</p>
<p>To use the machine learning features to analyze your data, you can create an anomaly detection job
and send your data to that job. The results of machine learning analysis are stored in Elasticsearch
and you can use Kibana to help you visualize and explore the results. For example,
charts illustrate the actual data values, the bounds for the expected values,
and the anomalies that occur outside these bounds:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/overview-smv.jpg" alt="Example screenshot from the Machine Learning Single Metric Viewer in Kibana">
</div>
</div>
<h3><a id="ml-ad-algorithms"></a>Anomaly detection algorithms<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>The anomaly detection machine learning features use a bespoke amalgamation of different
techniques such as clustering, various types of time series decomposition,
Bayesian distribution modeling, and correlation analysis. These analytics
provide sophisticated real-time automated anomaly detection for time series data.</p>
<p>The machine learning analytics statistically model the time-based characteristics of your
data by observing historical behavior and adapting to new data. The model
represents a baseline of normal behavior and can therefore be used to determine
how anomalous new events are.</p>
<p>Anomaly detection results are written for each <a class="xref" href="ml-buckets.html" title="Buckets">bucket span</a>.
These results include scores that are aggregated in order to reduce noise and
normalized in order to rank the most mathematically significant anomalies. For
more information, see <a class="xref" href="ml-buckets.html#ml-bucket-results" title="Bucket results">Bucket results</a> and <a class="xref" href="ml-influencers.html#ml-influencer-results" title="Influencer results">Influencer results</a>.</p>
<h3><a id="ml-ad-define-problem"></a>1. Define the problem<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>The machine learning features in Elastic Stack enable you to seek anomalies in your data in many
different ways. For example, there are functions that calculate metrics,
analyze geographic data, or seek rare events in your data set. You can also
optionally analyze your data relative to a specific population or group the data
based on specific attributes. For the full list of functions, see
<a class="xref" href="ml-functions.html" title="Function reference">Function reference</a>.</p>
<p>The most important considerations are the data sets that you have available and
the type of anomalous behavior you want to detect.</p>
<h3><a id="ml-ad-setup"></a>2. Set up environment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>If you want to use machine learning features, there must be at least one machine learning node in
your cluster and all master-eligible nodes must have machine learning enabled. By default,
all nodes are machine learning nodes. For more information about these settings, see
<a href="/guide/en/elasticsearch/reference/master/modules-node.html#ml-node" class="ulink" target="_top">machine learning nodes</a>.</p>
<p>If Elastic Stack security features are enabled, you must also ensure your users have
the necessary privileges. See <a class="xref" href="setup.html" title="Set up machine learning features"><em>Setup and security</em></a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If your data is located outside of Elasticsearch, you cannot use Kibana to create
your jobs and you cannot use datafeeds to retrieve your data in real time.
Posting data directly to anomaly detection jobs is deprecated, in a future major version
a datafeed will be required.</p>
</div>
</div>
<h3><a id="ml-ad-create-job"></a>3. Create a job<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>Anomaly detection jobs contain the configuration information and metadata
necessary to perform an analytics task.</p>
<p>You can create anomaly detection jobs by using the
<a href="/guide/en/elasticsearch/reference/master/ml-put-job.html" class="ulink" target="_top">Create anomaly detection jobs API</a>. Kibana also provides the
following wizards to make it easier to create jobs:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-create-job.jpg" alt="Create New Job">
</div>
</div>
<p>A <em>single metric job</em> is a simple job that contains a single <em>detector</em>. A
detector defines the type of analysis that will occur and which fields to
analyze. In addition to limiting the number of detectors, the single metric job
creation wizard omits many of the more advanced configuration options.</p>
<p>A <em>multi-metric job</em> can contain more than one detector, which is more efficient
than running multiple jobs against the same data.</p>
<p>A <em>population job</em> detects activity that is unusual compared to the behavior of
the population. For more information, see <a class="xref" href="ml-configuring-populations.html" title="Performing population analysis">Performing population analysis</a>.</p>
<p>A <em>categorization job</em> groups log messages into categories and uses
<a class="xref" href="ml-count-functions.html" title="Count functions">count</a> or <a class="xref" href="ml-rare-functions.html" title="Rare functions">rare</a> functions to detect
anomalies within them. See <a class="xref" href="ml-configuring-categories.html" title="Detecting anomalous categories of data">Detecting anomalous categories of data</a>.</p>
<p>An <em>advanced job</em> can contain multiple detectors and enables you to configure all
job settings.</p>
<p>Kibana can also recognize certain types of data and provide specialized wizards
for that context. For example, if you added the sample web log data set, the
following wizard appears:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-sample.jpg" alt="A screenshot of the Kibana sample data web log job creation wizard">
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Alternatively, after you load a sample data set on the Kibana home page, you
can click <span class="strong strong"><strong>View data</strong></span> &gt; <span class="strong strong"><strong>ML jobs</strong></span>. There are anomaly detection jobs for both the sample
eCommerce orders data set and the sample web logs data set.</p>
</div>
</div>
<p>If you use <a href="/guide/en/apm/get-started/master/overview.html" class="ulink" target="_top">Elastic APM</a>, Kibana also detects
this data and provides wizards for anomaly detection jobs. For example:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-apm.jpg" alt="A screenshot of the Kibana APM job creation wizard">
</div>
</div>
<p>If you use <a href="/guide/en/beats/filebeat/master/index.html" class="ulink" target="_top">Filebeat</a>
to ship access logs from your
<a href="http://nginx.org/" class="ulink" target="_top">Nginx</a> and <a href="https://httpd.apache.org/" class="ulink" target="_top">Apache</a> HTTP servers to
Elasticsearch and store it using fields and datatypes from the
<a href="/guide/en/ecs/1.11/ecs-reference.html" class="ulink" target="_top">Elastic Common Schema (ECS)</a>, the following wizards
appear:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-filebeat.jpg" alt="A screenshot of the Filebeat job creation wizards">
</div>
</div>
<p>If you use <a href="/guide/en/beats/auditbeat/master/index.html" class="ulink" target="_top">Auditbeat</a> to audit process
activity on your systems, the following wizards appear:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-auditbeat.jpg" alt="A screenshot of the Auditbeat job creation wizards">
</div>
</div>
<p>Likewise, if you use the <a href="/guide/en/beats/metricbeat/master/metricbeat-module-system.html" class="ulink" target="_top">Metricbeat system module</a> to monitor your servers, the following
wizards appear:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/ml-data-recognizer-metricbeat.jpg" alt="A screenshot of the Metricbeat job creation wizards">
</div>
</div>
<p>These wizards create anomaly detection jobs, dashboards, searches, and visualizations
that are customized to help you analyze your Auditbeat, Filebeat, and
Metricbeat data.</p>
<p>For a list of all the customized jobs, see <a class="xref" href="ootb-ml-jobs.html" title="Supplied anomaly detection configurations">Supplied configurations</a>.</p>
<p><a id="ml-ad-job-tips"></a>When you create an anomaly detection job in Kibana, the job creation wizards can
provide advice based on the characteristics of your data. By heeding these
suggestions, you can create jobs that are more likely to produce insightful machine learning
results.</p>
<h4><a id="ml-ad-bucket-span"></a>Bucket span<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h4>
<p>The bucket span is the time interval that machine learning analytics use to summarize and
model data for your job. When you create an anomaly detection job in Kibana, you can
choose to estimate a bucket span value based on your data characteristics.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The bucket span must contain a valid time interval. See
<a href="/guide/en/elasticsearch/reference/master/api-conventions.html#time-units" class="ulink" target="_top">Time units</a>.</p>
</div>
</div>
<p>If you choose a value that is larger than one day or is significantly different
than the estimated value, you receive an informational message. For more
information about choosing an appropriate bucket span, see <a class="xref" href="ml-buckets.html" title="Buckets">Buckets</a>.</p>
<h4><a id="ml-ad-cardinality"></a>Cardinality<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h4>
<p>If there are logical groupings of related entities in your data, machine learning analytics
can make data models and generate results that take these groupings into
consideration. For example, you might choose to split your data by user ID and
detect when users are accessing resources differently than they usually do.</p>
<p>If the field that you use to split your data has many different values, the
job uses more memory resources. In particular, if the cardinality of the
<code class="literal">by_field_name</code>, <code class="literal">over_field_name</code>, or <code class="literal">partition_field_name</code> is greater than
1000, you are advised that there might be high memory usage.</p>
<p>Likewise if you are performing population analysis and the cardinality of the
<code class="literal">over_field_name</code> is below 10, you are advised that this might not be a suitable
field to use. For more information, see <a class="xref" href="ml-configuring-populations.html" title="Performing population analysis">Performing population analysis</a>.</p>
<h4><a id="ml-ad-detectors"></a>Detectors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h4>
<p>Each anomaly detection job must have one or more <em>detectors</em>. A detector applies an
analytical function to specific fields in your data. If your job does not
contain a  detector or the detector does not contain a
<a class="xref" href="ml-functions.html" title="Function reference">valid function</a>, you receive an error.</p>
<p>If a job contains duplicate detectors, you also receive an error. Detectors are
duplicates if they have the same <code class="literal">function</code>, <code class="literal">field_name</code>, <code class="literal">by_field_name</code>,
<code class="literal">over_field_name</code> and <code class="literal">partition_field_name</code>.</p>
<h4><a id="ml-ad-influencers"></a>Influencers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h4>
<p>See <a class="xref" href="ml-influencers.html" title="Influencers">Influencers</a>.</p>
<h4><a id="ml-ad-model-memory-limits"></a>Model memory limits<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h4>
<p>For each anomaly detection job, you can optionally specify a <code class="literal">model_memory_limit</code>, which
is the approximate maximum amount of memory resources that are required for
analytical processing. The default value is 1 GB. Once this limit is approached,
data pruning becomes more aggressive. Upon exceeding this limit, new entities
are not modeled.</p>
<p>You can also optionally specify the <code class="literal">xpack.ml.max_model_memory_limit</code> setting.
By default, it&#8217;s not set, which means there is no upper bound on the acceptable
<code class="literal">model_memory_limit</code> values in your jobs.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you set the <code class="literal">model_memory_limit</code> too high, it will be impossible to open
the job; jobs cannot be allocated to nodes that have insufficient memory to run
them.</p>
</div>
</div>
<p>If the estimated model memory limit for an anomaly detection job is greater than the
model memory limit for the job or the maximum model memory limit for the cluster,
the job creation wizards in Kibana generate a warning. If the estimated memory
requirement is only a little higher than the <code class="literal">model_memory_limit</code>, the job will
probably produce useful results. Otherwise, the actions you take to address
these warnings vary depending on the resources available in your cluster:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If you are using the default value for the <code class="literal">model_memory_limit</code> and the machine learning
nodes in the cluster have lots of memory, the best course of action might be to
simply increase the job&#8217;s <code class="literal">model_memory_limit</code>. Before doing this, however,
double-check that the chosen analysis makes sense. The default
<code class="literal">model_memory_limit</code> is relatively low to avoid accidentally creating a job that
uses a huge amount of memory.
</li>
<li class="listitem">
<p>If the machine learning nodes in the cluster do not have sufficient memory to accommodate
a job of the estimated size, the only options are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Add bigger machine learning nodes to the cluster, or
</li>
<li class="listitem">
Accept that the job will hit its memory limit and will not necessarily find
all the anomalies it could otherwise find.
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>If you are using Elastic Cloud Enterprise or the hosted Elasticsearch Service on Elastic Cloud,
<code class="literal">xpack.ml.max_model_memory_limit</code> is set to prevent you from creating jobs
that cannot be allocated to any machine learning nodes in the cluster. If you find that you
cannot increase <code class="literal">model_memory_limit</code> for your machine learning jobs, the solution is to
increase the size of the machine learning nodes in your cluster.</p>
<h4><a id="ml-ad-dedicated-indices"></a>Dedicated indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/job-tips.asciidoc">edit</a></h4>
<p>For each anomaly detection job, you can optionally specify a dedicated index to store
the anomaly detection results. As anomaly detection jobs may produce a large amount
of results (for example, jobs with many time series, small bucket span, or with
long running period), it is recommended to use a dedicated results index by
choosing the <span class="strong strong"><strong>Use dedicated index</strong></span> option in Kibana or specifying the
<code class="literal">results_index_name</code> via the <a href="/guide/en/elasticsearch/reference/master/ml-put-job.html" class="ulink" target="_top">Create anomaly detection jobs API</a>.</p>
<h3><a id="ml-ad-open-job"></a>4. Open the job<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>An anomaly detection job must be opened in order for it to be ready to receive and
analyze data. It can be opened and closed multiple times throughout its
lifecycle.</p>
<p>After you start the job, you can start the datafeed, which retrieves data from
your cluster. A datafeed can be started and stopped multiple times throughout its
lifecycle.</p>
<p>You can perform both these tasks in Kibana or use the
<a href="/guide/en/elasticsearch/reference/master/ml-open-job.html" class="ulink" target="_top">open anomaly detection jobs</a> and
<a href="/guide/en/elasticsearch/reference/master/ml-start-datafeed.html" class="ulink" target="_top">start datafeeds</a> APIs.</p>
<h3><a id="ml-ad-view-results"></a>5. View the job results<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>After the anomaly detection job has processed some data, you can view the results in
Kibana.</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Depending on the capacity of your machine, you might need to wait a few
seconds for the machine learning analysis to generate initial results.</p>
</div>
</div>
<p>There are two tools for examining the results from anomaly detection jobs in Kibana: the
<span class="strong strong"><strong>Anomaly Explorer</strong></span> and the <span class="strong strong"><strong>Single Metric Viewer</strong></span>.</p>
<h3><a id="ml-ad-forecast"></a>6. Forecast future behavior<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>After the machine learning features create baselines of normal behavior for your data,
you can use that information to extrapolate future behavior.</p>
<p>You can use a forecast to estimate a time series value at a specific future date.
For example, you might want to determine how many users you can expect to visit
your website next Sunday at 0900.</p>
<p>You can also use it to estimate the probability of a time series value occurring
at a future date. For example, you might want to determine how likely it is that
your disk utilization will reach 100% before the end of next week.</p>
<p>Each forecast has a unique ID, which you can use to distinguish between forecasts
that you created at different times. You can create a forecast by using the
<a href="/guide/en/elasticsearch/reference/master/ml-forecast.html" class="ulink" target="_top">forecast anomaly detection jobs API</a> or by using Kibana. For
example:</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/overview-forecast.jpg" alt="Example screenshot from the Machine Learning Single Metric Viewer in Kibana">
</div>
</div>
<p>The yellow line in the chart represents the predicted data values. The
shaded yellow area represents the bounds for the predicted values, which also
gives an indication of the confidence of the predictions.</p>
<p>When you create a forecast, you specify its <em>duration</em>, which indicates how far
the forecast extends beyond the last record that was processed. By default, the
duration is 1 day. Typically the farther into the future that you forecast, the
lower the confidence levels become (that is to say, the bounds increase).
Eventually if the confidence levels are too low, the forecast stops.
For more information about limitations that affect your ability to create a
forecast, see <a class="xref" href="ml-limitations.html#ml-forecast-config-limitations" title="Unsupported forecast configurations">Unsupported forecast configurations</a>.</p>
<p>You can also optionally specify when the forecast expires. By default, it
expires in 14 days and is deleted automatically thereafter. You can specify a
different expiration period by using the <code class="literal">expires_in</code> parameter in the
<a href="/guide/en/elasticsearch/reference/master/ml-forecast.html" class="ulink" target="_top">forecast anomaly detection jobs API</a>.</p>
<h3><a id="ml-ad-close-job"></a>7. Close the job<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>If you need to stop your anomaly detection job, an orderly shutdown ensures that:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Datafeeds are stopped
</li>
<li class="listitem">
Buffers are flushed
</li>
<li class="listitem">
Model history is pruned
</li>
<li class="listitem">
Final results are calculated
</li>
<li class="listitem">
Model snapshots are saved
</li>
<li class="listitem">
Anomaly detection jobs are closed
</li>
</ul>
</div>
<p>This process ensures that jobs are in a consistent state in case you want to
subsequently re-open them.</p>
<h4><a id="stopping-ml-datafeeds"></a>Stopping datafeeds<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/stopping-ml.asciidoc">edit</a></h4>
<p>When you stop a datafeed, it ceases to retrieve data from Elasticsearch. You can stop a
datafeed by using Kibana or the
<a href="/guide/en/elasticsearch/reference/master/ml-stop-datafeed.html" class="ulink" target="_top">stop datafeeds API</a>. For example, the following
request stops the <code class="literal">feed1</code> datafeed:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/feed1/_stop</pre>
</div>
<div class="console_widget" data-snippet="snippets/1.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must have <code class="literal">manage_ml</code>, or <code class="literal">manage</code> cluster privileges to stop datafeeds.
For more information, see <a href="/guide/en/elasticsearch/reference/master/security-privileges.html" class="ulink" target="_top">Security privileges</a>.</p>
</div>
</div>
<p>A datafeed can be started and stopped multiple times throughout its lifecycle.</p>
<h4><a id="stopping-all-ml-datafeeds"></a>Stopping all datafeeds<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/stopping-ml.asciidoc">edit</a></h4>
<p>If you are upgrading your cluster, you can use the following request to stop all
datafeeds:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/datafeeds/_all/_stop</pre>
</div>
<div class="console_widget" data-snippet="snippets/2.console"></div>
<h4><a id="closing-ml-jobs"></a>Closing anomaly detection jobs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/stopping-ml.asciidoc">edit</a></h4>
<p>When you close an anomaly detection job, it cannot receive data or perform analysis
operations. If a job is associated with a datafeed, you must stop the datafeed
before you can close the job. If the datafeed has an end date, the job closes
automatically on that end date.</p>
<p>You can close a job by using the
<a href="/guide/en/elasticsearch/reference/master/ml-close-job.html" class="ulink" target="_top">close anomaly detection job API</a>. For
example, the following request closes the <code class="literal">job1</code> job:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/job1/_close</pre>
</div>
<div class="console_widget" data-snippet="snippets/3.console"></div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must have <code class="literal">manage_ml</code>, or <code class="literal">manage</code> cluster privileges to stop datafeeds.
For more information, see <a href="/guide/en/elasticsearch/reference/master/security-privileges.html" class="ulink" target="_top">Security privileges</a>.</p>
</div>
</div>
<p>Anomaly detection jobs can be opened and closed multiple times throughout their
lifecycle.</p>
<h4><a id="closing-all-ml-datafeeds"></a>Closing all anomaly detection jobs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/stopping-ml.asciidoc">edit</a></h4>
<p>If you are upgrading your cluster, you can use the following request to close
all open anomaly detection jobs on the cluster:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _ml/anomaly_detectors/_all/_close</pre>
</div>
<div class="console_widget" data-snippet="snippets/4.console"></div>
<h3><a id="_next_steps"></a>Next steps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/stack-docs/edit/master/docs/en/stack/ml/anomaly-detection/ml-ad-finding-anomalies.asciidoc">edit</a></h3>
<p>For a more detailed walk-through of machine learning features, see <a class="xref" href="ml-getting-started.html" title="Getting started with machine learning">Getting started with machine learning</a>.</p>
<p>For more advanced settings and scenarios, see <a class="xref" href="anomaly-examples.html" title="Anomaly detection examples"><em>Examples</em></a>.</p>
<p>Refer to <a class="xref" href="anomaly-detection-scale.html" title="Working with anomaly detection at scale">Working with anomaly detection at scale</a> to learn more about the particularities of
large anomaly detection jobs.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="ml-model-snapshots.html">« Model snapshots</a>
</span>
<span class="next">
<a href="ml-ad-concepts.html">Advanced concepts »</a>
</span>
</div>
</div>

                  <!-- end body -->
                </div>
                <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Most Popular</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Get Started with Elasticsearch: Video</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Intro to Kibana: Video</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/introduction-elk-stack?baymax=default&elektra=docs&storm=top-video">ELK for Logs & Metrics: Video</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'></div>
<script src='https://www.elastic.co/elastic-footer.js'></script>
<!-- Footer Section end-->

      </section>
    </div>

<script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/guide/static/jquery.js"></script>
<script type="text/javascript" src="/guide/static/docs.js"></script>
<script type="text/javascript">
  window.initial_state = {}</script>
  </body>
</html>
