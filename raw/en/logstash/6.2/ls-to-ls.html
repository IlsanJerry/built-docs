<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Configuring Logstash-to-Logstash Communication
        | Logstash Reference [6.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Logstash Reference [6.2]" /><link rel="up" href="configuration.html" title="Configuring Logstash" /><link rel="prev" href="ingest-converter.html" title="Converting Ingest Node Pipelines" /><link rel="next" href="config-management.html" title="Managing Logstash" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Logstash/Reference/6.2" /><meta xmlns="" name="DC.subject" content="Logstash" /><meta xmlns="" name="DC.identifier" content="6.2" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Logstash Reference
      [6.2]
    </a></span> » <span class="breadcrumb-link"><a href="configuration.html">Configuring Logstash</a></span> » <span class="breadcrumb-node">Configuring Logstash-to-Logstash Communication</span></div><div xmlns="" class="navheader"><span class="prev"><a href="ingest-converter.html">
              « 
              Converting Ingest Node Pipelines</a>
           
        </span><span class="next">
           
          <a href="config-management.html">Managing Logstash
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ls-to-ls"></a>Configuring Logstash-to-Logstash Communication<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can set up communication between two Logstash machines by connecting the Lumberjack output to the Beats input. You may need this configuration if the data path crosses network or firewall boundaries, for example. If you don’t have a compelling need for Logstash-to-Logstash communication, then don’t implement it.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ls-to-ls-overview"></a>Configuration overview<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Use the Lumberjack protocol to connect two Logstash machines.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Generate a trusted SSL certificate (required by the lumberjack protocol).</li><li class="listitem">Copy the SSL certificate to the upstream Logstash machine.</li><li class="listitem">Copy the SSL certificate and key to the downstream Logstash machine.</li><li class="listitem">Set the upstream Logstash machine to use the Lumberjack output to send data.</li><li class="listitem">Set the downstream Logstash machine to listen for incoming Lumberjack connections through the Beats input.</li><li class="listitem">Test it.</li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="generate-self-signed-cert"></a>Generate a self-signed SSL certificate and key<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Use the <code class="literal">openssl req</code> command to generate a self-signed certificate and key. The <code class="literal">openssl req</code> command is available with some operating systems. You may need to install the openssl command line program for others.</p><p>Run the following command:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">openssl req -x509 -batch -nodes -newkey rsa:2048 -keyout lumberjack.key -out lumberjack.cert -subj /CN=localhost</pre></div><p>where:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">lumberjack.key</code> is the name of the SSL key to be created</li><li class="listitem"><code class="literal">lumberjack.cert</code> is the name of the SSL certificate to be created</li><li class="listitem"><code class="literal">localhost</code> is the name of the upstream Logstash computer</li></ul></div><p>This command produces output similar to the following:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">Generating a 2048 bit RSA private key
.................................+++
....................+++
writing new private key to 'lumberjack.key'</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="copy-cert-key"></a>Copy the SSL certificate and key<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Copy the SSL certificate to the upstream Logstash machine.</p><p>Copy the SSL certificate and key to the downstream Logstash machine.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="save-cert-ls1"></a>Start the upstream Logstash instance<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Start Logstash and generate test events:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">bin/logstash -e 'input { generator { count =&gt; 5 } } output { lumberjack { codec =&gt; json hosts =&gt; "mydownstreamhost" ssl_certificate =&gt; "lumberjack.cert" port =&gt; 5000 } }'</pre></div><p>This sample command sends five events to mydownstreamhost:5000 using the SSL certificate provided.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="save-cert-ls2"></a>Start the downstream Logstash instance<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Start the downstream instance of Logstash:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">bin/logstash -e 'input { beats { codec =&gt; json port =&gt; 5000 ssl =&gt; true ssl_certificate =&gt; "lumberjack.cert" ssl_key =&gt; "lumberjack.key"} }'</pre></div><p>This sample command sets port 5000 to listen for incoming Beats input.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="test-ls-to-ls"></a>Verify the communication<a xmlns="" href="https://github.com/elastic/logstash/edit/6.2/docs/static/ls-ls-config.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Watch the downstream Logstash machine for the incoming events. You should see five incrementing events similar to the following:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">{
  "@timestamp" =&gt; 2018-02-07T12:16:39.415Z,
  "sequence"   =&gt; 0
  "tags"       =&gt; [
    [0] "beats_input_codec_json_applied"
  ],
  "message"    =&gt; "Hello world",
  "@version"   =&gt; "1",
  "host"       =&gt; "ls1.semicomplete.com"
}</pre></div><p>If you see all five events with consistent fields and formatting, incrementing by one, then your configuration is correct.</p></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="ingest-converter.html">
              « 
              Converting Ingest Node Pipelines</a>
           
        </span><span class="next">
           
          <a href="config-management.html">Managing Logstash
               »
            </a></span></div></body></html>