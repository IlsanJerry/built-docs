<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Configure the keystore
        | Elastic Cloud Enterprise Reference [2.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.1]" /><link rel="up" href="ece-securing-clusters.html" title="Secure your clusters" /><link rel="prev" href="ece-filter-ip-traffic.html" title="Filter IP traffic" /><link rel="next" href="ece-securing-clusters-LDAP.html" title="Secure your clusters with LDAP" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.1" /><meta xmlns="" name="DC.subject" content="ECE" /><meta xmlns="" name="DC.identifier" content="2.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference
      [2.1]
    </a></span> » <span class="breadcrumb-link"><a href="ece-administering-deployments.html">Administering deployments</a></span> » <span class="breadcrumb-link"><a href="ece-securing-clusters.html">Secure your clusters</a></span> » <span class="breadcrumb-node">Configure the keystore</span></div><div xmlns="" class="navheader"><span class="prev"><a href="ece-filter-ip-traffic.html">
              « 
              Filter IP traffic</a>
           
        </span><span class="next">
           
          <a href="ece-securing-clusters-LDAP.html">Secure your clusters with LDAP
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ece-configuring-keystore"></a>Configure the keystore</h2></div></div></div><p>When you configure Elastic Cloud Enterprise, you might include sensitive settings or configuration options, such as passwords. Instead of relying on file system permissions, you can use the keystore to protect these settings or options.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The keystore is a RESTful API-only feature.</p></div></div><h4><a id="ece-before_you_begin_17"></a>Before you begin</h4><p>To configure the keystore, you must meet the minimum criteria.</p><p>The minimum criteria include:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
To access the RESTful API for Elastic Cloud Enterprise, you must use your Elastic Cloud Enterprise credentials.
</li><li class="listitem">
The Elasticsearch cluster that you plan to configure must be version 6.0 or later.
</li></ul></div><p>To learn more about the keystore, refer to the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.6/secure-settings.html" target="_top">Elasticsearch documentation</a>.</p><h4><a id="ece-steps_5"></a>Steps</h4><p>Create the keystore:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">curl -k -X PATCH -u $USER<a id="CO17-1"></a><i xmlns="" class="conum" data-value="1"></i>:$PASSWORD<a id="CO17-2"></a><i xmlns="" class="conum" data-value="2"></i> https://$COORDINATOR_HOST<a id="CO17-3"></a><i xmlns="" class="conum" data-value="3"></i>:12443/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID<a id="CO17-4"></a><i xmlns="" class="conum" data-value="4"></i>/keystore \
{
  "secrets": {
    "s3.client.CLIENT_NAME.access_key": {
      "as_file": false
      "value": "ACCESS_KEY_VALUE"
    }
    "s3.client.CLIENT_NAME.secret_key": {
      "value": "SECRET_KEY_VALUE"
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
A user with sufficient privileges, such as the <code class="literal">admin</code> user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>
The password for the user
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-3"><i xmlns="" class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>
A host that you installed Elastic Cloud Enterprise on that holds the coordinator role
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-4"><i xmlns="" class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>
The Elasticsearch cluster ID as shown in the Cloud UI or obtained via the API
</p></td></tr></table></div><p>List the keys defined in the keystore:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">{
  "secrets": {
    "s3.client.CLIENT_NAME.access_key": {
      "as_file": false
    },
    "s3.client.CLIENT_NAME.secret_key": {
      "as_file": false
    }
  }
}</pre></div><p>Create the credentials for an S3, or Minio, repository:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">curl -k -X PUT -u $USER:$PASSWORD https://$COODINATOR_HOST:12443/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/_snapshot/s3-repo
{
  "type": "s3",
  "settings": {
    "bucket": "s3_REPOSITORY_NAME",
    "client": "CLIENT_NAME",
    "base_path": "PATH_NAME"
  }
}</pre></div><p>Create the credentials for a GCS repository:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">curl -k -X PUT -u $USER:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/_snapshot/s3-repo
{
  "type": "gcs",
  "settings": {
    "bucket": "BUCKET_NAME",
    "base_path": "BASE_PATH_NAME",
    "client": "CLIENT_NAME"
  }
}</pre></div><div xmlns="" class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">To use GCS snapshots, the cluster must have the <code class="literal">repository-gcs</code> plugin enabled.</p></div></div><p>Remove keys that are defined the keystore:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">curl -k -X PATCH -u $USER:$PASSWORD https://$COORDINATOR_HOST:12443/api/v1/clusters/elasticsearch/$ELASTICSEARCH_CLUSTER_ID/keystore \
{
  "secrets": {
    "KEY_TO_REMOVE": {}
  }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ece-verify_your_credentials"></a>Verify your credentials</h3></div></div></div><p>If your credentials are invalid, an administrator can verify that they are correct by checking the <code class="literal">keystore</code> field in the cluster metadata.</p><p>If the credential values are correct, but are not working, the keystore file could be out of sync on one or more nodes. To sync the keystore file, you can update the value for the key by using the patch API to delete the key from keystore, then add it back again.</p></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="ece-filter-ip-traffic.html">
              « 
              Filter IP traffic</a>
           
        </span><span class="next">
           
          <a href="ece-securing-clusters-LDAP.html">Secure your clusters with LDAP
               »
            </a></span></div></body></html>