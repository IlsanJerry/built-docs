<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Snapshotting to Google Cloud Storage (GCS) for Elasticsearch 6.x
        | Elastic Cloud Enterprise Reference [2.0]
      | Elastic
    </title><link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.0]" /><link rel="up" href="ece-manage-repositories.html" title="Manage Snapshot Repositories" /><link rel="prev" href="ece-manage-repositories.html" title="Manage Snapshot Repositories" /><link rel="next" href="ece-configure-azure-snapshotting.html" title="Snapshotting to Azure Storage for Elasticsearch 5.x and 6.x" /><meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.0" /><meta name="DC.subject" content="ECE" /><meta name="DC.identifier" content="2.0" /></head><body><div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference
      [2.0]
    </a></span> » <span class="breadcrumb-link"><a href="ece-configuring-ece.html">Configuring Your Installation</a></span> » <span class="breadcrumb-link"><a href="ece-manage-repositories.html">Manage Snapshot Repositories</a></span> » <span class="breadcrumb-node">Snapshotting to Google Cloud Storage (GCS) for Elasticsearch 6.x</span></div><div class="navheader"><span class="prev"><a href="ece-manage-repositories.html">
              « 
              Manage Snapshot Repositories</a>
           
        </span><span class="next">
           
          <a href="ece-configure-azure-snapshotting.html">Snapshotting to Azure Storage for Elasticsearch 5.x and 6.x
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ece-configure-gcp-snapshotting"></a>Snapshotting to Google Cloud Storage (GCS) for Elasticsearch 6.x</h2></div></div></div><p>Snapshotting to GCS isn’t currently supported in the Cloud UI, but there is a workaround using Application Default Credentials (<a class="ulink" href="https://developers.google.com/identity/protocols/application-default-credentials" target="_top">https://developers.google.com/identity/protocols/application-default-credentials</a>). This method uses keys built in to your GCP instances to login to GCS.</p><p>To use the Application Default Credentials it is necessary to make a small change to the Instance Template when you create your GCP instances <a class="link" href="ece-configure-gcp.html" title="Google Cloud Platform (GCP)">Google Cloud Platform Configuration</a>.</p><div class="note admon"><div class="icon"></div><div class="admon_content"><p>This method only works for Elasticsearch clusters at version 6.x. If you are using an earlier Elasticsearch version you must upgrade first.</p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Create a Google instance template with access to the Storage API:</p><p class="simpara">When creating an <span class="strong strong"><strong>Instance Template</strong></span>, under Identity and API access you need to set either:
<span class="strong strong"><strong> <span class="strong strong"><strong>Allow full access to all Cloud APIs</strong></span> or
</strong></span> <span class="strong strong"><strong>Set access for each API</strong></span> and select <span class="strong strong"><strong>Read Write</strong></span> under <span class="strong strong"><strong>Storage</strong></span></p><p class="simpara">+
image::images/ece-gcp-default-auth.png[Creating an instance template with default auth]</p></li><li class="listitem"><a class="link" href="ece-login.html" title="Log into the Cloud UI">Log into the Cloud UI</a>.</li><li class="listitem"><p class="simpara">Add the snapshot repository configuration through the Advanced Cluster Configuration:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Create a deployment with an Elasticsearch cluster that has the <code class="literal">repository-gcs</code> plugin enabled.</li><li class="listitem">From your deployment menu, go to the <span class="strong strong"><strong>Edit</strong></span> page then go to the bottom of the page and click <span class="strong strong"><strong>advanced Elasticsearch configuration</strong></span>.</li><li class="listitem">In the <span class="strong strong"><strong>Data</strong></span> text area, carefully edit the JSON to add a top-level <code class="literal">gcp_resources</code> configuration object with your bucket name for snapshotting (test-ece-auth in this case).  Also set <span class="strong strong"><strong>enabled</strong></span> under <span class="strong strong"><strong>snapshot</strong></span> to <span class="strong strong"><strong>true</strong></span>.:</li></ol></div></li></ol></div><div class="informalfigure"><div class="mediaobject"><img src="images/ece-gcp-cluster-data.png" alt="GCP resources cluster data" /></div></div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Press the <span class="strong strong"><strong>Data</strong></span> section <span class="strong strong"><strong>Save</strong></span> button to store the updated cluster data and trigger a plan change.</li></ol></div><p>The cluster should then have snapshots enabled and will begin snapshotting either immediately (if skip_snapshot is false in the plan) or in 30 minutes (the default snapshot interval).</p></div><div class="navfooter"><span class="prev"><a href="ece-manage-repositories.html">
              « 
              Manage Snapshot Repositories</a>
           
        </span><span class="next">
           
          <a href="ece-configure-azure-snapshotting.html">Snapshotting to Azure Storage for Elasticsearch 5.x and 6.x
               »
            </a></span></div></body></html>
