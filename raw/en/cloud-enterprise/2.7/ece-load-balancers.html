<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Load balancers | Elastic Cloud Enterprise Reference [2.7] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Cloud Enterprise Reference [2.7]"/>
<link rel="up" href="ece-prereqs.html" title="Preparing your installation"/>
<link rel="prev" href="ece-roles.html" title="Separation of roles"/>
<link rel="next" href="ece-users-permissions.html" title="Users and permissions"/>
<meta name="DC.type" content="Learn/Docs/CloudEnterprise/Reference/2.7"/>
<meta name="DC.subject" content="ECE"/>
<meta name="DC.identifier" content="2.7"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Cloud Enterprise Reference [2.7]</a></span>
»
<span class="breadcrumb-link"><a href="ece-prereqs.html">Preparing your installation</a></span>
»
<span class="breadcrumb-node">Load balancers</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ece-roles.html">« Separation of roles</a>
</span>
<span class="next">
<a href="ece-users-permissions.html">Users and permissions »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ece-load-balancers"></a>Load balancers<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/cloud/edit/ms-47/docs/cloud-enterprise/ce-load-balancer.asciidoc">edit</a></h2>
</div></div></div>
<p>Elastic Cloud Enterprise is designed to be used in conjunction with at least one load balancer. A load balancer is not included with Elastic Cloud Enterprise, so you need to provide one yourself and place it in front of the Elastic Cloud Enterprise proxies.</p>
<p>Use the following recommendations when configuring your load balancer:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<span class="strong strong"><strong>High availability</strong></span>: The exact number of load balancers depends on the utilization rate for your clusters. In a highly available installation, use at least two load balancers for each availability zone in your installation.
</li>
<li class="listitem">
<span class="strong strong"><strong>Inbound ports</strong></span>: Load balancers require that inbound traffic is open on the ports used by Elasticsearch, Kibana, and the transport client.
</li>
<li class="listitem">
<span class="strong strong"><strong>X-found-cluster</strong></span>: ECE proxy uses the header <code class="literal">X-found-cluster</code> to know which cluster’s UUID (Universally Unique Identifier) the traffic needs to be routed to. If the load balancer rewrites a URL, make sure the HTTP header <code class="literal">X-Found-Cluster</code> gets added. For example: <code class="literal">X-found-cluster: d59109b8d542c5c4845679e597810796</code>.
</li>
<li class="listitem">
<span class="strong strong"><strong>X-Forwarded-For</strong></span>: Configure load balancers to strip inbound <code class="literal">X-Forwarded-For</code> headers and to replace them with the client source IP as seen by the load balancer. This is required to prevent clients from spoofing their IP addresses. Elastic Cloud Enterprise uses <code class="literal">X-Forwarded-For</code> for logging client IP addresses and, if you have implemented IP filtering, for traffic management.
</li>
<li class="listitem">
<span class="strong strong"><strong>HTTP</strong></span>: Use <em>HTTP mode</em> for ports 9200/9243 (HTTP traffic to clusters) and also for ports 12400/12443 (adminconsole traffic). Make sure that all load balancers or proxies sending HTTP traffic to deployments hosted on Elastic Cloud Enterprise are sending HTTP/1.1 traffic.
</li>
<li class="listitem">
<span class="strong strong"><strong>TCP</strong></span>: Use <em>TCP mode</em> for ports 9300/9343 (transport client traffic to clusters) and the load balancer should enable the proxy protocol support.
</li>
<li class="listitem">
<span class="strong strong"><strong>Deployment traffic and Admin traffic</strong></span>: Create separate load balancers for Deployment traffic (Elasticsearch and Kibana traffic) and Admin traffic (Cloud UI Console and Admin API). This separation allows you to migrate to a large installation topology without reconfiguring or creating an additional load balancer.
</li>
<li class="listitem">
<span class="strong strong"><strong>Traffic across proxies</strong></span>: Balance traffic evenly across all proxies. Proxies are constantly updated with the internal routing information on how to direct requests to clusters on allocators that are hosting their nodes across zones. Proxies prefer cluster nodes in their local zone and route requests primarily to nodes in their own zone.
</li>
<li class="listitem">
<span class="strong strong"><strong>Network</strong></span>: Use network that is fast enough from a latency and throughput perspective to be considered local for the Elasticsearch clustering requirement. There shouldn&#8217;t be a major advantage in "preferring local" from a load balancer perspective (rather than a proxy perspective), it might even lead to potential hot spotting on specific proxies, so it should be avoided.
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="ece-roles.html">« Separation of roles</a>
</span>
<span class="next">
<a href="ece-users-permissions.html">Users and permissions »</a>
</span>
</div>
</div>
</body>
</html>
