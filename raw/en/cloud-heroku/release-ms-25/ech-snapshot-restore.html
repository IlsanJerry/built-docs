<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Snapshot and restore
        | Elasticsearch Add-On for Heroku Documentation
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Add-On for Heroku Documentation" /><link rel="up" href="index.html" title="Elasticsearch Add-On for Heroku Documentation" /><link rel="prev" href="ech-memory-pressure.html" title="Memory pressure indicator" /><link rel="next" href="ech-restoring-snapshots.html" title="Restoring snapshots" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Cloud-Heroku/Reference" /><meta xmlns="" name="DC.subject" content="Elasticsearch Add-On for Heroku" /><meta xmlns="" name="DC.identifier" content="release-ms-25" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">The documentation you are looking at is in the process of being revised.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Add-On for Heroku Documentation</a></span> » <span class="breadcrumb-node">Snapshot and restore</span></div><div xmlns="" class="navheader"><span class="prev"><a href="ech-memory-pressure.html">
              « 
              Memory pressure indicator</a>
           
        </span><span class="next">
           
          <a href="ech-restoring-snapshots.html">Restoring snapshots
               »
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 xmlns="" class="title"><a xmlns="http://www.w3.org/1999/xhtml" id="ech-snapshot-restore"></a>Snapshot and restore</h1></div></div></div><div class="partintro"><div></div><p>We support all of Elasticsearch’s Snapshot and Restore API to back up your data. You can also add <a class="link" href="ech-custom-repository.html" title="Snapshot and restore with custom repositories">custom repositories</a>.</p><p>This page explains details specific to Elasticsearch Add-On for Heroku. For up-to-date documentation on the Snapshot and Restore API, please consult the official <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/modules-snapshots.html" target="_top">Snapshot/Restore-documentation</a>.</p><h2><a id="echdefault_repository"></a>Default repository</h2><p>When you create a cluster, a repository called <code class="literal">found-snapshots</code> is automatically added to the cluster.</p><p>This repository is specific to that cluster: the deployment ID is part of the repository’s <code class="literal">base_path</code>, i.e., <code class="literal">/snapshots/[cluster-id]</code>.</p><h2><a id="echsharing_a_repository_across_clusters"></a>Sharing a repository across clusters</h2><p>Create a custom repository that references another cluster’s repository.</p><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">To restore a snapshot from one cluster to another cluster, both clusters must be in the same region.</p></div></div><p>If you do a <code class="literal">GET /_snapshot/found-snapshots</code>-request, you can find the name of your bucket. Here’s an example:</p><div xmlns="" class="pre_wrapper lang-json"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-json">{
  "found-snapshots" : {
    "type" : "s3",
    "settings" : {
      "bucket" : "[RANDOM_STRING]",
      "base_path" : "snapshots/[cluster-id]",
      "server_side_encryption" : "true",
      "compress" : "true"
    }
  }
}</pre></div><p>The random string bucket name is the same for all your clusters in that region. All nodes in your clusters in that region are configured with credentials that have access to that bucket. The only thing that differs is the <code class="literal">base_path</code>.</p><p>Thus, you can easily create a reference to another cluster’s repository by creating a second repository. For example, if you have a production cluster you want to copy indexes from, you can do a <code class="literal">PUT /_snapshot/production</code> with the following body to create a second repository:</p><div xmlns="" class="pre_wrapper lang-json"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-json">{
  "type": "s3",
  "settings" : {
    "bucket": "[RANDOM_STRING]",
    "base_path": "snapshots/[production-cluster-id]",
    "server_side_encryption": "true",
    "compress": "true"
  }
}</pre></div><p>You will then be able to restore indexes from the production cluster to another cluster by, for example, running <code class="literal">POST /_snapshot/production/_restore</code>.</p><p>When you register the same repository with multiple clusters, only one cluster should have write access to the repository. All other connected clusters should have <code class="literal">readonly</code> access. For example:</p><div xmlns="" class="pre_wrapper lang-json"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-json">{
  "type": "s3",
  "settings" : {
    "bucket": "[RANDOM_STRING]",
    "base_path": "snapshots/[connected-cluster-id]",
    "server_side_encryption": "true",
    "compress": "true"
    "readonly": "true"
  }
}</pre></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">When you use the same repository across clusters, you are responsible for not writing to the same location at the same time.</p></div></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="ech-memory-pressure.html">
              « 
              Memory pressure indicator</a>
           
        </span><span class="next">
           
          <a href="ech-restoring-snapshots.html">Restoring snapshots
               »
            </a></span></div></body></html>