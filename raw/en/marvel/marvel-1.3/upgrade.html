<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Upgrade
        | Marvel Documentation [marvel-1.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Marvel Documentation [marvel-1.3]" /><link rel="up" href="index.html" title="Marvel Documentation [marvel-1.3]" /><link rel="prev" href="manual_download.html" title="Manual download" /><link rel="next" href="configuration.html" title="Configuration Options" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Legacy/Marvel/Reference/marvel-1.3" /><meta xmlns="" name="DC.subject" content="Marvel" /><meta xmlns="" name="DC.identifier" content="marvel-1.3" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">From version 5.0 onward, Marvel is part of X-Pack. For more information, see 
<a href=https://www.elastic.co/guide/en/elastic-stack-overview/current/xpack-monitoring.html>
    Monitoring the Elastic Stack</a>. 
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Marvel Documentation
      [marvel-1.3]
    </a></span> » <span class="breadcrumb-node">Upgrade</span></div><div xmlns="" class="navheader"><span class="prev"><a href="manual_download.html">
              « 
              Manual download</a>
           
        </span><span class="next">
           
          <a href="configuration.html">Configuration Options
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="upgrade"></a>Upgrade</h1></div></div></div><p>Marvel must be upgraded on <span class="strong strong"><strong>every node in the cluster</strong></span>.  If a monitoring cluster is in use as well, Marvel must be upgraded on that cluster as well.  It is not necessary to fully shut down the production cluster in order to perform the upgrade.  A rolling upgrade of the production cluster is sufficient.  The monitoring cluster, if present, can be upgraded using a rolling upgrade, or it can be shut down and upgraded while offline.  The monitoring cluster should be upgraded before the production cluster.</p><p>In order to perform a rolling Marvel upgrade:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">Disable shard reallocation (optional).  This is done to allow for a faster startup after cluster shutdown.  If this step is not performed, the nodes will immediately start trying to replicate shards to each other on startup and will spend a lot of time on wasted I/O.  With shard reallocation disabled, the nodes will join the cluster with their indices intact, without attempting to rebalance.  After startup is complete, reallocation will be turned back on.</p><p class="simpara">This syntax applies to Elasticsearch 1.0 and later:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">curl -XPUT localhost:9200/_cluster/settings -d '{
  "transient" : {
    "cluster.routing.allocation.enable" : "none"
  }
}'</pre></div></li><li class="listitem"><p class="simpara">On each node in the cluster, one at a time, do the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">Stop Elasticsearch.</li><li class="listitem"><p class="simpara">Once the node stopped, remove the old version of the Marvel plugin:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">bin/plugin -r marvel</pre></div></li><li class="listitem"><p class="simpara">On the same node, install the latest version of the Marvel plugin:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">bin/plugin -i elasticsearch/marvel/latest</pre></div></li><li class="listitem">Start Elasticsearch and confirm that the node rejoins the cluster and that there are no errors in the logs.</li></ul></div></li><li class="listitem">Repeat the above for each node in the cluster, including dedicated master noded is used.</li><li class="listitem"><p class="simpara">When all nodes in the cluster are upgraded, re-enable shard allocation:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">curl -XPUT localhost:9200/_cluster/settings -d '{
  "transient" : {
      "cluster.routing.allocation.enable" : "all"
  }
}'</pre></div></li><li class="listitem">If you’re using a dedicated monitoring cluster, follow the same procedure to upgrade the production cluster.</li></ul></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="manual_download.html">
              « 
              Manual download</a>
           
        </span><span class="next">
           
          <a href="configuration.html">Configuration Options
               »
            </a></span></div></body></html>