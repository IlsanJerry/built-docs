<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tutorial: Snapshot and Restore
        | Kibana Guide [7.5]
      | Elastic
    </title><link rel="home" href="index.html" title="Kibana Guide [7.5]" /><link rel="up" href="snapshot-repositories.html" title="Snapshot and Restore" /><link rel="prev" href="snapshot-repositories.html" title="Snapshot and Restore" /><link rel="next" href="xpack-spaces.html" title="Spaces" /><meta name="DC.type" content="Learn/Docs/Kibana/Reference/7.5" /><meta name="DC.subject" content="Kibana" /><meta name="DC.identifier" content="7.5" /></head><body><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Kibana Guide
      [7.5]
    </a></span> » <span class="breadcrumb-link"><a href="management.html">Management</a></span> » <span class="breadcrumb-link"><a href="snapshot-repositories.html">Snapshot and Restore</a></span> » <span class="breadcrumb-node">Tutorial:  Snapshot and Restore</span></div><div class="navheader"><span class="prev"><a href="snapshot-repositories.html">
              « 
              Snapshot and Restore</a>
           
        </span><span class="next">
           
          <a href="xpack-spaces.html">Spaces
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="snapshot-restore-tutorial"></a>Tutorial:  Snapshot and Restore<a href="https://github.com/elastic/kibana/edit/7.5/docs/management/snapshot-restore/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><p>Ready to try <span class="strong strong"><strong>Snapshot and Restore</strong></span>? In this tutorial, you’ll learn to:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Register a repository</li><li class="listitem">Add snapshots to the repository</li><li class="listitem">Create a snapshot lifecycle policy</li><li class="listitem">Restore a snapshot</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_before_you_begin_4"></a>Before you begin<a href="https://github.com/elastic/kibana/edit/7.5/docs/management/snapshot-restore/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>This example shows you how to register a shared file system repository
and store snapshots.
Before you begin, you must register the location of the repository in the
<a class="ulink" href="/guide/en/elasticsearch/reference/7.5/modules-snapshots.html#_shared_file_system_repository" target="_top">path.repo</a> setting on
your master and data nodes.  You can do this in one of two ways:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Edit  your <code class="literal">elasticsearch.yml</code> to include the <code class="literal">path.repo</code> setting.</li><li class="listitem"><p class="simpara">Pass the <code class="literal">path.repo</code> setting when you start Elasticsearch.</p><p class="simpara"><code class="literal">bin/elasticsearch -E path.repo=/tmp/es-backups</code></p></li></ul></div><h4><a id="register-repo-example"></a>Register a repository<a href="https://github.com/elastic/kibana/edit/7.5/docs/management/snapshot-restore/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Use <span class="strong strong"><strong>Snapshot and Restore</strong></span> to register the repository where your snapshots
will live.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Go to <span class="strong strong"><strong>Management &gt; Elasticsearch &gt; Snapshot and Restore</strong></span>.</li><li class="listitem">Click <span class="strong strong"><strong>Register a repository</strong></span> in either the introductory message or <span class="strong strong"><strong>Repository view</strong></span>.</li><li class="listitem">Enter a name for your repository, for example, <code class="literal">my_backup</code>.</li><li class="listitem"><p class="simpara">Select <span class="strong strong"><strong>Shared file system</strong></span>.</p><p class="screenshot screenshot"><span class="inlinemediaobject"><img src="management/snapshot-restore/images/register_repo.png" alt="Register repository" /></span></p></li><li class="listitem">Click <span class="strong strong"><strong>Next</strong></span>.</li><li class="listitem">In <span class="strong strong"><strong>File system location</strong></span>, enter the path to the snapshot repository, <code class="literal">/tmp/es-backups</code>.</li><li class="listitem">In <span class="strong strong"><strong>Chunk size</strong></span>, enter <code class="literal">100mb</code> so that snapshot files are not bigger than that size.</li><li class="listitem"><p class="simpara">Use the defaults for all other fields, and then click <span class="strong strong"><strong>Register</strong></span>.</p><p class="simpara">Your new repository is listed on the <span class="strong strong"><strong>Repositories</strong></span> view.
The repository currently doesn’t have any snapshots.</p></li></ol></div><h4><a id="_add_a_snapshot_to_the_repository"></a>Add a snapshot to the repository<a href="https://github.com/elastic/kibana/edit/7.5/docs/management/snapshot-restore/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Use the <a class="ulink" href="/guide/en/elasticsearch/reference/7.5//modules-snapshots.html#snapshots-take-snapshot" target="_top">snapshot API</a> to create a snapshot.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Go to <span class="strong strong"><strong>Dev Tools &gt; Console</strong></span>.</li><li class="listitem"><p class="simpara">Create the snapshot:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">PUT /_snapshot/my_backup/2019-04-25_snapshot?wait_for_completion=true</pre></div><p class="simpara">In this example, the snapshot name is <code class="literal">2019-04-25_snapshot</code>. You can also
use <a class="ulink" href="/guide/en/elasticsearch/reference/7.5//date-math-index-names.html" target="_top">date math expression</a> for the snapshot name.</p><p class="screenshot screenshot"><span class="inlinemediaobject"><img src="management/snapshot-restore/images/create_snapshot.png" alt="Create snapshot" /></span></p></li><li class="listitem"><p class="simpara">Return to <span class="strong strong"><strong>Snapshot and Restore</strong></span>.</p><p class="simpara">Your new snapshot is available in the <span class="strong strong"><strong>Snapshots</strong></span> view.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="create-policy-example"></a>Create a snapshot lifecycle policy<a href="https://github.com/elastic/kibana/edit/7.5/docs/management/snapshot-restore/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Now you’ll automate the creation and deletion of snapshots
using the repository created in the previous example.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Open the <span class="strong strong"><strong>Policies</strong></span> view.</li><li class="listitem"><p class="simpara">Click <span class="strong strong"><strong>Create a policy</strong></span>.</p><p class="screenshot screenshot"><span class="inlinemediaobject"><img src="management/snapshot-restore/images/create-policy-example.png" alt="Create policy wizard" /></span></p></li><li class="listitem"><p class="simpara">As you walk through the wizard, enter the following values:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top"><span class="strong strong"><strong>Logistics</strong></span></th><th align="left" valign="top"> </th></tr></thead><tbody><tr><td align="left" valign="top"><p>Policy name</p></td><td align="left" valign="top"><p><code class="literal">daily-snapshots</code></p></td></tr><tr><td align="left" valign="top"><p>Snapshot name</p></td><td align="left" valign="top"><p><code class="literal">&lt;daily-snap-{now/d}&gt;</code></p></td></tr><tr><td align="left" valign="top"><p>Schedule</p></td><td align="left" valign="top"><p>Every day at 1:30 a.m.</p></td></tr><tr><td align="left" valign="top"><p>Repository</p></td><td align="left" valign="top"><p><code class="literal">my_backup</code></p></td></tr><tr><td align="left" valign="top"><p><span class="strong strong"><strong>Snapshot settings</strong></span></p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Indices</p></td><td align="left" valign="top"><p>Select the indices to back up. By default, all indices, including system indices, are backed up.</p></td></tr><tr><td align="left" valign="top"><p>All other settings</p></td><td align="left" valign="top"><p>Use the defaults.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong strong"><strong>Snapshot retention</strong></span></p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Expiration</p></td><td align="left" valign="top"><p><code class="literal">30 days</code></p></td></tr><tr><td align="left" valign="top"><p>Snapshots to retain</p></td><td align="left" valign="top"><p>Minimum count: <code class="literal">5</code>, Maximum count: <code class="literal">50</code></p></td></tr></tbody></table></div></li><li class="listitem"><p class="simpara">Review your input, and then click <span class="strong strong"><strong>Create policy</strong></span>.</p><p class="simpara">Your new policy is listed in the <span class="strong strong"><strong>Policies</strong></span> view, and you see a summary of its details.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="restore-snapshot-example"></a>Restore a snapshot<a href="https://github.com/elastic/kibana/edit/7.5/docs/management/snapshot-restore/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Finally, you’ll restore indices from an existing snapshot.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">In the <span class="strong strong"><strong>Snapshots</strong></span> view, find the snapshot you want to restore, for example <code class="literal">2019-04-25_snapshot</code>.</li><li class="listitem">Click the restore icon in the <span class="strong strong"><strong>Actions</strong></span> column.</li><li class="listitem"><p class="simpara">As you walk through the wizard, enter the following values:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top"><span class="strong strong"><strong>Logistics</strong></span></th><th align="left" valign="top"> </th></tr></thead><tbody><tr><td align="left" valign="top"><p>Indices</p></td><td align="left" valign="top"><p>Toggle to choose specific indices to restore, or leave in place to restore all indices.</p></td></tr><tr><td align="left" valign="top"><p>Rename indices</p></td><td align="left" valign="top"><p>Toggle to give your restored indices new names, or leave in place to restore under original index names.</p></td></tr><tr><td align="left" valign="top"><p>All other fields</p></td><td align="left" valign="top"><p>Use the defaults.</p></td></tr><tr><td align="left" valign="top"><p><span class="strong strong"><strong>Index settings</strong></span></p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Modify index settings</p></td><td align="left" valign="top"><p>Toggle to overwrite index settings when they are restored,
or leave in place to keep existing settings.</p></td></tr><tr><td align="left" valign="top"><p>Reset index settings</p></td><td align="left" valign="top"><p>Toggle to reset index settings back to the default when they are restored,
or leave in place to keep existing settings.</p></td></tr></tbody></table></div></li><li class="listitem"><p class="simpara">Review your restore settings, and then click <span class="strong strong"><strong>Restore snapshot</strong></span>.</p><p class="simpara">The operation loads for a few seconds,
and then you’re navigated to <span class="strong strong"><strong>Restore Status</strong></span>,
where you can monitor the status of your restored indices.</p></li></ol></div></div></div><div class="navfooter"><span class="prev"><a href="snapshot-repositories.html">
              « 
              Snapshot and Restore</a>
           
        </span><span class="next">
           
          <a href="xpack-spaces.html">Spaces
               »
            </a></span></div></body></html>
