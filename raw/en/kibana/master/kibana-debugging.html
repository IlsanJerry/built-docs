<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Conceptual and step-by-step procedures for using runtime fields, scripted fields, and field formatters.">
<meta name="keywords" content="administrator, data view, data views, management, runtime fields, runtime fields in Kibana, scripted fields, field formatters, data fields, index pattern, index patterns">
<title>Debugging Kibana | Kibana Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [master]"/>
<link rel="up" href="development-getting-started.html" title="Getting started"/>
<link rel="prev" href="sample-data.html" title="Installing sample data"/>
<link rel="next" href="building-kibana.html" title="Building a Kibana distributable"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/master"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="development.html">Developer guide</a></span>
»
<span class="breadcrumb-link"><a href="development-getting-started.html">Getting started</a></span>
»
<span class="breadcrumb-node">Debugging Kibana</span>
</div>
<div class="navheader">
<span class="prev">
<a href="sample-data.html">« Installing sample data</a>
</span>
<span class="next">
<a href="building-kibana.html">Building a Kibana distributable »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="kibana-debugging"></a>Debugging Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h2>
</div></div></div>
<p>For information about how to debug unit tests, refer to <a class="xref" href="development-tests.html#debugging-unit-tests" title="Debugging Unit Tests">Debugging Unit Tests</a>.</p>
<h4><a id="_server_code"></a>Server Code<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h4>
<p><code class="literal">yarn debug</code> will start the server with Node&#8217;s inspect flag. Kibana&#8217;s development mode will start three processes on ports <code class="literal">9229</code>, <code class="literal">9230</code>, and <code class="literal">9231</code>. Chrome&#8217;s developer tools need to be configured to connect to all three connections. Add <code class="literal">localhost:&lt;port&gt;</code> for each Kibana process in Chrome&#8217;s developer tools connection tab.</p>
<h4><a id="_instrumenting_with_elastic_apm"></a>Instrumenting with Elastic APM<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h4>
<p>Kibana ships with the
<a href="https://github.com/elastic/apm-agent-nodejs" class="ulink" target="_top">Elastic APM Node.js Agent</a>
built-in for debugging purposes.</p>
<p>With an application as varied and complex as Kibana has become, it&#8217;s not practical or scalable to craft all possible performance measurements by hand ahead of time. As such, we need to rely on tooling to help us catch things we may otherwise have missed.</p>
<p>For example, say you implement a brand new feature, plugin or service but don&#8217;t quite know how it will impact Kibana&#8217;s performance as a whole. APM allows us to not only spot that something is slow, but also hints at why it might be performing slowly. For example, if a function is slow on specific types of inputs, we can see where the time is spent by viewing the trace for that function call in the APM UI.</p>
<div class="imageblock">
<div class="content">
<img src="images/apm_example_trace.png" alt="apm example trace">
</div>
</div>
<p>The net of metrics captured by APM are both a wide and deep because the entire application is instrumented at runtime and we simply take a sample of these metrics. This means that we don&#8217;t have to know what we need to measure ahead of time, we&#8217;ll instead just get (most) of the data we&#8217;re likely going to need by default.</p>
<p>This type of data can help us identify unknown bottlenecks, spot when a performance regression may have been introduced, and inform how the performance of Kibana is changing between releases. Using APM allows us to be proactive in getting ahead of potential performance regressions before they are released.</p>
<p>The default APM configuration is meant to be used by core Kibana developers
only, but it can easily be re-configured to your needs. In its default
configuration it’s disabled and will, once enabled, send APM data to a
centrally managed Elasticsearch cluster accessible only to Elastic
employees.</p>
<p>To change the location where data is sent, use the
<a href="/guide/en/apm/agent/nodejs/current/configuration.html#server-url" class="ulink" target="_top"><code class="literal">serverUrl</code></a>
APM config option. To activate the APM agent, use the
<a href="/guide/en/apm/agent/nodejs/current/configuration.html#active" class="ulink" target="_top"><code class="literal">active</code></a>
APM config option.</p>
<p>All config options can be set by
creating an appropriate config file under <code class="literal">config/apm.dev.js</code>.</p>
<p>Example <code class="literal">config/apm.dev.js</code> file:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">module.exports = {
  active: true,
};</pre>
</div>
<p>APM
<a href="/guide/en/apm/agent/rum-js/current/index.html" class="ulink" target="_top">Real
User Monitoring agent</a> is not available in the Kibana distributables,
however the agent can be enabled by setting <code class="literal">ELASTIC_APM_ACTIVE</code> to
<code class="literal">true</code>. flags</p>
<pre class="literallayout">ELASTIC_APM_ACTIVE=true yarn start
// activates both Node.js and RUM agent</pre>

<p>Once the agent is active, it will trace all incoming HTTP requests to
Kibana, monitor for errors, and collect process-level metrics. The
collected data will be sent to the APM Server and is viewable in the APM
UI in Kibana.</p>
<h4><a id="_running_kibana_with_the_apm_agent_locally"></a>Running Kibana with the APM Agent Locally<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h4>
<p>The easiest and recommended way of running Kibana with the APM agent locally is to use the solution provided by the <a href="https://github.com/elastic/apm-integration-testing" class="ulink" target="_top">apm-integration-testing</a> repo. You’ll need <a href="https://www.docker.com/community-edition" class="ulink" target="_top">Docker</a> and <a href="https://docs.docker.com/compose/install/" class="ulink" target="_top">Docker Compose</a> to use the tool.</p>
<h5><a id="_quick_start_guide"></a>Quick start guide<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h5>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Clone the <a href="https://github.com/elastic/apm-integration-testing" class="ulink" target="_top">elastic/apm-integration-testing</a> repo.
</li>
<li class="listitem">
<p>Change into the apm-integration-testing repo:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">cd apm-integration-testing</pre>
</div>
</li>
<li class="listitem">
<p>Run Elasticsearch and the APM servers without running Kibana:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./scripts/compose.py start master --no-kibana</pre>
</div>
</li>
<li class="listitem">
<p>Change into the Kibana repo:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">cd ../kibana</pre>
</div>
</li>
<li class="listitem">
Change the elasticsearch credentials in your <code class="literal">kibana.yml</code> configuration file to match those needed by elasticsearch and the APM server (see the apm-integration-testing repo&#8217;s <a href="https://github.com/elastic/apm-integration-testing#logging-in" class="ulink" target="_top">README</a> for users provided to test different scenarios).
</li>
<li class="listitem">
<p>Make sure that the APM agent is active and points to the local APM server by adding the following configuration settings to a config file under <code class="literal">config/apm.dev.js</code>:</p>
<p>Example <code class="literal">config/apm.dev.js</code> file:</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">module.exports = {
  active: true,
  serverUrl: 'http://127.0.0.1:8200', // supports `http://localhost:8200`
  centralConfig: false,
  breakdownMetrics: false,
  transactionSampleRate: 0.1,
  metricsInterval: '120s'
};</pre>
</div>
</li>
<li class="listitem">
<p>Start Kibana with APM active using:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">yarn start</pre>
</div>
</li>
<li class="listitem">
After Kibana starts up, navigate to the APM app, where you should see some transactions.
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/apm_ui_transactions.png" alt="apm ui transactions">
</div>
</div>
<p>You can now continue doing what you want to in Kibana (e.g. install sample data sets, issue queries in dashboards, build new visualizations etc).
Once you&#8217;re finished, you can stop Kibana normally, then stop the Elasticsearch and APM servers in the apm-integration-testing clone with the following script:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">./scripts/compose.py stop</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_using_kibana_server_logs"></a>Using Kibana server logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h3>
</div></div></div>
<p>Kibana Logs is a great way to see what&#8217;s going on in your application and to debug performance issues. Navigating through a large number of generated logs can be overwhelming, and following are some techniques that you can use to optimize the process.</p>
<p>Start by defining a problem area that you are interested in. For example, you might be interested in seeing how a particular Kibana Plugin is performing, so no need to gather logs for all of Kibana. Or you might want to focus on a particular feature, such as requests from the Kibana server to the Elasticsearch server.
Depending on your needs, you can configure Kibana to generate logs for a specific feature.</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">logging:
  appenders:
    file:
      type: file
      fileName: ./kibana.log
      layout:
        type: json

### gather all the Kibana logs into a file
logging.root:
    appenders: [file]
    level: all

### or gather a subset of the logs
logging.loggers:
  ### responses to an HTTP request
  - name: http.server.response
    level: debug
    appenders: [file]
  ### result of a query to the Elasticsearch server
  - name: elasticsearch.query
    level: debug
    appenders: [file]
  ### logs generated by my plugin
  - name: plugins.myPlugin
    level: debug
    appenders: [file]</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Kibana&#8217;s <code class="literal">file</code> appender is configured to produce logs in <a href="/guide/en/ecs/master/ecs-reference.html" class="ulink" target="_top">ECS JSON</a> format. It&#8217;s the only format that includes the meta information necessary for <a href="/guide/en/apm/agent/nodejs/current/log-correlation.html" class="ulink" target="_top">log correlation</a> out-of-the-box.</p>
</div>
</div>
<p>The next step is to define what <a href="/observability" class="ulink" target="_top">observability tools</a> are available.
For a better experience, set up an <a href="/guide/en/apm/get-started/current/observability-integrations.html" class="ulink" target="_top">Observability integration</a> provided by Elastic to debug your application with the <a class="xref" href="kibana-debugging.html#debugging-logs-apm-ui" title="APM UI">APM UI.</a>
To debug something quickly without setting up additional tooling, you can work with <a class="xref" href="kibana-debugging.html#plain-kibana-logs" title="Plain Kibana logs">the plain Kibana logs.</a></p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="debugging-logs-apm-ui"></a>APM UI<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h4>
</div></div></div>
<p><span class="strong strong"><strong>Prerequisites</strong></span> Kibana logs are configured to be in <a href="/guide/en/ecs/master/ecs-reference.html" class="ulink" target="_top">ECS JSON</a> format to include tracing identifiers.</p>
<p>To debug Kibana with the APM UI, you must set up the APM infrastructure. You can find instructions for the setup process
<a href="/guide/en/apm/get-started/current/observability-integrations.html" class="ulink" target="_top">on the Observability integrations page</a>.</p>
<p>Once you set up the APM infrastructure, you can enable the APM agent and put Kibana under load to collect APM events. To analyze the collected metrics and logs, use the APM UI as demonstrated <a href="/guide/en/kibana/master/transactions.html#transaction-trace-sample" class="ulink" target="_top">in the docs</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="plain-kibana-logs"></a>Plain Kibana logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/kibana/edit/main/docs/developer/getting-started/debugging.asciidoc">edit</a></h4>
</div></div></div>
<p><span class="strong strong"><strong>Prerequisites</strong></span> Kibana logs are configured to be in <a href="/guide/en/ecs/master/ecs-reference.html" class="ulink" target="_top">ECS JSON</a> format to include tracing identifiers.</p>
<p>Open Kibana Logs and search for an operation you are interested in.
For example, suppose you want to investigate the response times for queries to the <code class="literal">/api/telemetry/v2/clusters/_stats</code> Kibana endpoint.
Open Kibana Logs and search for the HTTP server response for the endpoint. It looks similar to the following (some fields are omitted for brevity).</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "message":"POST /api/telemetry/v2/clusters/_stats 200 1014ms - 43.2KB",
  "log":{"level":"DEBUG","logger":"http.server.response"},
  "trace":{"id":"9b99131a6f66587971ef085ef97dfd07"},
  "transaction":{"id":"d0c5bbf14f5febca"}
}</pre>
</div>
<p>You are interested in the <a href="/guide/en/ecs/current/ecs-tracing.html#field-trace-id" class="ulink" target="_top">trace.id</a> field, which is a unique identifier of a trace. The <code class="literal">trace.id</code> provides a way to group multiple events, like transactions, which belong together. You can search for <code class="literal">"trace":{"id":"9b99131a6f66587971ef085ef97dfd07"}</code> to get all the logs that belong to the same trace. This enables you to see how many Elasticsearch requests were triggered during the <code class="literal">9b99131a6f66587971ef085ef97dfd07</code> trace, what they looked like, what Elasticsearch endpoints were hit, and so on.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="sample-data.html">« Installing sample data</a>
</span>
<span class="next">
<a href="building-kibana.html">Building a Kibana distributable »</a>
</span>
</div>
</div>
</body>
</html>
