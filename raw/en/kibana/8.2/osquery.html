<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Kibana provides you with several options to share *Discover* saved searches, dashboards, *Visualize Library* visualizations, and *Canvas* workpads with others, or on a website.">
<meta name="keywords" content="analyst, concept, task, reporting">
<title>Osquery | Kibana Guide [8.2] | Elastic</title>
<link rel="home" href="index.html" title="Kibana Guide [8.2]"/>
<link rel="up" href="index.html" title="Kibana Guide [8.2]"/>
<link rel="prev" href="fleet.html" title="Fleet"/>
<link rel="next" href="advanced-osquery.html" title="Advanced Osquery"/>
<meta name="DC.type" content="Learn/Docs/Kibana/Reference/8.2"/>
<meta name="DC.subject" content="Kibana"/>
<meta name="DC.identifier" content="8.2"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Kibana Guide [8.2]</a></span>
»
<span class="breadcrumb-node">Osquery</span>
</div>
<div class="navheader">
<span class="prev">
<a href="fleet.html">« Fleet</a>
</span>
<span class="next">
<a href="advanced-osquery.html">Advanced Osquery »</a>
</span>
</div>
<div class="part">
<div class="titlepage"><div><div>
<h1 class="title"><a id="osquery"></a>Osquery<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h1>
</div></div></div>
<div class="openblock partintro">
<div class="content">
<p><a href="https://osquery.io" class="ulink" target="_top">Osquery</a> is an open source tool that lets you query operating systems like a database, providing you with visibility into your infrastructure and operating systems.
Using basic SQL commands, you can ask questions about devices, such as servers,
Docker containers, and computers running Linux, macOS, or Windows.
The <a href="https://osquery.io/schema" class="ulink" target="_top">extensive schema</a> helps with a variety of use cases,
including vulnerability detection, compliance monitoring, incident investigations, and more.</p>
<p>With Osquery in Kibana, you can:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Run live queries for one or more agents
</li>
<li class="listitem">
Schedule query packs to capture changes to OS state over time
</li>
<li class="listitem">
View a history of past queries and their results
</li>
<li class="listitem">
Save queries and build a library of queries for specific use cases
</li>
</ul>
</div>
<p>Osquery is powered by the <span class="strong strong"><strong>Osquery Manager</strong></span> integration.
For information on how to set up <span class="strong strong"><strong>Osquery Manager</strong></span>, refer to <a class="xref" href="manage-osquery-integration.html" title="Manage the integration"><em>Manage the integration</em></a>.</p>
<h2><a id="_required_privileges_2"></a>Required privileges<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h2>
<p>To use <span class="strong strong"><strong>Osquery Manager</strong></span>, you must be assigned to a role with the following privileges:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">Read</code> privileges for the <code class="literal">logs-osquery_manager.result*</code> index.
</li>
<li class="listitem">
Kibana privileges for <span class="strong strong"><strong>Osquery Manager</strong></span>. The <code class="literal">All</code> privilege
enables you to run, schedule, and save queries. <code class="literal">Read</code> enables you to
view live and scheduled query results, but you cannot run live queries or edit.
</li>
</ul>
</div>
<h2><a id="osquery-run-query"></a>Run live queries<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h2>
<p>To inspect hosts, run a query against one or more agents or policies,
then view the results.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the main menu, and then click <span class="strong strong"><strong>Osquery</strong></span>.
</li>
<li class="listitem">
In the <span class="strong strong"><strong>Live queries</strong></span> view, click <span class="strong strong"><strong>New live query</strong></span>.
</li>
<li class="listitem">
Select one or more agents or groups to query. Start typing in the search field,
and you&#8217;ll get suggestions for agents by name, ID, platform, and policy.
</li>
<li class="listitem">
<p>Enter a query or select a query from your saved queries.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/enter-query.png" alt="Select saved query dropdown name showing query name and description">
</div>
</div>
</li>
<li class="listitem">
(Optional) Expand the <span class="strong strong"><strong>Advanced</strong></span> section to view or set <a class="xref" href="advanced-osquery.html#osquery-map-fields" title="Map result fields to ECS">mapped ECS fields</a> included in the results from the live query.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Submit</strong></span>.
</li>
<li class="listitem">
Review the results in a table, or navigate to <span class="strong strong"><strong>Discover</strong></span> to dive deeper into the response,
or to the drag-and-drop <span class="strong strong"><strong>Lens</strong></span> editor to create visualizations.
</li>
<li class="listitem">
To view more information about the request, such as failures, open the <span class="strong strong"><strong>Status</strong></span> tab.
</li>
<li class="listitem">
To save the query for future use, click <span class="strong strong"><strong>Save for later</strong></span> and define the ID,
description, and other <a class="xref" href="osquery.html#osquery-manage-query" title="Save queries">details</a>.
</li>
</ol>
</div>
<h2><a id="osquery-view-history"></a>View or rerun previous live queries<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h2>
<p>From the <span class="strong strong"><strong>Live queries history</strong></span> section on the <span class="strong strong"><strong>Live queries</strong></span> tab:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Click <span class="image"><img src="images/play-icon.png" alt="Right-pointing triangle"></span> to replay a query.
</li>
<li class="listitem">
<p>Click <span class="image"><img src="images/table-icon.png" alt="Table icon"></span> to view the query <a class="xref" href="advanced-osquery.html#osquery-results" title="Osquery results">results</a> and <a class="xref" href="advanced-osquery.html#osquery-status" title="Osquery status">status</a>.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/live-query-check-results.png" alt="Results of OSquery">
</div>
</div>
</li>
</ul>
</div>
<h2><a id="osquery-schedule-query"></a>Schedule queries with packs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h2>
<p>Create packs to organize sets of queries. For example, you might create one pack that checks
for IT compliance-type issues, and another pack that monitors for evidence of malware.
You can schedule packs to run for one or more agent policies. When scheduled, queries in the pack are run at the set intervals for all agents in those policies. Scheduling packs is optional.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the <span class="strong strong"><strong>Packs</strong></span> tab.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Add pack</strong></span> to create a new pack, or click the name of an existing pack, then <span class="strong strong"><strong>Edit</strong></span> to add queries to an existing pack.
</li>
<li class="listitem">
<p>Provide the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The name of the pack.
</li>
<li class="listitem">
A short description of the pack.
</li>
<li class="listitem">
The agent policies where this pack should run. If no agent policies are set, then the pack is not scheduled.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Add queries to schedule:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
To add a query to the pack, click <span class="strong strong"><strong>Add query</strong></span>, and then either add a saved query or enter a new query.
Each query must include a unique query ID and the interval at which it should run.
Optionally, set the minimum Osquery version and platform,
or <a class="xref" href="advanced-osquery.html#osquery-map-fields" title="Map result fields to ECS">map ECS fields</a>. When you add a saved query to a pack, this adds a copy of the query. A connection is not maintained between saved queries and packs.
</li>
<li class="listitem">
To upload queries from a <code class="literal">.conf</code> query pack, drag the pack to the drop zone under the query table. To explore the community packs that Osquery publishes, click <span class="strong strong"><strong>Example packs</strong></span>.
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save pack</strong></span>. The queries run when the policy receives the update.
</li>
</ol>
</div>
<h2><a id="osquery-schedule-status"></a>View status of scheduled packs<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h2>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Open the <span class="strong strong"><strong>Packs</strong></span> tab.
</li>
<li class="listitem">
<p>Click a pack name to view the status.</p>
<p>Details include the last time each query ran, how many results were returned, and the number of agents the query ran against.
If there are errors, expand the row to view the details, including an option to view more information in the Logs.</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/scheduled-pack.png" alt="Shows queries in the pack and details about each query" width="including the last time it ran" height="how many results were returned">
</div>
</div>
</li>
<li class="listitem">
View scheduled query results in <a class="xref" href="discover.html" title="Discover"><span class="strong strong"><strong>Discover</strong></span></a> or the drag-and-drop <a class="xref" href="lens.html" title="Create visualizations with Lens"><span class="strong strong"><strong>Lens</strong></span></a> editor.
</li>
</ol>
</div>
<h2><a id="osquery-manage-query"></a>Save queries<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/kibana/edit/8.2/docs/osquery/osquery.asciidoc">edit</a></h2>
<p>You can save queries in two ways:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
After running a live query, click the <span class="strong strong"><strong>Save for later</strong></span> link.
</li>
<li class="listitem">
From the <span class="strong strong"><strong>Saved queries</strong></span> tab, click the <span class="strong strong"><strong>Add saved query</strong></span> button.
</li>
</ul>
</div>
<p>Once you save a query, you can only edit it from the <span class="strong strong"><strong>Saved queries</strong></span> tab.</p>
<p>To add or edit saved queries from the <span class="strong strong"><strong>Saved queries</strong></span> tab:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Saved queries</strong></span>, and then click <span class="strong strong"><strong>Add saved query</strong></span> or the edit icon.
</li>
<li class="listitem">
<p>Provide the following fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The unique identifier.
</li>
<li class="listitem">
A brief description.
</li>
<li class="listitem">
The SQL query.
</li>
<li class="listitem">
The <a class="xref" href="advanced-osquery.html#osquery-map-fields" title="Map result fields to ECS">ECS fields</a> to populate when the query is run. These fields are also copied in when you add this query to a pack.
</li>
<li class="listitem">
<p>The defaults to set when you add the query to a pack.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The frequency to run the query.
</li>
<li class="listitem">
The minimum <a href="https://github.com/osquery/osquery/releases)" class="ulink" target="_top">version of Osquery</a> required to run the query.
</li>
<li class="listitem">
The operating system required to run the query. For information about supported platforms per table, refer to the <a href="https://osquery.io/schema" class="ulink" target="_top">Osquery schema</a>.
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Click <span class="strong strong"><strong>Test configuration</strong></span> to test the query and any mapped fields:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
From the <span class="strong strong"><strong>Test query</strong></span> panel, select agents or groups to test the query, then click <span class="strong strong"><strong>Submit</strong></span> to run a live query. Result columns with the <span class="image"><img src="images/mapped-icon.png" alt="mapping"></span> icon are mapped. Hover over the icon to see the mapped ECS field.
</li>
</ul>
</div>
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Save</strong></span> or <span class="strong strong"><strong>Update</strong></span>.
</li>
</ol>
</div>
</div>
</div>



</div>
<div class="navfooter">
<span class="prev">
<a href="fleet.html">« Fleet</a>
</span>
<span class="next">
<a href="advanced-osquery.html">Advanced Osquery »</a>
</span>
</div>
</div>
</body>
</html>
