<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Running an action for each element in an array
        | Elastic Stack Overview [7.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [7.x]" /><link rel="up" href="actions.html" title="Actions" /><link rel="prev" href="actions.html" title="Actions" /><link rel="next" href="action-conditions.html" title="Adding conditions to actions" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elastic Stack/Overview/7.x" /><meta xmlns="" name="DC.subject" content="Elastic Stack" /><meta xmlns="" name="DC.identifier" content="7.x" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [7.x]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-alerting.html">Alerting on cluster and index events</a></span> » <span class="breadcrumb-link"><a href="actions.html">Actions</a></span> » <span class="breadcrumb-node">Running an action for each element in an array</span></div><div xmlns="" class="navheader"><span class="prev"><a href="actions.html">
              « 
              Actions</a>
           
        </span><span class="next">
           
          <a href="action-conditions.html">Adding conditions to actions
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="action-foreach"></a>Running an action for each element in an array<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.x/x-pack/docs/en/watcher/actions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can use the <code class="literal">foreach</code> field in an action to trigger the configured action
for every element within that array.</p><p>In order to protect from long running watches, you can use the <code class="literal">max_iterations</code>
field to limit the maximum amount of runs that each watch executes. If this limit
is reached, the execution is gracefully stopped. If not set, this field defaults
to one hundred.</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT _watcher/watch/log_event_watch
{
  "trigger" : {
    "schedule" : { "interval" : "5m" }
  },
  "input" : {
    "search" : {
      "request" : {
        "indices" : "log-events",
        "body" : {
          "query" : { "match" : { "status" : "error" } }
        }
      }
    }
  },
  "condition" : {
    "compare" : { "ctx.payload.hits.total" : { "gt" : 0 } }
  },
  "actions" : {
    "log_hits" : {
      "foreach" : "ctx.payload.hits.hits", <a id="CO31-1"></a><i xmlns="" class="conum" data-value="1"></i>
      "max_iterations" : 500,
      "logging" : {
        "text" : "Found id {{ctx.payload._id}} with field {{ctx.payload._source.my_field}}"
      }
    }
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/57.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The logging statement will be executed for each of the returned search hits.</p></td></tr></table></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="actions.html">
              « 
              Actions</a>
           
        </span><span class="next">
           
          <a href="action-conditions.html">Adding conditions to actions
               »
            </a></span></div></body></html>