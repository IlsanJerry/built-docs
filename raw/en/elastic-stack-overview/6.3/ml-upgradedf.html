<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Upgraded nodes fail to start due to datafeed issues
        | Elastic Stack Overview [6.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [6.3]" /><link rel="up" href="ml-troubleshooting.html" title="Troubleshooting machine learning" /><link rel="prev" href="ml-jobnames.html" title="Kibana cannot display jobs with invalid characters in their name" /><link rel="next" href="xpack-limitations.html" title="Limitations" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elastic Stack/Overview/6.3" /><meta xmlns="" name="DC.subject" content="Elastic Stack" /><meta xmlns="" name="DC.identifier" content="6.3" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [6.3]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-troubleshooting.html">Troubleshooting</a></span> » <span class="breadcrumb-link"><a href="ml-troubleshooting.html">Troubleshooting machine learning</a></span> » <span class="breadcrumb-node">Upgraded nodes fail to start due to datafeed issues</span></div><div xmlns="" class="navheader"><span class="prev"><a href="ml-jobnames.html">
              « 
              Kibana cannot display jobs with invalid characters in their name</a>
           
        </span><span class="next">
           
          <a href="xpack-limitations.html">Limitations
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ml-upgradedf"></a>Upgraded nodes fail to start due to datafeed issues<a xmlns="" href="https://github.com/elastic/stack-docs/edit/6.3/docs/en/stack/ml/troubleshooting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This problem occurs when you have a datafeed that contains search or query
domain specific language (DSL) that was discontinued. For example, if you
created a datafeed query in 5.x using search syntax that was deprecated in 5.x
and removed in 6.0, you must fix the datafeed before you upgrade to 6.0.</p><p><span class="strong strong"><strong>Symptoms:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">If <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/logging.html#deprecation-logging" target="_top">deprecation logging</a> is enabled
before the upgrade, deprecation messages are generated when the datafeeds attempt
to retrieve data.</li><li class="listitem">After the upgrade, nodes fail to start and the error indicates that they
failed to read the local state.</li></ul></div><p><span class="strong strong"><strong>Resolution:</strong></span></p><p>Before you upgrade, identify the problematic search or query DSL. In 5.6.5 and
later, the Upgrade Assistant detects these scenarios. If you cannot fix the DSL
before the upgrade, you must delete the datafeed then re-create it with valid DSL
after the upgrade.</p><p>If you do not fix or delete the datafeed before the upgrade, in order to successfully
start the failing nodes you must downgrade the nodes then fix the problem per
above.</p><p>See also <a class="ulink" href="http://www.elastic.co/guide/en/elastic-stack/6.3/upgrading-elastic-stack.html" target="_top">Upgrading the Elastic Stack</a>.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="ml-jobnames.html">
              « 
              Kibana cannot display jobs with invalid characters in their name</a>
           
        </span><span class="next">
           
          <a href="xpack-limitations.html">Limitations
               »
            </a></span></div></body></html>