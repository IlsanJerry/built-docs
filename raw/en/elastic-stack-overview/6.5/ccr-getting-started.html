<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Getting started with cross-cluster replication
        | Elastic Stack Overview [6.5]
      | Elastic
    </title><link rel="home" href="index.html" title="Elastic Stack Overview [6.5]" /><link rel="up" href="xpack-ccr.html" title="Cross-cluster replication" /><link rel="prev" href="ccr-auto-follow.html" title="Automatically following indices" /><link rel="next" href="troubleshooting.html" title="Troubleshooting" /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/6.5" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="6.5" /></head><body><div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [6.5]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-ccr.html">Cross-cluster replication</a></span> » <span class="breadcrumb-node">Getting started with cross-cluster replication</span></div><div class="navheader"><span class="prev"><a href="ccr-auto-follow.html">
              « 
              Automatically following indices</a>
           
        </span><span class="next">
           
          <a href="troubleshooting.html">Troubleshooting
               »
            </a></span></div><div class="xpack chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ccr-getting-started"></a>Getting started with cross-cluster replication<a href="https://github.com/elastic/elasticsearch/edit/6.5/docs/reference/ccr/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p></div></div><p>This getting-started guide for cross-cluster replication shows you how to:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="ccr-getting-started.html#ccr-getting-started-remote-cluster" title="Connecting to a remote cluster">Connect a local cluster to a remote
cluster</a></li><li class="listitem"><a class="link" href="ccr-getting-started.html#ccr-getting-started-leader-index" title="Creating a leader index">Create a leader index</a> in a remote cluster</li><li class="listitem"><a class="link" href="ccr-getting-started.html#ccr-getting-started-follower-index" title="Creating a follower index">Create a follower index</a> that replicates
a leader index</li><li class="listitem"><a class="link" href="ccr-getting-started.html#ccr-getting-started-auto-follow" title="Automatically create follower indices">Automatically create follower indices</a></li></ul></div><h3><a id="ccr-getting-started-before-you-begin"></a>Before you begin<a href="https://github.com/elastic/elasticsearch/edit/6.5/docs/reference/ccr/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-get-started/6.5/get-started-elastic-stack.html#install-elasticsearch" target="_top">Install Elasticsearch</a>
on your local and remote clusters.</li><li class="listitem">Obtain a license that includes the cross-cluster replication features. See
<a class="ulink" href="https://www.elastic.co/subscriptions" target="_top">subscriptions</a> and
<a class="xref" href="license-management.html" title="License management">License management</a>.</li><li class="listitem"><p class="simpara">If the Elastic security features are enabled in your local and remote
clusters, you need a user that has appropriate authority to perform the steps
in this tutorial.</p><p class="simpara"><a id="ccr-getting-started-security"></a>The cross-cluster replication features use cluster privileges and built-in roles to make it easier
to control which users have authority to manage cross-cluster replication.</p><p class="simpara">By default, you can perform all of the steps in this tutorial by
using the built-in <code class="literal">elastic</code> user. However, a password must be set for this user
before the user can do anything. For information about how to set that password,
see <a class="xref" href="security-getting-started.html" title="Tutorial: Getting started with security"><em>Tutorial: Getting started with security</em></a>.</p><p class="simpara">If you are performing these steps in a production environment, take extra care
because the <code class="literal">elastic</code> user has the <code class="literal">superuser</code> role and you could inadvertently
make significant changes.</p><p class="simpara">Alternatively, you can assign the appropriate privileges to a user ID of your
choice. On the remote cluster that contains the leader index, a user will need
the <code class="literal">read_ccr</code> cluster privilege and <code class="literal">monitor</code> and <code class="literal">read</code> privileges on the
leader index.</p><div class="pre_wrapper lang-yml"><pre class="programlisting prettyprint lang-yml">ccr_user:
  cluster:
    - read_ccr
  indices:
    - names: [ 'leader-index' ]
      privileges:
        - monitor
        - read</pre></div><p class="simpara">On the local cluster that contains the follower index, the same user will need
the <code class="literal">manage_ccr</code> cluster privilege and <code class="literal">monitor</code>, <code class="literal">read</code>, <code class="literal">write</code> and
<code class="literal">manage_follow_index</code> privileges on the follower index.</p><div class="pre_wrapper lang-yml"><pre class="programlisting prettyprint lang-yml">ccr_user:
  cluster:
    - manage_ccr
  indices:
    - names: [ 'follower-index' ]
      privileges:
        - monitor
        - read
        - write
        - manage_follow_index</pre></div><p class="simpara">If you are managing
<a class="link" href="ccr-getting-started.html#ccr-getting-started-remote-cluster" title="Connecting to a remote cluster">connecting to the remote cluster</a> via the
cluster update settings API, you will also need a user with the <code class="literal">all</code> cluster
privilege.</p></li></ol></div><h3><a id="ccr-getting-started-remote-cluster"></a>Connecting to a remote cluster<a href="https://github.com/elastic/elasticsearch/edit/6.5/docs/reference/ccr/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The cross-cluster replication features require that you
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/modules-remote-clusters.html" target="_top">connect your local cluster to a remote
cluster</a>. In this tutorial, we will connect our local cluster to a remote
cluster with the cluster alias <code class="literal">leader</code>.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_cluster/settings
{
  "persistent" : {
    "cluster" : {
      "remote" : {
        "leader" : {
          "seeds" : [
            "127.0.0.1:9300" <a id="CO65-1"></a><i class="conum" data-value="1"></i>
          ]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/103.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO65-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Specifies the hostname and transport port of a seed node in the remote
cluster.</p></td></tr></table></div><p>You can verify that the local cluster is successfully connected to the remote
cluster.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET /_remote/info</pre></div><div class="console_widget" data-snippet="snippets/104.console"></div><p>The API will respond by showing that the local cluster is connected to the
remote cluster.</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
  "leader" : {
    "seeds" : [
      "127.0.0.1:9300"
    ],
    "http_addresses" : [
      "127.0.0.1:9200"
    ],
    "connected" : true, <a id="CO66-1"></a><i class="conum" data-value="1"></i>
    "num_nodes_connected" : 1, <a id="CO66-2"></a><i class="conum" data-value="2"></i>
    "max_connections_per_cluster" : 3,
    "initial_connect_timeout" : "30s",
    "skip_unavailable" : false
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO66-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This shows the local cluster is connected to the remote cluster with cluster
alias <code class="literal">leader</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO66-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>This shows the number of nodes in the remote cluster the local cluster is
connected to.</p></td></tr></table></div><h3><a id="ccr-getting-started-leader-index"></a>Creating a leader index<a href="https://github.com/elastic/elasticsearch/edit/6.5/docs/reference/ccr/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Leader indices require special index settings to ensure that the operations that
need to be replicated are available when the
follower requests them from the leader. These settings are used to enable soft
deletes on the leader index and to control how many soft deletes are retained. A
<span class="emphasis"><em>soft delete</em></span> occurs whenever a document is deleted or updated. Soft deletes can
be enabled only on new indices created on or after Elasticsearch 6.5.0.</p><p>In the following example, we will create a leader index in the remote cluster:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /server-metrics
{
  "settings" : {
    "index" : {
      "number_of_shards" : 1,
      "number_of_replicas" : 0,
      "soft_deletes" : {
        "enabled" : true, <a id="CO67-1"></a><i class="conum" data-value="1"></i>
        "retention" : {
          "operations" : 1024 <a id="CO67-2"></a><i class="conum" data-value="2"></i>
        }
      }
    }
  },
  "mappings" : {
    "metric" : {
      "properties" : {
        "@timestamp" : {
          "type" : "date"
        },
        "accept" : {
          "type" : "long"
        },
        "deny" : {
          "type" : "long"
        },
        "host" : {
          "type" : "keyword"
        },
        "response" : {
          "type" : "float"
        },
        "service" : {
          "type" : "keyword"
        },
        "total" : {
          "type" : "long"
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/105.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO67-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Enables soft deletes on the leader index.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO67-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Sets that up to 1024 soft deletes will be retained.</p></td></tr></table></div><h3><a id="ccr-getting-started-follower-index"></a>Creating a follower index<a href="https://github.com/elastic/elasticsearch/edit/6.5/docs/reference/ccr/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Follower indices are created with the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/ccr-put-follow.html" target="_top">create follower
API</a>. When you create a follower index, you must reference the
<a class="link" href="ccr-getting-started.html#ccr-getting-started-remote-cluster" title="Connecting to a remote cluster">remote cluster</a> and the
<a class="link" href="ccr-getting-started.html#ccr-getting-started-leader-index" title="Creating a leader index">leader index</a> that you created in the remote
cluster.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /server-metrics-copy/_ccr/follow
{
  "remote_cluster" : "leader",
  "leader_index" : "server-metrics"
}</pre></div><div class="console_widget" data-snippet="snippets/106.console"></div><p>Now when you index documents into your leader index, you will see these
documents replicated in the follower index. You can
inspect the status of replication using the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/ccr-get-follow-stats.html" target="_top">get follower stats API</a>.</p><h3><a id="ccr-getting-started-auto-follow"></a>Automatically create follower indices<a href="https://github.com/elastic/elasticsearch/edit/6.5/docs/reference/ccr/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <a class="link" href="ccr-auto-follow.html" title="Automatically following indices">auto-follow</a> feature in cross-cluster replication helps for time series use
cases where you want to follow new indices that are periodically created in the
remote cluster (such as daily Beats indices). Auto-following is configured using
the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/ccr-put-auto-follow-pattern.html" target="_top">create auto-follow pattern API</a>. With
an auto-follow pattern, you reference the
<a class="link" href="ccr-getting-started.html#ccr-getting-started-remote-cluster" title="Connecting to a remote cluster">remote cluster</a> that you connected your
local cluster to. You must also specify a collection of  patterns that match the
indices you want to automatically follow.</p><p>For example:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_ccr/auto_follow/beats
{
  "remote_cluster" : "leader",
  "leader_index_patterns" :
  [
    "metricbeat-*", <a id="CO68-1"></a><i class="conum" data-value="1"></i>
    "packetbeat-*" <a id="CO68-2"></a><i class="conum" data-value="2"></i>
  ],
  "follow_index_pattern" : "{{leader_index}}-copy" <a id="CO68-3"></a><i class="conum" data-value="3"></i>
}</pre></div><div class="console_widget" data-snippet="snippets/107.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO68-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Automatically follow new Metricbeat indices.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO68-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Automatically follow new Packetbeat indices.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO68-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>The name of the follower index is derived from the name of the leader index
by adding the suffix <code class="literal">-copy</code> to the name of the leader index.</p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="ccr-auto-follow.html">
              « 
              Automatically following indices</a>
           
        </span><span class="next">
           
          <a href="troubleshooting.html">Troubleshooting
               »
            </a></span></div></body></html>
