<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Authorization exceptions
        | Elastic Stack Overview [6.5]
      | Elastic
    </title><link rel="home" href="index.html" title="Elastic Stack Overview [6.5]" /><link rel="up" href="security-troubleshooting.html" title="Troubleshooting security" /><link rel="prev" href="security-trb-settings.html" title="Some settings are not returned via the nodes settings API" /><link rel="next" href="security-trb-extraargs.html" title="Users command fails due to extra arguments" /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/6.5" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="6.5" /></head><body><div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [6.5]
    </a></span> » <span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshooting</a></span> » <span class="breadcrumb-link"><a href="security-troubleshooting.html">Troubleshooting security</a></span> » <span class="breadcrumb-node">Authorization exceptions</span></div><div class="navheader"><span class="prev"><a href="security-trb-settings.html">
              « 
              Some settings are not returned via the nodes settings API</a>
           
        </span><span class="next">
           
          <a href="security-trb-extraargs.html">Users command fails due to extra arguments
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="security-trb-roles"></a>Authorization exceptions<a href="https://github.com/elastic/stack-docs/edit/6.5/docs/en/stack/security/troubleshooting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><span class="strong strong"><strong>Symptoms:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">I configured the appropriate roles and the users, but I still get an
authorization exception.</li><li class="listitem">I can authenticate to LDAP, but I still get an authorization exception.</li></ul></div><p><span class="strong strong"><strong>Resolution:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Verify that the role names associated with the users match the roles defined
in the <code class="literal">roles.yml</code> file. You can use the <code class="literal">elasticsearch-users</code> tool to list all
the users. Any unknown roles are marked with <code class="literal">*</code>.</p><div class="pre_wrapper lang-shell"><pre class="programlisting prettyprint lang-shell">bin/elasticsearch-users list
rdeniro        : admin
alpacino       : power_user
jacknich       : monitoring,unknown_role* <a id="CO33-1"></a><i class="conum" data-value="1"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p><code class="literal">unknown_role</code> was not found in <code class="literal">roles.yml</code></p></td></tr></table></div><p class="simpara">For more information about this command, see the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/users-command.html" target="_top"><code class="literal">elasticsearch-users</code> command</a>.</p></li><li class="listitem"><p class="simpara">If you are authenticating to LDAP, a number of configuration options can cause
this error.</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><tbody><tr><td align="left" valign="top"><p><span class="emphasis"><em>group identification</em></span></p></td><td align="left" valign="top"><p>Groups are located by either an LDAP search or by the "memberOf" attribute on
the user.  Also, If subtree search is turned off, it will search only one
level deep.  See the <a class="link" href="ldap-realm.html#ldap-settings" title="LDAP realm settings">LDAP Settings</a> for all the options.
There are many options here and sticking to the defaults will not work for all
scenarios.</p></td></tr><tr><td align="left" valign="top"><p><span class="emphasis"><em>group to role mapping</em></span></p></td><td align="left" valign="top"><p>Either the <code class="literal">role_mapping.yml</code> file or the location for this file could be
misconfigured. For more information, see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/security-files.html" target="_top">Security files</a>.</p></td></tr><tr><td align="left" valign="top"><p><span class="emphasis"><em>role definition</em></span></p></td><td align="left" valign="top"><p>The role definition might be missing or invalid.</p></td></tr></tbody></table></div><p class="simpara">To help track down these possibilities, add the following lines to the end of
the <code class="literal">log4j2.properties</code> configuration file in the <code class="literal">ES_PATH_CONF</code>:</p><div class="pre_wrapper lang-properties"><pre class="programlisting prettyprint lang-properties">logger.authc.name = org.elasticsearch.xpack.security.authc
logger.authc.level = DEBUG</pre></div><p class="simpara">A successful authentication should produce debug statements that list groups and
role mappings.</p></li></ol></div></div><div class="navfooter"><span class="prev"><a href="security-trb-settings.html">
              « 
              Some settings are not returned via the nodes settings API</a>
           
        </span><span class="next">
           
          <a href="security-trb-extraargs.html">Users command fails due to extra arguments
               »
            </a></span></div></body></html>
