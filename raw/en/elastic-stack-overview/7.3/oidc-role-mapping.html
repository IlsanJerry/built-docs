<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Configuring role mappings
        | Elastic Stack Overview [7.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [7.3]" /><link rel="up" href="oidc-guide.html" title="Configuring single sign-on to the Elastic Stack using OpenID Connect" /><link rel="prev" href="oidc-guide-authentication.html" title="Configure Elasticsearch for OpenID Connect authentication" /><link rel="next" href="oidc-user-metadata.html" title="User metadata" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elastic Stack/Overview/7.3" /><meta xmlns="" name="DC.subject" content="Elastic Stack" /><meta xmlns="" name="DC.identifier" content="7.3" /></head><body><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [7.3]
    </a></span> » <span class="breadcrumb-link"><a href="elasticsearch-security.html">Securing the Elastic Stack</a></span> » <span class="breadcrumb-link"><a href="oidc-guide.html">Configuring single sign-on to the Elastic Stack using OpenID Connect</a></span> » <span class="breadcrumb-node">Configuring role mappings</span></div><div xmlns="" class="navheader"><span class="prev"><a href="oidc-guide-authentication.html">
              « 
              Configure Elasticsearch for OpenID Connect authentication</a>
           
        </span><span class="next">
           
          <a href="oidc-user-metadata.html">User metadata
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="oidc-role-mapping"></a>Configuring role mappings<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.3/x-pack/docs/en/security/authentication/oidc-guide.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When a user authenticates using OpenID Connect, they are identified to the Elastic Stack,
but this does not automatically grant them access to perform any actions or
access any data.</p><p>Your OpenID Connect users cannot do anything until they are assigned roles. This can be done
through either the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/security-api-put-role-mapping.html" target="_top">add role mapping API</a>, or with
<a class="link" href="realm-chains.html#authorization_realms" title="Delegating authorization to another realm">authorization realms</a>.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">You cannot use <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/mapping-roles.html#mapping-roles-file" target="_top">role mapping files</a>
to grant roles to users authenticating via OpenID Connect.</p></div></div><p>This is an example of a simple role mapping that grants the <code class="literal">kibana_user</code> role
to any user who authenticates against the <code class="literal">oidc1</code> OpenID Connect realm:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /_security/role_mapping/oidc-kibana
{
  "roles": [ "kibana_user" ],
  "enabled": true,
  "rules": {
    "field": { "realm.name": "oidc1" }
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/4.console"></div><p>The user properties that are mapped via the realm configuration are used to process
role mapping rules, and these rules determine which roles a user is granted.</p><p>The user fields that are provided to the role
mapping are derived from the OpenID Connect claims as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">username</code>: The <code class="literal">principal</code> user property</li><li class="listitem"><code class="literal">dn</code>: The <code class="literal">dn</code> user property</li><li class="listitem"><code class="literal">groups</code>: The <code class="literal">groups</code> user property</li><li class="listitem"><code class="literal">metadata</code>: See <a class="xref" href="oidc-user-metadata.html" title="User metadata">User metadata</a></li></ul></div><p>For more information, see <a class="xref" href="mapping-roles.html" title="Mapping users and groups to roles">Mapping users and groups to roles</a> and
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/security-api.html#security-role-mapping-apis" target="_top">role mapping APIs</a>.</p><p>If your OP has the ability to provide groups or roles to RPs via tha use of
an OpenID Claim, then you should map this claim to the <code class="literal">claims.groups</code> setting in
the Elasticsearch realm (see <a class="xref" href="oidc-guide-authentication.html#oidc-claim-to-property" title="Mapping claims to user properties">Mapping claims to user properties</a>), and then make use of it in a role mapping
as per the example below.</p><p>This mapping grants the Elasticsearch <code class="literal">finance_data</code> role, to any users who authenticate
via the <code class="literal">oidc1</code> realm with the <code class="literal">finance-team</code> group membership.</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /_security/role_mapping/oidc-finance
{
  "roles": [ "finance_data" ],
  "enabled": true,
  "rules": { "all": [
        { "field": { "realm.name": "oidc1" } },
        { "field": { "groups": "finance-team" } }
  ] }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/5.console"></div><p>If your users also exist in a repository that can be directly accessed by Elasticsearch
(such as an LDAP directory) then you can use
<a class="link" href="realm-chains.html#authorization_realms" title="Delegating authorization to another realm">authorization realms</a> instead of role mappings.</p><p>In this case, you perform the following steps:
1. In your OpenID Connect realm, assign a claim to act as the lookup userid,
   by configuring the <code class="literal">claims.principal</code> setting.
2. Create a new realm that can lookup users from your local repository (e.g. an
   <code class="literal">ldap</code> realm)
3. In your OpenID Connect realm, set <code class="literal">authorization_realms</code> to the name of the realm you
   created in step 2.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="oidc-guide-authentication.html">
              « 
              Configure Elasticsearch for OpenID Connect authentication</a>
           
        </span><span class="next">
           
          <a href="oidc-user-metadata.html">User metadata
               »
            </a></span></div></body></html>