<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Finding your best customers
        | Elastic Stack Overview [7.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [7.4]" /><link rel="up" href="dataframe-examples.html" title="Data frame transform examples" /><link rel="prev" href="ecommerce-dataframes.html" title="Transforming the eCommerce sample data" /><link rel="next" href="example-airline.html" title="Finding air carriers with the most delays" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/7.4" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="7.4" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [7.4]
    </a></span> » <span class="breadcrumb-link"><a href="ml-dataframes.html">Data frame transforms</a></span> » <span class="breadcrumb-link"><a href="dataframe-examples.html">Data frame transform examples</a></span> » <span class="breadcrumb-node">Finding your best customers</span></div><div class="navheader"><span class="prev"><a href="ecommerce-dataframes.html">
              « 
              Transforming the eCommerce sample data</a>
           
        </span><span class="next">
           
          <a href="example-airline.html">Finding air carriers with the most delays
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="example-best-customers"></a>Finding your best customers<a href="https://github.com/elastic/stack-docs/edit/7.4/docs/en/stack/data-frames/dataframe-examples.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In this example, we use the eCommerce orders sample dataset to find the customers
who spent the most in our hypothetical webshop. Let’s transform the data such
that the destination index contains the number of orders, the total price of
the orders, the amount of unique products and the average price per order,
and the total amount of ordered products for each customer.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST _data_frame/transforms/_preview
{
  "source": {
    "index": "kibana_sample_data_ecommerce"
  },
  "dest" : { <a id="CO57-1"></a><i class="conum" data-value="1"></i>
    "index" : "sample_ecommerce_orders_by_customer"
  },
  "pivot": {
    "group_by": { <a id="CO57-2"></a><i class="conum" data-value="2"></i>
      "user": { "terms": { "field": "user" }},
      "customer_id": { "terms": { "field": "customer_id" }}
    },
    "aggregations": {
      "order_count": { "value_count": { "field": "order_id" }},
      "total_order_amt": { "sum": { "field": "taxful_total_price" }},
      "avg_amt_per_order": { "avg": { "field": "taxful_total_price" }},
      "avg_unique_products_per_order": { "avg": { "field": "total_unique_products" }},
      "total_unique_products": { "cardinality": { "field": "products.product_id" }}
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/78.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO57-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This is the destination index for the data frame. It is ignored by
<code class="literal">_preview</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO57-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Two <code class="literal">group_by</code> fields have been selected. This means the data frame will
contain a unique row per <code class="literal">user</code> and <code class="literal">customer_id</code> combination. Within this
dataset both these fields are unique. By including both in the data frame it
gives more context to the final results.</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>In the example above, condensed JSON formatting has been used for easier
readability of the pivot object.</p></div></div><p>The preview data frame transforms API enables you to see the layout of the
data frame in advance, populated with some sample values. For example:</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">{
  "preview" : [
    {
      "total_order_amt" : 3946.9765625,
      "order_count" : 59.0,
      "total_unique_products" : 116.0,
      "avg_unique_products_per_order" : 2.0,
      "customer_id" : "10",
      "user" : "recip",
      "avg_amt_per_order" : 66.89790783898304
    },
    ...
    ]
  }</pre></div><div class="console_widget" data-snippet="snippets/79.console"></div><p>This data frame makes it easier to answer questions such as:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Which customers spend the most?</li><li class="listitem">Which customers spend the most per order?</li><li class="listitem">Which customers order most often?</li><li class="listitem">Which customers ordered the least number of different products?</li></ul></div><p>It’s possible to answer these questions using aggregations alone, however
data frames allow us to persist this data as a customer centric index. This
enables us to analyze data at scale and gives more flexibility to explore and
navigate data from a customer centric perspective. In some cases, it can even
make creating visualizations much simpler.</p></div><div class="navfooter"><span class="prev"><a href="ecommerce-dataframes.html">
              « 
              Transforming the eCommerce sample data</a>
           
        </span><span class="next">
           
          <a href="example-airline.html">Finding air carriers with the most delays
               »
            </a></span></div></body></html>
