<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Finding air carriers with the most delays
        | Elastic Stack Overview [7.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elastic Stack Overview [7.4]" /><link rel="up" href="dataframe-examples.html" title="Transform examples" /><link rel="prev" href="example-best-customers.html" title="Finding your best customers" /><link rel="next" href="example-clientips.html" title="Finding suspicious client IPs by using scripted metrics" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elastic Stack/Overview/7.4" /><meta name="DC.subject" content="Elastic Stack" /><meta name="DC.identifier" content="7.4" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elastic Stack Overview
      [7.4]
    </a></span> » <span class="breadcrumb-link"><a href="ml-dataframes.html">Transforms</a></span> » <span class="breadcrumb-link"><a href="dataframe-examples.html">Transform examples</a></span> » <span class="breadcrumb-node">Finding air carriers with the most delays</span></div><div class="navheader"><span class="prev"><a href="example-best-customers.html">
              « 
              Finding your best customers</a>
           
        </span><span class="next">
           
          <a href="example-clientips.html">Finding suspicious client IPs by using scripted metrics
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="example-airline"></a>Finding air carriers with the most delays<a href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/transform/dataframe-examples.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In this example, we use the Flights sample dataset to find out which air carrier
had the most delays. First, we filter the source data such that it excludes all
the cancelled flights by using a query filter. Then we transform the data to
contain the distinct number of flights, the sum of delayed minutes, and the sum
of the flight minutes by air carrier. Finally, we use a
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.4/search-aggregations-pipeline-bucket-script-aggregation.html" target="_top"><code class="literal">bucket_script</code></a>
to determine what percentage of the flight time was actually delay.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST _data_frame/transforms/_preview
{
  "source": {
    "index": "kibana_sample_data_flights",
    "query": { <a id="CO58-1"></a><i class="conum" data-value="1"></i>
      "bool": {
        "filter": [
          { "term":  { "Cancelled": false } }
        ]
      }
    }
  },
  "dest" : { <a id="CO58-2"></a><i class="conum" data-value="2"></i>
    "index" : "sample_flight_delays_by_carrier"
  },
  "pivot": {
    "group_by": { <a id="CO58-3"></a><i class="conum" data-value="3"></i>
      "carrier": { "terms": { "field": "Carrier" }}
    },
    "aggregations": {
      "flights_count": { "value_count": { "field": "FlightNum" }},
      "delay_mins_total": { "sum": { "field": "FlightDelayMin" }},
      "flight_mins_total": { "sum": { "field": "FlightTimeMin" }},
      "delay_time_percentage": { <a id="CO58-4"></a><i class="conum" data-value="4"></i>
        "bucket_script": {
          "buckets_path": {
            "delay_time": "delay_mins_total.value",
            "flight_time": "flight_mins_total.value"
          },
          "script": "(params.delay_time / params.flight_time) * 100"
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/79.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>Filter the source data to select only flights that were not cancelled.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>This is the destination index for the data frame. It is ignored by
<code class="literal">_preview</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>The data is grouped by the <code class="literal">Carrier</code> field which contains the airline name.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-4"><i class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>This <code class="literal">bucket_script</code> performs calculations on the results that are returned
by the aggregation. In this particular example, it calculates what percentage of
travel time was taken up by delays.</p></td></tr></table></div><p>The preview shows you that the new index would contain data like this for each
carrier:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
  "preview" : [
    {
      "carrier" : "ES-Air",
      "flights_count" : 2802.0,
      "flight_mins_total" : 1436927.5130677223,
      "delay_time_percentage" : 9.335543983955839,
      "delay_mins_total" : 134145.0
    },
    ...
  ]
}</pre></div><p>This data frame makes it easier to answer questions such as:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Which air carrier has the most delays as a percentage of flight time?</li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>This data is fictional and does not reflect actual delays
or flight stats for any of the featured destination or origin airports.</p></div></div></div><div class="navfooter"><span class="prev"><a href="example-best-customers.html">
              « 
              Finding your best customers</a>
           
        </span><span class="next">
           
          <a href="example-clientips.html">Finding suspicious client IPs by using scripted metrics
               »
            </a></span></div></body></html>
