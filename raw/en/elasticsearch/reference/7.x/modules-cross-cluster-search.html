<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Search across clusters
        | Elasticsearch Reference [7.x]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch Reference [7.x]" /><link rel="up" href="index.html" title="Elasticsearch Reference [7.x]" /><link rel="prev" href="regexp-syntax.html" title="Regular expression syntax" /><link rel="next" href="modules-scripting.html" title="Scripting" /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="7.x" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.x]
    </a></span> » <span class="breadcrumb-node">Search across clusters</span></div><div class="navheader"><span class="prev"><a href="regexp-syntax.html">
              « 
              Regular expression syntax</a>
           
        </span><span class="next">
           
          <a href="modules-scripting.html">Scripting
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="modules-cross-cluster-search"></a>Search across clusters<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><p><span class="strong strong"><strong>Cross-cluster search</strong></span> lets you run a single search request against one or more
<a class="link" href="modules-remote-clusters.html" title="Remote clusters">remote clusters</a>. For example, you can use a cross-cluster search to
filter and analyze log data stored on clusters in different data centers.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p>Cross-cluster search requires <a class="link" href="modules-remote-clusters.html" title="Remote clusters">remote clusters</a>.</p></div></div><h2><a id="ccs-example"></a>Cross-cluster search examples<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><h3><a id="ccs-remote-cluster-setup"></a>Remote cluster setup<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To perform a cross-cluster search, you must have at least one remote cluster configured.</p><p>The following <a class="link" href="cluster-update-settings.html" title="Cluster Update Settings">cluster update settings</a> API request
adds three remote clusters:<code class="literal">cluster_one</code>, <code class="literal">cluster_two</code>, and <code class="literal">cluster_three</code>.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "cluster": {
      "remote": {
        "cluster_one": {
          "seeds": [
            "127.0.0.1:9300"
          ]
        },
        "cluster_two": {
          "seeds": [
            "127.0.0.1:9301"
          ]
        },
        "cluster_three": {
          "seeds": [
            "127.0.0.1:9302"
          ]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/485.console"></div><h3><a id="ccs-search-remote-cluster"></a>Search a single remote cluster<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The following <a class="link" href="search.html" title="Search APIs">search</a> API request searches the
<code class="literal">twitter</code> index on a single remote cluster, <code class="literal">cluster_one</code>.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET /cluster_one:twitter/_search
{
  "query": {
    "match": {
      "user": "kimchy"
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/486.console"></div><p>The API returns the following response:</p><div class="pre_wrapper lang-console-result"><pre class="programlisting prettyprint lang-console-result">{
  "took": 150,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "failed": 0,
    "skipped": 0
  },
  "_clusters": {
    "total": 1,
    "successful": 1,
    "skipped": 0
  },
  "hits": {
    "total" : {
        "value": 1,
        "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": "cluster_one:twitter", <a id="CO130-1"></a><i class="conum" data-value="1"></i>
        "_type": "_doc",
        "_id": "0",
        "_score": 1,
        "_source": {
          "user": "kimchy",
          "date": "2009-11-15T14:12:12",
          "message": "trying out Elasticsearch",
          "likes": 0
        }
      }
    ]
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO130-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The search response body includes the name of the remote cluster in the
<code class="literal">_index</code> parameter.</p></td></tr></table></div><h3><a id="ccs-search-multi-remote-cluster"></a>Search multiple remote clusters<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The following <a class="link" href="search.html" title="Search APIs">search</a> API request searches the <code class="literal">twitter</code> index on
three clusters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Your local cluster</li><li class="listitem">Two remote clusters, <code class="literal">cluster_one</code> and <code class="literal">cluster_two</code></li></ul></div><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET /twitter,cluster_one:twitter,cluster_two:twitter/_search
{
  "query": {
    "match": {
      "user": "kimchy"
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/487.console"></div><p>The API returns the following response:</p><div class="pre_wrapper lang-console-result"><pre class="programlisting prettyprint lang-console-result">{
  "took": 150,
  "timed_out": false,
  "num_reduce_phases": 4,
  "_shards": {
    "total": 3,
    "successful": 3,
    "failed": 0,
    "skipped": 0
  },
  "_clusters": {
    "total": 3,
    "successful": 3,
    "skipped": 0
  },
  "hits": {
    "total" : {
        "value": 3,
        "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": "twitter", <a id="CO131-1"></a><i class="conum" data-value="1"></i>
        "_type": "_doc",
        "_id": "0",
        "_score": 2,
        "_source": {
          "user": "kimchy",
          "date": "2009-11-15T14:12:12",
          "message": "trying out Elasticsearch",
          "likes": 0
        }
      },
      {
        "_index": "cluster_one:twitter", <a id="CO131-2"></a><i class="conum" data-value="2"></i>
        "_type": "_doc",
        "_id": "0",
        "_score": 1,
        "_source": {
          "user": "kimchy",
          "date": "2009-11-15T14:12:12",
          "message": "trying out Elasticsearch",
          "likes": 0
        }
      },
      {
        "_index": "cluster_two:twitter", <a id="CO131-3"></a><i class="conum" data-value="3"></i>
        "_type": "_doc",
        "_id": "0",
        "_score": 1,
        "_source": {
          "user": "kimchy",
          "date": "2009-11-15T14:12:12",
          "message": "trying out Elasticsearch",
          "likes": 0
        }
      }
    ]
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO131-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>This document’s <code class="literal">_index</code> parameter doesn’t include a cluster name. This
means the document came from the local cluster.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO131-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>This document came from <code class="literal">cluster_one</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO131-3"><i class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>This document came from <code class="literal">cluster_two</code>.</p></td></tr></table></div><h2><a id="skip-unavailable-clusters"></a>Skip unavailable clusters<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>By default, a cross-cluster search returns an error if <span class="strong strong"><strong>any</strong></span> cluster in the request is
unavailable.</p><p>To skip an unavailable cluster during a cross-cluster search, set the
<a class="link" href="cluster-remote-info.html#skip-unavailable"><code class="literal">skip_unavailable</code></a> cluster setting to <code class="literal">true</code>.</p><p>The following <a class="link" href="cluster-update-settings.html" title="Cluster Update Settings">cluster update settings</a> API request
changes <code class="literal">cluster_two</code>'s <code class="literal">skip_unavailable</code> setting to <code class="literal">true</code>.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT _cluster/settings
{
  "persistent": {
    "cluster.remote.cluster_two.skip_unavailable": true
  }
}</pre></div><div class="console_widget" data-snippet="snippets/488.console"></div><p>If <code class="literal">cluster_two</code> is disconnected or unavailable during a cross-cluster search, Elasticsearch won’t
include matching documents from that cluster in the final results.</p><h2><a id="ccs-works"></a>How cross-cluster search works<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>Because cross-cluster search involves sending requests to remote clusters, any network delays
can impact search speed. To avoid slow searches, cross-cluster search offers two options for
handling network delays:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><a class="link" href="modules-cross-cluster-search.html#ccs-min-roundtrips" title="Minimize network roundtrips">Minimize network roundtrips</a></span></dt><dd><p class="simpara">By default, Elasticsearch reduces the number of network roundtrips between remote
clusters. This reduces the impact of network delays on search speed. However,
Elasticsearch can’t reduce network roundtrips for large search requests, such as those
including a <a class="link" href="search-request-body.html#request-body-search-scroll" title="Scroll">scroll</a> or
<a class="link" href="search-request-body.html#request-body-search-inner-hits" title="Inner hits">inner hits</a>.</p><p class="simpara">See <a class="xref" href="modules-cross-cluster-search.html#ccs-min-roundtrips" title="Minimize network roundtrips">Minimize network roundtrips</a> to learn how this option works.</p></dd><dt><span class="term"><a class="link" href="modules-cross-cluster-search.html#ccs-unmin-roundtrips" title="Don’t minimize network roundtrips">Don’t minimize network roundtrips</a></span></dt><dd><p class="simpara">For search requests that include a scroll or inner hits, Elasticsearch sends multiple
outgoing and ingoing requests to each remote cluster. You can also choose this
option by setting the <a class="link" href="search.html" title="Search APIs">search</a> API’s
<a class="link" href="search-request-body.html#ccs-minimize-roundtrips"><code class="literal">ccs_minimize_roundtrips</code></a> parameter to <code class="literal">false</code>.
While typically slower, this approach may work well for networks with low
latency.</p><p class="simpara">See <a class="xref" href="modules-cross-cluster-search.html#ccs-unmin-roundtrips" title="Don’t minimize network roundtrips">Don’t minimize network roundtrips</a> to learn how this option works.</p></dd></dl></div><h3><a id="ccs-min-roundtrips"></a>Minimize network roundtrips<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Here’s how cross-cluster search works when you minimize network roundtrips.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">You send a cross-cluster search request to your local cluster. A coordinating node in that
cluster receives and parses the request.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-client-request.png" alt="ccs min roundtrip client request" /></span></p></li><li class="listitem"><p class="simpara">The coordinating node sends a single search request to each cluster, including
its own. Each cluster performs the search request independently.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-cluster-search.png" alt="ccs min roundtrip cluster search" /></span></p></li><li class="listitem"><p class="simpara">Each remote cluster sends its search results back to the coordinating node.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-cluster-results.png" alt="ccs min roundtrip cluster results" /></span></p></li><li class="listitem"><p class="simpara">After collecting results from each cluster, the coordinating node returns the
final results in the cross-cluster search response.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-client-response.png" alt="ccs min roundtrip client response" /></span></p></li></ol></div><h3><a id="ccs-unmin-roundtrips"></a>Don’t minimize network roundtrips<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/modules/cross-cluster-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Here’s how cross-cluster search works when you don’t minimize network roundtrips.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">You send a cross-cluster search request to your local cluster. A coordinating node in that
cluster receives and parses the request.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-client-request.png" alt="ccs min roundtrip client request" /></span></p></li><li class="listitem"><p class="simpara">The coordinating node sends a <a class="link" href="search-shards.html" title="Search Shards API">search shards</a> API request to
each remote cluster.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-cluster-search.png" alt="ccs min roundtrip cluster search" /></span></p></li><li class="listitem"><p class="simpara">Each remote cluster sends its response back to the coordinating node.
This response contains information about the indices and shards the cross-cluster search
request will be executed on.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-cluster-results.png" alt="ccs min roundtrip cluster results" /></span></p></li><li class="listitem"><p class="simpara">The coordinating node sends a search request to each shard, including those in
its own cluster. Each shard performs the search request independently.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-dont-min-roundtrip-shard-search.png" alt="ccs dont min roundtrip shard search" /></span></p></li><li class="listitem"><p class="simpara">Each shard sends its search results back to the coordinating node.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-dont-min-roundtrip-shard-results.png" alt="ccs dont min roundtrip shard results" /></span></p></li><li class="listitem"><p class="simpara">After collecting results from each cluster, the coordinating node returns the
final results in the cross-cluster search response.</p><p class="simpara"><span class="inlinemediaobject"><img src="images/ccs/ccs-min-roundtrip-client-response.png" alt="ccs min roundtrip client response" /></span></p></li></ol></div></div><div class="navfooter"><span class="prev"><a href="regexp-syntax.html">
              « 
              Regular expression syntax</a>
           
        </span><span class="next">
           
          <a href="modules-scripting.html">Scripting
               »
            </a></span></div></body></html>
