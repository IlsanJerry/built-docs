<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Enrich your data
        | Elasticsearch Reference [7.x]
      | Elastic
    </title><link rel="home" href="index.html" title="Elasticsearch Reference [7.x]" /><link rel="up" href="ingest.html" title="Ingest node" /><link rel="prev" href="handling-failure-in-pipelines.html" title="Handling Failures in Pipelines" /><link rel="next" href="ingest-processors.html" title="Processors" /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="7.x" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.x]
    </a></span> » <span class="breadcrumb-link"><a href="ingest.html">Ingest node</a></span> » <span class="breadcrumb-node">Enrich your data</span></div><div class="navheader"><span class="prev"><a href="handling-failure-in-pipelines.html">
              « 
              Handling Failures in Pipelines</a>
           
        </span><span class="next">
           
          <a href="ingest-processors.html">Processors
               »
            </a></span></div><div class="xpack chapter"><div class="titlepage"><div><div><h2 class="title"><a id="ingest-enriching-data"></a>Enrich your data<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><p>You can use the <a class="link" href="enrich-processor.html" title="Enrich Processor">enrich processor</a>
to append data from existing indices
to incoming documents during ingest.</p><p>For example, you can use the enrich processor to:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Identify web services or vendors based on known IP addresses</li><li class="listitem">Add product information to retail orders based on product IDs</li><li class="listitem">Supplement contact information based on an email address</li><li class="listitem">Add postal codes based on user coordinates</li></ul></div><h3><a id="enrich-setup"></a>Set up an enrich processor<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To set up an enrich processor and learn how it works,
follow these steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Check the <a class="link" href="ingest-enriching-data.html#enrich-prereqs" title="Prerequisites">prerequisites</a>.</li><li class="listitem"><a class="xref" href="ingest-enriching-data.html#create-enrich-source-index" title="Create a source index">Create a source index</a>.</li><li class="listitem"><a class="xref" href="ingest-enriching-data.html#create-enrich-policy" title="Create an enrich policy">Create an enrich policy</a>.</li><li class="listitem"><a class="xref" href="ingest-enriching-data.html#execute-enrich-policy" title="Execute an enrich policy">Execute an enrich policy</a>.</li><li class="listitem"><a class="xref" href="ingest-enriching-data.html#add-enrich-processor" title="Add the enrich processor to an ingest pipeline">Add the enrich processor to an ingest pipeline</a>.</li><li class="listitem"><a class="xref" href="ingest-enriching-data.html#ingest-enrich-docs" title="Ingest and enrich documents">Ingest and enrich documents</a>.</li></ol></div><p>Once you have an enrich processor set up,
you can <a class="link" href="ingest-enriching-data.html#update-enrich-data" title="Update your enrich index">update your enrich data</a>
and <a class="link" href="ingest-enriching-data.html#update-enrich-policies" title="Update an enrich policy">update your enrich policies</a>
using the <a class="link" href="enrich-apis.html" title="Enrich APIs">enrich APIs</a>.</p><div class="important admon"><div class="icon"></div><div class="admon_content"><p>The enrich processor performs several operations
and may impact the speed of your <a class="link" href="pipeline.html" title="Pipeline Definition">ingest pipeline</a>.</p><p>We strongly recommend testing and benchmarking your enrich processors
before deploying them in production.</p><p>We do not recommend using the enrich processor to append real-time data.
The enrich processor works best with reference data
that doesn’t change frequently.</p></div></div><h4><a id="enrich-prereqs"></a>Prerequisites<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>If you use Elasticsearch security features, you must have:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">read</code> index privileges for any indices used</li><li class="listitem">The <code class="literal">enrich_user</code> <a class="ulink" href="/guide/en/elastic-stack-overview/7.x/built-in-roles.html" target="_top">built-in role</a></li></ul></div><h4><a id="create-enrich-source-index"></a>Create a source index<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>To begin,
create one or more source indices.</p><p>A <span class="emphasis"><em>source index</em></span> contains data you want to append to incoming documents.
You can index and manage documents in a source index
like a regular index.</p><p>The following <a class="link" href="docs-index_.html" title="Index API">index API</a> request creates the <code class="literal">users</code> source index
containing user data.
This request also indexes a new document to the <code class="literal">users</code> source index.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /users/_doc/1?refresh=wait_for
{
    "email": "mardy.brown@asciidocsmith.com",
    "first_name": "Mardy",
    "last_name": "Brown",
    "city": "New Orleans",
    "county": "Orleans",
    "state": "LA",
    "zip": 70116,
    "web": "mardy.asciidocsmith.com"
}</pre></div><div class="console_widget" data-snippet="snippets/963.console"></div><p>You also can set up <a class="ulink" href="/guide/en/beats/libbeat/7.x/getting-started.html" target="_top">Beats</a>,
such as a <a class="ulink" href="/guide/en/beats/filebeat/7.x/filebeat-getting-started.html" target="_top">Filebeat</a>,
to automatically send and index documents
to your source indices.
See <a class="ulink" href="/guide/en/beats/libbeat/7.x/getting-started.html" target="_top">Getting started with Beats</a>.</p><h4><a id="create-enrich-policy"></a>Create an enrich policy<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Use the <a class="link" href="put-enrich-policy-api.html" title="Put enrich policy API">put enrich policy API</a>
to create an enrich policy.</p><p>An <span class="strong strong"><strong>enrich policy</strong></span> is a set of rules the enrich processor uses
to append the appropriate data to incoming documents.
An enrich policy contains:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">The <span class="strong strong"><strong>policy type</strong></span>,
which determines how the processor enriches incoming documents</li><li class="listitem">A list of source indices</li><li class="listitem">The <span class="strong strong"><strong>match field</strong></span> used to match incoming documents</li><li class="listitem"><span class="strong strong"><strong>Enrich fields</strong></span> appended to incoming documents
from matching documents</li></ul></div><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_enrich/policy/users-policy
{
    "match": {
        "indices": "users",
        "match_field": "email",
        "enrich_fields": ["first_name", "last_name", "city", "zip", "state"]
    }
}</pre></div><div class="console_widget" data-snippet="snippets/964.console"></div><h4><a id="execute-enrich-policy"></a>Execute an enrich policy<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Use the <a class="link" href="execute-enrich-policy-api.html" title="Execute enrich policy API">execute enrich policy API</a>
to create an enrich index for the policy.</p><p>The <span class="emphasis"><em>enrich index</em></span> contains documents from the policy’s source indices.
Enrich indices always begin with <code class="literal">.enrich-*</code>,
are read-only,
and are <a class="link" href="indices-forcemerge.html" title="Force merge API">force merged</a>.</p><div class="warning admon"><div class="icon"></div><div class="admon_content"><p>Enrich indices should be used by the <a class="link" href="enrich-processor.html" title="Enrich Processor">enrich processor</a> only.
Avoid using enrich indices for other purposes.</p></div></div><p>The following request executes the <code class="literal">users-policy</code> enrich policy.
Because this API request performs several operations,
it may take a while to return a response.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">POST /_enrich/policy/users-policy/_execute</pre></div><div class="console_widget" data-snippet="snippets/965.console"></div><h4><a id="add-enrich-processor"></a>Add the enrich processor to an ingest pipeline<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Use the <a class="link" href="put-pipeline-api.html" title="Put pipeline API">put pipeline API</a>
to create an ingest pipeline.
Include an <a class="link" href="enrich-processor.html" title="Enrich Processor">enrich processor</a>
that uses your enrich policy.</p><p>When defining an enrich processor,
you must include the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">The field used to match incoming documents
to documents in the enrich index.</p><p class="simpara">This field should be included in incoming documents.</p></li><li class="listitem">The target field added to incoming documents.
This field contains all appended enrich data.</li></ul></div><p>The following request adds a new pipeline, <code class="literal">user_lookup</code>.
This pipeline includes an enrich processor
that uses the <code class="literal">users-policy</code> enrich policy.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /_ingest/pipeline/user_lookup
{
  "description" : "Enriching user details to messages",
  "processors" : [
    {
      "enrich" : {
        "policy_name": "users-policy",
        "field" : "email",
        "target_field": "user",
        "max_matches": "1"
      }
    }
  ]
}</pre></div><div class="console_widget" data-snippet="snippets/966.console"></div><p>Because the enrich policy type is <code class="literal">match</code>,
the enrich processor matches incoming documents
to documents in the enrich index
based on match field values.
The enrich processor then appends the enrich field data
from matching documents in the enrich index
to the target field of incoming documents.</p><p>Because the <code class="literal">max_matches</code> option for the enrich processor is <code class="literal">1</code>,
the enrich processor appends the data from only the best matching document
to each incoming document’s target field as an object.</p><p>If the <code class="literal">max_matches</code> option were greater than <code class="literal">1</code>,
the processor could append data from up to the <code class="literal">max_matches</code> number of documents
to the target field as an array.</p><p>If the incoming document matches no documents in the enrich index,
the processor appends no data.</p><p>You also can add other <a class="link" href="ingest-processors.html" title="Processors">processors</a>
to your ingest pipeline.
You can use these processors to change or drop incoming documents
based on your criteria.
See <a class="xref" href="ingest-processors.html" title="Processors"><em>Processors</em></a> for a list of built-in processors.</p><h4><a id="ingest-enrich-docs"></a>Ingest and enrich documents<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Index incoming documents using your ingest pipeline.</p><p>The following <a class="link" href="docs-index_.html" title="Index API">index API</a> request uses the ingest pipeline
to index a document
containing the <code class="literal">email</code> field
specified in the enrich processor.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">PUT /my_index/_doc/my_id?pipeline=user_lookup
{
  "email": "mardy.brown@asciidocsmith.com"
}</pre></div><div class="console_widget" data-snippet="snippets/967.console"></div><p>To verify the enrich processor matched
and appended the appropriate field data,
use the <a class="link" href="docs-get.html" title="Get API">get API</a> to view the indexed document.</p><div class="pre_wrapper lang-console"><pre class="programlisting prettyprint lang-console">GET /my_index/_doc/my_id</pre></div><div class="console_widget" data-snippet="snippets/968.console"></div><p>The API returns the following response:</p><div class="pre_wrapper lang-console-result"><pre class="programlisting prettyprint lang-console-result">{
  "found": true,
  "_index": "my_index",
  "_type": "_doc",
  "_id": "my_id",
  "_version": 1,
  "_seq_no": 55,
  "_primary_term": 1,
  "_source": {
    "user": {
      "email": "mardy.brown@asciidocsmith.com",
      "first_name": "Mardy",
      "last_name": "Brown",
      "zip": 70116,
      "city": "New Orleans",
      "state": "LA"
    },
    "email": "mardy.brown@asciidocsmith.com"
  }
}</pre></div><h3><a id="update-enrich-data"></a>Update your enrich index<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Once created, you cannot update
or index documents to an enrich index.
Instead, update your source indices
and execute the enrich policy again.
This creates a new enrich index from your updated source indices
and deletes the previous enrich index.</p><p>If wanted, you can <a class="link" href="docs-reindex.html" title="Reindex API">reindex</a>
or <a class="link" href="docs-update-by-query.html" title="Update By Query API">update</a> any already ingested documents
using your ingest pipeline.</p><h3><a id="update-enrich-policies"></a>Update an enrich policy<a href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/ingest/enrich.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You cannot update an existing enrich policy.
Instead, you can:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Create and execute a new enrich policy.</li><li class="listitem">Replace the previous enrich policy
with the new enrich policy
in any in-use enrich processors.</li><li class="listitem">Use the <a class="link" href="delete-enrich-policy-api.html" title="Delete enrich policy API">delete enrich policy</a> API
to delete the previous enrich policy.</li></ol></div></div><div class="navfooter"><span class="prev"><a href="handling-failure-in-pipelines.html">
              « 
              Handling Failures in Pipelines</a>
           
        </span><span class="next">
           
          <a href="ingest-processors.html">Processors
               »
            </a></span></div></body></html>
