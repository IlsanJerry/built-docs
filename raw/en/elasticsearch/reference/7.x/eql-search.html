<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Run an EQL search | Elasticsearch Reference [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [7.x]"/>
<link rel="up" href="eql.html" title="EQL for event-based search"/>
<link rel="prev" href="eql-requirements.html" title="EQL requirements"/>
<link rel="next" href="eql-syntax.html" title="EQL syntax reference"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.x"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="eql.html">EQL for event-based search</a></span>
»
<span class="breadcrumb-node">Run an EQL search</span>
</div>
<div class="navheader">
<span class="prev">
<a href="eql-requirements.html">« EQL requirements</a>
</span>
<span class="next">
<a href="eql-syntax.html">EQL syntax reference »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="eql-search"></a>Run an EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in development and may be changed or removed completely in a future release. These features are unsupported and not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>To start using EQL in Elasticsearch, first ensure your event data meets
<a class="xref" href="eql-requirements.html" title="EQL requirements">EQL requirements</a>. You can then use the <a class="xref" href="eql-search-api.html" title="EQL search API">EQL
search API</a> to search event data stored in one or more Elasticsearch indices.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>To get started, ingest or add the data to an Elasticsearch index.</p>
<p>The following <a class="xref" href="docs-bulk.html" title="Bulk API">bulk API</a> request adds some example log data to the
<code class="literal">sec_logs</code> index. This log data follows the <a href="/guide/en/ecs/1.4" class="ulink" target="_top">Elastic Common Schema
(ECS)</a>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /sec_logs/_bulk?refresh
{"index":{"_index" : "sec_logs", "_id" : "1"}}
{ "@timestamp": "2020-12-06T11:04:05.000Z", "agent": { "id": "8a4f500d" }, "event": { "category": "process", "id": "edwCRnyD","sequence": 1 }, "process": { "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe" } }
{"index":{"_index" : "sec_logs", "_id" : "2"}}
{ "@timestamp": "2020-12-06T11:04:07.000Z", "agent": { "id": "8a4f500d" }, "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2020-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe" } }
{"index":{"_index" : "sec_logs", "_id" : "3"}}
{ "@timestamp": "2020-12-07T11:06:07.000Z", "agent": { "id": "8a4f500d" }, "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe" } }
{"index":{"_index" : "sec_logs", "_id" : "4"}}
{ "@timestamp": "2020-12-07T11:07:08.000Z", "agent": { "id": "8a4f500d" }, "event": { "category": "file", "id": "bYA7gPay", "sequence": 4 }, "file": { "accessed": "2020-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe" } }
{"index":{"_index" : "sec_logs", "_id" : "5"}}
{ "@timestamp": "2020-12-07T11:07:09.000Z", "agent": { "id": "8a4f500d" }, "event": { "category": "process", "id": "aR3NWVOs", "sequence": 5 }, "process": { "name": "regsvr32.exe", "path": "C:\\Windows\\System32\\regsvr32.exe" } }</pre>
</div>
<div class="console_widget" data-snippet="snippets/336.console"></div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You also can set up <a href="/guide/en/beats/libbeat/7.x/getting-started.html" class="ulink" target="_top">Beats</a>, such as
<a href="/guide/en/beats/auditbeat/7.x/auditbeat-getting-started.html" class="ulink" target="_top">Auditbeat</a> or
<a href="/guide/en/beats/winlogbeat/7.x/winlogbeat-getting-started.html" class="ulink" target="_top">Winlogbeat</a>, to automatically
send and index your event data in Elasticsearch. See
<a href="/guide/en/beats/libbeat/7.x/getting-started.html" class="ulink" target="_top">Getting started with Beats</a>.</p>
</div>
</div>
<p>You can now use the EQL search API to search this index using an EQL query.</p>
<p>The following request searches the <code class="literal">sec_logs</code> index using the EQL query
specified in the <code class="literal">query</code> parameter. The EQL query matches events with an
<code class="literal">event.category</code> of <code class="literal">process</code> that have a <code class="literal">process.name</code> of <code class="literal">cmd.exe</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/337.console"></div>
<p>Because the <code class="literal">sec_log</code> index follows the ECS, you don&#8217;t need to specify the
required <a class="xref" href="eql-requirements.html#eql-required-fields" title="Required fields">event category or timestamp</a> fields. The request
uses the <code class="literal">event.category</code> and <code class="literal">@timestamp</code> fields by default.</p>
<p>The API returns the following response containing the matching events. Events
in the response are sorted by timestamp, converted to milliseconds since the
<a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>, in ascending order.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "events": [
      {
        "_index": "sec_logs",
        "_type": "_doc",
        "_id": "1",
        "_score": null,
        "_source": {
          "@timestamp": "2020-12-06T11:04:05.000Z",
          "agent": {
            "id": "8a4f500d"
          },
          "event": {
            "category": "process",
            "id": "edwCRnyD",
            "sequence": 1
          },
          "process": {
            "name": "cmd.exe",
            "path": "C:\\Windows\\System32\\cmd.exe"
          }
        },
        "sort": [
          1607252645000
        ]
      },
      {
        "_index": "sec_logs",
        "_type": "_doc",
        "_id": "3",
        "_score": null,
        "_source": {
          "@timestamp": "2020-12-07T11:06:07.000Z",
          "agent": {
            "id": "8a4f500d"
          },
          "event": {
            "category": "process",
            "id": "cMyt5SZ2",
            "sequence": 3
          },
          "process": {
            "name": "cmd.exe",
            "path": "C:\\Windows\\System32\\cmd.exe"
          }
        },
        "sort": [
          1607339167000
        ]
      }
    ]
  }
}</pre>
</div>
</div>
</details>
<h3><a id="eql-search-sequence"></a>Search for a sequence of events<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>Many query languages allow you to match single events. However, EQL&#8217;s
<a class="xref" href="eql-syntax.html#eql-sequences" title="Sequences">sequence syntax</a> lets you match an ordered series of events.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following EQL search request matches a sequence that:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Starts with an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">file</code>
</li>
<li class="listitem">
A <code class="literal">file.name</code> of <code class="literal">cmd.exe</code>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Followed by an event with:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
An <code class="literal">event.category</code> of <code class="literal">process</code>
</li>
<li class="listitem">
A <code class="literal">process.name</code> that contains the substring <code class="literal">regsvr32</code>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "query": """
    sequence
      [ file where file.name == "cmd.exe" ]
      [ process where stringContains(process.name, "regsvr32") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/338.console"></div>
<p>The API returns the following response. Matching events in
the <code class="literal">hits.sequences.events</code> property are sorted by
<a class="xref" href="eql-search-api.html#eql-search-api-timestamp-field">timestamp</a>, converted to milliseconds since
the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix epoch</a>, in ascending order.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "sequences": [
      {
        "events": [
          {
            "_index": "sec_logs",
            "_type": "_doc",
            "_id": "4",
            "_score": null,
            "_source": {
              "@timestamp": "2020-12-07T11:07:08.000Z",
              "agent": {
                "id": "8a4f500d"
              },
              "event": {
                "category": "file",
                "id": "bYA7gPay",
                "sequence": 4
              },
              "file": {
                "accessed": "2020-12-07T11:07:08.000Z",
                "name": "cmd.exe",
                "path": "C:\\Windows\\System32\\cmd.exe",
                "type": "file",
                "size": 16384
              },
              "process": {
                "name": "cmd.exe",
                "path": "C:\\Windows\\System32\\cmd.exe"
              }
            },
            "sort": [
              1607339228000
            ]
          },
          {
            "_index": "sec_logs",
            "_type": "_doc",
            "_id": "5",
            "_score": null,
            "_source": {
              "@timestamp": "2020-12-07T11:07:09.000Z",
              "agent": {
                "id": "8a4f500d"
              },
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 5
              },
              "process": {
                "name": "regsvr32.exe",
                "path": "C:\\Windows\\System32\\regsvr32.exe"
              }
            },
            "sort": [
              1607339229000
            ]
          }
        ]
      }
    ]
  }
}</pre>
</div>
<p>You can further constrain matching event sequences using the <code class="literal">by</code> keyword.</p>
<p>The following EQL search request adds <code class="literal">by agent.id</code> to each event item. This
ensures events matching the sequence share the same <code class="literal">agent.id</code> field value.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "query": """
    sequence
      [ file where file.name == "cmd.exe" ] by agent.id
      [ process where stringContains(process.name, "regsvr32") ] by agent.id
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/339.console"></div>
<p>Because the <code class="literal">agent.id</code> field is shared across all events in the sequence, it
can be included using <code class="literal">sequence by</code>. The following query is equivalent to the
prior one.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "query": """
    sequence by agent.id
      [ file where file.name == "cmd.exe" ]
      [ process where stringContains(process.name, "regsvr32") ]
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/340.console"></div>
<p>The API returns the following response. The <code class="literal">hits.sequences.join_keys</code> property
contains the shared <code class="literal">agent.id</code> value for each matching event.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 60,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "sequences": [
      {
        "join_keys": [
          "8a4f500d"
        ],
        "events": [
          {
            "_index": "sec_logs",
            "_type": "_doc",
            "_id": "4",
            "_score": null,
            "_source": {
              "@timestamp": "2020-12-07T11:07:08.000Z",
              "agent": {
                "id": "8a4f500d"
              },
              "event": {
                "category": "file",
                "id": "bYA7gPay",
                "sequence": 4
              },
              "file": {
                "accessed": "2020-12-07T11:07:08.000Z",
                "name": "cmd.exe",
                "path": "C:\\Windows\\System32\\cmd.exe",
                "type": "file",
                "size": 16384
              },
              "process": {
                "name": "cmd.exe",
                "path": "C:\\Windows\\System32\\cmd.exe"
              }
            },
            "sort": [
              1607339228000
            ]
          },
          {
            "_index": "sec_logs",
            "_type": "_doc",
            "_id": "5",
            "_score": null,
            "_source": {
              "@timestamp": "2020-12-07T11:07:09.000Z",
              "agent": {
                "id": "8a4f500d"
              },
              "event": {
                "category": "process",
                "id": "aR3NWVOs",
                "sequence": 5
              },
              "process": {
                "name": "regsvr32.exe",
                "path": "C:\\Windows\\System32\\regsvr32.exe"
              }
            },
            "sort": [
              1607339229000
            ]
          }
        ]
      }
    ]
  }
}</pre>
</div>
</div>
</details>
<h3><a id="eql-search-specify-event-category-field"></a>Specify an event category field<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>The EQL search API uses <code class="literal">event.category</code> as the required
<a class="xref" href="eql-requirements.html#eql-required-fields" title="Required fields">event category field</a> by default. You can use the
<code class="literal">event_category_field</code> parameter to specify another event category field.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following request specifies <code class="literal">file.type</code> as the event category
field.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "event_category_field": "file.type",
  "query": """
    file where agent.id == "8a4f500d"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/341.console"></div>
</div>
</details>
<h3><a id="eql-search-specify-timestamp-field"></a>Specify a timestamp field<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>The EQL search API uses <code class="literal">@timestamp</code> as the required <a class="xref" href="eql-requirements.html#eql-required-fields" title="Required fields">event
timestamp field</a> by default. You can use the <code class="literal">timestamp_field</code> parameter to
specify another timestamp field.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following request specifies <code class="literal">file.accessed</code> as the event
timestamp field.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "timestamp_field": "file.accessed",
  "query": """
    file where (file.size &gt; 1 and file.type == "file")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/342.console"></div>
</div>
</details>
<h3><a id="eql-search-specify-a-sort-tiebreaker"></a>Specify a sort tiebreaker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>By default, the EQL search API sorts matching events in the search response by
timestamp. However, if two or more events share the same timestamp, a tiebreaker
field is used to sort the events in ascending, lexicographic order.</p>
<p>The EQL search API uses <code class="literal">event.sequence</code> as the default tiebreaker field. You
can use the <code class="literal">tiebreaker_field</code> parameter to specify another field.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following request specifies <code class="literal">event.start</code> as the tiebreaker field.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "tiebreaker_field": "event.id",
  "query": """
    process where process.name == "cmd.exe" and stringContains(process.path, "System32")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/343.console"></div>
<p>The API returns the following response. Note the <code class="literal">sort</code> property of each
matching event contains an array of two items:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The first item is the event&#8217;s <a class="xref" href="eql-search-api.html#eql-search-api-timestamp-field">timestamp</a>,
converted to milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix
epoch</a>.
</li>
<li class="listitem">
The second item is the event&#8217;s <code class="literal">event.id</code> value. This value is used as a sort
tiebreaker for events with the same timestamp.
</li>
</ul>
</div>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "is_partial": false,
  "is_running": false,
  "took": 34,
  "timed_out": false,
  "hits": {
    "total": {
      "value": 2,
      "relation": "eq"
    },
    "events": [
      {
        "_index": "sec_logs",
        "_type": "_doc",
        "_id": "1",
        "_score": null,
        "_source": {
          "@timestamp": "2020-12-06T11:04:05.000Z",
          "agent": {
            "id": "8a4f500d"
          },
          "event": {
            "category": "process",
            "id": "edwCRnyD",
            "sequence": 1
          },
          "process": {
            "name": "cmd.exe",
            "path": "C:\\Windows\\System32\\cmd.exe"
          }
        },
        "sort": [
          1607252645000,                                <a id="CO51-1"></a><i class="conum" data-value="1"></i>
          "edwCRnyD"                                    <a id="CO51-2"></a><i class="conum" data-value="2"></i>
          ]
        },
            {
        "_index": "sec_logs",
        "_type": "_doc",
        "_id": "3",
        "_score": null,
        "_source": {
          "@timestamp": "2020-12-07T11:06:07.000Z",
          "agent": {
            "id": "8a4f500d"
          },
          "event": {
            "category": "process",
            "id": "cMyt5SZ2",
            "sequence": 3
          },
          "process": {
            "name": "cmd.exe",
            "path": "C:\\Windows\\System32\\cmd.exe"
          }
        },
        "sort": [
          1607339167000,                                <a id="CO51-3"></a><i class="conum" data-value="1"></i>
          "cMyt5SZ2"                                    <a id="CO51-4"></a><i class="conum" data-value="2"></i>
        ]
      }
    ]
  }
}</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO51-1"><i class="conum" data-value="1"></i></a><a href="#CO51-3"></a></p>
</td>
<td align="left" valign="top">
<p>The event&#8217;s <a class="xref" href="eql-search-api.html#eql-search-api-timestamp-field">timestamp</a>, converted to
milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time" class="ulink" target="_top">Unix
epoch</a></p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO51-2"><i class="conum" data-value="2"></i></a><a href="#CO51-4"></a></p>
</td>
<td align="left" valign="top">
<p>The event&#8217;s <code class="literal">event.id</code> value.</p>
</td>
</tr>
</table>
</div>
</div>
</details>
<h3><a id="eql-search-filter-query-dsl"></a>Filter using query DSL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>You can use the EQL search API&#8217;s <code class="literal">filter</code> parameter to specify an additional
query using <a class="xref" href="query-dsl.html" title="Query DSL">query DSL</a>. This query filters the documents on which
the EQL query runs.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following request uses a <code class="literal">range</code> query to filter the <code class="literal">sec_logs</code>
index down to only documents with a <code class="literal">file.size</code> value greater than <code class="literal">1</code> but less
than <code class="literal">1000000</code> bytes. The EQL query in <code class="literal">query</code> parameter then runs on these
filtered documents.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "filter": {
    "range" : {
      "file.size" : {
        "gte" : 1,
        "lte" : 1000000
      }
    }
  },
  "query": """
    file where (file.type == "file" and file.name == "cmd.exe")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/344.console"></div>
</div>
</details>
<h3><a id="eql-search-async"></a>Run an async EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>EQL searches in Elasticsearch are designed to run on large volumes of data quickly,
often returning results in milliseconds. Because of this, the EQL search API
runs <em>synchronous</em> searches by default. This means the search request waits for
complete results before returning a response.</p>
<p>However, complete results can take longer for searches across:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="frozen-indices.html" title="Frozen indices">Frozen indices</a>
</li>
<li class="listitem">
<a class="xref" href="modules-cross-cluster-search.html" title="Search across clusters">Multiple clusters</a>
</li>
<li class="listitem">
Many shards
</li>
</ul>
</div>
<p>To avoid long waits, you can use the EQL search API&#8217;s
<code class="literal">wait_for_completion_timeout</code> parameter to run an <em>asynchronous</em>, or <em>async</em>,
search.</p>
<p>Set the <code class="literal">wait_for_completion_timeout</code> parameter to a duration you&#8217;d like to wait
for complete search results. If the search request does not finish within this
period, the search becomes an async search. The EQL search
API returns a response that includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
A search ID, which can be used to monitor the progress of the async search and
retrieve complete results when it finishes.
</li>
<li class="listitem">
An <code class="literal">is_partial</code> value of <code class="literal">true</code>, indicating the response does not contain
complete search results.
</li>
<li class="listitem">
An <code class="literal">is_running</code> value of <code class="literal">true</code>, indicating the search is async and ongoing.
</li>
</ul>
</div>
<p>The async search continues to run in the background without blocking
other requests.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following request searches the <code class="literal">frozen_sec_logs</code> index, which has been
<a class="xref" href="frozen-indices.html" title="Frozen indices">frozen</a> for storage and is rarely searched.</p>
<p>Because searches on frozen indices are expected to take longer to complete, the
request contains a <code class="literal">wait_for_completion_timeout</code> parameter value of <code class="literal">2s</code>
(two seconds).</p>
<p>If the request does not return complete results in two seconds, the search
becomes an async search and a search ID is returned.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /frozen_sec_logs/_eql/search
{
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/345.console"></div>
<p>After two seconds, the request returns the following response. Note the
<code class="literal">is_partial</code> and <code class="literal">is_running</code> properties are <code class="literal">true</code>, indicating an ongoing async
search.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_partial": true,
  "is_running": true,
  "took": 2000,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
</div>
</details>
<p>You can use the the returned search ID and the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get
async EQL search API</a> to check the progress of an ongoing async search.</p>
<p>The get async EQL search API also accepts a <code class="literal">wait_for_completion_timeout</code> query
parameter. Set the <code class="literal">wait_for_completion_timeout</code> parameter to a duration you&#8217;d
like to wait for complete search results. If the request does not complete
during this period, the response returns an <code class="literal">is_partial</code> value of <code class="literal">true</code> and no
search results.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following get async EQL search API request checks the progress of the
previous async EQL search. The request specifies a <code class="literal">wait_for_completion_timeout</code>
query parameter value of <code class="literal">2s</code> (two seconds).</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?wait_for_completion_timeout=2s</pre>
</div>
<div class="console_widget" data-snippet="snippets/346.console"></div>
<p>The request returns the following response. Note the <code class="literal">is_partial</code> and
<code class="literal">is_running</code> properties are <code class="literal">false</code>, indicating the async EQL search has
finished and the search results in the <code class="literal">hits</code> property are complete.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=",
  "is_partial": false,
  "is_running": false,
  "took": 2000,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
</div>
</details>
<h3><a id="eql-search-store-async-eql-search"></a>Change the search retention period<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>By default, the EQL search API only stores async searches and their results for
five days. After this period, any ongoing searches or saved results are deleted.</p>
<p>You can use the EQL search API&#8217;s <code class="literal">keep_alive</code> parameter to change the duration
of this period.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>In the following EQL search API request, the <code class="literal">keep_alive</code> parameter is <code class="literal">2d</code> (two
days). This means that if the search becomes async, its results
are stored on the cluster for two days. After two days, the async
search and its results are deleted, even if it&#8217;s still ongoing.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "keep_alive": "2d",
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/347.console"></div>
</div>
</details>
<p>You can use the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL search API</a>'s
<code class="literal">keep_alive</code> query parameter to later change the retention period. The new
retention period starts after the get async EQL search API request executes.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following get async EQL search API request sets the <code class="literal">keep_alive</code> query
parameter to <code class="literal">5d</code> (five days). The async search and its results are deleted five
days after the get async EQL search API request executes.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?keep_alive=5d</pre>
</div>
<div class="console_widget" data-snippet="snippets/348.console"></div>
</div>
</details>
<p>You can use the <a class="xref" href="delete-async-eql-search-api.html" title="Delete async EQL search API">delete async EQL search API</a> to
manually delete an async EQL search before the <code class="literal">keep_alive</code> period ends. If the
search is still ongoing, this cancels the search request.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following delete async EQL search API request deletes an async EQL search
and its results.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">DELETE /_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE=?keep_alive=5d</pre>
</div>
<div class="console_widget" data-snippet="snippets/349.console"></div>
</div>
</details>
<h3><a id="eql-search-store-sync-eql-search"></a>Store synchronous EQL searches<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>By default, the EQL search API only stores async searches that cannot be
completed within the period set by the <code class="literal">wait_for_completion_timeout</code> parameter.</p>
<p>To save the results of searches that complete during this period, set the
<code class="literal">keep_on_completion</code> parameter to <code class="literal">true</code>.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>In the following EQL search API request, the <code class="literal">keep_on_completion</code> parameter is
<code class="literal">true</code>. This means the search results are stored on the cluster, even if
the search completes within the <code class="literal">2s</code> (two-second) period set by the
<code class="literal">wait_for_completion_timeout</code> parameter.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "keep_on_completion": true,
  "wait_for_completion_timeout": "2s",
  "query": """
    process where process.name == "cmd.exe"
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/350.console"></div>
<p>The API returns the following response. Note that a search ID is provided in the
<code class="literal">id</code> property. The <code class="literal">is_partial</code> and <code class="literal">is_running</code> properties are <code class="literal">false</code>,
indicating the EQL search was synchronous and returned complete search results.</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "id": "FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY=",
  "is_partial": false,
  "is_running": false,
  "took": 52,
  "timed_out": false,
  "hits": ...
}</pre>
</div>
<p>You can use the search ID and the <a class="xref" href="get-async-eql-search-api.html" title="Get async EQL search API">get async EQL
search API</a> to retrieve the same results later.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_eql/search/FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY=</pre>
</div>
<div class="console_widget" data-snippet="snippets/351.console"></div>
</div>
</details>
<p>Saved synchronous searches are still subject to the storage retention period set
by the <code class="literal">keep_alive</code> parameter. After this period, the search and its saved
results are deleted.</p>
<p>You can also manually delete saved synchronous searches using the
<a class="xref" href="delete-async-eql-search-api.html" title="Delete async EQL search API">delete async EQL search API</a>.</p>
<h3><a id="eql-search-case-sensitive"></a>Run a case-sensitive EQL search<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/7.x/docs/reference/eql/search.asciidoc">edit</a></h3>
<p>By default, matching for EQL queries is case-insensitive. You can use the EQL
search API&#8217;s <code class="literal">case_sensitive</code> parameter to toggle case sensitivity on or off.</p>
<details>
<summary class="title"><span class="strong strong"><strong>Example</strong></span></summary>
<div class="content">
<p>The following search request contains a query that matches <code class="literal">process</code> events
with a <code class="literal">process.path</code> containing <code class="literal">System32</code>.</p>
<p>Because the <code class="literal">case_sensitive</code> parameter is <code class="literal">true</code>, this query only matches
<code class="literal">process.path</code> values containing <code class="literal">System32</code> with the exact same capitalization.
A <code class="literal">process.path</code> value containing <code class="literal">system32</code> or <code class="literal">SYSTEM32</code> would not match this
query.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /sec_logs/_eql/search
{
  "keep_on_completion": true,
  "case_sensitive": true,
  "query": """
    process where stringContains(process.path, "System32")
  """
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/352.console"></div>
</div>
</details>
</div>
<div class="navfooter">
<span class="prev">
<a href="eql-requirements.html">« EQL requirements</a>
</span>
<span class="next">
<a href="eql-syntax.html">EQL syntax reference »</a>
</span>
</div>
</div>
</body>
</html>
