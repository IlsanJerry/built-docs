<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Percentile Ranks Aggregation
        | Elasticsearch Reference [1.5]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [1.5]" /><link rel="up" href="search-aggregations.html" title="Aggregations" /><link rel="prev" href="search-aggregations-metrics-percentile-aggregation.html" title="Percentiles Aggregation" /><link rel="next" href="search-aggregations-metrics-cardinality-aggregation.html" title="Cardinality Aggregation" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/1.5" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="1.5" /></head><body><div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.5]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Percentile Ranks Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-percentile-aggregation.html">
              « 
              Percentiles Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-percentile-rank-aggregation"></a>Percentile Ranks Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.5/docs/reference/search/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that calculates one or more percentile ranks
over numeric values extracted from the aggregated documents.  These values
can be extracted either from specific numeric fields in the documents, or
be generated by a provided script.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Please see <a class="xref" href="search-aggregations-metrics-percentile-aggregation.html#search-aggregations-metrics-percentile-aggregation-approximation" title="Percentiles are (usually) approximate">Percentiles are (usually) approximate</a>
and <a class="xref" href="search-aggregations-metrics-percentile-aggregation.html#search-aggregations-metrics-percentile-aggregation-compression" title="Compression">Compression</a> for advice
regarding approximation and memory use of the percentile ranks aggregation</p></div></div><p>Percentile rank show the percentage of observed values which are below certain
value.  For example, if a value is greater than or equal to 95% of the observed values
it is said to be at the 95th percentile rank.</p><p>Assume your data consists of website load times.  You may have a service agreement that
95% of page loads completely within 15ms and 99% of page loads complete within 30ms.</p><p>Let’s look at a range of percentiles representing load time:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "field" : "load_time", <a id="CO20-1"></a><i class="conum" data-value="1"></i>
                "values" : [15, 30]
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The field <code class="literal">load_time</code> must be a numeric field</p></td></tr></table></div><p>The response will look like this:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
    ...

   "aggregations": {
      "load_time_outlier": {
         "values" : {
            "15": 92,
            "30": 100
         }
      }
   }
}</pre></div><p>From this information you can determine you are hitting the 99% load time target but not quite
hitting the 95% load time target</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_9"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.5/docs/reference/search/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The percentile rank metric supports scripting.  For example, if our load times
are in milliseconds but we want to specify values in seconds, we could use
a script to convert them on-the-fly:</p><div class="pre_wrapper lang-js"><pre class="programlisting prettyprint lang-js">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "values" : [3, 5],
                "script" : "doc['load_time'].value / timeUnit", <a id="CO21-1"></a><i class="conum" data-value="1"></i>
                "params" : {
                    "timeUnit" : 1000   <a id="CO21-2"></a><i class="conum" data-value="2"></i>
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><i class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The <code class="literal">field</code> parameter is replaced with a <code class="literal">script</code> parameter, which uses the
script to generate values which percentile ranks are calculated on</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-2"><i class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Scripting supports parameterized input just like any other script</p></td></tr></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-percentile-aggregation.html">
              « 
              Percentiles Aggregation</a>
           
        </span><span class="next">
           
          <a href="search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation
               »
            </a></span></div></body></html>
