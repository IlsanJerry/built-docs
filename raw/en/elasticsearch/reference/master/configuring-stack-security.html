<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Start the Elastic Stack with security enabled | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="secure-cluster.html" title="Secure the Elastic Stack"/>
<link rel="prev" href="es-security-principles.html" title="Elasticsearch security principles"/>
<link rel="next" href="manually-configure-security.html" title="Manually configure security"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
»
<span class="breadcrumb-node">Start the Elastic Stack with security enabled</span>
</div>
<div class="navheader">
<span class="prev">
<a href="es-security-principles.html">« Elasticsearch security principles</a>
</span>
<span class="next">
<a href="manually-configure-security.html">Manually configure security »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-stack-security"></a>Start the Elastic Stack with security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>When you start Elasticsearch for the first time, the following security configuration
occurs automatically:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="configuring-stack-security.html#stack-security-certificates" title="Security certificates and keys">Certificates and keys</a> for TLS are
generated for the transport and HTTP layers.
</li>
<li class="listitem">
The TLS configuration settings are written to <code class="literal">elasticsearch.yml</code>.
</li>
<li class="listitem">
A password is generated for the <code class="literal">elastic</code> user.
</li>
<li class="listitem">
An enrollment token is generated for Kibana.
</li>
</ul>
</div>
<p>You can then start Kibana and enter the enrollment token, which is valid for 30
minutes. This token automatically applies the security settings from your Elasticsearch
cluster, authenticates to Elasticsearch with the built-in <code class="literal">kibana</code> service account, and writes the
security configuration to <code class="literal">kibana.yml</code>.</p>
<h3><a id="_prerequisites_11"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/downloads/elasticsearch#preview-release" class="ulink" target="_top">Download</a> and
unpack the <code class="literal">elasticsearch 8.0.0-beta</code> package distribution for your
environment.
</li>
<li class="listitem">
<a href="/downloads/kibana#preview-release" class="ulink" target="_top">Download</a> and unpack
the <code class="literal">kibana 8.0.0-beta</code> package distribution for your environment.
</li>
</ul>
</div>
<h3><a id="stack-start-with-security"></a>Start Elasticsearch and enroll Kibana with security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the installation directory, start Elasticsearch. A password is generated for the
<code class="literal">elastic</code> user and output to the terminal, plus an enrollment token for
enrolling Kibana.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/elasticsearch</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You might need to scroll back a bit in the terminal to view the password
and enrollment token.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Copy the generated password and enrollment token and save them in a secure
location. These values are shown only when you start Elasticsearch for the first time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you need to reset the password for the <code class="literal">elastic</code> user or other
built-in users, run the <a class="xref" href="reset-password.html" title="elasticsearch-reset-password"><code class="literal">elasticsearch-reset-password</code></a> tool.
To generate new enrollment tokens for Kibana or Elasticsearch nodes, run the
<a class="xref" href="create-enrollment-token.html" title="elasticsearch-create-enrollment-token"><code class="literal">elasticsearch-create-enrollment-token</code></a> tool.
These tools are available in the Elasticsearch <code class="literal">bin</code> directory.</p>
</div>
</div>
</li>
<li class="listitem">
<p>(Optional) Open a new terminal and verify that you can connect to your Elasticsearch
cluster by making an authenticated call. Enter the password for the <code class="literal">elastic</code>
user when prompted:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl --cacert config/tls_auto_config_&lt;timestamp&gt;/http_ca.crt \
-u elastic https://localhost:9200</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;timestamp&gt;</code>
</span>
</dt>
<dd>
The timestamp of when the auto-configuration process created
the security files directory in your Docker container.
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>From the directory where you installed Kibana, start Kibana.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">bin/kibana</pre>
</div>
<p>This command generates a unique link to enroll your Kibana instance with Elasticsearch.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
In your terminal, click the generated link to open Kibana in your browser.
</li>
<li class="listitem">
In your browser, paste the enrollment token that you copied and click the
button to connect your Kibana instance with Elasticsearch.
</li>
<li class="listitem">
Log in to Kibana as the <code class="literal">elastic</code> user with the password that was generated
when you started Elasticsearch.
</li>
</ol>
</div>
</li>
</ol>
</div>
<h3><a id="stack-enroll-nodes"></a>Enroll additional nodes in your cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="olist orderedlist exclude">
<ol class="orderedlist">
<li class="listitem">
<p>In a separate terminal from where Elasticsearch is running, navigate to the directory
where you installed Elasticsearch and run the
<a class="xref" href="create-enrollment-token.html" title="elasticsearch-create-enrollment-token"><code class="literal">elasticsearch-create-enrollment-token</code></a> tool
to generate an enrollment token for your new nodes.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/elasticsearch-create-enrollment-token -s node</pre>
</div>
<p>Copy the enrollment token, which you&#8217;ll use to enroll new nodes with
your Elasticsearch cluster.</p>
</li>
<li class="listitem">
<p>From the installation directory of your new node, start Elasticsearch and pass the
enrollment token with the <code class="literal">--enrollment-token</code> parameter.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">bin/elasticsearch --enrollment-token &lt;enrollment-token&gt;</pre>
</div>
<p>Elasticsearch automatically generates certificates and keys in the following directory:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">config/tls_auto_config_node_&lt;timestamp&gt;</pre>
</div>
</li>
<li class="listitem">
Repeat the previous step for any new nodes that you want to enroll.
</li>
</ol>
</div>
<h3><a id="_connect_clients_to_elasticsearch_6"></a>Connect clients to Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/setup/install/connect-clients.asciidoc">edit</a></h3>
<p>When you start Elasticsearch for the first time, TLS is configured automatically for the
HTTP layer. A CA certificate is generated and stored on disk, and the hex-coded
SHA-256 fingerprint of this certificate is also output to the terminal. Any
clients that connect to Elasticsearch, such as the
<a href="/guide/en/elasticsearch/client/index.html" class="ulink" target="_top">Elasticsearch Clients</a>,
Beats, Logstash, and Fleet must validate that they trust the certificate that
Elasticsearch uses for HTTPS. Clients can establish trust by using either the fingerprint
of the CA certificate or the CA certificate itself.</p>
<p>If the auto-configuration process already completed, you can still obtain the
fingerprint of the security certificate. You can also copy the CA certificate
to your machine and configure your client to use it.</p>
<h4><a id="_use_the_ca_fingerprint_6"></a>Use the CA fingerprint<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/setup/install/connect-clients.asciidoc">edit</a></h4>
<p>Copy the fingerprint value that&#8217;s output to your terminal when Elasticsearch starts, and
configure your client to use this fingerprint to establish trust when it
connects to Elasticsearch.</p>
<p>If the auto-configuration process already completed, you can still obtain the
fingerprint of the security certificate by running the following command. The
path is to the auto-generated CA certificate for the HTTP layer.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">openssl x509 -fingerprint -sha256 -in config/tls_auto_config_&lt;timestamp&gt;/http_ca.crt</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;timestamp&gt;</code>
</span>
</dt>
<dd>
The timestamp of when the auto-configuration process created the security files directory.
</dd>
</dl>
</div>
<p>The command returns the security certificate, including the fingerprint.
The <code class="literal">issuer</code> should be <code class="literal">Elasticsearch security auto-configuration HTTP CA</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">issuer= /CN=Elasticsearch security auto-configuration HTTP CA
SHA256 Fingerprint=&lt;fingerprint&gt;</pre>
</div>
<h4><a id="_use_the_ca_certificate_6"></a>Use the CA certificate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/setup/install/connect-clients.asciidoc">edit</a></h4>
<p>If your library doesn&#8217;t support a method of validating the fingerprint, the
auto-generated CA certificate is created in the
<code class="literal">config/tls_auto_config_&lt;timestamp&gt;</code> directory on each Elasticsearch node. Copy the
<code class="literal">http_ca.crt</code> file to your machine and configure your client to use this
certificate to establish trust when it connects to Elasticsearch.</p>
<h3><a id="_whats_next"></a>What&#8217;s next?<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<p>Congratulations! You&#8217;ve successfully started the Elastic Stack with security enabled.
Elasticsearch and Kibana are secured with TLS on the HTTP layer, and internode
communication is encrypted. If you want to enable HTTPS for web traffic, you
can <a class="xref" href="security-basic-setup-https.html#encrypt-kibana-browser" title="Encrypt traffic between your browser and Kibana">encrypt traffic between your browser and Kibana</a>.</p>
<h3><a id="stack-security-certificates"></a>Security certificates and keys<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<p>When you start Elasticsearch for the first time, the following certificates and keys are
generated in the <code class="literal">config/tls_auto_config_&lt;timestamp&gt;</code> directory,
which are used to connect a Kibana instance to your secured Elasticsearch cluster and
to encrypt internode communication. The files are listed here for reference.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">http_ca.crt</code>
</span>
</dt>
<dd>
The CA certificate that is used to sign the certificates for the HTTP layer of
this Elasticsearch cluster.
</dd>
<dt>
<span class="term">
<code class="literal">http_keystore_local_node.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the HTTP layer for this node.
</dd>
<dt>
<span class="term">
<code class="literal">transport_keystore_all_nodes.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the transport layer for all
the nodes in your cluster.
</dd>
</dl>
</div>
<p>Additionally, when you use the enrollment token to connect Kibana to a secured Elasticsearch cluster, a security certificate is retrieved from Elasticsearch and stored in the
Kibana <code class="literal">/data</code> directory. This file establishes trust between Kibana and the Elasticsearch
Certificate Authority (CA) for the HTTP layer.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="es-security-principles.html">« Elasticsearch security principles</a>
</span>
<span class="next">
<a href="manually-configure-security.html">Manually configure security »</a>
</span>
</div>
</div>
</body>
</html>
