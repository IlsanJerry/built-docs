<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Start the Elastic Stack with security enabled | Elasticsearch Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [master]"/>
<link rel="up" href="secure-cluster.html" title="Secure the Elastic Stack"/>
<link rel="prev" href="es-security-principles.html" title="Elasticsearch security principles"/>
<link rel="next" href="manually-configure-security.html" title="Manually configure security"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="secure-cluster.html">Secure the Elastic Stack</a></span>
»
<span class="breadcrumb-node">Start the Elastic Stack with security enabled</span>
</div>
<div class="navheader">
<span class="prev">
<a href="es-security-principles.html">« Elasticsearch security principles</a>
</span>
<span class="next">
<a href="manually-configure-security.html">Manually configure security »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="configuring-stack-security"></a>Start the Elastic Stack with security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in alpha and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Alpha features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>Before you start Elasticsearch for the first time, run the <code class="literal">elasticsearch-security-config</code>
tool. This tool generates certificates and keys for the transport and HTTP
layers of Elasticsearch, and writes the TLS configuration settings to <code class="literal">elasticsearch.yml</code>.</p>
<h3><a id="_prerequisites_10"></a>Prerequisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<p><a href="/downloads/elasticsearch#preview-release" class="ulink" target="_top">Download</a> the <code class="literal">elasticsearch 8.0.0-alpha1</code> package distribution for your
environment.</p>
<h3><a id="_start_elasticsearch_with_security_enabled"></a>Start Elasticsearch with security enabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Before starting Elasticsearch for the first time, run the
<code class="literal">elasticsearch-security-config</code> tool from the directory where you downloaded
the Elasticsearch package distribution:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-security-config</pre>
</div>
<p>The <code class="literal">elasticsearch-security-config</code> tool generates the following security
certificates and keys in <code class="literal">$ES_PATH_CONF/auto_config_on_&lt;timestamp&gt;</code>:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">http_ca.crt</code>
</span>
</dt>
<dd>
The CA certificate that is used to sign the certificates for the HTTP layer of
this Elasticsearch cluster.
</dd>
<dt>
<span class="term">
<code class="literal">http_keystore_local_node.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the HTTP layer for this node.
</dd>
<dt>
<span class="term">
<code class="literal">transport_keystore_all_nodes.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the transport layer for all the nodes in your cluster.
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">ES_PATH_CONF</code> variable is the path for the Elasticsearch
configuration files. If you installed Elasticsearch using archive distributions
(<code class="literal">zip</code> or <code class="literal">tar.gz</code>), the variable defaults to <code class="literal">ES_HOME/config</code>. If you used
package distributions (Debian or RPM), the variable defaults to
<code class="literal">/etc/elasticsearch</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Start Elasticsearch.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch</pre>
</div>
</li>
<li class="listitem">
<p>In another terminal window, run the
<a class="xref" href="setup-passwords.html" title="elasticsearch-setup-passwords"><code class="literal">elasticsearch-setup-passwords</code></a> utility from the directory
where you downloaded the Elasticsearch package distribution:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-setup-passwords auto</pre>
</div>
<p>If you want to use your own passwords, run the command with the
<code class="literal">interactive</code> parameter instead of the <code class="literal">auto</code> parameter. Using this mode
steps you through password configuration for all of the built-in users.</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/elasticsearch-setup-passwords interactive</pre>
</div>
</li>
<li class="listitem">
<p>Save the generated passwords. You&#8217;ll need them to add the built-in user to
Kibana.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>After you set a password for the <code class="literal">elastic</code> user, you cannot run the
<code class="literal">elasticsearch-setup-passwords</code> command a second time. If you forgot the
password for the <code class="literal">elastic</code> user or want to change it, use the
<a class="xref" href="reset-elastic-password.html" title="elasticsearch-reset-elastic-password"><code class="literal">elasticsearch-reset-elastic-password</code></a> tool.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Make an authenticated call to your Elasticsearch cluster and enter the password for
the <code class="literal">elastic</code> user when prompted:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">curl --cacert $ES_PATH_CONF/auto_config_on_&lt;timestamp&gt;/http_ca.crt \
-u elastic https://localhost:9200</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">--cacert</code>
</span>
</dt>
<dd>
Path to the generated <code class="literal">http_ca.crt</code> certificate for the HTTP layer.
</dd>
</dl>
</div>
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="configuring-stack-security.html#add-kib-user" title="Configure Kibana to connect to Elasticsearch with a password">Configure Kibana to connect to Elasticsearch with a password</a></p>
<h3><a id="add-kib-user"></a>Configure Kibana to connect to Elasticsearch with a password<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<p>With security enabled, users must log in to Kibana with a valid username and
password.</p>
<p>You&#8217;ll configure Kibana to use the built-in <code class="literal">kibana_system</code> user and the password
that you created earlier. Kibana performs some background tasks that require use
of the <code class="literal">kibana_system</code> user.</p>
<p>This account is not meant for individual users and does not have permission to
log in to Kibana from a browser. Instead, you&#8217;ll log in to Kibana as the <code class="literal">elastic</code>
superuser.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Add the <code class="literal">elasticsearch.username</code> setting to the <code class="literal">$KBN_PATH_CONF/kibana.yml</code>
file and set the value to the <code class="literal">kibana_system</code> user:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: "kibana_system"</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">$KBN_PATH_CONF</code> variable is the path for the Kibana
configuration files. If you installed Kibana using archive distributions
(<code class="literal">zip</code> or <code class="literal">tar.gz</code>), the variable defaults to <code class="literal">$KBN_HOME/config</code>. If you used
package distributions (Debian or RPM), the variable defaults to <code class="literal">/etc/kibana</code>.</p>
</div>
</div>
</li>
<li class="listitem">
<p>From the directory where you installed Kibana, run the following commands
to create the Kibana keystore and add the secure settings:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Create the Kibana keystore:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/kibana-keystore create</pre>
</div>
</li>
<li class="listitem">
<p>Add the password for the <code class="literal">kibana_system</code> user to the Kibana keystore:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/kibana-keystore add elasticsearch.password</pre>
</div>
<p>When prompted, enter the password for the <code class="literal">kibana_system</code> user.</p>
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Restart Kibana. For example, if you installed Kibana with a <code class="literal">.tar.gz</code> package, run the following command from the Kibana directory:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">./bin/kibana</pre>
</div>
</li>
<li class="listitem">
Log in to Kibana as the <code class="literal">elastic</code> user. Use this superuser account to
<a href="/guide/en/kibana/master/tutorial-secure-access-to-kibana.html" class="ulink" target="_top">manage spaces, create new users, and assign roles</a>. If you&#8217;re running Kibana locally, go to <code class="literal">http://localhost:5601</code> to view the login page.
</li>
</ol>
</div>
<p><span class="strong strong"><strong>Next</strong></span>: <a class="xref" href="configuring-stack-security.html#encrypt-kibana-with-elasticsearch" title="Encrypt traffic between Kibana and Elasticsearch">Encrypt traffic between Kibana and Elasticsearch</a></p>
<h3><a id="encrypt-kibana-with-elasticsearch"></a>Encrypt traffic between Kibana and Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/x-pack/docs/en/security/configuring-stack-security.asciidoc">edit</a></h3>
<p>When you ran the <code class="literal">elasticsearch-security-config</code> tool, it
created an <code class="literal">http_ca.crt</code> file in <code class="literal">$ES_PATH_CONF/auto_config_on_&lt;timestamp&gt;</code>.
Use this file to configure Kibana to trust the Elasticsearch CA for the HTTP layer.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Copy the <code class="literal">http_ca.crt</code> file to the Kibana configuration directory, as defined
by the <code class="literal">$KBN_PATH_CONF</code> path.
</li>
<li class="listitem">
<p>Open <code class="literal">kibana.yml</code> and add the following line to specify the location of the
security certificate for the HTTP layer.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.ssl.certificateAuthorities: $KBN_PATH_CONF/http_ca.crt</pre>
</div>
</li>
<li class="listitem">
<p>Add the following line to specify the HTTPS URL for your Elasticsearch
cluster.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.hosts: https://&lt;your_elasticsearch_host&gt;.com:9200</pre>
</div>
</li>
<li class="listitem">
Restart Kibana. You can now connect to Kibana securely over HTTPS, such as
<code class="literal">https://localhost:5601</code>.
</li>
</ol>
</div>
<div class="sidebar">
<div class="titlepage"><div><div>
<p class="title"><strong>Connect to a secure monitoring cluster</strong></p>
</div></div></div>
<p>If the Elastic monitoring features are enabled and you configured a separate
Elasticsearch monitoring cluster, you can also configure Kibana to connect to
the monitoring cluster via HTTPS. The steps are the same, but each setting is
prefixed by <code class="literal">monitoring</code>. For example, <code class="literal">monitoring.ui.elasticsearch.hosts</code> and
<code class="literal">monitoring.ui.elasticsearch.ssl.truststore.path</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>You must create a separate <code class="literal">elasticsearch-ca.pem</code> security file for the
monitoring cluster. Refer to
<a class="xref" href="security-basic-setup-https.html#encrypt-http-communication" title="Encrypt HTTP client communications for Elasticsearch">Encrypt HTTP client communications for Elasticsearch</a>.</p>
</div>
</div>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="es-security-principles.html">« Elasticsearch security principles</a>
</span>
<span class="next">
<a href="manually-configure-security.html">Manually configure security »</a>
</span>
</div>
</div>
</body>
</html>
