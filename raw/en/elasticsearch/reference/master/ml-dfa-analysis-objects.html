<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Analysis configuration objects | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="api-definitions.html" title="Definitions"/>
<link rel="prev" href="api-definitions.html" title="Definitions"/>
<link rel="next" href="role-mapping-resources.html" title="Role mapping resources"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span>
»
<span class="breadcrumb-link"><a href="api-definitions.html">Definitions</a></span>
»
<span class="breadcrumb-node">Analysis configuration objects</span>
</div>
<div class="navheader">
<span class="prev">
<a href="api-definitions.html">« Definitions</a>
</span>
<span class="next">
<a href="role-mapping-resources.html">Role mapping resources »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ml-dfa-analysis-objects"></a>Analysis configuration objects<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>Data frame analytics resources contain <code class="literal">analysis</code> objects. For example, when you
create a data frame analytics job, you must define the type of analysis it performs.
This page lists all the available parameters that you can use in the <code class="literal">analysis</code>
object grouped by data frame analytics types.</p>
<h4><a id="oldetection-resources"></a>Outlier detection configuration objects<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h4>
<p>An <code class="literal">outlier_detection</code> configuration object has the following properties:</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">compute_feature_influence</code>
</span>
</dt>
<dd>
(Optional, boolean)
If <code class="literal">true</code>, the feature influence calculation is enabled. Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">feature_influence_threshold</code>
</span>
</dt>
<dd>
(Optional, double)
The minimum outlier score that a document needs to have in order to calculate its
feature influence score. Value range: 0-1 (<code class="literal">0.1</code> by default).
</dd>
<dt>
<span class="term">
<code class="literal">method</code>
</span>
</dt>
<dd>
(Optional, string)
Sets the method that outlier detection uses. If the method is not set outlier detection
uses an ensemble of different methods and normalises and combines their
individual outlier scores to obtain the overall outlier score. We recommend to use the
ensemble method. Available methods are <code class="literal">lof</code>, <code class="literal">ldof</code>, <code class="literal">distance_kth_nn</code>,
<code class="literal">distance_knn</code>.
</dd>
<dt>
<span class="term">
<code class="literal">n_neighbors</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the value for how many nearest neighbors each method of
outlier detection will use to calculate its outlier score. When the value is not set,
different values will be used for different ensemble members. This helps
improve diversity in the ensemble. Therefore, only override this if you are
confident that the value you choose is appropriate for the data set.
</dd>
<dt>
<span class="term">
<code class="literal">outlier_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Sets the proportion of the data set that is assumed to be outlying prior to
outlier detection. For example, 0.05 means it is assumed that 5% of values are real
outliers and 95% are inliers.
</dd>
<dt>
<span class="term">
<code class="literal">standardization_enabled</code>
</span>
</dt>
<dd>
(Optional, boolean)
If <code class="literal">true</code>, then the following operation is performed on the columns before
computing outlier scores: (x_i - mean(x_i)) / sd(x_i). Defaults to <code class="literal">true</code>. For
more information, see
<a href="https://en.wikipedia.org/wiki/Feature_scaling#Standardization_(Z-score_Normalization)" class="ulink" target="_top">this wiki page about standardization</a>.
</dd>
</dl>
</div>
<h4><a id="reganalysis-resources"></a>Regression configuration objects<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h4>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ml/data_frame/analytics/house_price_regression_analysis
{
  "source": {
    "index": "houses_sold_last_10_yrs" <a id="CO658-1"></a><i class="conum" data-value="1"></i>
  },
  "dest": {
    "index": "house_price_predictions" <a id="CO658-2"></a><i class="conum" data-value="2"></i>
  },
  "analysis":
    {
      "regression": { <a id="CO658-3"></a><i class="conum" data-value="3"></i>
        "dependent_variable": "price" <a id="CO658-4"></a><i class="conum" data-value="4"></i>
      }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/2063.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO658-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Training data is taken from source index <code class="literal">houses_sold_last_10_yrs</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO658-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Analysis results will be output to destination index
<code class="literal">house_price_predictions</code>.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO658-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>The regression analysis configuration object.</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO658-4"><i class="conum" data-value="4"></i></a></p>
</td>
<td align="left" valign="top">
<p>Regression analysis will use field <code class="literal">price</code> to train on. As no other
parameters have been specified it will train on 100% of eligible data, store its
prediction in destination index field <code class="literal">price_prediction</code> and use in-built
hyperparameter optimization to give minimum validation errors.</p>
</td>
</tr>
</table>
</div>
<h5><a id="regression-resources-standard"></a>Standard parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h5>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">dependent_variable</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Defines which field of the document is to be predicted.
This parameter is supplied by field name and must match one of the fields in
the index being used to train. If this field is missing from a document, then
that document will not be used for training, but a prediction with the trained
model will be generated for it. It is also known as continuous target variable.
</p>
<p>The data type of the field must be numeric.</p>
</dd>
<dt>
<span class="term">
<code class="literal">prediction_field_name</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the name of the prediction field in the results.
Defaults to <code class="literal">&lt;dependent_variable&gt;_prediction</code>.
</dd>
<dt>
<span class="term">
<code class="literal">training_percent</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines what percentage of the eligible documents that will
be used for training. Documents that are ignored by the analysis (for example
those that contain arrays) won’t be included in the calculation for used
percentage. Defaults to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">randomize_seed</code>
</span>
</dt>
<dd>
(Optional, long)
Defines the seed to the random generator that is used to pick which documents
will be used for training. By default it is randomly generated. Set it to a
specific value to ensure the same documents are used for training assuming other
related parameters (for example, <code class="literal">source</code>, <code class="literal">analyzed_fields</code>, etc.) are the
same.
</dd>
</dl>
</div>
<h5><a id="regression-resources-advanced"></a>Advanced parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h5>
<p>Advanced parameters are for fine-tuning regression analysis. They are set
automatically by <a class="xref" href="ml-dfa-analysis-objects.html#ml-hyperparam-optimization" title="Hyperparameter optimization">hyperparameter optimization</a>
to give minimum validation error. It is highly recommended to use the default
values unless you fully understand the function of these parameters. If these
parameters are not supplied, their values are automatically tuned to give
minimum validation error.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">eta</code>
</span>
</dt>
<dd>
(Optional, double)
The shrinkage applied to the weights. Smaller values result
in larger forests which have better generalization error. However, the smaller
the value the longer the training will take. For more information, see
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Shrinkage" class="ulink" target="_top">this wiki article</a>
about shrinkage.
</dd>
<dt>
<span class="term">
<code class="literal">feature_bag_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Defines the fraction of features that will be used when
selecting a random bag for each candidate split.
</dd>
<dt>
<span class="term">
<code class="literal">maximum_number_trees</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the maximum number of trees the forest is allowed
to contain. The maximum value is 2000.
</dd>
<dt>
<span class="term">
<code class="literal">gamma</code>
</span>
</dt>
<dd>
(Optional, double)
Regularization parameter to prevent overfitting on the
training dataset. Multiplies a linear penalty associated with the size of
individual trees in the forest. The higher the value the more training will
prefer smaller trees. The smaller this parameter the larger individual trees
will be and the longer train will take.
</dd>
<dt>
<span class="term">
<code class="literal">lambda</code>
</span>
</dt>
<dd>
(Optional, double)
Regularization parameter to prevent overfitting on the
training dataset. Multiplies an L2 regularisation term which applies to leaf
weights of the individual trees in the forest. The higher the value the more
training will attempt to keep leaf weights small. This makes the prediction
function smoother at the expense of potentially not being able to capture
relevant relationships between the features and the dependent variable. The smaller this
parameter the larger individual trees will be and the longer train will take.
</dd>
</dl>
</div>
<h4><a id="classanalysis-resources"></a>Classification configuration objects<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h4>
<h5><a id="classification-resources-standard"></a>Standard parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h5>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">dependent_variable</code>
</span>
</dt>
<dd>
<p>
(Required, string)
Defines which field of the document is to be predicted.
This parameter is supplied by field name and must match one of the fields in
the index being used to train. If this field is missing from a document, then
that document will not be used for training, but a prediction with the trained
model will be generated for it. It is also known as continuous target variable.
</p>
<p>The data type of the field must be numeric (<code class="literal">integer</code>, <code class="literal">short</code>, <code class="literal">long</code>, <code class="literal">byte</code>),
categorical (<code class="literal">ip</code>, <code class="literal">keyword</code>, <code class="literal">text</code>), or boolean.</p>
</dd>
<dt>
<span class="term">
<code class="literal">num_top_classes</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the number of categories for which the predicted
probabilities are reported. It must be non-negative. If it is greater than the
total number of categories (in the 8.0.0 version of the Elastic Stack, it&#8217;s two)
to predict then we will report all category probabilities. Defaults to 2.
</dd>
<dt>
<span class="term">
<code class="literal">prediction_field_name</code>
</span>
</dt>
<dd>
(Optional, string)
Defines the name of the prediction field in the results.
Defaults to <code class="literal">&lt;dependent_variable&gt;_prediction</code>.
</dd>
<dt>
<span class="term">
<code class="literal">training_percent</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines what percentage of the eligible documents that will
be used for training. Documents that are ignored by the analysis (for example
those that contain arrays) won’t be included in the calculation for used
percentage. Defaults to <code class="literal">100</code>.
</dd>
<dt>
<span class="term">
<code class="literal">randomize_seed</code>
</span>
</dt>
<dd>
(Optional, long)
Defines the seed to the random generator that is used to pick which documents
will be used for training. By default it is randomly generated. Set it to a
specific value to ensure the same documents are used for training assuming other
related parameters (for example, <code class="literal">source</code>, <code class="literal">analyzed_fields</code>, etc.) are the
same.
</dd>
</dl>
</div>
<h5><a id="classification-resources-advanced"></a>Advanced parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h5>
<p>Advanced parameters are for fine-tuning classification analysis. They are set
automatically by <a class="xref" href="ml-dfa-analysis-objects.html#ml-hyperparam-optimization" title="Hyperparameter optimization">hyperparameter optimization</a>
to give minimum validation error. It is highly recommended to use the default
values unless you fully understand the function of these parameters. If these
parameters are not supplied, their values are automatically tuned to give
minimum validation error.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">eta</code>
</span>
</dt>
<dd>
(Optional, double)
The shrinkage applied to the weights. Smaller values result
in larger forests which have better generalization error. However, the smaller
the value the longer the training will take. For more information, see
<a href="https://en.wikipedia.org/wiki/Gradient_boosting#Shrinkage" class="ulink" target="_top">this wiki article</a>
about shrinkage.
</dd>
<dt>
<span class="term">
<code class="literal">feature_bag_fraction</code>
</span>
</dt>
<dd>
(Optional, double)
Defines the fraction of features that will be used when
selecting a random bag for each candidate split.
</dd>
<dt>
<span class="term">
<code class="literal">maximum_number_trees</code>
</span>
</dt>
<dd>
(Optional, integer)
Defines the maximum number of trees the forest is allowed
to contain. The maximum value is 2000.
</dd>
<dt>
<span class="term">
<code class="literal">gamma</code>
</span>
</dt>
<dd>
(Optional, double)
Regularization parameter to prevent overfitting on the
training dataset. Multiplies a linear penalty associated with the size of
individual trees in the forest. The higher the value the more training will
prefer smaller trees. The smaller this parameter the larger individual trees
will be and the longer train will take.
</dd>
<dt>
<span class="term">
<code class="literal">lambda</code>
</span>
</dt>
<dd>
(Optional, double)
Regularization parameter to prevent overfitting on the
training dataset. Multiplies an L2 regularisation term which applies to leaf
weights of the individual trees in the forest. The higher the value the more
training will attempt to keep leaf weights small. This makes the prediction
function smoother at the expense of potentially not being able to capture
relevant relationships between the features and the dependent variable. The smaller this
parameter the larger individual trees will be and the longer train will take.
</dd>
</dl>
</div>
<h4><a id="ml-hyperparam-optimization"></a>Hyperparameter optimization<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ml/df-analytics/apis/analysisobjects.asciidoc">edit</a></h4>
<p>If you don&#8217;t supply regression or classification parameters, hyperparameter
optimization will be performed by default to set a value for the undefined
parameters. The starting point is calculated for data dependent parameters by
examining the loss on the training data. Subject to the size constraint, this
operation provides an upper bound on the improvement in validation loss.</p>
<p>A fixed number of rounds is used for optimization which depends on the number of
parameters being optimized. The optimization starts with random search, then
Bayesian optimization is performed that is targeting maximum expected
improvement. If you override any parameters, then the optimization will
calculate the value of the remaining parameters accordingly and use the value
you provided for the overridden parameter. The number of rounds are reduced
respectively. The validation error is estimated in each round by using 4-fold
cross validation.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="api-definitions.html">« Definitions</a>
</span>
<span class="next">
<a href="role-mapping-resources.html">Role mapping resources »</a>
</span>
</div>
</div>
</body>
</html>
