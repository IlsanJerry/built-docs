<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Allocate | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="ilm-actions.html" title="Index lifecycle actions"/>
<link rel="prev" href="ilm-actions.html" title="Index lifecycle actions"/>
<link rel="next" href="ilm-delete.html" title="Delete"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="index-lifecycle-management.html">ILM: Manage the index lifecycle</a></span>
»
<span class="breadcrumb-link"><a href="ilm-actions.html">Index lifecycle actions</a></span>
»
<span class="breadcrumb-node">Allocate</span>
</div>
<div class="navheader">
<span class="prev">
<a href="ilm-actions.html">« Index lifecycle actions</a>
</span>
<span class="next">
<a href="ilm-delete.html">Delete »</a>
</span>
</div>
<div class="section xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="ilm-allocate"></a>Allocate<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/actions/ilm-allocate.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<p>Phases allowed: warm, cold.</p>
<p>Specifies which nodes are allowed to host the
shards of an index and set the number of replicas.</p>
<p>Behind the scenes, the allocate action modifies the index settings
for shard filtering and/or replica counts. When updating the number of replicas,
configuring allocation rules is optional. When configuring allocation rules,
setting number of replicas is optional. Although this action can be treated as
two separate index settings updates, both can be configured at once.</p>
<p>For more information about how Elasticsearch uses replicas for scaling, see
<a class="xref" href="scalability.html" title="Scalability and resilience: clusters, nodes, and shards"><em>Scalability and resilience</em></a>. See <a class="xref" href="shard-allocation-filtering.html" title="Index-level shard allocation filtering">Index-level shard allocation filtering</a> for more information about
controlling where Elasticsearch allocates shards of a particular index.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The allocate action is not allowed in the hot phase,
so the initial allocation for the index should be done manually or via index templates.
ILM won&#8217;t take care of index allocation during the <code class="literal">hot</code> phase.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ilm-allocate-options"></a>Allocate options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/actions/ilm-allocate.asciidoc">edit</a></h3>
</div></div></div>
<p>You must either specify the number of replicas or at least one
<code class="literal">include</code>, <code class="literal">exclude</code>, or <code class="literal">require</code> option.
An empty allocate action is invalid.</p>
<p>For more information about using custom attributes for shard allocation,
see <a class="xref" href="shard-allocation-filtering.html" title="Index-level shard allocation filtering">Index-level shard allocation filtering</a>.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">number_of_replicas</code>
</span>
</dt>
<dd>
(Optional, integer)
Number of replicas to assign to the index.
</dd>
<dt>
<span class="term">
<code class="literal">include</code>
</span>
</dt>
<dd>
(Optional, object)
Assigns an index to nodes that have at least <em>one</em> of the specified custom attributes.
</dd>
<dt>
<span class="term">
<code class="literal">exclude</code>
</span>
</dt>
<dd>
(Optional, object)
Assigns an index to nodes that have <em>none</em> of the specified custom attributes.
</dd>
<dt>
<span class="term">
<code class="literal">require</code>
</span>
</dt>
<dd>
(Optional, object)
Assigns an index to nodes that have <em>all</em> of the specified custom attributes.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="ilm-allocate-examples"></a>Examples<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/actions/ilm-allocate.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ilm-allocate-change-replicas"></a>Change number of replicas<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/actions/ilm-allocate.asciidoc">edit</a></h4>
</div></div></div>
<p>The allocate action in the following policy changes the index&#8217;s number of replicas to <code class="literal">2</code>.
Allocation rules are unchanged.</p>
<a id="1116c769f39f0c7fe86ec2a4871efcd5"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "allocate" : {
            "number_of_replicas" : 2
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1019.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ilm-allocate-assign-index-attribute"></a>Assign index to nodes using a custom attribute<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/actions/ilm-allocate.asciidoc">edit</a></h4>
</div></div></div>
<p>The allocate action in the following policy assigns the index to nodes
that have a <code class="literal">box_type</code> of <em>hot</em> or <em>warm</em>.</p>
<p>To designate a node&#8217;s <em>box_type</em>, you set a custom attribute in the node configuration.
For example, set <code class="literal">node.attr.box_type: hot</code> in <code class="literal">elasticsearch.yml</code>.
For more information, see <a class="xref" href="shard-allocation-filtering.html#index-allocation-filters" title="Enabling index-level shard allocation filtering">Enabling index-level shard allocation filtering</a>.</p>
<a id="0518c673094fb18ecb491a3b78af4695"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "allocate" : {
            "include" : {
              "box_type": "hot,warm"
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1020.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="ilm-allocate-assign-index-node"></a>Assign index to a specific node and update replica settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/ilm/actions/ilm-allocate.asciidoc">edit</a></h4>
</div></div></div>
<p>The allocate action in the following policy updates the index to have one replica per shard
and be allocated to nodes that have a <code class="literal">box_type</code> of <em>cold</em>.</p>
<p>To designate a node&#8217;s <em>box_type</em>, you set a custom attribute in the node configuration.
For example, set <code class="literal">node.attr.box_type: hot</code> in <code class="literal">elasticsearch.yml</code>.
For more information, see <a class="xref" href="shard-allocation-filtering.html#index-allocation-filters" title="Enabling index-level shard allocation filtering">Enabling index-level shard allocation filtering</a>.</p>
<a id="9d461ae140ddc018efd2650559800cd1"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT _ilm/policy/my_policy
{
  "policy": {
    "phases": {
      "warm": {
        "actions": {
          "allocate" : {
            "number_of_replicas": 1,
            "require" : {
              "box_type": "cold"
            }
        }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/1021.console"></div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="ilm-actions.html">« Index lifecycle actions</a>
</span>
<span class="next">
<a href="ilm-delete.html">Delete »</a>
</span>
</div>
</div>
</body>
</html>
