<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Breaking changes in 8.0 | Elasticsearch Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Reference [master]"/>
<link rel="up" href="breaking-changes.html" title="Breaking changes"/>
<link rel="prev" href="breaking-changes.html" title="Breaking changes"/>
<link rel="next" href="es-release-notes.html" title="Release notes"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span>
»
<span class="breadcrumb-node">Breaking changes in 8.0</span>
</div>
<div class="navheader">
<span class="prev">
<a href="breaking-changes.html">« Breaking changes</a>
</span>
<span class="next">
<a href="es-release-notes.html">Release notes »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="breaking-changes-8.0"></a>Breaking changes in 8.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0.asciidoc">edit</a></h2>
</div></div></div>

<p>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 8.0.</p>
<p>See also <a class="xref" href="release-highlights.html" title="Release highlights">Release highlights</a> and <a class="xref" href="es-release-notes.html" title="Release notes">Release notes</a>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Coming in 8.0.0.</p>
</div>
</div>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_aggregations_changes" title="Aggregations changes">Aggregations changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_allocation_changes" title="Allocation changes">Allocation changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_analysis_changes" title="Analysis changes">Analysis changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_breaker_changes" title="Packaging changes">Packaging changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_cluster_changes" title="Cluster changes">Cluster changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_discovery_changes" title="Discovery changes">Discovery changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_http_changes" title="HTTP changes">HTTP changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_ilm_changes" title="Index Lifecycle Management changes">Index Lifecycle Management changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_indices_changes" title="Indices changes">Indices changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_java_changes" title="Java API changes">Java API changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_mappings_changes" title="Mapping changes">Mapping changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_network_changes" title="Network changes">Network changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_node_changes" title="Node changes">Node changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_packaging_changes" title="Packaging changes">Packaging changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_reindex_changes" title="Reindex changes">Reindex changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_api_changes" title="REST API changes">REST API changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_rollup_changes" title="Rollup changes">Rollup changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_search_changes" title="Search Changes">Search Changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_security_changes" title="Security changes">Security changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_settings_changes" title="Settings changes">Settings changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_snapshots_changes" title="Snapshot and Restore changes">Snapshot and Restore changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_threadpool_changes" title="Thread pool changes">Thread pool changes</a>
</li>
<li class="listitem">
<a class="xref" href="breaking-changes-8.0.html#breaking_80_transport_changes" title="Transport changes">Transport changes</a>
</li>
</ul>
</div>
<h4><a id="_indices_created_before_7_0"></a>Indices created before 7.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0.asciidoc">edit</a></h4>
<p>Elasticsearch 8.0 can read indices created in version 7.0 or above.  An
Elasticsearch 8.0 node will not start in the presence of indices created in a
version of Elasticsearch before 7.0.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Reindex indices from Elasticsearch 6.x or before</h3>
<p>Indices created in Elasticsearch 6.x or before will need to be reindexed with
Elasticsearch 7.x in order to be readable by Elasticsearch 8.x.</p>
</div>
</div>
<h4><a id="_rest_endpoints_containing_xpack"></a>REST endpoints containing <code class="literal">_xpack</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0.asciidoc">edit</a></h4>
<p>In 7.0, we deprecated REST endpoints that contain <code class="literal">_xpack</code> in their path. These
endpoints are now removed in 8.0. Each endpoint that was deprecated and removed
is replaced with a new endpoint that does not contain <code class="literal">_xpack</code>. As an example,
<code class="literal">/{index}/_xpack/graph/_explore</code> is replaced by <code class="literal">/{index}/_graph/explore</code>.</p>
<h3><a id="breaking_80_aggregations_changes"></a>Aggregations changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/aggregations.asciidoc">edit</a></h3>
<h4><a id="percentile-duplication"></a>Duplicate values no longer supported in percentiles aggregation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/aggregations.asciidoc">edit</a></h4>
<p>If you specify the <code class="literal">percents</code> parameter with the
<a href="/guide/en/elasticsearch/reference/master/search-aggregations-metrics-percentile-aggregation.html" class="ulink" target="_top">percentiles aggregation</a>,
its values must be unique. Otherwise, an exception occurs.</p>
<h3><a id="breaking_80_allocation_changes"></a>Allocation changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/allocation.asciidoc">edit</a></h3>
<h4><a id="breaking_80_allocation_change_flood_stage_block_always_removed"></a>Auto-release flood-stage block no longer optional<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/allocation.asciidoc">edit</a></h4>
<p>If a node exceeds the flood-stage disk watermark then we add a block to all of
its indices to prevent further writes as a last-ditch attempt to prevent the
node completely exhausting its disk space. By default, from 7.4 onwards the
block is automatically removed when a node drops below the high watermark
again, but this behaviour could be disabled by setting the system property
<code class="literal">es.disk.auto_release_flood_stage_block</code> to <code class="literal">false</code>. This behaviour is no
longer optional, and this system property must now not be set.</p>
<h4><a id="breaking_80_allocation_change_include_relocations_removed"></a>Accounting for disk usage of relocating shards no longer optional<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/allocation.asciidoc">edit</a></h4>
<p>By default Elasticsearch will account for the sizes of relocating shards when making
allocation decisions based on the disk usage of the nodes in the cluster. In
earlier versions the <code class="literal">cluster.routing.allocation.disk.include_relocations</code>
setting allowed this accounting to be disabled, which would result in poor
allocation decisions that might overshoot watermarks and require significant
extra work to correct. This behaviour is no longer optional, and this setting
has been removed.</p>
<h3><a id="breaking_80_analysis_changes"></a>Analysis changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/analysis.asciidoc">edit</a></h3>
<h4><a id="ngram-edgengram-filter-names-removed"></a>The <code class="literal">nGram</code> and <code class="literal">edgeNGram</code> token filter names have been removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/analysis.asciidoc">edit</a></h4>
<p>The <code class="literal">nGram</code> and <code class="literal">edgeNGram</code> token filter names that have been deprecated since
version 6.4 have been removed. Both token filters can only be used by their
alternative names <code class="literal">ngram</code> and <code class="literal">edge_ngram</code> since version 7.0.</p>
<h4><a id="nGram-edgeNGram-tokenizer-dreprecation"></a>Disallow use of the <code class="literal">nGram</code> and <code class="literal">edgeNGram</code> tokenizer names<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/analysis.asciidoc">edit</a></h4>
<p>The <code class="literal">nGram</code> and <code class="literal">edgeNGram</code> tokenizer names haven been deprecated with 7.6 and are no longer
supported on new indices. Mappings for indices created after 7.6 will continue to work but
emit a deprecation warning. The tokenizer name should be changed to the fully equivalent
<code class="literal">ngram</code> or <code class="literal">edge_ngram</code> names for new indices and in index templates.</p>
<h3><a id="breaking_80_breaker_changes"></a>Packaging changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/breaker.asciidoc">edit</a></h3>
<h4><a id="_in_flight_request_circuit_breaker"></a>In Flight Request Circuit Breaker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/breaker.asciidoc">edit</a></h4>
<p>The name of the in flight requests circuit breaker in log output and diagnostic APIs (such as the node stats API) changes from <code class="literal">in_flight_requests</code> to <code class="literal">inflight_requests</code> to align it with the name of the corresponding settings.</p>
<h3><a id="breaking_80_cluster_changes"></a>Cluster changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/cluster.asciidoc">edit</a></h3>
<h4><a id="_change_to_api_to_add_voting_configuration_exclusions"></a>Change to API to add voting configuration exclusions<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/cluster.asciidoc">edit</a></h4>
<p>The <code class="literal">POST /_cluster/voting_config_exclusions/{node_filter}</code> API has been
removed in favour of <code class="literal">POST /_cluster/voting_config_exclusions?node_names=...</code>
and <code class="literal">POST /_cluster/voting_config_exclusions?node_ids=...</code> which allow you to
specify the names or IDs of the nodes to exclude.</p>
<h3><a id="breaking_80_discovery_changes"></a>Discovery changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/discovery.asciidoc">edit</a></h3>
<h4><a id="_removal_of_old_discovery_settings"></a>Removal of old discovery settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/discovery.asciidoc">edit</a></h4>
<p>All settings under the <code class="literal">discovery.zen</code> namespace, which existed only for BWC reasons in 7.x,
are no longer supported. In particular, this includes:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">discovery.zen.no_master_block</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.hosts_provider</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.publish_timeout</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.commit_timeout</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.publish_diff.enable</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.ping.unicast.concurrent_connects</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.ping.unicast.hosts.resolve_timeout</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.ping.unicast.hosts</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.unsafe_rolling_upgrades_enabled</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.commit_timeout</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.fd.connect_on_network_disconnect</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.fd.ping_interval</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.fd.ping_timeout</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.fd.ping_retries</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.fd.register_connection_listener</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.join_retry_attempts</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.join_retry_delay</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.max_pings_from_another_master</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.send_leave_request</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.master_election.wait_for_joins_timeout</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.master_election.ignore_non_master_pings</code>
</li>
<li class="listitem">
<code class="literal">discovery.zen.publish.max_pending_cluster_states</code>
</li>
</ul>
</div>
<h3><a id="breaking_80_http_changes"></a>HTTP changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/http.asciidoc">edit</a></h3>
<h4><a id="_removal_of_old_http_settings"></a>Removal of old HTTP settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/http.asciidoc">edit</a></h4>
<p>The <code class="literal">http.tcp_no_delay</code> setting was deprecated in 7.x and has been removed in 8.0. It has been replaced by
<code class="literal">http.tcp.no_delay</code>.</p>
<h4><a id="_changes_to_encoding_plus_signs_in_urls"></a>Changes to Encoding Plus Signs in URLs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/http.asciidoc">edit</a></h4>
<p>Starting in version 7.4, a <code class="literal">+</code> in a URL will be encoded as <code class="literal">%2B</code> by all REST API functionality. Prior versions handled a <code class="literal">+</code> as a single space.
If your application requires handling <code class="literal">+</code> as a single space you can return to the old behaviour by setting the system property
<code class="literal">es.rest.url_plus_as_space</code> to <code class="literal">true</code>. Note that this behaviour is deprecated and setting this system property to <code class="literal">true</code> will cease
to be supported in version 8.</p>
<h3><a id="breaking_80_ilm_changes"></a>Index Lifecycle Management changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/ilm.asciidoc">edit</a></h3>
<h4><a id="ilm-poll-interval-limit"></a><code class="literal">indices.lifecycle.poll_interval</code> must be greater than 1 second<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/ilm.asciidoc">edit</a></h4>
<p>The setting <code class="literal">indices.lifecycle.poll_interval</code>, if set too low, can cause
excessive load on a cluster. This setting must now be set to 1 second or higher.</p>
<h4><a id="ilm-hlrc-rename"></a><code class="literal">indexlifecycle</code> packages renamed to <code class="literal">ilm</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/ilm.asciidoc">edit</a></h4>
<p>In the high level REST client, the <code class="literal">indexlifecycle</code> package has been
renamed to <code class="literal">ilm</code> to match the package rename inside the Elasticsearch code.</p>
<h3><a id="breaking_80_indices_changes"></a>Indices changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h3>
<h4><a id="_force_merge_api_changes"></a>Force Merge API changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h4>
<p>Previously, the Force Merge API allowed the parameters <code class="literal">only_expunge_deletes</code>
and <code class="literal">max_num_segments</code> to be set to a non default value at the same time. But
the <code class="literal">max_num_segments</code> was silently ignored when <code class="literal">only_expunge_deletes</code> is set
to <code class="literal">true</code>, leaving the false impression that it has been applied.</p>
<p>The Force Merge API now rejects requests that have a <code class="literal">max_num_segments</code> greater
than or equal to 0 when the <code class="literal">only_expunge_deletes</code> is set to true.</p>
<h4><a id="_on_disk_term_dictionary_cannot_be_disabled"></a>On-disk term dictionary cannot be disabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h4>
<p>The <code class="literal">index.force_memory_term_dictionary</code> setting was introduced in 7.0 as a
temporary measure to allow users to opt-out of the optimization that leaves the
term dictionary on disk when appropriate. This optimization is now mandatory
and the setting is removed.</p>
<h4><a id="_remove_support_for_template_in_put_index_template_requests"></a>Remove support for <code class="literal">template</code> in put index template requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h4>
<p>In 6.0, we deprecated the <code class="literal">template</code> field in put index template requests
in favor of using <code class="literal">index_patterns</code>. Support for the <code class="literal">template</code> field is now
removed in 8.0.</p>
<h4><a id="_remove_synced_flush"></a>Remove synced flush<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h4>
<p>Synced flush was deprecated in 7.6 and is removed in 8.0. Use a regular flush
instead as it has the same effect as a synced flush in 7.6 and later.</p>
<h4><a id="_indices_with_soft_deletes_disabled"></a>Indices with soft deletes disabled<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h4>
<p>Creating indices with soft deletes disabled was deprecated in 7.6 and
is no longer supported in 8.0. The setting index.soft_deletes.enabled
can no longer be set to false. As the setting defaults to true, simply
leave the setting unset.</p>
<h4><a id="_translog_retention_settings_are_no_longer_supported"></a>Translog retention settings are no longer supported<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/indices.asciidoc">edit</a></h4>
<p>Translog retention settings <code class="literal">index.translog.retention.size</code> and
<code class="literal">index.translog.retention.age</code> were effectively ignored in 7.4,
deprecated in 7.7, and removed in 8.0 in favor of
<a class="xref" href="index-modules-history-retention.html" title="History retention">soft deletes</a>.</p>
<h3><a id="breaking_80_java_changes"></a>Java API changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/java.asciidoc">edit</a></h3>
<h4><a id="_changes_to_fuzziness"></a>Changes to Fuzziness<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/java.asciidoc">edit</a></h4>
<p>To create <code class="literal">Fuzziness</code> instances, use the <code class="literal">fromString</code> and <code class="literal">fromEdits</code> method
instead of the <code class="literal">build</code> method that used to accept both Strings and numeric
values. Several fuzziness setters on query builders (e.g.
MatchQueryBuilder#fuzziness) now accept only a `Fuzziness`instance instead of
an Object. You should preferably use the available constants (e.g.
Fuzziness.ONE, Fuzziness.AUTO) or build your own instance using the above
mentioned factory methods.</p>
<p>Fuzziness used to be lenient when it comes to parsing arbitrary numeric values
while silently truncating them to one of the three allowed edit distances 0, 1
or 2. This leniency is now removed and the class will throw errors when trying
to construct an instance with another value (e.g. floats like 1.3 used to get
accepted but truncated to 1). You should use one of the allowed values.</p>
<h4><a id="_changes_to_repository"></a>Changes to Repository<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/java.asciidoc">edit</a></h4>
<p>Repository has no dependency on IndexShard anymore. The contract of restoreShard
and snapshotShard has been reduced to Store and MappingService in order to improve
testability.</p>
<h3><a id="breaking_80_mappings_changes"></a>Mapping changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/mappings.asciidoc">edit</a></h3>
<h4><a id="_limiting_the_number_of_completion_contexts"></a>Limiting the number of completion contexts<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/mappings.asciidoc">edit</a></h4>
<p>The number of completion contexts within a single completion field
has been limited to 10.</p>
<h4><a id="_removal_of_types"></a>Removal of types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/mappings.asciidoc">edit</a></h4>
<p>The typed REST endpoints of the Put Mapping, Get Mapping and Get Field mapping
APIs have been removed in favour of their typeless REST endpoints, since indexes
no longer contain types, these typed endpoints are obsolete.</p>
<h4><a id="_defining_multi_fields_within_multi_fields"></a>Defining multi-fields within multi-fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/mappings.asciidoc">edit</a></h4>
<p>Previously, it was possible to define a multi-field within a multi-field.
Defining chained multi-fields was deprecated in 7.3 and is now no longer
supported. To migrate the mappings, all instances of <code class="literal">fields</code> that occur within
a <code class="literal">fields</code> block should be removed, either by flattening the chained <code class="literal">fields</code>
blocks into a single level, or by switching to <code class="literal">copy_to</code> if appropriate.</p>
<h4><a id="fieldnames-enabling"></a>Disallow use of the <code class="literal">enabled</code> setting on the  <code class="literal">_field_names</code> field<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/mappings.asciidoc">edit</a></h4>
<p>The setting has been deprecated with 7.5 and is no longer supported on new indices.
Mappings for older indices will continue to work but emit a deprecation warning.
The <code class="literal">enabled</code> setting for <code class="literal">_field_names</code> should be removed from templates and mappings.
Disabling _field_names is not necessary because it no longer carries a large index overhead.</p>
<h3><a id="breaking_80_network_changes"></a>Network changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/network.asciidoc">edit</a></h3>
<h4><a id="_removal_of_old_network_settings"></a>Removal of old network settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/network.asciidoc">edit</a></h4>
<p>The <code class="literal">network.tcp.connect_timeout</code> setting was deprecated in 7.x and has been removed in 8.0. This setting
was a fallback setting for <code class="literal">transport.connect_timeout</code>. To change the default connection timeout for client
connections <code class="literal">transport.connect_timeout</code> should be modified.</p>
<h3><a id="breaking_80_node_changes"></a>Node changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/node.asciidoc">edit</a></h3>
<h4><a id="_removal_of_node_max_local_storage_nodes_setting"></a>Removal of <code class="literal">node.max_local_storage_nodes</code> setting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/node.asciidoc">edit</a></h4>
<p>The <code class="literal">node.max_local_storage_nodes</code> setting was deprecated in 7.x and
has been removed in 8.0. Nodes should be run on separate data paths
to ensure that each node is consistently assigned to the same data path.</p>
<h4><a id="_change_of_data_folder_layout"></a>Change of data folder layout<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/node.asciidoc">edit</a></h4>
<p>Each node&#8217;s data is now stored directly in the data directory set by the
<code class="literal">path.data</code> setting, rather than in <code class="literal">${path.data}/nodes/0</code>, because the removal
of the <code class="literal">node.max_local_storage_nodes</code> setting means that nodes may no longer
share a data path. At startup, Elasticsearch will automatically migrate the data
path to the new layout. This automatic migration will not proceed if the data
path contains data for more than one node. You should move to a configuration in
which each node has its own data path before upgrading.</p>
<p>If you try to upgrade a configuration in which there is data for more than one
node in a data path then the automatic migration will fail and Elasticsearch
will refuse to start. To resolve this you will need to perform the migration
manually. The data for the extra nodes are stored in folders named
<code class="literal">${path.data}/nodes/1</code>, <code class="literal">${path.data}/nodes/2</code> and so on, and you should move
each of these folders to an appropriate location and then configure the
corresponding node to use this location for its data path. If your nodes each
have more than one data path in their <code class="literal">path.data</code> settings then you should move
all the corresponding subfolders in parallel. Each node uses the same subfolder
(e.g. <code class="literal">nodes/2</code>) across all its data paths.</p>
<h4><a id="_rejection_of_ancient_closed_indices"></a>Rejection of ancient closed indices<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/node.asciidoc">edit</a></h4>
<p>In earlier versions a node would start up even if it had data from indices
created in a version before the previous major version, as long as those
indices were closed. Elasticsearch now ensures that it is compatible with every index,
open or closed, at startup time.</p>
<h3><a id="breaking_80_packaging_changes"></a>Packaging changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/packaging.asciidoc">edit</a></h3>
<h4><a id="_java_11_is_required"></a>Java 11 is required<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/packaging.asciidoc">edit</a></h4>
<p>Java 11 or higher is now required to run Elasticsearch and any of its command
line tools.</p>
<h3><a id="breaking_80_reindex_changes"></a>Reindex changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/reindex.asciidoc">edit</a></h3>
<p>Reindex from remote would previously allow URL encoded index-names and not
re-encode them when generating the search request for the remote host. This
leniency has been removed such that all index-names are correctly encoded when
reindex generates remote search requests.</p>
<p>Instead, please specify the index-name without any encoding.</p>
<h4><a id="_removal_of_types_2"></a>Removal of types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/reindex.asciidoc">edit</a></h4>
<p>The <code class="literal">/{index}/{type}/_delete_by_query</code> and <code class="literal">/{index}/{type}/_update_by_query</code> REST endpoints have been removed in favour of <code class="literal">/{index}/_delete_by_query</code> and <code class="literal">/{index}/_update_by_query</code>, since indexes no longer contain types, these typed endpoints are obsolete.</p>
<h4><a id="_removal_of_size_parameter"></a>Removal of size parameter<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/reindex.asciidoc">edit</a></h4>
<p>Previously, a <code class="literal">_reindex</code> request had two different size specifications in the body:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Outer level, determining the maximum number of documents to process
</li>
<li class="listitem">
Inside the <code class="literal">source</code> element, determining the scroll/batch size.
</li>
</ul>
</div>
<p>The outer level <code class="literal">size</code> parameter has now been renamed to <code class="literal">max_docs</code> to
avoid confusion and clarify its semantics.</p>
<p>Similarly, the <code class="literal">size</code> parameter has been renamed to <code class="literal">max_docs</code> for
<code class="literal">_delete_by_query</code> and <code class="literal">_update_by_query</code> to keep the 3 interfaces consistent.</p>
<h3><a id="breaking_80_api_changes"></a>REST API changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/api.asciidoc">edit</a></h3>
<h4><a id="_deprecated_local_parameter_removed_from_get_catnodes_api"></a>Deprecated <code class="literal">?local</code> parameter removed from <code class="literal">GET _cat/nodes</code> API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/api.asciidoc">edit</a></h4>
<p>The <code class="literal">?local</code> parameter to the <code class="literal">GET _cat/nodes</code> API was deprecated in 7.x and is
rejected in 8.0. This parameter caused the API to use the local cluster state
to determine the nodes returned by the API rather than the cluster state from
the master, but this API requests information from each selected node
regardless of the <code class="literal">?local</code> parameter which means this API does not run in a
fully node-local fashion.</p>
<h4><a id="_deprecated_local_parameter_removed_from_get_field_mapping_api"></a>Deprecated <code class="literal">local</code> parameter removed from get field mapping API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/api.asciidoc">edit</a></h4>
<p>The <code class="literal">local</code> parameter for get field mapping API was deprecated in 7.8 and is
removed in 8.0. This parameter is a no-op and field mappings are always retrieved
locally.</p>
<h3><a id="breaking_80_rollup_changes"></a>Rollup changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/rollup.asciidoc">edit</a></h3>
<h4><a id="_startrollupjob_endpoint_returns_success_if_job_already_started"></a>StartRollupJob endpoint returns success if job already started<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/rollup.asciidoc">edit</a></h4>
<p>Previously, attempting to start an already-started rollup job would
result in a <code class="literal">500 InternalServerError: Cannot start task for Rollup Job
[job] because state was [STARTED]</code> exception.</p>
<p>Now, attempting to start a job that is already started will just
return a successful <code class="literal">200 OK: started</code> response.</p>
<h3><a id="breaking_80_search_changes"></a>Search Changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h3>
<h4><a id="_removal_of_types_3"></a>Removal of types<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h4>
<p>The <code class="literal">/{index}/{type}/_search</code>, <code class="literal">/{index}/{type}/_msearch</code>, <code class="literal">/{index}/{type}/_search/template</code> and <code class="literal">/{index}/{type}/_msearch/template</code> REST endpoints have been removed in favour of <code class="literal">/{index}/_search</code>, <code class="literal">/{index}/_msearch</code>, <code class="literal">/{index}/_search/template</code> and <code class="literal">/{index}/_msearch/template</code>; since indexes no longer contain types, these typed endpoints are obsolete..</p>
<p>The <code class="literal">/{index}/{type}/_termvectors</code>, <code class="literal">/{index}/{type}/{id}/_termvectors</code> and <code class="literal">/{index}/{type}/_mtermvectors</code> REST endpoints have been removed in favour of <code class="literal">/{index}/_termvectors</code>, <code class="literal">/{index}/{id}/_termvectors</code> and <code class="literal">/{index}/_mtermvectors</code>; since indexes no longer contain types, these typed endpoints are obsolete..</p>
<p>The <code class="literal">/{index}/{type}/{doc}</code> and <code class="literal">/{index}/{type}/_mget</code> REST endpoints have been removed in favour of <code class="literal">/{index}/_doc/{doc}</code> and <code class="literal">/{index}/_mget</code>; since indexes no longer contain types, these typed endpoints are obsolete.</p>
<h4><a id="_removal_of_queries"></a>Removal of queries<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h4>
<p>The <code class="literal">common</code> query, deprecated in 7.x, has been removed in 8.0.
The same functionality can be achieved by the <code class="literal">match</code> query if the total number of hits is not tracked.</p>
<h5><a id="_removal_of_query_parameters"></a>Removal of query parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h5>
<p>The <code class="literal">cutoff_frequency</code> parameter, deprecated in 7.x, has been removed in 8.0 from <code class="literal">match</code> and <code class="literal">multi_match</code> queries.
The same functionality can be achieved without any configuration provided that the total number of hits is not tracked.</p>
<h5><a id="_removal_of_sort_parameters"></a>Removal of sort parameters<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h5>
<p>The <code class="literal">nested_filter</code> and <code class="literal">nested_path</code> options, deprecated in 6.x, have been removed in favor of the <code class="literal">nested</code> context.</p>
<h5><a id="_shard_allocation_awareness_in_search_and_get_requests"></a>Shard allocation awareness in Search and Get requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h5>
<p>Elasticsearch will no longer prefer using shards in the same location (with the same awareness attribute values) to process
<code class="literal">_search</code> and <code class="literal">_get</code> requests. Adaptive replica selection (activated by default in this version) will route requests
more efficiently using the service time of prior inter-node communications.</p>
<h4><a id="_removal_of_sparse_vector_fields"></a>Removal of sparse vector fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h4>
<p>The <code class="literal">sparse_vector</code> field type was deprecated in 7.6 and is now removed in
8.0. We have not seen much interest in this experimental field type, and don&#8217;t
see a clear use case as it&#8217;s currently designed. If you have feedback or
suggestions around sparse vector functionality, please let us know through
GitHub or the <em>discuss</em> forums.</p>
<h4><a id="_update_to_vector_function_signatures"></a>Update to vector function signatures<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h4>
<p>The vector functions of the form <code class="literal">function(query, doc['field'])</code> were
deprecated in 7.6, and are now removed in 8.x. The form
<code class="literal">function(query, 'field')</code> should be used instead. For example,
<code class="literal">cosineSimilarity(query, doc['field'])</code> is replaced by
<code class="literal">cosineSimilarity(query, 'field')</code>.</p>
<h4><a id="_object_format_for_indices_boost"></a>Object format for <code class="literal">indices_boost</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h4>
<p>The <code class="literal">indices_boost</code> option in the search request used to accept the boosts
both as an object and as an array. The object format has been deprecated since
5.2 and is now removed in 8.0.</p>
<h4><a id="_removal_of_use_field_mapping_for_docvalues_fields"></a>Removal of <code class="literal">use_field_mapping</code> for docvalues fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/search.asciidoc">edit</a></h4>
<p>In 7.0, we began formatting <code class="literal">docvalue_fields</code> by default using each field&#8217;s
mapping definition. To ease the transition from 6.x, we added the format
option <code class="literal">use_field_mapping</code>. This parameter was deprecated in 7.0, and is now
removed in 8.0.</p>
<h3><a id="breaking_80_security_changes"></a>Security changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h3>
<h4><a id="_the_realm_order_setting_is_required"></a>The realm <code class="literal">order</code> setting is required<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<p>The <code class="literal">xpack.security.authc.realms.{type}.{name}.order</code> setting is now required and must be
specified for each explicitly configured realm. Each value must be unique.
The cluster will fail to start if the requirements are not met.</p>
<p>For example, the following configuration is invalid:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.authc.realms.kerberos.kerb1:
  keytab.path: es.keytab
  remove_realm_name: false</pre>
</div>
<p>And must be configured as:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.authc.realms.kerberos.kerb1:
  order: 0
  keytab.path: es.keytab
  remove_realm_name: false</pre>
</div>
<h4><a id="accept-default-password-removed"></a>The <code class="literal">accept_default_password</code> setting has been removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<p>The <code class="literal">xpack.security.authc.accept_default_password</code> setting has not had any affect
since the 6.0 release of Elasticsearch. It has been removed and cannot be used.</p>
<h4><a id="roles-index-cache-removed"></a>The <code class="literal">roles.index.cache.*</code> settings have been removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<p>The <code class="literal">xpack.security.authz.store.roles.index.cache.max_size</code> and
<code class="literal">xpack.security.authz.store.roles.index.cache.ttl</code> settings have
been removed. These settings have been redundant and deprecated
since the 5.2 release of Elasticsearch.</p>
<h4><a id="migrate-tool-removed"></a>The <code class="literal">elasticsearch-migrate</code> tool has been removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<p>The <code class="literal">elasticsearch-migrate</code> tool provided a way to convert file
realm users and roles into the native realm. It has been deprecated
since 7.2.0. Users and roles should now be created in the native
realm directly.</p>
<h4><a id="separating-node-and-client-traffic"></a>The <code class="literal">transport.profiles.*.xpack.security.type</code> setting has been removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<p>The <code class="literal">transport.profiles.*.xpack.security.type</code> setting has been removed since
the Transport Client has been removed and therefore all client traffic now uses
the HTTP transport. Transport profiles using this setting should be removed.</p>
<h4><a id="ssl-validation-changes"></a>SSL/TLS configuration validation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<h5><a id="_the_xpack_security_transport_ssl_enabled_setting_may_be_required"></a>The <code class="literal">xpack.security.transport.ssl.enabled</code> setting may be required<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h5>
<p>It is now an error to configure any SSL settings for
<code class="literal">xpack.security.transport.ssl</code> without also configuring
<code class="literal">xpack.security.transport.ssl.enabled</code>.</p>
<p>For example, the following configuration is invalid:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</pre>
</div>
<p>And must be configured as:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.transport.ssl.enabled: true <a id="CO668-1"></a><i class="conum" data-value="1"></i>
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO668-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>or <code class="literal">false</code>.</p>
</td>
</tr>
</table>
</div>
<h5><a id="_the_xpack_security_http_ssl_enabled_setting_may_be_required"></a>The <code class="literal">xpack.security.http.ssl.enabled</code> setting may be required<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h5>
<p>It is now an error to configure any SSL settings for
<code class="literal">xpack.security.http.ssl</code> without also configuring
<code class="literal">xpack.security.http.ssl.enabled</code>.</p>
<p>For example, the following configuration is invalid:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl.certificate: elasticsearch.crt
xpack.security.http.ssl.key: elasticsearch.key
xpack.security.http.ssl.certificate_authorities: [ "corporate-ca.crt" ]</pre>
</div>
<p>And must be configured as either:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.http.ssl.enabled: true <a id="CO669-1"></a><i class="conum" data-value="1"></i>
xpack.security.http.ssl.certificate: elasticsearch.crt
xpack.security.http.ssl.key: elasticsearch.key
xpack.security.http.ssl.certificate_authorities: [ "corporate-ca.crt" ]</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO669-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>or <code class="literal">false</code>.</p>
</td>
</tr>
</table>
</div>
<h5><a id="_the_xpack_security_transport_ssl_certificate_and_key_may_be_required"></a>The <code class="literal">xpack.security.transport.ssl</code> Certificate and Key may be required<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h5>
<p>It is now an error to enable SSL for the transport interface without also configuring
a certificate and key through use of the <code class="literal">xpack.security.transport.ssl.keystore.path</code>
setting or the <code class="literal">xpack.security.transport.ssl.certificate</code> and
<code class="literal">xpack.security.transport.ssl.key</code> settings.</p>
<h5><a id="_the_xpack_security_http_ssl_certificate_and_key_may_be_required"></a>The <code class="literal">xpack.security.http.ssl</code> Certificate and Key may be required<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h5>
<p>It is now an error to enable SSL for the HTTP (Rest) server without also configuring
a certificate and key through use of the <code class="literal">xpack.security.http.ssl.keystore.path</code>
setting or the <code class="literal">xpack.security.http.ssl.certificate</code> and
<code class="literal">xpack.security.http.ssl.key</code> settings.</p>
<h4><a id="builtin-users-changes"></a>Changes to built-in users<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<h5><a id="_the_kibana_user_has_been_removed_in_favor_of_the_kibana_system_user"></a>The <code class="literal">kibana</code> user has been removed in favor of the <code class="literal">kibana_system</code> user<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h5>
<p>The <code class="literal">kibana</code> user was historically used to authenticate Kibana to Elasticsearch.
The name of this user was confusing, and was often mistakenly used to login to Kibana.
This has been renamed to <code class="literal">kibana_system</code> in order to reduce confusion, and to better
align with other built-in system accounts.</p>
<p>If your <code class="literal">kibana.yml</code> used to contain:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: kibana</pre>
</div>
<p>then you should update to use the new <code class="literal">kibana_system</code> user instead:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">elasticsearch.username: kibana_system</pre>
</div>
<h4><a id="builtin-roles-changes"></a>Changes to built-in roles<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h4>
<h5><a id="_the_kibana_user_role_has_been_removed_in_favor_of_the_kibana_admin_role"></a>The <code class="literal">kibana_user</code> role has been removed in favor of the <code class="literal">kibana_admin</code> role<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/security.asciidoc">edit</a></h5>
<p>Users who were previously assigned the <code class="literal">kibana_user</code> role should instead be assigned
the <code class="literal">kibana_admin</code> role. This role grants the same set of privileges as <code class="literal">kibana_user</code>, but has been
renamed to better reflect its intended use.</p>
<h3><a id="breaking_80_settings_changes"></a>Settings changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h3>
<h4><a id="search-remote-settings-removed"></a>The <code class="literal">search.remote</code> settings have been removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>In 6.5 these settings were deprecated in favor of <code class="literal">cluster.remote</code>. In 7.x we
provided automatic upgrading of these settings to their <code class="literal">cluster.remote</code>
counterparts. In 8.0.0, these settings have been removed. Elasticsearch will
refuse to start if you have these settings in your configuration or cluster
state.</p>
<h4><a id="remove-pidfile"></a><code class="literal">pidfile</code> setting is replaced by <code class="literal">node.pidfile</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>To ensure that all settings are in a proper namespace, the <code class="literal">pidfile</code> setting was
previously deprecated in version 7.4.0 of Elasticsearch, and is removed in
version 8.0.0. Instead, use <code class="literal">node.pidfile</code>.</p>
<h4><a id="remove-processors"></a><code class="literal">processors</code> setting is replaced by <code class="literal">node.processors</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>To ensure that all settings are in a proper namespace, the <code class="literal">processors</code> setting
was previously deprecated in version 7.4.0 of Elasticsearch, and is removed in
version 8.0.0. Instead, use <code class="literal">node.processors</code>.</p>
<h4><a id="_node_processors_can_no_longer_exceed_the_available_number_of_processors"></a><code class="literal">node.processors</code> can no longer exceed the available number of processors<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>Previously it was possible to set the number of processors used to set the
default sizes for the thread pools to be more than the number of available
processors. As this leads to more context switches and more threads but without
an increase in the number of physical CPUs on which to schedule these additional
threads, the <code class="literal">node.processors</code> setting is now bounded by the number of available
processors.</p>
<h4><a id="_cluster_remote_connect_is_removed"></a><code class="literal">cluster.remote.connect</code> is removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>In Elasticsearch 7.7.0, the setting <code class="literal">cluster.remote.connect</code> was deprecated in
favor of setting <code class="literal">node.remote_cluster_client</code>. In Elasticsearch 8.0.0, the
setting <code class="literal">cluster.remote.connect</code> is removed.</p>
<h4><a id="_node_local_storage_is_removed"></a><code class="literal">node.local_storage</code> is removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>In Elasticsearch 7.8.0, the setting <code class="literal">node.local_storage</code> was deprecated and
beginning in Elasticsearch 8.0.0 all nodes will require local storage. Therefore,
the <code class="literal">node.local_storage</code> setting has been removed.</p>
<h4><a id="_auth_password_for_http_monitoring_is_removed"></a><code class="literal">auth.password</code> for HTTP monitoring is removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>In Elasticsearch 7.7.0, the setting <code class="literal">xpack.monitoring.exporters.&lt;exporterName&gt;.auth.password</code>
was deprecated in favor of setting <code class="literal">xpack.monitoring.exporters.&lt;exporterName&gt;.auth.secure_password</code>.
In Elasticsearch 8.0.0, the setting <code class="literal">xpack.monitoring.exporters.&lt;exporterName&gt;.auth.password</code> is
removed.</p>
<h4><a id="_option_to_disable_basic_license_features_is_deprecated"></a>Option to disable basic license features is deprecated<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>In Elasticsearch 7.8.0, the following settings have been deprecated:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">xpack.enrich.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.flattened.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.ilm.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.monitoring.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.rollup.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.slm.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.sql.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.transform.enabled</code>
</li>
<li class="listitem">
<code class="literal">xpack.vectors.enabled</code>
</li>
</ul>
</div>
<p>In future releases, it will not be possible to disable the APIs for Enrichment,
Flattened mappings, ILM, Monitoring, Rollup, SLM, SQL, Transforms, and Vectors.</p>
<h4><a id="_the_prefer_v2_templates_parameter_now_defaults_to_true"></a>The <code class="literal">prefer_v2_templates</code> parameter now defaults to <code class="literal">true</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/settings.asciidoc">edit</a></h4>
<p>In Elasticsearch 7.8.0 the <code class="literal">?prefer_v2_templates=true|false</code> parameter was introduced to allow
specifying whether to favor V1 or V2 templates when a new index is created. In 8.0 this now defaults
to <code class="literal">true</code>, meaning that V2 index templates will always take precedence if they match. V1 templates
will continue to be applied if no V2 index template matches the newly created index pattern.</p>
<p>The <code class="literal">?prefer_v2_templates</code> parameter is supported on the <a class="xref" href="indices-create-index.html" title="Create index API">Create Index</a>,
<a class="xref" href="docs-index_.html" title="Index API">Index</a>, <a class="xref" href="docs-bulk.html" title="Bulk API">Bulk</a>, <a class="xref" href="docs-update.html" title="Update API">Update</a>, and
<a class="xref" href="indices-rollover-index.html" title="Rollover index API">Rollover</a> APIs.</p>
<h3><a id="breaking_80_snapshots_changes"></a>Snapshot and Restore changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/snapshots.asciidoc">edit</a></h3>
<h3><a id="_get_snapshots_response_format_is_changed"></a>Get snapshots response format is changed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/snapshots.asciidoc">edit</a></h3>
<p>It&#8217;s possible to get snapshots from multiple repositories in one go. The response format has changed
and now contains separate response for each repository.</p>
<p>For example, requesting one snapshot from particular repository</p>
<a id="6458a2377155ecbdd2d3ebd0e1529201"></a>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET _snapshot/repo1/snap1</pre>
</div>
<div class="console_widget" data-snippet="snippets/2170.console"></div>
<p>produces the following response</p>
<a id="97eab207747d5ad2e1f6d3b84971d74b"></a>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
    "responses": [
        {
            "repository": "repo1",
            "snapshots": [
                {
                    "snapshot": "snap1",
                    "uuid": "cEzdqUKxQ5G6MyrJAcYwmA",
                    "version_id": 8000099,
                    "version": "8.0.0",
                    "indices": [],
                    "include_global_state": true,
                    "state": "SUCCESS",
                    "start_time": "2019-05-10T17:01:57.868Z",
                    "start_time_in_millis": 1557507717868,
                    "end_time": "2019-05-10T17:01:57.909Z",
                    "end_time_in_millis": 1557507717909,
                    "duration_in_millis": 41,
                    "failures": [],
                    "shards": {
                        "total": 0,
                        "failed": 0,
                        "successful": 0
                    }
                }
            ]
        }
    ]
}</pre>
</div>
<p>See <a class="xref" href="modules-snapshots.html" title="Snapshot module">Snapshot module</a> for more information.</p>
<h4><a id="_deprecated_node_level_compress_setting_removed"></a>Deprecated node level compress setting removed<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/snapshots.asciidoc">edit</a></h4>
<p>For shared file system repositories (<code class="literal">"type": "fs"</code>), the node level setting <code class="literal">repositories.fs.compress</code> could
previously be used to enable compression for all shared file system repositories where <code class="literal">compress</code> was not specified.
The <code class="literal">repositories.fs.compress</code> setting has been removed.</p>
<p>Instead use the repository specific <code class="literal">compress</code> setting to enable compression. See <a class="xref" href="modules-snapshots.html" title="Snapshot module">Snapshot module</a> for information
on the <code class="literal">compress</code> setting.</p>
<h4><a id="_compression_of_meta_data_files_is_now_on_by_default"></a>Compression of meta data files is now on by default<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/snapshots.asciidoc">edit</a></h4>
<p>Previously, the default value for <code class="literal">compress</code> was <code class="literal">false</code>. The default has been changed to <code class="literal">true</code>.</p>
<p>This change will affect both newly created repositories and existing repositories where <code class="literal">compress=false</code> has not been
explicitly specified.</p>
<p>For more information on the compress option, see <a class="xref" href="modules-snapshots.html" title="Snapshot module">Snapshot module</a></p>
<h4><a id="_the_s3_repository_plugin_uses_the_dns_style_access_pattern_by_default"></a>The S3 repository plugin uses the DNS style access pattern by default<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/snapshots.asciidoc">edit</a></h4>
<p>Starting in version 7.4 the <code class="literal">repository-s3</code> plugin does not use the
now-deprecated path-style access pattern by default. In versions 7.0, 7.1, 7.2
and 7.3 the <code class="literal">repository-s3</code> plugin always used the path-style access pattern.
This is a breaking change for deployments that only support path-style access
but which are recognized as supporting DNS-style access by the AWS SDK. If your
deployment only supports path-style access and is affected by this change then
you must configure the S3 client setting <code class="literal">path_style_access</code> to <code class="literal">true</code>. This
breaking change was made necessary by
<a href="https://aws.amazon.com/blogs/aws/amazon-s3-path-deprecation-plan-the-rest-of-the-story/" class="ulink" target="_top">AWS&#8217;s
announcement</a> that the path-style access pattern is deprecated and will be
unsupported on buckets created after September 30th 2020.</p>
<h4><a id="_restore_requests_no_longer_accept_settings"></a>Restore requests no longer accept settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/snapshots.asciidoc">edit</a></h4>
<p>In earlier versions, you could pass both <code class="literal">settings</code> and <code class="literal">index_settings</code> in the
body of a restore snapshot request, but the <code class="literal">settings</code> value was ignored. The
restore snapshot API now rejects requests that include a <code class="literal">settings</code> value.</p>
<h3><a id="breaking_80_threadpool_changes"></a>Thread pool changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/threadpool.asciidoc">edit</a></h3>
<h4><a id="_removal_of_the_fixed_auto_queue_size_thread_pool_type"></a>Removal of the <code class="literal">fixed_auto_queue_size</code> thread pool type<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/threadpool.asciidoc">edit</a></h4>
<p>The <code class="literal">fixed_auto_queue_size</code> thread pool type, previously marked as an
experimental feature, was deprecated in 7.x and has been removed in 8.0.
The <code class="literal">search</code> and <code class="literal">search_throttled</code> thread pools have the <code class="literal">fixed</code> type now.</p>
<h3><a id="breaking_80_transport_changes"></a>Transport changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/transport.asciidoc">edit</a></h3>
<h4><a id="_removal_of_old_transport_settings"></a>Removal of old transport settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/migration/migrate_8_0/transport.asciidoc">edit</a></h4>
<p>The following settings have been deprecated in 7.x and removed in 8.0. Each setting has a replacement
setting that was introduced in 6.7.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">transport.tcp.port</code> replaced by <code class="literal">transport.port</code>
</li>
<li class="listitem">
<code class="literal">transport.tcp.compress</code> replaced by <code class="literal">transport.compress</code>
</li>
<li class="listitem">
<code class="literal">transport.tcp.connect_timeout</code> replaced by <code class="literal">transport.connect_timeout</code>
</li>
<li class="listitem">
<code class="literal">transport.tcp_no_delay</code> replaced by <code class="literal">transport.tcp.no_delay</code>
</li>
<li class="listitem">
<code class="literal">transport.profiles.profile_name.tcp_no_delay</code> replaced by <code class="literal">transport.profiles.profile_name.tcp.no_delay</code>
</li>
<li class="listitem">
<code class="literal">transport.profiles.profile_name.tcp_keep_alive</code> replaced by <code class="literal">transport.profiles.profile_name.tcp.keep_alive</code>
</li>
<li class="listitem">
<code class="literal">transport.profiles.profile_name.reuse_address</code> replaced by <code class="literal">transport.profiles.profile_name.tcp.reuse_address</code>
</li>
<li class="listitem">
<code class="literal">transport.profiles.profile_name.send_buffer_size</code> replaced by <code class="literal">transport.profiles.profile_name.tcp.send_buffer_size</code>
</li>
<li class="listitem">
<code class="literal">transport.profiles.profile_name.receive_buffer_size</code> replaced by <code class="literal">transport.profiles.profile_name.tcp.receive_buffer_size</code>
</li>
</ul>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="breaking-changes.html">« Breaking changes</a>
</span>
<span class="next">
<a href="es-release-notes.html">Release notes »</a>
</span>
</div>
</div>
</body>
</html>
