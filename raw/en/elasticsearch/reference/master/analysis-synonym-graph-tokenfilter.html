<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Synonym Graph Token Filter
        | Elasticsearch Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="analysis-tokenfilters.html" title="Token Filters" /><link rel="prev" href="_parsing_synonym_files.html" title="Parsing synonym files" /><link rel="next" href="analysis-compound-word-tokenfilter.html" title="Compound Word Token Filters" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="master" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="analysis.html">Analysis</a></span> » <span class="breadcrumb-link"><a href="analysis-tokenfilters.html">Token Filters</a></span> » <span class="breadcrumb-node">Synonym Graph Token Filter</span></div><div xmlns="" class="navheader"><span class="prev"><a href="_parsing_synonym_files.html">
              « 
              Parsing synonym files</a>
           
        </span><span class="next">
           
          <a href="analysis-compound-word-tokenfilter.html">Compound Word Token Filters
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="analysis-synonym-graph-tokenfilter"></a>Synonym Graph Token Filter<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">synonym_graph</code> token filter allows to easily handle synonyms,
including multi-word synonyms correctly during the analysis process.</p><p>In order to properly handle multi-word synonyms this token filter
creates a "graph token stream" during processing.  For more information
on this topic and its various complexities, please read the
<a class="ulink" href="http://blog.mikemccandless.com/2012/04/lucenes-tokenstreams-are-actually.html" target="_top">Lucene’s TokenStreams are actually graphs</a> blog post.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><a xmlns="http://www.w3.org/1999/xhtml" id="synonym-graph-index-note"></a><p xmlns="http://www.w3.org/1999/xhtml">This token filter is designed to be used as part of a search analyzer
only.  If you want to apply synonyms during indexing please use the
standard <a class="link" href="analysis-synonym-tokenfilter.html" title="Synonym Token Filter">synonym token filter</a>.</p></div></div><p>Synonyms are configured using a configuration file.
Here is an example:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /test_index
{
    "settings": {
        "index" : {
            "analysis" : {
                "analyzer" : {
                    "search_synonyms" : {
                        "tokenizer" : "whitespace",
                        "filter" : ["graph_synonyms"]
                    }
                },
                "filter" : {
                    "graph_synonyms" : {
                        "type" : "synonym_graph",
                        "synonyms_path" : "analysis/synonym.txt"
                    }
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/790.console"></div><p>The above configures a <code class="literal">search_synonyms</code> filter, with a path of
<code class="literal">analysis/synonym.txt</code> (relative to the <code class="literal">config</code> location). The
<code class="literal">search_synonyms</code> analyzer is then configured with the filter.</p><p>Additional settings are:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">expand</code> (defaults to <code class="literal">true</code>).</li><li class="listitem"><code class="literal">lenient</code> (defaults to <code class="literal">false</code>). If <code class="literal">true</code> ignores exceptions while parsing the synonym configuration. It is important
to note that only those synonym rules which cannot get parsed are ignored. For instance consider the following request:</li></ul></div><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /test_index
{
    "settings": {
        "index" : {
            "analysis" : {
                "analyzer" : {
                    "synonym" : {
                        "tokenizer" : "standard",
                        "filter" : ["my_stop", "synonym_graph"]
                    }
                },
                "filter" : {
                    "my_stop": {
                        "type" : "stop",
                        "stopwords": ["bar"]
                    },
                    "synonym_graph" : {
                        "type" : "synonym_graph",
                        "lenient": true,
                        "synonyms" : ["foo, bar =&gt; baz"]
                    }
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/791.console"></div><p>With the above request the word <code class="literal">bar</code> gets skipped but a mapping <code class="literal">foo =&gt; baz</code> is still added. However, if the mapping
being added was "foo, baz ⇒ bar" nothing would get added to the synonym list. This is because the target word for the
mapping is itself eliminated because it was a stop word. Similarly, if the mapping was "bar, foo, baz" and <code class="literal">expand</code> was
set to <code class="literal">false</code> no mapping would get added as when <code class="literal">expand=false</code> the target mapping is the first word. However, if
<code class="literal">expand=true</code> then the mappings added would be equivalent to <code class="literal">foo, baz =&gt; foo, baz</code> i.e, all mappings other than the
stop word.</p><h4><a id="synonym-graph-tokenizer-ignore_case-deprecated"></a><code class="literal">tokenizer</code> and <code class="literal">ignore_case</code> are deprecated<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">tokenizer</code> parameter controls the tokenizers that will be used to
tokenize the synonym, this parameter is for backwards compatibility for indices that created before 6.0..
The <code class="literal">ignore_case</code> parameter works with <code class="literal">tokenizer</code> parameter only.</p><p>Two synonym formats are supported: Solr, WordNet.</p><h4><a id="_solr_synonyms_2"></a>Solr synonyms<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The following is a sample format of the file:</p><div xmlns="" class="pre_wrapper lang-synonyms"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-synonyms"># Blank lines and lines starting with pound are comments.

# Explicit mappings match any token sequence on the LHS of "=&gt;"
# and replace with all alternatives on the RHS.  These types of mappings
# ignore the expand parameter in the schema.
# Examples:
i-pod, i pod =&gt; ipod,
sea biscuit, sea biscit =&gt; seabiscuit

# Equivalent synonyms may be separated with commas and give
# no explicit mapping.  In this case the mapping behavior will
# be taken from the expand parameter in the schema.  This allows
# the same synonym file to be used in different synonym handling strategies.
# Examples:
ipod, i-pod, i pod
foozball , foosball
universe , cosmos
lol, laughing out loud

# If expand==true, "ipod, i-pod, i pod" is equivalent
# to the explicit mapping:
ipod, i-pod, i pod =&gt; ipod, i-pod, i pod
# If expand==false, "ipod, i-pod, i pod" is equivalent
# to the explicit mapping:
ipod, i-pod, i pod =&gt; ipod

# Multiple synonym mapping entries are merged.
foo =&gt; foo bar
foo =&gt; baz
# is equivalent to
foo =&gt; foo bar, baz</pre></div><p>You can also define synonyms for the filter directly in the
configuration file (note use of <code class="literal">synonyms</code> instead of <code class="literal">synonyms_path</code>):</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /test_index
{
    "settings": {
        "index" : {
            "analysis" : {
                "filter" : {
                    "synonym" : {
                        "type" : "synonym_graph",
                        "synonyms" : [
                            "lol, laughing out loud",
                            "universe, cosmos"
                        ]
                    }
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/792.console"></div><p>However, it is recommended to define large synonyms set in a file using
<code class="literal">synonyms_path</code>, because specifying them inline increases cluster size unnecessarily.</p><h4><a id="_wordnet_synonyms_2"></a>WordNet synonyms<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Synonyms based on <a class="ulink" href="http://wordnet.princeton.edu/" target="_top">WordNet</a> format can be
declared using <code class="literal">format</code>:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /test_index
{
    "settings": {
        "index" : {
            "analysis" : {
                "filter" : {
                    "synonym" : {
                        "type" : "synonym_graph",
                        "format" : "wordnet",
                        "synonyms" : [
                            "s(100000001,1,'abstain',v,1,0).",
                            "s(100000001,2,'refrain',v,1,0).",
                            "s(100000001,3,'desist',v,1,0)."
                        ]
                    }
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/793.console"></div><p>Using <code class="literal">synonyms_path</code> to define WordNet synonyms in a file is supported
as well.</p><h4><a id="_parsing_synonym_files_2"></a>Parsing synonym files<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/analysis/tokenfilters/synonym-graph-tokenfilter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Elasticsearch will use the token filters preceding the synonym filter
in a tokenizer chain to parse the entries in a synonym file.  So, for example, if a
synonym filter is placed after a stemmer, then the stemmer will also be applied
to the synonym entries.  Because entries in the synonym map cannot have stacked
positions, some token filters may cause issues here.  Token filters that produce
multiple versions of a token may choose which version of the token to emit when
parsing synonyms, e.g. <code class="literal">asciifolding</code> will only produce the folded version of the
token.  Others, e.g. <code class="literal">multiplexer</code>, <code class="literal">word_delimiter_graph</code> or <code class="literal">ngram</code> will throw an
error.</p><p>If you need to build analyzers that include both multi-token filters and synonym
filters, consider using the <a class="link" href="analysis-multiplexer-tokenfilter.html" title="Multiplexer Token Filter">multiplexer</a> filter,
with the multi-token filters in one branch and the synonym filter in the other.</p><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The synonym rules should not contain words that are removed by
a filter that appears after in the chain (a <code class="literal">stop</code> filter for instance).
Removing a term from a synonym rule breaks the matching at query time.</p></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="_parsing_synonym_files.html">
              « 
              Parsing synonym files</a>
           
        </span><span class="next">
           
          <a href="analysis-compound-word-tokenfilter.html">Compound Word Token Filters
               »
            </a></span></div></body></html>