<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Nested Query
        | Reference [0.90]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Reference [0.90]" /><link rel="up" href="query-dsl-queries.html" title="Queries" /><link rel="prev" href="query-dsl-mlt-field-query.html" title="More Like This Field Query" /><link rel="next" href="query-dsl-prefix-query.html" title="Prefix Query" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/0.90" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="0.90" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Reference
      [0.90]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Nested Query</span></div><div xmlns="" class="navheader"><span class="prev"><a href="query-dsl-mlt-field-query.html">
              « 
              More Like This Field Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-prefix-query.html">Prefix Query
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-nested-query"></a>Nested Query<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/0.90/docs/reference/query-dsl/queries/nested-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Nested query allows to query nested objects / docs (see
<a class="link" href="mapping-nested-type.html" title="Nested Type">nested mapping</a>). The
query is executed against the nested objects / docs as if they were
indexed as separate docs (they are, internally) and resulting in the
root parent doc (or parent nested mapping). Here is a sample mapping we
will work with:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</pre></div><p>And here is a sample nested query usage:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "nested" : {
        "path" : "obj1",
        "score_mode" : "avg",
        "query" : {
            "bool" : {
                "must" : [
                    {
                        "match" : {"obj1.name" : "blue"}
                    },
                    {
                        "range" : {"obj1.count" : {"gt" : 5}}
                    }
                ]
            }
        }
    }
}</pre></div><p>The query <code class="literal">path</code> points to the nested object path, and the <code class="literal">query</code> (or
<code class="literal">filter</code>) includes the query that will run on the nested docs matching
the direct path, and joining with the root parent docs.</p><p>The <code class="literal">score_mode</code> allows to set how inner children matching affects
scoring of parent. It defaults to <code class="literal">avg</code>, but can be <code class="literal">total</code>, <code class="literal">max</code> and
<code class="literal">none</code>.</p><p>Multi level nesting is automatically supported, and detected, resulting
in an inner nested query to automatically match the relevant nesting
level (and not root) if it exists within another nested query.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="query-dsl-mlt-field-query.html">
              « 
              More Like This Field Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-prefix-query.html">Prefix Query
               »
            </a></span></div></body></html>