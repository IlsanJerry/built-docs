<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Configuring a Kerberos realm
        | Elasticsearch Reference [7.3]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [7.3]" /><link rel="up" href="configuring-security.html" title="Configuring security in Elasticsearch" /><link rel="prev" href="configuring-saml-realm.html" title="Configuring a SAML realm" /><link rel="next" href="security-files.html" title="Security files" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.3" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="7.3" /></head><body><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.3]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span> » <span class="breadcrumb-link"><a href="configuring-security.html">Configuring security in Elasticsearch</a></span> » <span class="breadcrumb-node">Configuring a Kerberos realm</span></div><div xmlns="" class="navheader"><span class="prev"><a href="configuring-saml-realm.html">
              « 
              Configuring a SAML realm</a>
           
        </span><span class="next">
           
          <a href="security-files.html">Security files
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-kerberos-realm"></a>Configuring a Kerberos realm<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.3/x-pack/docs/en/security/authentication/configuring-kerberos-realm.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a xmlns="" class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><p>Kerberos is used to protect services and uses a ticket-based authentication
protocol to authenticate users.
You can configure Elasticsearch to use the Kerberos V5 authentication protocol, which is
an industry standard protocol, to authenticate users.
In this scenario, clients must present Kerberos tickets for authentication.</p><p>In Kerberos, users authenticate with an authentication service and later
with a ticket granting service to generate a TGT (ticket-granting ticket).
This ticket is then presented to the service for authentication.
Refer to your Kerberos installation documentation for more information about
obtaining TGT. Elasticsearch clients must first obtain a TGT then initiate the process of
authenticating with Elasticsearch.</p><p>For a summary of Kerberos terminology, see <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/kerberos-realm.html" target="_top">Kerberos authentication</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_before_you_begin"></a>Before you begin<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.3/x-pack/docs/en/security/authentication/configuring-kerberos-realm.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Deploy Kerberos.</p><p class="simpara">You must have the Kerberos infrastructure set up in your environment.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Kerberos requires a lot of external services to function properly, such as
time synchronization between all machines and working forward and reverse DNS
mappings in your domain. Refer to your Kerberos documentation for more details.</p></div></div><p class="simpara">These instructions do not cover setting up and configuring your Kerberos
deployment. Where examples are provided, they pertain to an MIT Kerberos V5
deployment. For more information, see
<a class="ulink" href="http://web.mit.edu/kerberos/www/index.html" target="_top">MIT Kerberos documentation</a></p></li><li class="listitem"><p class="simpara">Configure Java GSS.</p><p class="simpara">Elasticsearch uses Java GSS framework support for Kerberos authentication.
To support Kerberos authentication, Elasticsearch needs the following files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">krb5.conf</code>, a Kerberos configuration file</li><li class="listitem">A <code class="literal">keytab</code> file that contains credentials for the Elasticsearch service principal</li></ul></div><p class="simpara">The configuration requirements depend on your Kerberos setup. Refer to your
Kerberos documentation to configure the <code class="literal">krb5.conf</code> file.</p><p class="simpara">For more information on Java GSS, see
<a class="ulink" href="https://docs.oracle.com/javase/10/security/kerberos-requirements1.htm" target="_top">Java GSS Kerberos requirements</a></p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_create_a_kerberos_realm"></a>Create a Kerberos realm<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.3/x-pack/docs/en/security/authentication/configuring-kerberos-realm.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To configure a Kerberos realm in Elasticsearch:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Configure the JVM to find the Kerberos configuration file.</p><p class="simpara">Elasticsearch uses Java GSS and JAAS Krb5LoginModule to support Kerberos authentication
using a Simple and Protected GSSAPI Negotiation Mechanism (SPNEGO) mechanism.
The Kerberos configuration file (<code class="literal">krb5.conf</code>) provides information such as the
default realm, the Key Distribution Center (KDC), and other configuration details
required for Kerberos authentication. When the JVM needs some configuration
properties, it tries to find those values by locating and loading this file. The
JVM system property to configure the file path is <code class="literal">java.security.krb5.conf</code>. To
configure JVM system properties see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/jvm-options.html" target="_top">configuring jvm options</a>.
If this system property is not specified, Java tries to locate the file based on
the conventions.</p><div xmlns="" class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">It is recommended that this system property be configured for Elasticsearch.
The method for setting this property depends on your Kerberos infrastructure.
Refer to your Kerberos documentation for more details.</p></div></div><p class="simpara">For more information, see <a class="ulink" href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/krb5_conf.html" target="_top">krb5.conf</a></p></li><li class="listitem"><p class="simpara">Create a keytab for the Elasticsearch node.</p><p class="simpara">A keytab is a file that stores pairs of principals and encryption keys. Elasticsearch
uses the keys from the keytab to decrypt the tickets presented by the user. You
must create a keytab for Elasticsearch by using the tools provided by your Kerberos
implementation. For example, some tools that create keytabs are <code class="literal">ktpass.exe</code> on
Windows and <code class="literal">kadmin</code> for MIT Kerberos.</p></li><li class="listitem"><p class="simpara">Put the keytab file in the Elasticsearch configuration directory.</p><p class="simpara">Make sure that this keytab file has read permissions. This file contains
credentials, therefore you must take appropriate measures to protect it.</p><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Elasticsearch uses Kerberos on the HTTP network layer, therefore there must be
a keytab file for the HTTP service principal on every Elasticsearch node. The service
principal name must have the format <code class="literal">HTTP/es.domain.local@ES.DOMAIN.LOCAL</code>.
The keytab files are unique for each node since they include the hostname.
An Elasticsearch node can act as any principal a client requests as long as that
principal and its credentials are found in the configured keytab.</p></div></div></li><li class="listitem"><p class="simpara">Create a Kerberos realm.</p><p class="simpara">To enable Kerberos authentication in Elasticsearch, you must add a Kerberos realm in the
realm chain.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">You can configure only one Kerberos realm on Elasticsearch nodes.</p></div></div><p class="simpara">To configure a Kerberos realm, there are a few mandatory realm settings and
other optional settings that you need to configure in the <code class="literal">elasticsearch.yml</code>
configuration file. Add a realm configuration under the
<code class="literal">xpack.security.authc.realms.kerberos</code> namespace.</p><p class="simpara">The most common configuration for a Kerberos realm is as follows:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">xpack.security.authc.realms.kerberos.kerb1:
  order: 3
  keytab.path: es.keytab
  remove_realm_name: false</pre></div><p class="simpara">The <code class="literal">username</code> is extracted from the ticket presented by user and usually has
the format <code class="literal">username@REALM</code>. This <code class="literal">username</code> is used for mapping
roles to the user. If realm setting <code class="literal">remove_realm_name</code> is
set to <code class="literal">true</code>, the realm part (<code class="literal">@REALM</code>) is removed. The resulting <code class="literal">username</code>
is used for role mapping.</p><p class="simpara">For detailed information of available realm settings,
see <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/security-settings.html#ref-kerberos-settings" target="_top">Kerberos realm settings</a>.</p></li><li class="listitem">Restart Elasticsearch</li><li class="listitem"><p class="simpara">Map Kerberos users to roles.</p><p class="simpara">The <code class="literal">kerberos</code> realm enables you to map Kerberos users to roles. You can
configure these role mappings by using the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/security-api-role-mapping.html" target="_top">role-mapping API</a>. You identify
users by their <code class="literal">username</code> field.</p><p class="simpara">The following example uses the role mapping API to map <code class="literal">user@REALM</code> to the roles
<code class="literal">monitoring</code> and <code class="literal">user</code>:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">POST /_security/role_mapping/kerbrolemapping
{
  "roles" : [ "monitoring_user" ],
  "enabled": true,
  "rules" : {
    "field" : { "username" : "user@REALM" }
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/33.console"></div><p class="simpara">In case you want to support Kerberos cross realm authentication you may
need to map roles based on the Kerberos realm name. For such scenarios
following are the additional user metadata available for role mapping:
- <code class="literal">kerberos_realm</code> will be set to Kerberos realm name.
- <code class="literal">kerberos_user_principal_name</code> will be set to user principal name from the Kerberos ticket.</p><p class="simpara">For more information, see <a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/mapping-roles.html" target="_top">Mapping users and groups to roles</a>.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The Kerberos realm supports
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.3/realm-chains.html#authorization_realms" target="_top">authorization realms</a> as an
alternative to role mapping.</p></div></div></li></ol></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="configuring-saml-realm.html">
              « 
              Configuring a SAML realm</a>
           
        </span><span class="next">
           
          <a href="security-files.html">Security files
               »
            </a></span></div></body></html>