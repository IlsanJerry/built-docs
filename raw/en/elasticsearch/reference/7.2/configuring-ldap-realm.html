<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Configuring an LDAP realm
        | Elasticsearch Reference [7.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [7.2]" /><link rel="up" href="configuring-security.html" title="Configuring security in Elasticsearch" /><link rel="prev" href="configuring-file-realm.html" title="Configuring a file realm" /><link rel="next" href="configuring-native-realm.html" title="Configuring a native realm" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.2" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="7.2" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.2]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span> » <span class="breadcrumb-link"><a href="configuring-security.html">Configuring security in Elasticsearch</a></span> » <span class="breadcrumb-node">Configuring an LDAP realm</span></div><div xmlns="" class="navheader"><span class="prev"><a href="configuring-file-realm.html">
              « 
              Configuring a file realm</a>
           
        </span><span class="next">
           
          <a href="configuring-native-realm.html">Configuring a native realm
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="configuring-ldap-realm"></a>Configuring an LDAP realm<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.2/x-pack/docs/en/security/authentication/configuring-ldap-realm.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a xmlns="" class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><p>You can configure Elasticsearch to authenticate users by communicating with a Lightweight
Directory Access Protocol (LDAP) server. To integrate with LDAP, you configure
an <code class="literal">ldap</code> realm and map LDAP groups to user roles.</p><p>For more information about LDAP realms, see
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/ldap-realm.html" target="_top">LDAP User Authentication</a>.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Determine which mode you want to use. The <code class="literal">ldap</code> realm supports two modes of
operation, a user search mode and a mode with specific templates for user DNs.</p><p class="simpara">LDAP user search is the most common mode of operation. In this mode, a specific
user with permission to search the LDAP directory is used to search for the DN
of the authenticating user based on the provided username and an LDAP attribute.
Once found, the user is authenticated by attempting to bind to the LDAP server
using the found DN and the provided password.</p><p class="simpara">If your LDAP environment uses a few specific standard naming conditions for
users, you can use user DN templates to configure the realm. The advantage of
this method is that a search does not have to be performed to find the user DN.
However, multiple bind operations might be needed to find the correct user DN.</p></li><li class="listitem"><p class="simpara">To configure an <code class="literal">ldap</code> realm with user search:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">Add a realm configuration of to <code class="literal">elasticsearch.yml</code> under the
<code class="literal">xpack.security.authc.realms.ldap</code> namespace. At a minimum, you must specify
the <code class="literal">url</code> of the LDAP server, and set <code class="literal">user_search.base_dn</code> to the container DN
where the users are searched for.
If you are configuring multiple realms, you should also explicitly set the
<code class="literal">order</code> attribute to control the order in which the realms are consulted during
authentication. See <a class="xref" href="security-settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP realm settings</a> for all of the options you can set for
an <code class="literal">ldap</code> realm.</p><p class="simpara">For example, the following snippet shows an LDAP realm configured with a user search:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            order: 0
            url: "ldaps://ldap.example.com:636"
            bind_dn: "cn=ldapuser, ou=users, o=services, dc=example, dc=com"
            user_search:
              base_dn: "dc=example,dc=com"
              filter: "(cn={0})"
            group_search:
              base_dn: "dc=example,dc=com"
            files:
              role_mapping: "ES_PATH_CONF/role_mapping.yml"
            unmapped_groups_as_roles: false</pre></div><p class="simpara">The password for the <code class="literal">bind_dn</code> user should be configured by adding the appropriate
<code class="literal">secure_bind_password</code> setting to the Elasticsearch keystore.
For example, the following command adds the password for the example realm above:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">bin/elasticsearch-keystore add \
xpack.security.authc.realms.ldap.ldap1.secure_bind_password</pre></div><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">When you configure realms in <code class="literal">elasticsearch.yml</code>, only the
realms you specify are used for authentication. If you also want to use the
<code class="literal">native</code> or <code class="literal">file</code> realms, you must include them in the realm chain.</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">To configure an <code class="literal">ldap</code> realm with user DN templates:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">Add a realm configuration to <code class="literal">elasticsearch.yml</code> in the
<code class="literal">xpack.security.authc.realms.ldap</code> namespace. At a minimum, you must specify
the <code class="literal">url</code> of the LDAP server, and specify at least one template with the
<code class="literal">user_dn_templates</code> option. If you are configuring multiple realms, you should
also explicitly set the <code class="literal">order</code> attribute to control the order in which the
realms are consulted during authentication.
See <a class="xref" href="security-settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP realm settings</a> for all of the options you can set for an <code class="literal">ldap</code> realm.</p><p class="simpara">For example, the following snippet shows an LDAP realm configured with user DN
templates:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            order: 0
            url: "ldaps://ldap.example.com:636"
            user_dn_templates:
              - "cn={0}, ou=users, o=marketing, dc=example, dc=com"
              - "cn={0}, ou=users, o=engineering, dc=example, dc=com"
            group_search:
              base_dn: "dc=example,dc=com"
            files:
              role_mapping: "/mnt/elasticsearch/group_to_role_mapping.yml"
            unmapped_groups_as_roles: false</pre></div><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The <code class="literal">bind_dn</code> setting is not used in template mode.
All LDAP operations run as the authenticating user.</p></div></div></li></ol></div></li><li class="listitem"><p class="simpara">(Optional) Configure how the security features interact with multiple LDAP
servers.</p><p class="simpara">The <code class="literal">load_balance.type</code> setting can be used at the realm level. The Elasticsearch
security features support both failover and load balancing modes of operation.
See <a class="xref" href="security-settings.html#ref-ldap-settings" title="LDAP realm settings">LDAP realm settings</a>.</p></li><li class="listitem">(Optional) To protect passwords,
<a class="link" href="configuring-tls.html#tls-ldap" title="Encrypting communications between Elasticsearch and LDAP">encrypt communications between Elasticsearch and the LDAP server</a>.</li><li class="listitem">Restart Elasticsearch.</li><li class="listitem"><p class="simpara">Map LDAP groups to roles.</p><p class="simpara">The <code class="literal">ldap</code> realm enables you to map LDAP users to roles via their LDAP
groups, or other metadata. This role mapping can be configured via the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.2/security-api-put-role-mapping.html" target="_top">add role mapping API</a> or by using a file stored
on each node. When a user authenticates with LDAP, the privileges
for that user are the union of all privileges defined by the roles to which
the user is mapped.</p><p class="simpara">Within a mapping definition, you specify groups using their distinguished
names. For example, the following mapping configuration maps the LDAP
<code class="literal">admins</code> group to both the <code class="literal">monitoring</code> and <code class="literal">user</code> roles, and maps the
<code class="literal">users</code> group to the <code class="literal">user</code> role.</p><p class="simpara">Configured via the role-mapping API:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /_security/role_mapping/admins
{
  "roles" : [ "monitoring" , "user" ],
  "rules" : { "field" : {
    "groups" : "cn=admins,dc=example,dc=com" <a id="CO31-1"></a><i xmlns="" class="conum" data-value="1"></i>
  } },
  "enabled": true
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/30.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">admins</code> group.</p></td></tr></table></div><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT /_security/role_mapping/basic_users
{
  "roles" : [ "user" ],
  "rules" : { "field" : {
    "groups" : "cn=users,dc=example,dc=com" <a id="CO32-1"></a><i xmlns="" class="conum" data-value="1"></i>
  } },
  "enabled": true
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/31.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">users</code> group.</p></td></tr></table></div><p class="simpara">Or, alternatively, configured via the role-mapping file:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">monitoring: <a id="CO33-1"></a><i xmlns="" class="conum" data-value="1"></i>
  - "cn=admins,dc=example,dc=com" <a id="CO33-2"></a><i xmlns="" class="conum" data-value="2"></i>
user:
  - "cn=users,dc=example,dc=com" <a id="CO33-3"></a><i xmlns="" class="conum" data-value="3"></i>
  - "cn=admins,dc=example,dc=com"</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>The name of the mapped role.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">admins</code> group.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-3"><i xmlns="" class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>The LDAP distinguished name (DN) of the <code class="literal">users</code> group.</p></td></tr></table></div><p class="simpara">For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/ldap-realm.html#mapping-roles-ldap" target="_top">Mapping LDAP Groups to Roles</a>
and
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/mapping-roles.html" target="_top">Mapping Users and Groups to Roles</a>.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The LDAP realm supports
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/realm-chains.html#authorization_realms" target="_top">authorization realms</a> as an
alternative to role mapping.</p></div></div></li><li class="listitem"><p class="simpara">(Optional) Configure the <code class="literal">metadata</code> setting on the LDAP realm to include extra
fields in the user’s metadata.</p><p class="simpara">By default, <code class="literal">ldap_dn</code> and <code class="literal">ldap_groups</code> are populated in the user’s metadata.
For more information, see
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.2/ldap-realm.html#ldap-user-metadata" target="_top">User Metadata in LDAP Realms</a>.</p><p class="simpara">The example below includes the user’s common name (<code class="literal">cn</code>) as an additional
field in their metadata.</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">xpack:
  security:
    authc:
      realms:
        ldap:
          ldap1:
            metadata: cn</pre></div></li></ol></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="configuring-file-realm.html">
              « 
              Configuring a file realm</a>
           
        </span><span class="next">
           
          <a href="configuring-native-realm.html">Configuring a native realm
               »
            </a></span></div></body></html>