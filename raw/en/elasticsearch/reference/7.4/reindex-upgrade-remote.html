<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Reindex from a remote cluster
        | Elasticsearch Reference [7.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [7.4]" /><link rel="up" href="reindex-upgrade.html" title="Reindex before upgrading" /><link rel="prev" href="reindex-upgrade-inplace.html" title="Reindex in place" /><link rel="next" href="search-aggregations.html" title="Aggregations" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/7.4" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="7.4" /></head><body><div xmlns="" class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [7.4]
    </a></span> » <span class="breadcrumb-link"><a href="setup-upgrade.html">Upgrade Elasticsearch</a></span> » <span class="breadcrumb-link"><a href="reindex-upgrade.html">Reindex before upgrading</a></span> » <span class="breadcrumb-node">Reindex from a remote cluster</span></div><div xmlns="" class="navheader"><span class="prev"><a href="reindex-upgrade-inplace.html">
              « 
              Reindex in place</a>
           
        </span><span class="next">
           
          <a href="search-aggregations.html">Aggregations
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="reindex-upgrade-remote"></a>Reindex from a remote cluster<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/7.4/docs/reference/upgrade/reindex_upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>You can use <a class="link" href="docs-reindex.html#reindex-from-remote" title="Reindex from Remote">reindex from remote</a> to migrate indices from
your old cluster to a new 7.4.0 cluster. This enables you move to 7.4.0
from a pre-6.8 cluster without interrupting service.</p><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Elasticsearch provides backwards compatibility support that enables
indices from the previous major version to be upgraded to the
current major version. Skipping a major version means that you must
resolve any backward compatibility issues yourself.</p><p xmlns="http://www.w3.org/1999/xhtml">If you use machine learning features and you’re migrating indices from a 6.5 or earlier
cluster, the job and datafeed configuration information are not stored in an
index. You must recreate your machine learning jobs in the new cluster. If you are migrating
from a 6.6 or later cluster, it is a good idea to temporarily halt the tasks
associated with your machine learning jobs and datafeeds to prevent inconsistencies between
different machine learning indices that are reindexed at slightly different times. Use the
<a class="link" href="ml-set-upgrade-mode.html" title="Set upgrade mode API">set upgrade mode API</a> or
<a class="ulink" href="https://www.elastic.co/guide/en/elastic-stack-overview/7.4/stopping-ml.html" target="_top">stop all datafeeds and close all machine learning jobs</a>.</p></div></div><p>To migrate your indices:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Set up a new 7.4.0 cluster and add the existing cluster to the
<code class="literal">reindex.remote.whitelist</code> in <code class="literal">elasticsearch.yml</code>.</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">reindex.remote.whitelist: oldhost:9200</pre></div><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The new cluster doesn’t have to start fully-scaled out. As you migrate
indices and shift the load to the new cluster, you can add nodes to the new
cluster and remove nodes from the old one.</p></div></div></li><li class="listitem"><p class="simpara">For each index that you need to migrate to the new cluster:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">Create an index the appropriate mappings and settings. Set the
<code class="literal">refresh_interval</code> to <code class="literal">-1</code> and set <code class="literal">number_of_replicas</code> to <code class="literal">0</code> for
faster reindexing.</li><li class="listitem"><p class="simpara">Use the <a class="link" href="docs-reindex.html" title="Reindex API"><code class="literal">reindex</code> API</a> to pull documents from the
remote index into the new 7.4.0 index:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">POST _reindex
{
  "source": {
    "remote": {
      "host": "http://oldhost:9200",
      "username": "user",
      "password": "pass"
    },
    "index": "source",
    "query": {
      "match": {
        "test": "data"
      }
    }
  },
  "dest": {
    "index": "dest"
  }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/50.console"></div><p class="simpara">If you run the reindex job in the background by setting <code class="literal">wait_for_completion</code>
to <code class="literal">false</code>, the reindex request returns a <code class="literal">task_id</code> you can use to
monitor progress of the reindex job with the <a class="link" href="tasks.html" title="Task Management API">task API</a>:
<code class="literal">GET _tasks/TASK_ID</code>.</p></li><li class="listitem">When the reindex job completes, set the <code class="literal">refresh_interval</code> and
<code class="literal">number_of_replicas</code> to the desired values (the default settings are
<code class="literal">30s</code> and <code class="literal">1</code>).</li><li class="listitem">Once reindexing is complete and the status of the new index is <code class="literal">green</code>,
you can delete the old index.</li></ol></div></li></ol></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="reindex-upgrade-inplace.html">
              « 
              Reindex in place</a>
           
        </span><span class="next">
           
          <a href="search-aggregations.html">Aggregations
               »
            </a></span></div></body></html>