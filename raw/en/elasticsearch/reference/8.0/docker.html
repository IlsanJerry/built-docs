<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Install Elasticsearch with Docker | Elasticsearch Guide [8.0] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Guide [8.0]"/>
<link rel="up" href="install-elasticsearch.html" title="Installing Elasticsearch"/>
<link rel="prev" href="windows.html" title="Install Elasticsearch with Windows MSI Installer"/>
<link rel="next" href="brew.html" title="Install Elasticsearch on macOS with Homebrew"/>
<meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/8.0"/>
<meta name="DC.subject" content="Elasticsearch"/>
<meta name="DC.identifier" content="8.0"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Guide [8.0]</a></span>
»
<span class="breadcrumb-link"><a href="setup.html">Set up Elasticsearch</a></span>
»
<span class="breadcrumb-link"><a href="install-elasticsearch.html">Installing Elasticsearch</a></span>
»
<span class="breadcrumb-node">Install Elasticsearch with Docker</span>
</div>
<div class="navheader">
<span class="prev">
<a href="windows.html">« Install Elasticsearch with Windows MSI Installer</a>
</span>
<span class="next">
<a href="brew.html">Install Elasticsearch on macOS with Homebrew »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="docker"></a>Install Elasticsearch with Docker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h2>
</div></div></div>
<p>Elasticsearch is also available as Docker images. Starting with version 8.0.0, these
are based upon a tiny core of essential files. Prior versions used
<a href="https://hub.docker.com/_/centos/" class="ulink" target="_top">centos:8</a> as the base image.</p>
<p>A list of all published Docker images and tags is available at
<a href="https://www.docker.elastic.co" class="ulink" target="_top">www.docker.elastic.co</a>. The source files
are in
<a href="https://github.com/elastic/elasticsearch/blob/8.0/distribution/docker" class="ulink" target="_top">Github</a>.</p>
<p>This package contains both free and subscription features.
<a class="xref" href="license-settings.html" title="License settings">Start a 30-day trial</a> to try out all of the features.</p>
<p>Starting in Elasticsearch 8.0, security is enabled by default. With security enabled,
Elastic Stack security features require TLS encryption for the transport networking
layer, or your cluster will fail to start.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_install_docker_desktop_or_docker_engine"></a>Install Docker Desktop or Docker Engine<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>Install the appropriate <a href="https://docs.docker.com/get-docker/" class="ulink" target="_top">Docker application</a>
for your operating system.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Make sure that Docker is allotted at least 4GiB of memory. In Docker
Desktop, you configure resource usage on the Advanced tab in Preference (macOS)
or Settings (Windows).</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_pull_the_elasticsearch_docker_image"></a>Pull the Elasticsearch Docker image<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>Obtaining Elasticsearch for Docker is as simple as issuing a <code class="literal">docker pull</code> command
against the Elastic Docker registry.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker pull docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1</pre>
</div>
<p>Now that you have the Elasticsearch Docker image, you can start a
<a class="xref" href="docker.html#docker-cli-run-dev-mode" title="Start a single-node cluster with Docker">single-node</a> or <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">multi-node</a>
cluster.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-cli-run-dev-mode"></a>Start a single-node cluster with Docker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>If you&#8217;re starting a single-node Elasticsearch cluster in a Docker container, security
will be automatically enabled and configured for you. When you start Elasticsearch for
the first time, the following security configuration occurs automatically:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docker.html#elasticsearch-security-certificates" title="Security certificates and keys">Certificates and keys</a> are generated
for the transport and HTTP layers.
</li>
<li class="listitem">
The Transport Layer Security (TLS) configuration settings are written to
<code class="literal">elasticsearch.yml</code>.
</li>
<li class="listitem">
A password is generated for the <code class="literal">elastic</code> user.
</li>
<li class="listitem">
An enrollment token is generated for Kibana.
</li>
</ul>
</div>
<p>You can then <a href="/guide/en/kibana/8.0/docker.html" class="ulink" target="_top">start Kibana</a> and enter the enrollment
token, which is valid for 30 minutes. This token automatically applies the
security settings from your Elasticsearch cluster, authenticates to Elasticsearch with the
<code class="literal">kibana_system</code> user, and writes the security configuration to <code class="literal">kibana.yml</code>.</p>
<p>The following command starts a single-node Elasticsearch cluster for development or
testing.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Start Elasticsearch in Docker. A password is generated for the <code class="literal">elastic</code> user and
output to the terminal, plus an enrollment token for enrolling Kibana.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run --name es-node01 -p 9200:9200 -p 9300:9300 -it docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1</pre>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>You might need to scroll back a bit in the terminal to view the password
and enrollment token.</p>
</div>
</div>
</li>
<li class="listitem">
<p>Copy the generated password and enrollment token and save them in a secure
location. These values are shown only when you start Elasticsearch for the first time.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you need to reset the password for the <code class="literal">elastic</code> user or other
built-in users, run the <a class="xref" href="reset-password.html" title="elasticsearch-reset-password"><code class="literal">elasticsearch-reset-password</code></a> tool.
This tool is available in the Elasticsearch <code class="literal">/bin</code> directory of the Docker container.
For example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker exec -it es-node01 /usr/share/elasticsearch/bin/reset-elastic-password</pre>
</div>
</div>
</div>
</li>
<li class="listitem">
<p>Copy the <code class="literal">http_ca.crt</code> security certificate from your Docker container to
your local machine.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker cp es-node01:/usr/share/elasticsearch/config/tls_auto_config_*/http_ca.crt .</pre>
</div>
</li>
<li class="listitem">
<p>Open a new terminal and verify that you can connect to your Elasticsearch cluster by
making an authenticated call, using the <code class="literal">http_ca.crt</code> file that you copied from
your Docker container. Enter the password for the <code class="literal">elastic</code> user when prompted.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl --cacert http_ca.crt -u elastic https://localhost:9200</pre>
</div>
</li>
</ol>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_next_steps_6"></a>Next steps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You now have a test Elasticsearch environment set up. Before you start
serious development or go into production with Elasticsearch, review the
<a class="xref" href="docker.html#docker-prod-prerequisites" title="Using the Docker images in production">requirements and recommendations</a> to apply when running Elasticsearch in Docker in production.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="elasticsearch-security-certificates"></a>Security certificates and keys<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>When you start Elasticsearch for the first time, the following certificates and keys are
generated in the
<code class="literal">/usr/share/elasticsearch/config/tls_auto_config_initial_node_&lt;timestamp&gt;</code>
directory in the Docker container, and allow you to connect a Kibana instance
to your secured Elasticsearch cluster and encrypt internode communication. The files are
listed here for reference.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">http_ca.crt</code>
</span>
</dt>
<dd>
The CA certificate that is used to sign the certificates for the HTTP layer of
this Elasticsearch cluster.
</dd>
<dt>
<span class="term">
<code class="literal">http_keystore_local_node.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the HTTP layer for this node.
</dd>
<dt>
<span class="term">
<code class="literal">transport_keystore_all_nodes.p12</code>
</span>
</dt>
<dd>
Keystore that contains the key and certificate for the transport layer for all
the nodes in your cluster.
</dd>
</dl>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-compose-file"></a>Start a multi-node cluster with Docker Compose<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>When defining multiple nodes in a <code class="literal">docker-compose.yml</code> file, you&#8217;ll need to
explicitly enable and configure security so that Elasticsearch doesn&#8217;t try to generate a
password for the <code class="literal">elastic</code> user on every node.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_prepare_the_environment"></a>Prepare the environment<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The following example uses Docker Compose to start a three-node Elasticsearch cluster.
Create each of the following files inside of a new directory. Copy and paste the
contents of each example into the appropriate file as described in the
following sections:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="docker.html#docker-instances-yml" title="instances.yml"><code class="literal">instances.yml</code></a>
</li>
<li class="listitem">
<a class="xref" href="docker.html#docker-env" title=".env"><code class="literal">.env</code></a>
</li>
<li class="listitem">
<a class="xref" href="docker.html#docker-create-certs" title="create-certs.yml"><code class="literal">create-certs.yml</code></a>
</li>
<li class="listitem">
<a class="xref" href="docker.html#docker-docker-compose" title="docker-compose.yml"><code class="literal">docker-compose.yml</code></a>
</li>
</ul>
</div>
<h5><a id="docker-instances-yml"></a><code class="literal">instances.yml</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
<p>When you run the example, Elasticsearch uses this file to create a three-node cluster.
The nodes are named <code class="literal">es01</code>, <code class="literal">es02</code>,and <code class="literal">es03</code>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">instances:
  - name: es01
    dns:
      - es01
      - localhost
    ip:
      - 127.0.0.1

  - name: es02
    dns:
      - es02
      - localhost
    ip:
      - 127.0.0.1

  - name: es03
    dns:
      - es03
      - localhost
    ip:
      - 127.0.0.1</pre>
</div>
<h5><a id="docker-env"></a><code class="literal">.env</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
<p>The <code class="literal">.env</code> file sets environment variables that are used when you run the
example. Ensure that you specify a strong password for the <code class="literal">elastic</code> user with
the <code class="literal">ELASTIC_PASSWORD</code> variable. This variable is referenced by the
<code class="literal">docker-compose.yml</code> file.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">COMPOSE_PROJECT_NAME=es
CERTS_DIR=/usr/share/elasticsearch/config/certificates
ELASTIC_PASSWORD=&lt;password&gt;</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">COMPOSE_PROJECT_NAME</code>
</span>
</dt>
<dd>
Adds an <code class="literal">es_</code> prefix for all volumes and networks
created by <code class="literal">docker-compose</code>.
</dd>
<dt>
<span class="term">
<code class="literal">CERTS_DIR</code>
</span>
</dt>
<dd>
Specifies the path inside the Docker image where Elasticsearch expects the
security certificates.
</dd>
<dt>
<span class="term">
<code class="literal">ELASTIC_PASSWORD</code>
</span>
</dt>
<dd>
Sets the initial password for the <code class="literal">elastic</code> user.
</dd>
</dl>
</div>
<h5><a id="docker-create-certs"></a><code class="literal">create-certs.yml</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
<p>The <code class="literal">create-certs.yml</code> file includes a script that generates node certificates
and a certificate authority (CA) certificate and key where Elasticsearch expects them.
These certificates and key are placed in a Docker volume named <code class="literal">es_certs</code>.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: "2.2"

services:
  create_certs:
    container_name: create_certs
    image: docker.elastic.co/elasticsearch/elasticsearch:7.15.1
    command: &gt;
      bash -c '
        if [[ ! -f /certs/bundle.zip ]]; then
          bin/elasticsearch-certutil cert --silent --pem --in config/certificates/instances.yml -out /certs/bundle.zip;
          unzip /certs/bundle.zip -d /certs;
        fi;
        chown -R 1000:0 /certs
      '
    user: "0"
    working_dir: /usr/share/elasticsearch
    volumes: ["certs:/certs", ".:/usr/share/elasticsearch/config/certificates"]

volumes: { "certs" }</pre>
</div>
<h5><a id="docker-docker-compose"></a><code class="literal">docker-compose.yml</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h5>
<p>The <code class="literal">docker-compose.yml</code> file defines configuration settings for each of your
Elasticsearch nodes.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This sample <code class="literal">docker-compose.yml</code> file uses the <code class="literal">ES_JAVA_OPTS</code>
environment variable to manually set the heap size to 512MB. We do not recommend
using <code class="literal">ES_JAVA_OPTS</code> in production.
See <a class="xref" href="docker.html#docker-set-heap-size" title="Manually set the heap size">manually set the heap size</a>.</p>
</div>
</div>
<p>This configuration exposes port <code class="literal">9200</code> on all network interfaces. Given how
Docker manipulates <code class="literal">iptables</code> on Linux, this means that your Elasticsearch cluster is
publicly accessible, potentially ignoring any firewall settings. If you don&#8217;t
want to expose port <code class="literal">9200</code> and instead use a reverse proxy, replace <code class="literal">9200:9200</code>
with <code class="literal">127.0.0.1:9200:9200</code> in the <code class="literal">docker-compose.yml</code> file. Elasticsearch will then only
be accessible from the host machine itself.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">version: "2.2"

services:
  es01:
    container_name: es01
    image: { docker-image }
    environment:
      - node.name=es01
      - discovery.seed_hosts=es02,es03
      - cluster.initial_master_nodes=es01,es02,es03
      - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=$CERTS_DIR/es01/es01.key
      - xpack.security.http.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.http.ssl.certificate=$CERTS_DIR/es01/es01.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.security.transport.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.transport.ssl.certificate=$CERTS_DIR/es01/es01.crt
      - xpack.security.transport.ssl.key=$CERTS_DIR/es01/es01.key
    volumes: ["data01:/usr/share/elasticsearch/data", "certs:$CERTS_DIR"]
    ports:
      - 9200:9200
    healthcheck:
      test: curl --cacert $CERTS_DIR/ca/ca.crt -s https://localhost:9200 &gt;/dev/null; if [[ $$? == 52 ]]; then echo 0; else echo 1; fi
      interval: 30s
      timeout: 10s
      retries: 5

  es02:
    container_name: es02
    image: { docker-image }
    environment:
      - node.name=es02
      - discovery.seed_hosts=es01,es03
      - cluster.initial_master_nodes=es01,es02,es03
      - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.license.self_generated.type=trial
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=$CERTS_DIR/es02/es02.key
      - xpack.security.http.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.http.ssl.certificate=$CERTS_DIR/es02/es02.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.security.transport.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.transport.ssl.certificate=$CERTS_DIR/es02/es02.crt
      - xpack.security.transport.ssl.key=$CERTS_DIR/es02/es02.key
    volumes: ["data02:/usr/share/elasticsearch/data", "certs:$CERTS_DIR"]

  es03:
    container_name: es03
    image: { docker-image }
    environment:
      - node.name=es03
      - discovery.seed_hosts=es01,es02
      - cluster.initial_master_nodes=es01,es02,es03
      - ELASTIC_PASSWORD=$ELASTIC_PASSWORD
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.license.self_generated.type=trial
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=true
      - xpack.security.http.ssl.key=$CERTS_DIR/es03/es03.key
      - xpack.security.http.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.http.ssl.certificate=$CERTS_DIR/es03/es03.crt
      - xpack.security.transport.ssl.enabled=true
      - xpack.security.transport.ssl.verification_mode=certificate
      - xpack.security.transport.ssl.certificate_authorities=$CERTS_DIR/ca/ca.crt
      - xpack.security.transport.ssl.certificate=$CERTS_DIR/es03/es03.crt
      - xpack.security.transport.ssl.key=$CERTS_DIR/es03/es03.key
    volumes: ["data03:/usr/share/elasticsearch/data", "certs:$CERTS_DIR"]

  wait_until_ready:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.15.1
    command: /usr/bin/true
    depends_on: { "es01": { "condition": "service_healthy" } }

volumes: { "data01", "data02", "data03", "certs" }</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_start_your_cluster_with_security_enabled_and_configured"></a>Start your cluster with security enabled and configured<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>This sample Docker Compose file starts a three-node Elasticsearch cluster.</p>
<p>The <a href="https://docs.docker.com/storage/volumes" class="ulink" target="_top">Docker named volumes</a>
<code class="literal">data01</code>, <code class="literal">data02</code>, and <code class="literal">data03</code> store the node data directories so that the
data persists across restarts. If they don&#8217;t already exist, running
<code class="literal">docker-compose</code> creates these volumes.</p>
<div id="docker-generate-certificates" class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Generate the certificates. You only need to run this command one time:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose -f create-certs.yml run --rm create_certs</pre>
</div>
</li>
<li class="listitem">
<p>Start your Elasticsearch nodes with TLS configured on the transport layer:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose up -d</pre>
</div>
<p>Node <code class="literal">es01</code> listens on <code class="literal">localhost:9200</code> and <code class="literal">es02</code> and <code class="literal">es03</code> talk to <code class="literal">es01</code>
over a Docker network.</p>
</li>
<li class="listitem">
<p>Access the Elasticsearch API over TLS using the bootstrapped password for the <code class="literal">elastic</code>
user that you specified in the <code class="literal">.env</code> file:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run --rm -v es_certs:/certs --network=es_default docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1 curl --cacert /certs/ca/ca.crt -u elastic:&lt;password&gt; https://es01:9200</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">es_certs</code>
</span>
</dt>
<dd>
The name of the volume that the script in <code class="literal">create-certs.yml</code>
creates to hold your certificates.
</dd>
<dt>
<span class="term">
<code class="literal">&lt;password&gt;</code>
</span>
</dt>
<dd>
The password for the <code class="literal">elastic</code> user, defined by the
<code class="literal">ELASTIC_PASSWORD</code> variable in the <code class="literal">.env</code> file.
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>Submit a <code class="literal">_cat/nodes</code> request to check that the nodes are up and running:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl -X GET "https://localhost:9200/_cat/nodes?v=true&amp;pretty"</pre>
</div>
</li>
</ol>
</div>
<p>Log messages go to the console and are handled by the configured Docker logging
driver. By default, you can access logs with <code class="literal">docker logs</code>. If you prefer that
the Elasticsearch container write logs to disk, set the <code class="literal">ES_LOG_STYLE</code> environment
variable to <code class="literal">file</code>. This causes Elasticsearch to use the same logging configuration as
other Elasticsearch distribution formats.</p>
<p>If you need to generate a new password for the <code class="literal">elastic</code> user or any of the
built-in users, use the <code class="literal">elasticsearch-reset-password</code> tool:</p>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Windows users not running PowerShell must remove all backslashes (<code class="literal">\</code>)
and join lines in the following command.</p>
</div>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker exec es01 /bin/bash -c "bin/elasticsearch-reset-password \
auto --batch \
--url https://localhost:9200"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_stop_the_cluster"></a>Stop the cluster<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>To stop the cluster, run <code class="literal">docker-compose down</code>. The data in the Docker volumes
is preserved and loaded when you restart the cluster with <code class="literal">docker-compose up</code>.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose down</pre>
</div>
<p>To <span class="strong strong"><strong>delete the data volumes</strong></span> when you stop the cluster, specify the <code class="literal">-v</code>
option:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-compose down -v</pre>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>Deleting data volumes will remove the generated security certificates
for your nodes. You will need to run <code class="literal">docker-compose</code> and
<a class="xref" href="docker.html#docker-generate-certificates">regenerate the security certificates</a> before
starting your cluster.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_next_steps_7"></a>Next steps<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You now have a test Elasticsearch environment set up. Before you start
serious development or go into production with Elasticsearch, review the
<a class="xref" href="docker.html#docker-prod-prerequisites" title="Using the Docker images in production">requirements and recommendations</a> to apply when running Elasticsearch in Docker in production.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-prod-prerequisites"></a>Using the Docker images in production<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>The following requirements and recommendations apply when running Elasticsearch in Docker in production.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_set_vm_max_map_count_to_at_least_262144"></a>Set <code class="literal">vm.max_map_count</code> to at least <code class="literal">262144</code><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The <code class="literal">vm.max_map_count</code> kernel setting must be set to at least <code class="literal">262144</code> for production use.</p>
<p>How you set <code class="literal">vm.max_map_count</code> depends on your platform:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Linux</p>
<p>The <code class="literal">vm.max_map_count</code> setting should be set permanently in <code class="literal">/etc/sysctl.conf</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">grep vm.max_map_count /etc/sysctl.conf
vm.max_map_count=262144</pre>
</div>
<p>To apply the setting on a live system, run:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sysctl -w vm.max_map_count=262144</pre>
</div>
</li>
<li class="listitem">
<p>macOS with <a href="https://docs.docker.com/docker-for-mac" class="ulink" target="_top">Docker for Mac</a></p>
<p>The <code class="literal">vm.max_map_count</code> setting must be set within the xhyve virtual machine:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>From the command line, run:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty</pre>
</div>
</li>
<li class="listitem">
<p>Press enter and use`sysctl` to configure <code class="literal">vm.max_map_count</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">sysctl -w vm.max_map_count=262144</pre>
</div>
</li>
<li class="listitem">
To exit the <code class="literal">screen</code> session, type <code class="literal">Ctrl a d</code>.
</li>
</ol>
</div>
</li>
<li class="listitem">
<p>Windows and macOS with <a href="https://www.docker.com/products/docker-desktop" class="ulink" target="_top">Docker Desktop</a></p>
<p>The <code class="literal">vm.max_map_count</code> setting must be set via docker-machine:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker-machine ssh
sudo sysctl -w vm.max_map_count=262144</pre>
</div>
</li>
<li class="listitem">
<p>Windows with <a href="https://docs.docker.com/docker-for-windows/wsl" class="ulink" target="_top">Docker Desktop WSL 2 backend</a></p>
<p>The <code class="literal">vm.max_map_count</code> setting must be set in the docker-desktop container:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">wsl -d docker-desktop
sysctl -w vm.max_map_count=262144</pre>
</div>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_configuration_files_must_be_readable_by_the_elasticsearch_user"></a>Configuration files must be readable by the <code class="literal">elasticsearch</code> user<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch runs inside the container as user <code class="literal">elasticsearch</code> using
uid:gid <code class="literal">1000:0</code>.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>One exception is <a href="https://docs.openshift.com/container-platform/3.6/creating_images/guidelines.html#openshift-specific-guidelines" class="ulink" target="_top">Openshift</a>,
which runs containers using an arbitrarily assigned user ID.
Openshift presents persistent volumes with the gid set to <code class="literal">0</code>, which works without any adjustments.</p>
</div>
</div>
<p>If you are bind-mounting a local directory or file, it must be readable by the <code class="literal">elasticsearch</code> user.
In addition, this user must have write access to the <a class="xref" href="important-settings.html#path-settings" title="Path settings">config, data and log dirs</a>
(Elasticsearch needs write access to the <code class="literal">config</code> directory so that it can generate a keystore).
A good strategy is to grant group access to gid <code class="literal">0</code> for the local directory.</p>
<p>For example, to prepare a local directory for storing data through a bind-mount:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">mkdir esdatadir
chmod g+rwx esdatadir
chgrp 0 esdatadir</pre>
</div>
<p>You can also run an Elasticsearch container using both a custom UID and GID. Unless you
bind-mount each of the <code class="literal">config</code>, <code class="literal">data</code> and <code class="literal">logs</code> directories, you must pass
the command line option <code class="literal">--group-add 0</code> to <code class="literal">docker run</code>. This ensures that the user
under which Elasticsearch is running is also a member of the <code class="literal">root</code> (GID 0) group inside the
container.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_increase_ulimits_for_nofile_and_nproc"></a>Increase ulimits for nofile and nproc<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Increased ulimits for <a class="xref" href="setting-system-settings.html" title="Configuring system settings">nofile</a> and <a class="xref" href="max-number-threads-check.html" title="Maximum number of threads check">nproc</a>
must be available for the Elasticsearch containers.
Verify the <a href="https://github.com/moby/moby/tree/ea4d1243953e6b652082305a9c3cda8656edab26/contrib/init" class="ulink" target="_top">init system</a>
for the Docker daemon sets them to acceptable values.</p>
<p>To check the Docker daemon defaults for ulimits, run:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run --rm centos:8 /bin/bash -c 'ulimit -Hn &amp;&amp; ulimit -Sn &amp;&amp; ulimit -Hu &amp;&amp; ulimit -Su'</pre>
</div>
<p>If needed, adjust them in the Daemon or override them per container.
For example, when using <code class="literal">docker run</code>, set:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">--ulimit nofile=65535:65535</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_disable_swapping"></a>Disable swapping<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Swapping needs to be disabled for performance and node stability.
For information about ways to do this, see <a class="xref" href="setup-configuration-memory.html" title="Disable swapping">Disable swapping</a>.</p>
<p>If you opt for the <code class="literal">bootstrap.memory_lock: true</code> approach,
you also need to define the <code class="literal">memlock: true</code> ulimit in the
<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#default-ulimits" class="ulink" target="_top">Docker Daemon</a>,
or explicitly set for the container as shown in the  <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">sample compose file</a>.
When using <code class="literal">docker run</code>, you can specify:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">-e "bootstrap.memory_lock=true" --ulimit memlock=-1:-1</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_randomize_published_ports"></a>Randomize published ports<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>The image <a href="https://docs.docker.com/engine/reference/builder/#/expose" class="ulink" target="_top">exposes</a>
TCP ports 9200 and 9300. For production clusters, randomizing the
published ports with <code class="literal">--publish-all</code> is recommended,
unless you are pinning one container per host.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-set-heap-size"></a>Manually set the heap size<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch automatically sizes JVM heap based on a nodes&#8217;s
<a class="xref" href="modules-node.html#node-roles" title="Node roles">roles</a> and the total memory available to the node&#8217;s container. We
recommend this default sizing for most production environments. If needed, you
can override default sizing by manually setting JVM heap size.</p>
<p>To manually set the heap size in production, bind mount a <a class="xref" href="advanced-configuration.html#set-jvm-options" title="Set JVM options">JVM
options</a> file under <code class="literal">/usr/share/elasticsearch/config/jvm.options.d</code> that
includes your desired <a class="xref" href="advanced-configuration.html#set-jvm-heap-size" title="Set the JVM heap size">heap size</a> settings.</p>
<p>For testing, you can also manually set the heap size using the <code class="literal">ES_JAVA_OPTS</code>
environment variable. For example, to use 16GB, specify <code class="literal">-e
ES_JAVA_OPTS="-Xms16g -Xmx16g"</code> with <code class="literal">docker run</code>. The <code class="literal">ES_JAVA_OPTS</code> variable
overrides all other JVM options. The <code class="literal">ES_JAVA_OPTS</code> variable overrides all other
JVM options. We do not recommend using <code class="literal">ES_JAVA_OPTS</code> in production. The
<code class="literal">docker-compose.yml</code> file above sets the heap size to 512MB.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_pin_deployments_to_a_specific_image_version"></a>Pin deployments to a specific image version<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Pin your deployments to a specific version of the Elasticsearch Docker image. For
example <code class="literal">docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_always_bind_data_volumes"></a>Always bind data volumes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>You should use a volume bound on <code class="literal">/usr/share/elasticsearch/data</code> for the following reasons:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
The data of your Elasticsearch node won&#8217;t be lost if the container is killed
</li>
<li class="listitem">
Elasticsearch is I/O sensitive and the Docker storage driver is not ideal for fast I/O
</li>
<li class="listitem">
It allows the use of advanced
<a href="https://docs.docker.com/engine/extend/plugins/#volume-plugins" class="ulink" target="_top">Docker volume plugins</a>
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_avoid_using_loop_lvm_mode"></a>Avoid using <code class="literal">loop-lvm</code> mode<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>If you are using the devicemapper storage driver, do not use the default <code class="literal">loop-lvm</code> mode.
Configure docker-engine to use
<a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-docker-with-devicemapper" class="ulink" target="_top">direct-lvm</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_centralize_your_logs"></a>Centralize your logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Consider centralizing your logs by using a different
<a href="https://docs.docker.com/engine/admin/logging/overview/" class="ulink" target="_top">logging driver</a>. Also
note that the default json-file logging driver is not ideally suited for
production use.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="docker-configuration-methods"></a>Configuring Elasticsearch with Docker<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h3>
</div></div></div>
<p>When you run in Docker, the <a class="xref" href="settings.html#config-files-location" title="Config files location">Elasticsearch configuration files</a> are loaded from
<code class="literal">/usr/share/elasticsearch/config/</code>.</p>
<p>To use custom configuration files, you <a class="xref" href="docker.html#docker-config-bind-mount" title="Mounting Elasticsearch configuration files">bind-mount the files</a>
over the configuration files in the image.</p>
<p>You can set individual Elasticsearch configuration parameters using Docker environment variables.
The <a class="xref" href="docker.html#docker-compose-file" title="Start a multi-node cluster with Docker Compose">sample compose file</a> and the
<a class="xref" href="docker.html#docker-cli-run-dev-mode" title="Start a single-node cluster with Docker">single-node example</a> use this method. You can
use the setting name directly as the environment variable name. If
you cannot do this, for example because your orchestration platform forbids
periods in environment variable names, then you can use an alternative
style by converting the setting name as follows.</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Change the setting name to uppercase
</li>
<li class="listitem">
Prefix it with <code class="literal">ES_SETTING_</code>
</li>
<li class="listitem">
Escape any underscores (<code class="literal">_</code>) by duplicating them
</li>
<li class="listitem">
Convert all periods (<code class="literal">.</code>) to underscores (<code class="literal">_</code>)
</li>
</ol>
</div>
<p>For example, <code class="literal">-e bootstrap.memory_lock=true</code> becomes
<code class="literal">-e ES_SETTING_BOOTSTRAP_MEMORY__LOCK=true</code>.</p>
<p>You can use the contents of a file to set the value of the
<code class="literal">ELASTIC_PASSWORD</code> or <code class="literal">KEYSTORE_PASSWORD</code> environment variables, by
suffixing the environment variable name with <code class="literal">_FILE</code>. This is useful for
passing secrets such as passwords to Elasticsearch without specifying them directly.</p>
<p>For example, to set the Elasticsearch bootstrap password from a file, you can bind mount the
file and set the <code class="literal">ELASTIC_PASSWORD_FILE</code> environment variable to the mount location.
If you mount the password file to <code class="literal">/run/secrets/bootstrapPassword.txt</code>, specify:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">-e ELASTIC_PASSWORD_FILE=/run/secrets/bootstrapPassword.txt</pre>
</div>
<p>You can override the default command for the image to pass Elasticsearch configuration
parameters as command line options. For example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run &lt;various parameters&gt; bin/elasticsearch -Ecluster.name=mynewclustername</pre>
</div>
<p>While bind-mounting your configuration files is usually the preferred method in production,
you can also <a class="xref" href="docker.html#_c_customized_image" title="Using custom Docker images">create a custom Docker image</a>
that contains your configuration.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-config-bind-mount"></a>Mounting Elasticsearch configuration files<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>Create custom config files and bind-mount them over the corresponding files in the Docker image.
For example, to bind-mount <code class="literal">custom_elasticsearch.yml</code> with <code class="literal">docker run</code>, specify:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">-v full_path_to/custom_elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</pre>
</div>
<p>If you bind-mount a custom <code class="literal">elasticsearch.yml</code> file, ensure it includes the
<code class="literal">network.host: 0.0.0.0</code> setting. This setting ensures the node is reachable for
HTTP and transport traffic, provided its ports are exposed. The Docker image&#8217;s
built-in <code class="literal">elasticsearch.yml</code> file includes this setting by default.</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The container <span class="strong strong"><strong>runs Elasticsearch as user <code class="literal">elasticsearch</code> using
uid:gid <code class="literal">1000:0</code></strong></span>. Bind mounted host directories and files must be accessible by this user,
and the data and log directories must be writable by this user.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="docker-keystore-bind-mount"></a>Create an encrypted Elasticsearch keystore<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>By default, Elasticsearch will auto-generate a keystore file for <a class="xref" href="secure-settings.html" title="Secure settings">secure
settings</a>. This file is obfuscated but not encrypted.</p>
<p>To encrypt your secure settings with a password and have them persist outside
the container, use a <code class="literal">docker run</code> command to manually create the keystore
instead. The command must:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Bind-mount the <code class="literal">config</code> directory. The command will create an
<code class="literal">elasticsearch.keystore</code> file in this directory. To avoid errors, do
not directly bind-mount the <code class="literal">elasticsearch.keystore</code> file.
</li>
<li class="listitem">
Use the <code class="literal">elasticsearch-keystore</code> tool with the <code class="literal">create -p</code> option. You&#8217;ll be
prompted to enter a password for the keystore.
</li>
</ul>
</div>
<p>For example:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1 \
bin/elasticsearch-keystore create -p</pre>
</div>
<p>You can also use a <code class="literal">docker run</code> command to add or update secure settings in the
keystore. You&#8217;ll be prompted to enter the setting values. If the keystore is
encrypted, you&#8217;ll also be prompted to enter the keystore password.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker run -it --rm \
-v full_path_to/config:/usr/share/elasticsearch/config \
docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1 \
bin/elasticsearch-keystore \
add my.secure.setting \
my.other.secure.setting</pre>
</div>
<p>If you&#8217;ve already created the keystore and don&#8217;t need to update it, you can
bind-mount the <code class="literal">elasticsearch.keystore</code> file directly. You can use the
<code class="literal">KEYSTORE_PASSWORD</code> environment variable to provide the keystore password to the
container at startup. For example, a <code class="literal">docker run</code> command might have the
following options:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">-v full_path_to/config/elasticsearch.keystore:/usr/share/elasticsearch/config/elasticsearch.keystore
-e KEYSTORE_PASSWORD=mypassword</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_c_customized_image"></a>Using custom Docker images<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<p>In some environments, it might make more sense to prepare a custom image that contains
your configuration. A <code class="literal">Dockerfile</code> to achieve this might be as simple as:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">FROM docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1
COPY --chown=elasticsearch:elasticsearch elasticsearch.yml /usr/share/elasticsearch/config/</pre>
</div>
<p>You could then build and run the image with:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">docker build --tag=elasticsearch-custom .
docker run -ti -v /usr/share/elasticsearch/data elasticsearch-custom</pre>
</div>
<p>Some plugins require additional security permissions.
You must explicitly accept them either by:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Attaching a <code class="literal">tty</code> when you run the Docker image and allowing the permissions when prompted.
</li>
<li class="listitem">
Inspecting the security permissions and accepting them (if appropriate) by adding the <code class="literal">--batch</code> flag to the plugin install command.
</li>
</ul>
</div>
<p>See <a href="/guide/en/elasticsearch/plugins/8.0/_other_command_line_parameters.html" class="ulink" target="_top">Plugin management</a>
for more information.</p>
<p>The Elasticsearch Docker image only includes what is required to run Elasticsearch, and does
not provide a package manager. It is possible to add additional utilities
with a multi-phase Docker build. You must also copy any dependencies, for
example shared libraries.</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">FROM centos:8 AS builder
yum install -y some-package

FROM docker.elastic.co/elasticsearch/elasticsearch:8.0.0-beta1
COPY --from=builder /usr/bin/some-utility /usr/bin/
COPY --from=builder /usr/lib/some-lib.so /usr/lib/</pre>
</div>
<p>You should use <code class="literal">centos:8</code> as a base in order to avoid incompatibilities.
Use <a href="http://man7.org/linux/man-pages/man1/ldd.1.html" class="ulink" target="_top"><code class="literal">ldd</code></a> to list the
shared libraries required by a utility.</p>
<h4><a id="troubleshoot-docker-errors"></a>Troubleshoot Docker errors for Elasticsearch<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
<p>Here’s how to resolve common errors when running Elasticsearch with Docker.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_elasticsearch_keystore_is_a_directory"></a>elasticsearch.keystore is a directory<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">Exception in thread "main" org.elasticsearch.bootstrap.BootstrapException: java.io.IOException: Is a directory: SimpleFSIndexInput(path="/usr/share/elasticsearch/config/elasticsearch.keystore") Likely root cause: java.io.IOException: Is a directory</pre>
</div>
<p>A <a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">keystore-related</a> <code class="literal">docker run</code> command attempted
to directly bind-mount an <code class="literal">elasticsearch.keystore</code> file that doesn&#8217;t exist. If
you use the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to mount a file that doesn&#8217;t exist, Docker
instead creates a directory with the same name.</p>
<p>To resolve this error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Delete the <code class="literal">elasticsearch.keystore</code> directory in the <code class="literal">config</code> directory.
</li>
<li class="listitem">
Update the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to point to the <code class="literal">config</code> directory path
rather than the keystore file&#8217;s path. For an example, see
<a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">Create an encrypted Elasticsearch keystore</a>.
</li>
<li class="listitem">
Retry the command.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_elasticsearch_keystore_device_or_resource_busy"></a>elasticsearch.keystore: Device or resource busy<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch/edit/8.0/docs/reference/setup/install/docker.asciidoc">edit</a></h4>
</div></div></div>
<div class="pre_wrapper lang-txt">
<pre class="programlisting prettyprint lang-txt">Exception in thread "main" java.nio.file.FileSystemException: /usr/share/elasticsearch/config/elasticsearch.keystore.tmp -&gt; /usr/share/elasticsearch/config/elasticsearch.keystore: Device or resource busy</pre>
</div>
<p>A <code class="literal">docker run</code> command attempted to <a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">update the
keystore</a> while directly bind-mounting the <code class="literal">elasticsearch.keystore</code> file. To
update the keystore, the container requires access to other files in the
<code class="literal">config</code> directory, such as <code class="literal">keystore.tmp</code>.</p>
<p>To resolve this error:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Update the <code class="literal">-v</code> or <code class="literal">--volume</code> flag to point to the <code class="literal">config</code> directory
path rather than the keystore file&#8217;s path. For an example, see
<a class="xref" href="docker.html#docker-keystore-bind-mount" title="Create an encrypted Elasticsearch keystore">Create an encrypted Elasticsearch keystore</a>.
</li>
<li class="listitem">
Retry the command.
</li>
</ol>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="windows.html">« Install Elasticsearch with Windows MSI Installer</a>
</span>
<span class="next">
<a href="brew.html">Install Elasticsearch on macOS with Homebrew »</a>
</span>
</div>
</div>
</body>
</html>
