<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Migration upgrade API
        | Elasticsearch Reference [6.7]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [6.7]" /><link rel="up" href="migration-api.html" title="Migration APIs" /><link rel="prev" href="migration-api-assistance.html" title="Migration assistance API" /><link rel="next" href="migration-api-deprecation.html" title="Deprecation info APIs" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.7" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="6.7" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [6.7]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-api.html">X-Pack APIs</a></span> » <span class="breadcrumb-link"><a href="migration-api.html">Migration APIs</a></span> » <span class="breadcrumb-node">Migration upgrade API</span></div><div xmlns="" class="navheader"><span class="prev"><a href="migration-api-assistance.html">
              « 
              Migration assistance API</a>
           
        </span><span class="next">
           
          <a href="migration-api-deprecation.html">Deprecation info APIs
               »
            </a></span></div><div class="xpack section"><div class="titlepage"><div><div><h2 class="title"><a id="migration-api-upgrade"></a>Migration upgrade API<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.7/docs/reference/migration/apis/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a xmlns="" class="xpack_tag" href="/subscriptions"></a></h2></div></div></div><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">To prepare a cluster for an upgrade to Elasticsearch version 7, use
the <a class="ulink" href="https://www.elastic.co/guide/en/kibana/6.7/upgrade-assistant.html" target="_top">Kibana Upgrade Assistant</a> or
<a class="link" href="reindex-upgrade.html" title="Reindex before upgrading">reindex manually</a> before upgrading.</p></div></div><div xmlns="" class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><h3>Deprecated in 6.7. </h3><p xmlns="http://www.w3.org/1999/xhtml">Use the <a class="ulink" href="https://www.elastic.co/guide/en/kibana/6.7/upgrade-assistant.html" target="_top">Kibana Upgrade Assistant</a> or <a class="link" href="reindex-upgrade.html" title="Reindex before upgrading">reindex manually</a> before upgrading.</p></div></div><p>The migration upgrade API performs the upgrade of internal indices to make them
compatible with version 6 of Elasticsearch.</p><h4><a id="_request_33"></a>Request<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.7/docs/reference/migration/apis/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p><code class="literal">POST /_xpack/migration/upgrade/&lt;index_name&gt;</code></p><h4><a id="_description_32"></a>Description<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.7/docs/reference/migration/apis/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Indices must be upgraded one at a time.</p><h4><a id="_path_parameters_21"></a>Path Parameters<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.7/docs/reference/migration/apis/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">index_name</code></span></dt><dd>(string) Identifier for the index.</dd><dt><span class="term"><code class="literal">wait_for_completion</code></span></dt><dd>(boolean) Defines whether the upgrade call blocks until the upgrade process is
finished. The default value is <code class="literal">true</code>. If set to <code class="literal">false</code>, the upgrade can be
performed asynchronously.</dd></dl></div><h4><a id="_examples_28"></a>Examples<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.7/docs/reference/migration/apis/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The following example submits a POST request to the
<code class="literal">/_xpack/migration/upgrade/&lt;index_name&gt;</code> endpoint:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">POST /_xpack/migration/upgrade/.watches</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/1532.console"></div><p>A successful call returns the statistics about the upgrade process:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "took" : 127,
  "timed_out" : false,
  "total" : 4,
  "updated" : 0,
  "created" : 4,
  "deleted" : 0,
  "batches" : 1,
  "version_conflicts" : 0,
  "noops" : 0,
  "retries" : {
    "bulk" : 0,
    "search" : 0
  },
  "throttled_millis" : 0,
  "failures" : [ ]
}</pre></div><p>The following example upgrades a large index asynchronously by specifying the
<code class="literal">wait_for_completion</code> parameter:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">POST /_xpack/migration/upgrade/.watches?wait_for_completion=false</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/1533.console"></div><p>This call should return the id of the upgrade process task:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "task" : "PFvgv7T6TGumRyFF3vqTFg:1137"
}</pre></div><p>The status of the running or finished upgrade requests can be obtained by using
the <a class="link" href="tasks.html" title="Task Management API">Task API</a>:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">GET _tasks/PFvgv7T6TGumRyFF3vqTFg:1137?detailed=true</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/1534.console"></div><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "completed" : true, <a id="CO538-1"></a><i xmlns="" class="conum" data-value="1"></i>
  "task" : {
    "node" : "PFvgv7T6TGumRyFF3vqTFg",
    "id" : 1137,
    "type" : "transport",
    "action" : "cluster:admin/xpack/upgrade",
    "description" : "",
    "start_time_in_millis" : 1500650625413,
    "running_time_in_nanos" : 947456819,
    "cancellable" : true
  },
  "response" : { <a id="CO538-2"></a><i xmlns="" class="conum" data-value="2"></i>
    "took" : 212,
    "timed_out" : false,
    "total" : 4,
    "updated" : 0,
    "created" : 4,
    "deleted" : 0,
    "batches" : 1,
    "version_conflicts" : 0,
    "noops" : 0,
    "retries" : {
      "bulk" : 0,
      "search" : 0
    },
    "throttled_millis" : 0,
    "failures" : [ ]
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO538-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>If the <code class="literal">completed</code> field value is <code class="literal">true</code>, the upgrade request has finished.
If it is <code class="literal">false</code>, the request is still running.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO538-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>The <code class="literal">response</code> field contains the status of the upgrade request.</p></td></tr></table></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="migration-api-assistance.html">
              « 
              Migration assistance API</a>
           
        </span><span class="next">
           
          <a href="migration-api-deprecation.html">Deprecation info APIs
               »
            </a></span></div></body></html>