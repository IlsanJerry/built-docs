<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Complex Conditionals
        | Elasticsearch Reference [6.7]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [6.7]" /><link rel="up" href="ingest-conditionals.html" title="Conditional Execution in Pipelines" /><link rel="prev" href="ingest-conditional-nullcheck.html" title="Handling Nested Fields in Conditionals" /><link rel="next" href="conditionals-with-multiple-pipelines.html" title="Conditionals with the Pipeline Processor" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.7" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="6.7" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [6.7]
    </a></span> » <span class="breadcrumb-link"><a href="ingest.html">Ingest Node</a></span> » <span class="breadcrumb-link"><a href="ingest-conditionals.html">Conditional Execution in Pipelines</a></span> » <span class="breadcrumb-node">Complex Conditionals</span></div><div xmlns="" class="navheader"><span class="prev"><a href="ingest-conditional-nullcheck.html">
              « 
              Handling Nested Fields in Conditionals</a>
           
        </span><span class="next">
           
          <a href="conditionals-with-multiple-pipelines.html">Conditionals with the Pipeline Processor
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ingest-conditional-complex"></a>Complex Conditionals<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.7/docs/reference/ingest/ingest-node.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">if</code> condition can be more then a simple equality check.
The full power of the <a class="link" href="modules-scripting-painless.html" title="Painless Scripting Language">Painless Scripting Language</a> is available and
running in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/painless/6.7/painless-ingest-processor-context.html" target="_top">ingest processor context</a>.</p><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">The value of ctx is read-only in <code class="literal">if</code> conditions.</p></div></div><p>A more complex <code class="literal">if</code> condition that drops the document (i.e. not index it)
unless it has a multi-valued tag field with at least one value that contains the characters
<code class="literal">prod</code> (case insensitive).</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">PUT _ingest/pipeline/not_prod_dropper
{
  "processors": [
    {
      "drop": {
        "if": "Collection tags = ctx.tags;if(tags != null){for (String tag : tags) {if (tag.toLowerCase().contains('prod')) { return false;}}} return true;"
      }
    }
  ]
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/1377.console"></div><p>The conditional needs to be all on one line since JSON does not
support new line characters. However, Kibana’s console supports
a triple quote syntax to help with writing and debugging
scripts like these.</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">PUT _ingest/pipeline/not_prod_dropper
{
  "processors": [
    {
      "drop": {
        "if": """
            Collection tags = ctx.tags;
            if(tags != null){
              for (String tag : tags) {
                  if (tag.toLowerCase().contains('prod')) {
                      return false;
                  }
              }
            }
            return true;
        """
      }
    }
  ]
}</pre></div><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">POST test/_doc/1?pipeline=not_prod_dropper
{
  "tags": ["application:myapp", "env:Stage"]
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/1378.console"></div><p>The document is <a class="link" href="drop-processor.html" title="Drop Processor">dropped</a> since <code class="literal">prod</code> (case insensitive)
is not found in the tags.</p><p>The following document is indexed (i.e. not dropped) since
<code class="literal">prod</code> (case insensitive) is found in the tags.</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">POST test/_doc/2?pipeline=not_prod_dropper
{
  "tags": ["application:myapp", "env:Production"]
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/1379.console"></div><p>The <a class="xref" href="simulate-pipeline-api.html" title="Simulate Pipeline API">Simulate Pipeline API</a> with verbose can be used to help build out
complex conditionals. If the conditional evaluates to false it will be
omitted from the verbose results of the simulation since the document will not change.</p><p>Care should be taken to avoid overly complex or expensive conditional checks
since the condition needs to be checked for each and every document.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="ingest-conditional-nullcheck.html">
              « 
              Handling Nested Fields in Conditionals</a>
           
        </span><span class="next">
           
          <a href="conditionals-with-multiple-pipelines.html">Conditionals with the Pipeline Processor
               »
            </a></span></div></body></html>