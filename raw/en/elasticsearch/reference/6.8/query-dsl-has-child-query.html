<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Has Child Query
        | Elasticsearch Reference [6.8]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [6.8]" /><link rel="up" href="joining-queries.html" title="Joining queries" /><link rel="prev" href="query-dsl-nested-query.html" title="Nested Query" /><link rel="next" href="query-dsl-has-parent-query.html" title="Has Parent Query" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Reference/6.8" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="6.8" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [6.8]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="joining-queries.html">Joining queries</a></span> » <span class="breadcrumb-node">Has Child Query</span></div><div xmlns="" class="navheader"><span class="prev"><a href="query-dsl-nested-query.html">
              « 
              Nested Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-has-parent-query.html">Has Parent Query
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-child-query"></a>Has Child Query<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/reference/query-dsl/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">has_child</code> filter accepts a query and the child type to run against, and
results in parent documents that have child docs matching the query. Here is
an example:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "has_child" : {
            "type" : "blog_tag",
            "query" : {
                "term" : {
                    "tag" : "something"
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/890.console"></div><p>Note that the <code class="literal">has_child</code> is a slow query compared to other queries in the
query dsl due to the fact that it performs a join. The performance degrades
as the number of matching child documents pointing to unique parent documents
increases. If you care about query performance you should not use this query.
However if you do happen to use this query then use it as little as possible.
Each <code class="literal">has_child</code> query that gets added to a search request can increase query
time significantly.</p><h4><a id="_scoring_capabilities"></a>Scoring capabilities<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/reference/query-dsl/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_child</code> also has scoring support. The
supported score modes are <code class="literal">min</code>, <code class="literal">max</code>, <code class="literal">sum</code>, <code class="literal">avg</code> or <code class="literal">none</code>. The default is
<code class="literal">none</code> and yields the same behaviour as in previous versions. If the
score mode is set to another value than <code class="literal">none</code>, the scores of all the
matching child documents are aggregated into the associated parent
documents. The score type can be specified with the <code class="literal">score_mode</code> field
inside the <code class="literal">has_child</code> query:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "has_child" : {
            "type" : "blog_tag",
            "score_mode" : "min",
            "query" : {
                "term" : {
                    "tag" : "something"
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/891.console"></div><h4><a id="min-max-children"></a>Min/Max Children<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/reference/query-dsl/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_child</code> query allows you to specify that a minimum and/or maximum
number of children are required to match for the parent doc to be considered
a match:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "has_child" : {
            "type" : "blog_tag",
            "score_mode" : "min",
            "min_children": 2, <a id="CO221-1"></a><i xmlns="" class="conum" data-value="1"></i>
            "max_children": 10, <a id="CO221-2"></a><i xmlns="" class="conum" data-value="2"></i>
            "query" : {
                "term" : {
                    "tag" : "something"
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/892.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO221-1"><i xmlns="" class="conum" data-value="1"></i></a> <a href="#CO221-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>Both <code class="literal">min_children</code> and <code class="literal">max_children</code> are optional.</p></td></tr></table></div><p>The  <code class="literal">min_children</code> and <code class="literal">max_children</code> parameters can be combined with
the <code class="literal">score_mode</code> parameter.</p><h4><a id="_ignore_unmapped"></a>Ignore Unmapped<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/reference/query-dsl/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When set to <code class="literal">true</code> the <code class="literal">ignore_unmapped</code> option will ignore an unmapped <code class="literal">type</code>
and will not match any documents for this query. This can be useful when
querying multiple indexes which might have different mappings. When set to
<code class="literal">false</code> (the default value) the query will throw an exception if the <code class="literal">type</code>
is not mapped.</p><h4><a id="_sorting"></a>Sorting<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/reference/query-dsl/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Parent documents can’t be sorted by fields in matching child documents via the
regular sort options. If you need to sort parent document by field in the child
documents then you should use the <code class="literal">function_score</code> query and then just sort
by <code class="literal">_score</code>.</p><p>Sorting blogs by child documents' <code class="literal">click_count</code> field:</p><div xmlns="" class="pre_wrapper lang-console"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "has_child" : {
            "type" : "blog_tag",
            "score_mode" : "max",
            "query" : {
                "function_score" : {
                    "script_score": {
                        "script": "_score * doc['click_count'].value"
                    }
                }
            }
        }
    }
}</pre></div><div xmlns="" class="console_widget" data-snippet="snippets/893.console"></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="query-dsl-nested-query.html">
              « 
              Nested Query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-has-parent-query.html">Has Parent Query
               »
            </a></span></div></body></html>