<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Runtime options
        | Elasticsearch for Apache Hadoop [2.1]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch for Apache Hadoop [2.1]" /><link rel="up" href="reference.html" title="Elasticsearch for Apache Hadoop" /><link rel="prev" href="configuration.html" title="Configuration" /><link rel="next" href="security.html" title="Security" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Apache Hadoop/2.1" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="2.1" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch for Apache Hadoop
      [2.1]
    </a></span> » <span class="breadcrumb-link"><a href="reference.html">Elasticsearch for Apache Hadoop</a></span> » <span class="breadcrumb-node">Runtime options</span></div><div xmlns="" class="navheader"><span class="prev"><a href="configuration.html">
              « 
              Configuration</a>
           
        </span><span class="next">
           
          <a href="security.html">Security
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-runtime"></a>Runtime options<a xmlns="" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/core/configuration.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When using elasticsearch-hadoop, it is important to be aware of the following Hadoop configurations that can influence the way Map/Reduce tasks are executed and in return elasticsearch-hadoop.</p><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Unfortunately, these settings need to be setup <span class="strong strong"><strong>manually</strong></span> <span class="strong strong"><strong>before</strong></span> the job / script configuration. Since elasticsearch-hadoop is called too late in the life-cycle, after the task has been tasks have been already dispatched and as such, cannot influence the execution anymore.</p></div></div><h3><a id="_speculative_execution"></a>Speculative execution<a xmlns="" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/core/configuration.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>As most of the tasks in a job are coming to a close, <a class="ulink" href="http://developer.yahoo.com/hadoop/tutorial/module4.html#tolerance" target="_top">speculative execution</a> will schedule redundant copies of the remaining tasks across several nodes which do not have other work to perform. Therefore, the same input can be processed multiple times in parallel, to exploit differences in machine capabilities.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">
Yahoo! developer network
</span></td></tr></table></div><p>In other words, speculative execution is an <span class="strong strong"><strong>optimization</strong></span>, enabled by default, that allows Hadoop to create duplicates tasks of those which it considers hanged or slowed down. When doing data crunching or reading resources, having duplicate tasks is harmless and means at most a waste of computation resources; however when writing data to an external store, this can cause data corruption through duplicates or unnecessary updates.
Since the <span class="emphasis"><em>speculative execution</em></span> behavior can be triggered by external factors (such as network or CPU load which in turn cause false positive) even in stable environments (virtualized clusters are particularly prone to this) and has a direct impact on data, elasticsearch-hadoop disables this optimization for data safety.</p><p>Please check your library setting and disable this feature. If you encounter more data then expected, double and triple check this setting.</p><h4><a id="_disabling_mapreduce_speculative_execution"></a>Disabling Map/Reduce speculative execution<a xmlns="" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/core/configuration.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Speculative execution can be disabled for the map and reduce phase - we recommend disabling in both cases - by setting to <code class="literal">false</code> the following two properties:</p><p><code class="literal">mapred.map.tasks.speculative.execution</code>
<code class="literal">mapred.reduce.tasks.speculative.execution</code></p><p>One can either set the properties by name manually on the <code class="literal">Configuration</code>/<code class="literal">JobConf</code> client:</p><div xmlns="" class="pre_wrapper lang-java"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-java">jobConf.setSpeculativeExecution(false);
// or
configuration.setBoolean("mapred.map.tasks.speculative.execution", false);
configuration.setBoolean("mapred.reduce.tasks.speculative.execution", false);</pre></div><p>or by passing them as arguments to the command line:</p><div xmlns="" class="pre_wrapper lang-bash"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-bash">$ bin/hadoop jar -Dmapred.map.tasks.speculative.execution=false \
                 -Dmapred.reduce.tasks.speculative.execution=false &lt;jar&gt;</pre></div><h4><a id="_hive_speculative_execution"></a>Hive speculative execution<a xmlns="" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/core/configuration.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Apache Hive has its own setting for speculative execution through namely <code class="literal">hive.mapred.reduce.tasks.speculative.execution</code>. It is enabled by default so do change it to <code class="literal">false</code> in your scripts:</p><div xmlns="" class="pre_wrapper lang-sql"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sql">set hive.mapred.reduce.tasks.speculative.execution=false;</pre></div><p>Note that while the setting has been deprecated in Hive 0.10 and one might get a warning, double check that the speculative execution is actually disabled.</p><h4><a id="_spark_speculative_execution"></a>Spark speculative execution<a xmlns="" href="https://github.com/elastic/elasticsearch-hadoop/edit/2.1/docs/src/reference/asciidoc/core/configuration.adoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Out of the box, Spark has speculative execution disable. Double check this is the case through <code class="literal">spark.speculation</code> setting (<code class="literal">false</code> disabled it, <code class="literal">true</code> to enable it).</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="configuration.html">
              « 
              Configuration</a>
           
        </span><span class="next">
           
          <a href="security.html">Security
               »
            </a></span></div></body></html>