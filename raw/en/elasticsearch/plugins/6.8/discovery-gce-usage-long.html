<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Setting up GCE Discovery
        | Elasticsearch Plugins and Integrations [6.8]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Plugins and Integrations [6.8]" /><link rel="up" href="discovery-gce.html" title="GCE Discovery Plugin" /><link rel="prev" href="discovery-gce-network-host.html" title="GCE Network Host" /><link rel="next" href="discovery-gce-usage-cloning.html" title="Cloning your existing machine" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Plugins/6.8" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="6.8" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Plugins and Integrations
      [6.8]
    </a></span> » <span class="breadcrumb-link"><a href="discovery.html">Discovery Plugins</a></span> » <span class="breadcrumb-link"><a href="discovery-gce.html">GCE Discovery Plugin</a></span> » <span class="breadcrumb-node">Setting up GCE Discovery</span></div><div xmlns="" class="navheader"><span class="prev"><a href="discovery-gce-network-host.html">
              « 
              GCE Network Host</a>
           
        </span><span class="next">
           
          <a href="discovery-gce-usage-cloning.html">Cloning your existing machine
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="discovery-gce-usage-long"></a>Setting up GCE Discovery<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/plugins/discovery-gce.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-gce-usage-long-prerequisites"></a>Prerequisites<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/plugins/discovery-gce.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Before starting, you need:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Your project ID, e.g. <code class="literal">es-cloud</code>. Get it from <a class="ulink" href="https://code.google.com/apis/console/" target="_top">Google API Console</a>.</li><li class="listitem">To install <a class="ulink" href="https://developers.google.com/cloud/sdk/" target="_top">Google Cloud SDK</a></li></ul></div><p>If you did not set it yet, you can define your default project you will work on:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">gcloud config set project es-cloud</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-gce-usage-long-login"></a>Login to Google Cloud<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/plugins/discovery-gce.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If you haven’t already, login to Google Cloud</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">gcloud auth login</pre></div><p>This will open your browser. You will be asked to sign-in to a Google account and
authorize access to the Google Cloud SDK.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-gce-usage-long-first-instance"></a>Creating your first instance<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/plugins/discovery-gce.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">gcloud compute instances create myesnode1 \
       --zone &lt;your-zone&gt; \
       --scopes compute-rw</pre></div><p>When done, a report like this one should appears:</p><div xmlns="" class="pre_wrapper lang-text"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-text">Created [https://www.googleapis.com/compute/v1/projects/es-cloud-1070/zones/us-central1-f/instances/myesnode1].
NAME      ZONE          MACHINE_TYPE  PREEMPTIBLE INTERNAL_IP   EXTERNAL_IP   STATUS
myesnode1 us-central1-f n1-standard-1             10.240.133.54 104.197.94.25 RUNNING</pre></div><p>You can now connect to your instance:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh"># Connect using google cloud SDK
gcloud compute ssh myesnode1 --zone europe-west1-a

# Or using SSH with external IP address
ssh -i ~/.ssh/google_compute_engine 192.158.29.199</pre></div><div xmlns="" class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png" /></div><div class="admon_content"><h3>Service Account Permissions</h3><p xmlns="http://www.w3.org/1999/xhtml">It’s important when creating an instance that the correct permissions are set. At a minimum, you must ensure you have:</p><div class="pre_wrapper lang-text"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-text">scopes=compute-rw</pre></div><p xmlns="http://www.w3.org/1999/xhtml">Failing to set this will result in unauthorized messages when starting Elasticsearch.
See <a class="xref" href="discovery-gce-usage-tips.html#discovery-gce-usage-tips-permissions" title="Machine Permissions">Machine Permissions</a>.</p></div></div><p>Once connected, install Elasticsearch:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">sudo apt-get update

# Download Elasticsearch
wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-2.0.0.deb

# Prepare Java installation (Oracle)
sudo echo "deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" | sudo tee /etc/apt/sources.list.d/webupd8team-java.list
sudo echo "deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" | sudo tee -a /etc/apt/sources.list.d/webupd8team-java.list
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886
sudo apt-get update
sudo apt-get install oracle-java8-installer

# Prepare Java installation (or OpenJDK)
# sudo apt-get install java8-runtime-headless

# Prepare Elasticsearch installation
sudo dpkg -i elasticsearch-2.0.0.deb</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-gce-usage-long-install-plugin"></a>Install Elasticsearch discovery gce plugin<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.8/docs/plugins/discovery-gce.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Install the plugin:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh"># Use Plugin Manager to install it
sudo bin/elasticsearch-plugin install discovery-gce</pre></div><p>Open the <code class="literal">elasticsearch.yml</code> file:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">sudo vi /etc/elasticsearch/elasticsearch.yml</pre></div><p>And add the following lines:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml">cloud:
  gce:
      project_id: es-cloud
      zone: europe-west1-a
discovery:
      zen.hosts_provider: gce</pre></div><p>Start Elasticsearch:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">sudo /etc/init.d/elasticsearch start</pre></div><p>If anything goes wrong, you should check logs:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">tail -f /var/log/elasticsearch/elasticsearch.log</pre></div><p>If needed, you can change log level to <code class="literal">trace</code> by opening <code class="literal">log4j2.properties</code>:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">sudo vi /etc/elasticsearch/log4j2.properties</pre></div><p>and adding the following line:</p><div xmlns="" class="pre_wrapper lang-yaml"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-yaml"># discovery
logger.discovery_gce.name = discovery.gce
logger.discovery_gce.level = trace</pre></div></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="discovery-gce-network-host.html">
              « 
              GCE Network Host</a>
           
        </span><span class="next">
           
          <a href="discovery-gce-usage-cloning.html">Cloning your existing machine
               »
            </a></span></div></body></html>