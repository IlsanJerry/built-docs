<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>7.7.0 | Elasticsearch Node.js client [7.x] | Elastic</title>
<link rel="home" href="index.html" title="Elasticsearch Node.js client [7.x]"/>
<link rel="up" href="changelog-client.html" title="Changelog"/>
<link rel="prev" href="_7_7_1.html" title="7.7.1"/>
<link rel="next" href="_7_6_1.html" title="7.6.1"/>
<meta name="DC.type" content="Learn/Docs/Clients/JavaScript/7.x"/>
<meta name="DC.subject" content="Clients"/>
<meta name="DC.identifier" content="7.x"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch Node.js client [7.x]</a></span>
»
<span class="breadcrumb-link"><a href="changelog-client.html">Changelog</a></span>
»
<span class="breadcrumb-node">7.7.0</span>
</div>
<div class="navheader">
<span class="prev">
<a href="_7_7_1.html">« 7.7.1</a>
</span>
<span class="next">
<a href="_7_6_1.html">7.6.1 »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_7_7_0"></a>7.7.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_features_5"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_support_for_elasticsearch_v7_7"></a>Support for Elasticsearch <code class="literal">v7.7</code>.<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>You can find all the API changes <a href="/guide/en/elasticsearch/reference/7.7/release-notes-7.7.0.html" class="ulink" target="_top">here</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_introduced_client_helpers_1107"></a>Introduced client helpers - <a href="https://github.com/elastic/elasticsearch-js/pull/1107" class="ulink" target="_top">#1107</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>From now on, the client comes with an handy collection of helpers to give you a more comfortable experience with some APIs.</p>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The client helpers are experimental, and the API may change in the next minor releases.</p>
</div>
</div>
<p>The following helpers has been introduced:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">client.helpers.bulk</code>
</li>
<li class="listitem">
<code class="literal">client.helpers.search</code>
</li>
<li class="listitem">
<code class="literal">client.helpers.scrollSearch</code>
</li>
<li class="listitem">
<code class="literal">client.helpers.scrollDocuments</code>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_the_connectionpool_getconnection_now_always_returns_a_connection_1127"></a>The <code class="literal">ConnectionPool.getConnection</code> now always returns a <code class="literal">Connection</code> - <a href="https://github.com/elastic/elasticsearch-js/pull/1127" class="ulink" target="_top">#1127</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>What does this mean? It means that you will see less <code class="literal">NoLivingConnectionError</code>, which now can only be caused if you set a selector/filter too strict.
For improving the debugging experience, the <code class="literal">NoLivingConnectionsError</code> error message has been updated.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_abortable_promises_1141"></a>Abortable promises - <a href="https://github.com/elastic/elasticsearch-js/pull/1141" class="ulink" target="_top">#1141</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>From now on, it will be possible to abort a request generated with the promise-styl API. If you abort a request generated from a promise, the promise will be rejected with a <code class="literal">RequestAbortedError</code>.</p>
<div class="pre_wrapper lang-js">
<pre class="programlisting prettyprint lang-js">const promise = client.search({
  body: {
    query: { match_all: {} }
  }
})

promise
  .then(console.log)
  .catch(console.log)

promise.abort()</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_major_refactor_of_the_type_definitions_1119_1130_1132"></a>Major refactor of the Type Definitions - <a href="https://github.com/elastic/elasticsearch-js/pull/1119" class="ulink" target="_top">#1119</a> <a href="https://github.com/elastic/elasticsearch-js/issues/1130" class="ulink" target="_top">#1130</a> <a href="https://github.com/elastic/elasticsearch-js/pull/1132" class="ulink" target="_top">#1132</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>Now every API makes better use of the generics and overloading, so you can (or not, by default request/response bodies are <code class="literal">Record&lt;string, any&gt;</code>) define the request/response bodies in the generics.</p>
<div class="pre_wrapper lang-ts">
<pre class="programlisting prettyprint lang-ts">// request and response bodies are generics
client.search(...)
// response body is `SearchResponse` and request body is generic
client.search&lt;SearchResponse&gt;(...)
// request body is `SearchBody` and response body is `SearchResponse`
client.search&lt;SearchResponse, SearchBody&gt;(...)</pre>
</div>
<p>This <span class="strong strong"><strong>should</strong></span> not be a breaking change, as every generics defaults to <code class="literal">any</code>. It might happen to some users that the code breaks, but our test didn&#8217;t detect any of it, probably because they were not robust enough. However, given the gigantic improvement in the developer experience, we have decided to release this change in the 7.x line.</p>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_fixes_5"></a>Fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_the_connectionpool_update_method_now_cleans_the_dead_list_1122_1127"></a>The <code class="literal">ConnectionPool.update</code> method now cleans the <code class="literal">dead</code> list - <a href="https://github.com/elastic/elasticsearch-js/issues/1122" class="ulink" target="_top">#1122</a> <a href="https://github.com/elastic/elasticsearch-js/pull/1127" class="ulink" target="_top">#1127</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>It can happen in a situation where we are updating the connections list and running sniff, leaving the <code class="literal">dead</code> list in a dirty state. Now the <code class="literal">ConnectionPool.update</code> cleans up the <code class="literal">dead</code> list every time, which makes way more sense given that all the new connections are alive.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_connectionpoolmarkdead_should_ignore_connections_that_no_longer_exists_1159"></a><code class="literal">ConnectionPoolmarkDead</code> should ignore connections that no longer exists - <a href="https://github.com/elastic/elasticsearch-js/pull/1159" class="ulink" target="_top">#1159</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>It might happen that markDead is called just after a pool update, and in such case, the clint was adding the dead list a node that no longer exists, causing unhandled exceptions later.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_do_not_retry_a_request_if_the_body_is_a_stream_1143"></a>Do not retry a request if the body is a stream - <a href="https://github.com/elastic/elasticsearch-js/pull/1143" class="ulink" target="_top">#1143</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>The client should not retry if it&#8217;s sending a stream body, because it should store in memory a copy of the stream to be able to send it again, but since it doesn&#8217;t know in advance the size of the stream, it risks to take too much memory.
Furthermore, copying everytime the stream is very an expensive operation.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_return_an_error_if_the_request_has_been_aborted_1141"></a>Return an error if the request has been aborted - <a href="https://github.com/elastic/elasticsearch-js/pull/1141" class="ulink" target="_top">#1141</a><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-js/edit/7.x/docs/changelog.asciidoc">edit</a></h4>
</div></div></div>
<p>Until now, aborting a request was blocking the HTTP request, but never calling the callback or resolving the promise to notify the user. This is a bug because it could lead to dangerous memory leaks. From now on if the user calls the <code class="literal">request.abort()</code> method, the callback style API will be called with a <code class="literal">RequestAbortedError</code>, the promise will be rejected with <code class="literal">RequestAbortedError</code> as well.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="_7_7_1.html">« 7.7.1</a>
</span>
<span class="next">
<a href="_7_6_1.html">7.6.1 »</a>
</span>
</div>
</div>
</body>
</html>
