<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Selectors
        | Elasticsearch-PHP [1.0]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch-PHP [1.0]" /><link rel="up" href="index.html" title="Elasticsearch-PHP [1.0]" /><link rel="prev" href="_the_connection_pool.html" title="The Connection Pool" /><link rel="next" href="_connections.html" title="Connections" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Clients/PHP/1.0" /><meta xmlns="" name="DC.subject" content="Clients" /><meta xmlns="" name="DC.identifier" content="1.0" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch-PHP
      [1.0]
    </a></span> » <span class="breadcrumb-node">Selectors</span></div><div xmlns="" class="navheader"><span class="prev"><a href="_the_connection_pool.html">
              « 
              The Connection Pool</a>
           
        </span><span class="next">
           
          <a href="_connections.html">Connections
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="_selectors"></a>Selectors<a xmlns="" href="https://github.com/elastic/elasticsearch-php/edit/1.0/docs/connection-pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><p>The connection pool maintains the list of connections, and decides when nodes should transition from alive to dead (and
vice versa).  It has no logic to choose connections, however.  That job belongs to the Selector class.</p><p>The selector’s job is to return a single connection from a provided array of connections.  Like the Connection Pool, there
  are several implementations to choose from:</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_roundrobinselector_default"></a>RoundRobinSelector (Default)<a xmlns="" href="https://github.com/elastic/elasticsearch-php/edit/1.0/docs/connection-pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This selector returns connections in a round-robin fashion.  Node #1 is selected on the first request, Node #2 on
the second request, etc.  This ensures an even load of traffic across your cluster.  Round-robin’ing happens on a
per-request basis (e.g. sequential requests go to different nodes).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_stickyroundrobinselector"></a>StickyRoundRobinSelector<a xmlns="" href="https://github.com/elastic/elasticsearch-php/edit/1.0/docs/connection-pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This selector is "sticky", in that it prefers to reuse the same connection repeatedly.  For example, Node #1 is chosen
on the first request.  Node #1 will continue to be re-used for each subsequent request until that node fails.  Upon failure,
the selector will round-robin to the next available node, then "stick" to that node.</p><p>This is an ideal strategy for many PHP scripts.  Since PHP scripts are shared-nothing and tend to exit quickly, creating
new connections for each request is often a sub-optimal strategy and introduces a lot of overhead.  Instead, it is typically
better to "stick" to a single connection for the duration of the script.</p><p>By default, this selector will randomize the hosts upon initialization, which will still guarantee an even distribution
of load across the cluster.  It changes the round-robin dynamics from per-request to per-script.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_randomselector"></a>RandomSelector<a xmlns="" href="https://github.com/elastic/elasticsearch-php/edit/1.0/docs/connection-pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This selector simply returns a random node, regardless of state.  It is generally just for testing</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_changing_or_replacing_selector_class"></a>Changing or replacing Selector Class<a xmlns="" href="https://github.com/elastic/elasticsearch-php/edit/1.0/docs/connection-pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Changing the selector is also very simple: instantiate the client with your chosen implementation:</p><div xmlns="" class="pre_wrapper lang-php"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-php">$params['selectorClass'] = '\Elasticsearch\ConnectionPool\Selectors\RandomSelector';
$client = new Elasticsearch\Client($params);</pre></div><p>​</p><p>The client will now query random nodes.  It is sometimes useful to build a custom selector which services your particular
cluster with custom business logic.</p><p>For example, we can build a new selector that only selects the first connection each time. This is obviously not a good
selector (!!!), but it demonstrates the concept well:</p><div xmlns="" class="pre_wrapper lang-php"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-php">namespace MyProject\Selectors;

use Elasticsearch\Connections\ConnectionInterface;
use Elasticsearch\ConnectionPool\Selectors\SelectorInterface

class FirstSelector implements SelectorInterface
{

    /**
     * Selects the first connection
     *
     * @param array $connections Array of Connection objects
     *
     * @return ConnectionInterface
     */
    public function select($connections)
    {
        return $connections[0];
    }

}</pre></div><p>​</p><p>And now we can specify that when creating the client:</p><div xmlns="" class="pre_wrapper lang-php"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-php">$params['selectorClass'] = '\MyProject\Selectors\FirstSelector';
$client = new Elasticsearch\Client($params);</pre></div><p>​</p></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="_the_connection_pool.html">
              « 
              The Connection Pool</a>
           
        </span><span class="next">
           
          <a href="_connections.html">Connections
               »
            </a></span></div></body></html>