<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Search Operations
        | Elasticsearch-PHP [0.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch-PHP [0.4]" /><link rel="up" href="index.html" title="Elasticsearch-PHP [0.4]" /><link rel="prev" href="_indexing_operations.html" title="Indexing Operations" /><link rel="next" href="_the_connection_pool.html" title="The Connection Pool" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Clients/PHP/0.4" /><meta name="DC.subject" content="Clients" /><meta name="DC.identifier" content="0.4" /></head><body><div class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch-PHP
      [0.4]
    </a></span> » <span class="breadcrumb-node">Search Operations</span></div><div class="navheader"><span class="prev"><a href="_indexing_operations.html">
              « 
              Indexing Operations</a>
           
        </span><span class="next">
           
          <a href="_the_connection_pool.html">The Connection Pool
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="_search_operations"></a>Search Operations<a href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/search-operations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><p>Well…​it isn’t called elasticsearch for nothing!  Let’s talk about search operations in the PHP client.</p><p>The client gives you full access to every query and parameter exposed by the REST API, following the naming scheme as much as possible.  Let’s look at a few examples so you can become familiar with the syntax.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_match_query"></a>Match Query<a href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/search-operations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Here is a standard curl for a Match query:</p><div class="pre_wrapper lang-shell"><pre class="programlisting prettyprint lang-shell">curl -XGET 'localhost:9200/my_index/my_type/_search' -d '{
    "query" : {
        "match" : {
            "testField" : "abc"
        }
    }
}'</pre></div><p>​</p><p>And here is the same query constructed in the client:</p><div class="pre_wrapper lang-php"><pre class="programlisting prettyprint lang-php">$params['index'] = 'my_index';
$params['type']  = 'my_type';
$params['body']['query']['match']['testField'] = 'abc';

$results = $client-&gt;search($params);</pre></div><p>​</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Using Raw JSON</strong></p></div></div></div><p>As you can see, the translation between JSON and query is very straightforward.  You could serialize JSON directly into the body, or even provide the raw JSON string.  The client will handle it just fine:</p><div class="pre_wrapper lang-php"><pre class="programlisting prettyprint lang-php">$json = '{
    "query" : {
        "match" : {
            "testField" : "abc"
        }
    }
}';

$params['index'] = 'my_index';
$params['type']  = 'my_type';
$params['body']  = $json;

$results = $client-&gt;search($params);</pre></div></div><p>​</p><p>The search results that come back are simply elasticsearch response elements serialized into an array.  Working with the search results is as simple as iterating over the array values:</p><div class="pre_wrapper lang-php"><pre class="programlisting prettyprint lang-php">$milliseconds = $results['took'];
$maxScore     = $results['hits']['max_score'];

$score = $results['hits']['hits'][0]['_score'];
$doc   = $results['hits']['hits'][0]['_source'];</pre></div><p>​</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_a_more_complicated_example"></a>A more complicated example<a href="https://github.com/elastic/elasticsearch-php/edit/0.4/docs/search-operations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Let’s construct a slightly more complicated example: a filtered query that contains both a filter and a query.  This is a very common activity in elasticsearch queries, so it will be a good demonstration.</p><p>The curl version of the query:</p><div class="pre_wrapper lang-shell"><pre class="programlisting prettyprint lang-shell">curl -XGET 'localhost:9200/my_index/my_type/_search' -d '{
    "query" : {
        "filtered" : {
            "filter" : {
                "term" : {
                    "my_field" : "abc"
                }
            },
            "query" : {
                "match" : {
                    "my_other_field" : "xyz"
                }
            }
        }
    }
}'</pre></div><p>​</p><p>And in PHP:</p><div class="pre_wrapper lang-php"><pre class="programlisting prettyprint lang-php">$params['index'] = 'my_index';
$params['type']  = 'my_type';

$filter = array();
$filter['term']['my_field'] = 'abc';

$query = array();
$query['match']['my_other_field'] = 'xyz';

$params['body']['query']['filtered'] = array(
    "filter" =&gt; $filter,
    "query"  =&gt; $query
);

$results = $client-&gt;search($params);</pre></div><p>​</p><p>For clarity and ease of readability, the filter and query sections were allocated individually as variables and then composed together later.  This is often a good design pattern for applications, since it lets you treat the queries and filters as building blocks that can be passed around your application.</p><p>Of course, at the end of the day, it is built into a single array.  You could easily build the entire array in one definition of nested array blocks, or build them line-by-line.</p><p>All the client requires is an associative array with a structure that matches the JSON query structure.</p></div></div><div class="navfooter"><span class="prev"><a href="_indexing_operations.html">
              « 
              Indexing Operations</a>
           
        </span><span class="next">
           
          <a href="_the_connection_pool.html">The Connection Pool
               »
            </a></span></div></body></html>
