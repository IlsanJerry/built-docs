<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Search Template
        | Java API [6.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Java API [6.2]" /><link rel="up" href="java-search.html" title="Search API" /><link rel="prev" href="java-search-terminate-after.html" title="Terminate After" /><link rel="next" href="java-aggs.html" title="Aggregations" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Clients/Java/6.2" /><meta xmlns="" name="DC.subject" content="Clients" /><meta xmlns="" name="DC.identifier" content="6.2" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Java API
      [6.2]
    </a></span> » <span class="breadcrumb-link"><a href="java-search.html">Search API</a></span> » <span class="breadcrumb-node">Search Template</span></div><div xmlns="" class="navheader"><span class="prev"><a href="java-search-terminate-after.html">
              « 
              Terminate After</a>
           
        </span><span class="next">
           
          <a href="java-aggs.html">Aggregations
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="java-search-template"></a>Search Template<a xmlns="" href="https://github.com/elastic/elasticsearch/edit/6.2/docs/java-api/search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>See <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/search-template.html" target="_top">Search Template</a> documentation</p><p>Define your template parameters as a <code class="literal">Map&lt;String,Object&gt;</code>:</p><div xmlns="" class="pre_wrapper lang-java"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-java">Map&lt;String, Object&gt; template_params = new HashMap&lt;&gt;();
template_params.put("param_gender", "male");</pre></div><p>You can use your stored search templates in <code class="literal">config/scripts</code>.
For example, if you have a file named <code class="literal">config/scripts/template_gender.mustache</code> containing:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
    "query" : {
        "match" : {
            "gender" : "{{param_gender}}"
        }
    }
}</pre></div><p>Create your search template request:</p><div xmlns="" class="pre_wrapper lang-java"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-java">SearchResponse sr = new SearchTemplateRequestBuilder(client)
    .setScript("template_gender")                 <a id="CO10-1"></a><i xmlns="" class="conum" data-value="1"></i>
    .setScriptType(ScriptService.ScriptType.FILE) <a id="CO10-2"></a><i xmlns="" class="conum" data-value="2"></i>
    .setScriptParams(template_params)             <a id="CO10-3"></a><i xmlns="" class="conum" data-value="3"></i>
    .setRequest(new SearchRequest())              <a id="CO10-4"></a><i xmlns="" class="conum" data-value="4"></i>
    .get()                                        <a id="CO10-5"></a><i xmlns="" class="conum" data-value="5"></i>
    .getResponse();                               <a id="CO10-6"></a><i xmlns="" class="conum" data-value="6"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>template name</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>template stored on disk in <code class="literal">gender_template.mustache</code></p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-3"><i xmlns="" class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>parameters</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-4"><i xmlns="" class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>set the execution context (ie. define the index name here)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-5"><i xmlns="" class="conum" data-value="5"></i></a> </p></td><td valign="top" align="left"><p>execute and get the template response</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-6"><i xmlns="" class="conum" data-value="6"></i></a> </p></td><td valign="top" align="left"><p>get from the template response the search response itself</p></td></tr></table></div><p>You can also store your template in the cluster state:</p><div xmlns="" class="pre_wrapper lang-java"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-java">client.admin().cluster().preparePutStoredScript()
    .setScriptLang("mustache")
    .setId("template_gender")
    .setSource(new BytesArray(
        "{\n" +
        "    \"query\" : {\n" +
        "        \"match\" : {\n" +
        "            \"gender\" : \"{{param_gender}}\"\n" +
        "        }\n" +
        "    }\n" +
        "}")).get();</pre></div><p>To execute a stored templates, use <code class="literal">ScriptService.ScriptType.STORED</code>:</p><div xmlns="" class="pre_wrapper lang-java"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-java">SearchResponse sr = new SearchTemplateRequestBuilder(client)
        .setScript("template_gender")                       <a id="CO11-1"></a><i xmlns="" class="conum" data-value="1"></i>
        .setScriptType(ScriptType.STORED)     <a id="CO11-2"></a><i xmlns="" class="conum" data-value="2"></i>
        .setScriptParams(template_params)                   <a id="CO11-3"></a><i xmlns="" class="conum" data-value="3"></i>
        .setRequest(new SearchRequest())                    <a id="CO11-4"></a><i xmlns="" class="conum" data-value="4"></i>
        .get()                                              <a id="CO11-5"></a><i xmlns="" class="conum" data-value="5"></i>
        .getResponse();                                     <a id="CO11-6"></a><i xmlns="" class="conum" data-value="6"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>template name</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>template stored in the cluster state</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-3"><i xmlns="" class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>parameters</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-4"><i xmlns="" class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>set the execution context (ie. define the index name here)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-5"><i xmlns="" class="conum" data-value="5"></i></a> </p></td><td valign="top" align="left"><p>execute and get the template response</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-6"><i xmlns="" class="conum" data-value="6"></i></a> </p></td><td valign="top" align="left"><p>get from the template response the search response itself</p></td></tr></table></div><p>You can also execute inline templates:</p><div xmlns="" class="pre_wrapper lang-java"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-java">sr = new SearchTemplateRequestBuilder(client)
        .setScript("{\n" +                                  <a id="CO12-1"></a><i xmlns="" class="conum" data-value="1"></i>
                "        \"query\" : {\n" +
                "            \"match\" : {\n" +
                "                \"gender\" : \"{{param_gender}}\"\n" +
                "            }\n" +
                "        }\n" +
                "}")
        .setScriptType(ScriptType.INLINE)    <a id="CO12-2"></a><i xmlns="" class="conum" data-value="2"></i>
        .setScriptParams(template_params)                  <a id="CO12-3"></a><i xmlns="" class="conum" data-value="3"></i>
        .setRequest(new SearchRequest())                   <a id="CO12-4"></a><i xmlns="" class="conum" data-value="4"></i>
        .get()                                             <a id="CO12-5"></a><i xmlns="" class="conum" data-value="5"></i>
        .getResponse();                                    <a id="CO12-6"></a><i xmlns="" class="conum" data-value="6"></i></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>template name</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-2"><i xmlns="" class="conum" data-value="2"></i></a> </p></td><td valign="top" align="left"><p>template is passed inline</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-3"><i xmlns="" class="conum" data-value="3"></i></a> </p></td><td valign="top" align="left"><p>parameters</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-4"><i xmlns="" class="conum" data-value="4"></i></a> </p></td><td valign="top" align="left"><p>set the execution context (ie. define the index name here)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-5"><i xmlns="" class="conum" data-value="5"></i></a> </p></td><td valign="top" align="left"><p>execute and get the template response</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-6"><i xmlns="" class="conum" data-value="6"></i></a> </p></td><td valign="top" align="left"><p>get from the template response the search response itself</p></td></tr></table></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="java-search-terminate-after.html">
              « 
              Terminate After</a>
           
        </span><span class="next">
           
          <a href="java-aggs.html">Aggregations
               »
            </a></span></div></body></html>