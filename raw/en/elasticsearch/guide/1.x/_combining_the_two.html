<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Combining the Two
        | Elasticsearch: The Definitive Guide [1.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [1.x]" /><link rel="up" href="aggs-high-level.html" title="High-Level Concepts" /><link rel="prev" href="_metrics.html" title="Metrics" /><link rel="next" href="_aggregation_test_drive.html" title="Aggregation Test-Drive" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/1.x" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="1.x" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">This information applies to version 1.x of Elasticsearch. For the
most up to date information, see the current version of the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">
Elasticsearch Reference</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [1.x]
    </a></span> » <span class="breadcrumb-link"><a href="aggregations.html">Aggregations</a></span> » <span class="breadcrumb-link"><a href="aggs-high-level.html">High-Level Concepts</a></span> » <span class="breadcrumb-node">Combining the Two</span></div><div xmlns="" class="navheader"><span class="prev"><a href="_metrics.html">
              « 
              Metrics</a>
           
        </span><span class="next">
           
          <a href="_aggregation_test_drive.html">Aggregation Test-Drive
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_combining_the_two"></a>Combining the Two<a xmlns="" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/301_Aggregation_Overview.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>An <span class="emphasis"><em>aggregation</em></span> is a combination of buckets and metrics.<a id="id-1.7.3.12.2.2" class="indexterm"></a>
<a id="id-1.7.3.12.2.3" class="indexterm"></a>
<a id="id-1.7.3.12.2.4" class="indexterm"></a><a id="id-1.7.3.12.2.5" class="indexterm"></a>
<a id="id-1.7.3.12.2.6" class="indexterm"></a><a id="id-1.7.3.12.2.7" class="indexterm"></a>
<a id="id-1.7.3.12.2.8" class="indexterm"></a>  An aggregation may have
a single bucket, or a single metric, or one of each.  It may even have multiple
buckets nested inside other buckets. For example, we can partition documents by which country they belong to (a bucket), and
then calculate the average salary per country (a metric).</p><p>Because buckets can be nested, we can derive a much more complex aggregation:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Partition documents by country (bucket).
</li><li class="listitem">
Then partition each country bucket by gender (bucket).
</li><li class="listitem">
Then partition each gender bucket by age ranges (bucket).
</li><li class="listitem">
Finally, calculate the average salary for each age range (metric)
</li></ol></div><p>This will give you the average salary per <code class="literal">&lt;country, gender, age&gt;</code> combination.  All in
one request and with one pass over the data!</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="_metrics.html">
              « 
              Metrics</a>
           
        </span><span class="next">
           
          <a href="_aggregation_test_drive.html">Aggregation Test-Drive
               »
            </a></span></div></body></html>