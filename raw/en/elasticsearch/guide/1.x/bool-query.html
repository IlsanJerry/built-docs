<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Combining Queries
        | Elasticsearch: The Definitive Guide [1.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [1.x]" /><link rel="up" href="full-text-search.html" title="Full-Text Search" /><link rel="prev" href="match-multi-word.html" title="Multiword Queries" /><link rel="next" href="_how_match_uses_bool.html" title="How match Uses bool" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/1.x" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="1.x" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">This information applies to version 1.x of Elasticsearch. For the
most up to date information, see the current version of the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">
Elasticsearch Reference</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [1.x]
    </a></span> » <span class="breadcrumb-link"><a href="search-in-depth.html">Search in Depth</a></span> » <span class="breadcrumb-link"><a href="full-text-search.html">Full-Text Search</a></span> » <span class="breadcrumb-node">Combining Queries</span></div><div xmlns="" class="navheader"><span class="prev"><a href="match-multi-word.html">
              « 
              Multiword Queries</a>
           
        </span><span class="next">
           
          <a href="_how_match_uses_bool.html">How match Uses bool
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="bool-query"></a>Combining Queries<a xmlns="" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/100_Full_Text_Search/15_Combining_queries.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In <a class="xref" href="combining-filters.html" title="Combining Filters">Combining Filters</a> we discussed how to<a id="id-1.5.4.9.2.2" class="indexterm"></a>
<a id="id-1.5.4.9.2.3" class="indexterm"></a>, use the <code class="literal">bool</code> filter to combine
multiple filter clauses with <code class="literal">and</code>, <code class="literal">or</code>, and <code class="literal">not</code> logic.  In query land, the
<code class="literal">bool</code> query does a similar job but with one important difference.</p><p>Filters make a binary decision: should this document be included in the
results list or not? Queries, however, are more subtle. They decide not only
whether to include a document, but also how <span class="emphasis"><em>relevant</em></span> that document is.</p><p>Like the filter equivalent, the <code class="literal">bool</code> query accepts<a id="id-1.5.4.9.4.2" class="indexterm"></a> multiple query clauses
under the <code class="literal">must</code>, <code class="literal">must_not</code>, and <code class="literal">should</code> parameters.  For instance:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET /my_index/my_type/_search
{
  "query": {
    "bool": {
      "must":     { "match": { "title": "quick" }},
      "must_not": { "match": { "title": "lazy"  }},
      "should": [
                  { "match": { "title": "brown" }},
                  { "match": { "title": "dog"   }}
      ]
    }
  }
}</pre></div><div xmlns="" class="sense_widget" data-snippet="snippets/100_Full_Text_Search/15_Bool_query.json"></div><p>The results from the preceding query include any document whose <code class="literal">title</code> field
contains the term <code class="literal">quick</code>, except for those that also contain <code class="literal">lazy</code>. So
far, this is pretty similar to how the <code class="literal">bool</code> filter works.</p><p>The difference comes in with the two <code class="literal">should</code> clauses, which say that: a document
is <span class="emphasis"><em>not required</em></span> to contain <a id="id-1.5.4.9.8.3" class="indexterm"></a>
<a id="id-1.5.4.9.8.4" class="indexterm"></a>either <code class="literal">brown</code> or <code class="literal">dog</code>, but if it does, then
it should be considered <span class="emphasis"><em>more relevant</em></span>:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">{
  "hits": [
     {
        "_id":      "3",
        "_score":   0.70134366, <a id="CO61-1"></a><i xmlns="" class="conum" data-value="1"></i>
        "_source": {
           "title": "The quick brown fox jumps over the quick dog"
        }
     },
     {
        "_id":      "1",
        "_score":   0.3312608,
        "_source": {
           "title": "The quick brown fox"
        }
     }
  ]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO61-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
Document 3 scores higher because it contains both <code class="literal">brown</code> and <code class="literal">dog</code>.
</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_score_calculation"></a>Score Calculation<a xmlns="" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/100_Full_Text_Search/15_Combining_queries.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">bool</code> query calculates<a id="id-1.5.4.9.11.2.2" class="indexterm"></a>
<a id="id-1.5.4.9.11.2.3" class="indexterm"></a><a id="id-1.5.4.9.11.2.4" class="indexterm"></a>
<a id="id-1.5.4.9.11.2.5" class="indexterm"></a> the relevance <code class="literal">_score</code> for each document by adding
together the <code class="literal">_score</code> from all of the matching <code class="literal">must</code> and <code class="literal">should</code> clauses,
and then dividing by the total number of <code class="literal">must</code> and <code class="literal">should</code> clauses.</p><p>The <code class="literal">must_not</code> clauses do not affect <a id="id-1.5.4.9.11.3.2" class="indexterm"></a>
<a id="id-1.5.4.9.11.3.3" class="indexterm"></a>the score; their only purpose is to
exclude documents that might otherwise have been included.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_controlling_precision"></a>Controlling Precision<a xmlns="" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/100_Full_Text_Search/15_Combining_queries.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>All the <code class="literal">must</code> clauses must match, and all the <code class="literal">must_not</code> clauses must not
match, but how many <code class="literal">should</code> clauses<a id="id-1.5.4.9.12.2.4" class="indexterm"></a>
<a id="id-1.5.4.9.12.2.5" class="indexterm"></a><a id="id-1.5.4.9.12.2.6" class="indexterm"></a>
<a id="id-1.5.4.9.12.2.7" class="indexterm"></a>
<a id="id-1.5.4.9.12.2.8" class="indexterm"></a><a id="id-1.5.4.9.12.2.9" class="indexterm"></a>
<a id="id-1.5.4.9.12.2.10" class="indexterm"></a> should match? By default, none of the <code class="literal">should</code> clauses are required to match, with one
exception: if there are no <code class="literal">must</code> clauses, then at least one <code class="literal">should</code> clause
must match.</p><p>Just as we can control the <a class="link" href="match-multi-word.html#match-precision" title="Controlling Precision">precision of the <code class="literal">match</code> query</a>,
we can control how many <code class="literal">should</code> clauses need to match by using the
<code class="literal">minimum_should_match</code> parameter,<a id="id-1.5.4.9.12.3.4" class="indexterm"></a>
<a id="id-1.5.4.9.12.3.5" class="indexterm"></a> either as an absolute number or as a
percentage:</p><div xmlns="" class="pre_wrapper lang-js"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-js">GET /my_index/my_type/_search
{
  "query": {
    "bool": {
      "should": [
        { "match": { "title": "brown" }},
        { "match": { "title": "fox"   }},
        { "match": { "title": "dog"   }}
      ],
      "minimum_should_match": 2 <a id="CO62-1"></a><i xmlns="" class="conum" data-value="1"></i>
    }
  }
}</pre></div><div xmlns="" class="sense_widget" data-snippet="snippets/100_Full_Text_Search/15_Bool_query.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO62-1"><i xmlns="" class="conum" data-value="1"></i></a> </p></td><td valign="top" align="left"><p>
This could also be expressed as a percentage.
</p></td></tr></table></div><p>The results would include only documents whose <code class="literal">title</code> field contains <code class="literal">"brown"
AND "fox"</code>, <code class="literal">"brown" AND "dog"</code>, or <code class="literal">"fox" AND "dog"</code>. If a document contains
all three, it would be considered more relevant than those that contain
just two of the three.</p></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="match-multi-word.html">
              « 
              Multiword Queries</a>
           
        </span><span class="next">
           
          <a href="_how_match_uses_bool.html">How match Uses bool
               »
            </a></span></div></body></html>