<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Routing a Document to a Shard
        | Elasticsearch: The Definitive Guide [1.x]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [1.x]" /><link rel="up" href="distributed-docs.html" title="Distributed Document Store" /><link rel="prev" href="distributed-docs.html" title="Distributed Document Store" /><link rel="next" href="_how_primary_and_replica_shards_interact.html" title="How Primary and Replica Shards Interact" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/1.x" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="1.x" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">This information applies to version 1.x of Elasticsearch. For the
most up to date information, see the current version of the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">
Elasticsearch Reference</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [1.x]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="distributed-docs.html">Distributed Document Store</a></span> » <span class="breadcrumb-node">Routing a Document to a Shard</span></div><div xmlns="" class="navheader"><span class="prev"><a href="distributed-docs.html">
              « 
              Distributed Document Store</a>
           
        </span><span class="next">
           
          <a href="_how_primary_and_replica_shards_interact.html">How Primary and Replica Shards Interact
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="routing-value"></a>Routing a Document to a Shard<a xmlns="" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/1.x/040_Distributed_CRUD/05_Routing.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When you index a document, it is stored on a single primary shard.<a id="id-1.4.6.5.2.1" class="indexterm"></a>
<a id="id-1.4.6.5.2.2" class="indexterm"></a><a id="id-1.4.6.5.2.3" class="indexterm"></a>
<a id="id-1.4.6.5.2.4" class="indexterm"></a><a id="id-1.4.6.5.2.5" class="indexterm"></a> How does
Elasticsearch know which shard a document belongs to?  When we create a new
document, how does it know whether it should store that document on shard 1 or
shard 2?</p><p>The process can’t be random, since we may need to retrieve the document in the
future. In fact, it is determined by a simple formula:</p><pre class="literallayout">shard = hash(routing) % number_of_primary_shards</pre><p>The <code class="literal">routing</code> value is an arbitrary string, which defaults to the document’s
<code class="literal">_id</code> but can also be set to a custom value. This <code class="literal">routing</code> string is passed
through a hashing function to generate a number, which is divided by the
number of primary shards in the index to return the <span class="emphasis"><em>remainder</em></span>. The remainder
will always be in the range <code class="literal">0</code> to <code class="literal">number_of_primary_shards - 1</code>, and gives
us the number of the shard where a particular document lives.</p><p>This explains why the number of primary shards<a id="id-1.4.6.5.6.1" class="indexterm"></a>
<a id="id-1.4.6.5.6.2" class="indexterm"></a> can be set only when an index
is created and never changed:  if the number of primary shards ever changed in
the future, all previous routing values would be invalid and documents would
never be found.</p><div xmlns="" class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p xmlns="http://www.w3.org/1999/xhtml">Users sometimes think that having a fixed number of primary shards makes it
difficult to scale out an index later.  In reality, there are techniques
that make it easy to scale out as and when you need. We talk more about these
in <a class="xref" href="scale.html" title="Designing for Scale"><em>Designing for Scale</em></a>.</p></div></div><p>All document APIs (<code class="literal">get</code>, <code class="literal">index</code>, <code class="literal">delete</code>, <code class="literal">bulk</code>, <code class="literal">update</code>, and <code class="literal">mget</code>)
accept a <code class="literal">routing</code> parameter <a id="id-1.4.6.5.8.8" class="indexterm"></a>that can be used to customize the document-to-
shard mapping. A custom routing value could be used to ensure that all related
documents—for instance, all the documents belonging to the same user—are
stored on the same shard. We discuss in detail why you may want to do this in
<a class="xref" href="scale.html" title="Designing for Scale"><em>Designing for Scale</em></a>.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="distributed-docs.html">
              « 
              Distributed Document Store</a>
           
        </span><span class="next">
           
          <a href="_how_primary_and_replica_shards_interact.html">How Primary and Replica Shards Interact
               »
            </a></span></div></body></html>