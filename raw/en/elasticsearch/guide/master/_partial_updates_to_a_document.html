<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Partial Updates to a Document
        | Elasticsearch: The Definitive Guide [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: The Definitive Guide [master]" /><link rel="up" href="distributed-docs.html" title="Distributed Document Store" /><link rel="prev" href="distrib-read.html" title="Retrieving a Document" /><link rel="next" href="distrib-multi-doc.html" title="Multidocument Patterns" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Legacy/Elasticsearch/Definitive Guide/master" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="master" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">This information may not apply to the latest version of Elasticsearch.
For the most up to date information, see the current version of the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">
Elasticsearch Reference</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: The Definitive Guide
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="distributed-docs.html">Distributed Document Store</a></span> » <span class="breadcrumb-node">Partial Updates to a Document</span></div><div xmlns="" class="navheader"><span class="prev"><a href="distrib-read.html">
              « 
              Retrieving a Document</a>
           
        </span><span class="next">
           
          <a href="distrib-multi-doc.html">Multidocument Patterns
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_partial_updates_to_a_document"></a>Partial Updates to a Document<a xmlns="" href="https://github.com/elastic/elasticsearch-definitive-guide/edit/master/040_Distributed_CRUD/25_Partial_updates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">update</code> API , as shown in <a class="xref" href="_partial_updates_to_a_document.html#img-distrib-update" title="Figure 11. Partial updates to a document">Figure 11, “Partial updates to a document”</a>, combines the read and<a id="id-1.4.6.9.2.3" class="indexterm"></a>
<a id="id-1.4.6.9.2.4" class="indexterm"></a><a id="id-1.4.6.9.2.5" class="indexterm"></a>
<a id="id-1.4.6.9.2.6" class="indexterm"></a> write patterns explained previously.</p><div class="figure"><a id="img-distrib-update"></a><p class="title"><strong>Figure 11. Partial updates to a document</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/elas_0404.png" alt="Partial updates to a document" /></div></div></div><p>Here is the sequence of steps used to perform a partial update on  a
document:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
The client sends an update request to <code class="literal">Node 1</code>.
</li><li class="listitem">
It forwards the request to <code class="literal">Node 3</code>, where the primary shard is allocated.
</li><li class="listitem">
<code class="literal">Node 3</code> retrieves the document from the primary shard, changes the JSON
   in the <code class="literal">_source</code> field, and tries to reindex the document on the primary
   shard. If the document has already been changed by another process, it
   retries step 3 up to <code class="literal">retry_on_conflict</code> times, before giving up.
</li><li class="listitem">
If <code class="literal">Node 3</code> has managed to update the document successfully, it forwards
   the new version of the document in parallel to the replica shards on <code class="literal">Node 1</code>
   and <code class="literal">Node 2</code> to be reindexed. Once all replica shards report success,
   <code class="literal">Node 3</code> reports success to the coordinating node,  which reports success to
   the client.
</li></ol></div><p>The <code class="literal">update</code> API also accepts the <code class="literal">routing</code>, <code class="literal">replication</code>, <code class="literal">consistency</code>, and
<code class="literal">timeout</code> parameters that are explained in <a class="xref" href="distrib-write.html" title="Creating, Indexing, and Deleting a Document">Creating, Indexing, and Deleting a Document</a>.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Document-Based Replication</strong></p></div></div></div><p>When a primary shard forwards changes to its replica shards,<a id="id-1.4.6.9.7.2.1" class="indexterm"></a>
<a id="id-1.4.6.9.7.2.2" class="indexterm"></a> it doesn’t
forward the update request. Instead it forwards the new version of the full
document. Remember that these changes are forwarded to the replica shards
asynchronously, and there is no guarantee that they will arrive in the same
order that they were sent. If Elasticsearch forwarded just the change, it is
possible that changes would be applied in the wrong order, resulting in a
corrupt document.</p></div></div><div xmlns="" class="navfooter"><span class="prev"><a href="distrib-read.html">
              « 
              Retrieving a Document</a>
           
        </span><span class="next">
           
          <a href="distrib-multi-doc.html">Multidocument Patterns
               »
            </a></span></div></body></html>