<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Threat Intel module | Filebeat Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="Filebeat Reference [master]"/>
<link rel="up" href="filebeat-modules.html" title="Modules"/>
<link rel="prev" href="filebeat-module-system.html" title="System module"/>
<link rel="next" href="filebeat-module-tomcat.html" title="Tomcat module"/>
<meta name="DC.type" content="Learn/Docs/Filebeat/Reference/master"/>
<meta name="DC.subject" content="Filebeat"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Filebeat Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="filebeat-modules.html">Modules</a></span>
»
<span class="breadcrumb-node">Threat Intel module</span>
</div>
<div class="navheader">
<span class="prev">
<a href="filebeat-module-system.html">« System module</a>
</span>
<span class="next">
<a href="filebeat-module-tomcat.html">Tomcat module »</a>
</span>
</div>
<div class="chapter xpack">
<div class="titlepage"><div><div>
<h2 class="title"><a id="filebeat-module-threatintel"></a>Threat Intel module<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a><a class="xpack_tag" href="/subscriptions"></a></h2>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>This functionality is in beta and is subject to change. The design and code is less mature than official GA features and is being provided as-is with no warranties. Beta features are not subject to the support SLA of official GA features.</p>
</div>
</div>
<p>This module is a collection of different threat intelligence sources. The ingested data is meant to be used with <a href="/guide/en/security/7.11/rules-ui-create.html#create-indicator-rule" class="ulink" target="_top">Indicator Match rules</a>, but is also
compatible with other features like <a href="/guide/en/elasticsearch/reference/current/enrich-processor.html" class="ulink" target="_top">Enrich Processors</a>.
The related threat intel attribute that is meant to be used for matching incoming source data is stored under the <code class="literal">threatintel.indicator.*</code> fields.</p>
<p>Currently supporting:
- <code class="literal">abuseurl</code> fileset: Supports URL entities from Abuse.ch
- <code class="literal">abusemalware</code> fileset: Supports Malware/Payload entities from Abuse.ch
- <code class="literal">misp</code> fileset: Supports gathering threat intel attributes from MISP
- <code class="literal">otx</code> fileset: Supports gathering threat intel attributes from Alienvault OTX
- <code class="literal">anomali</code> fileset: Supports gathering threat intel attributes from Anomali</p>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>Read the <a class="xref" href="filebeat-installation-configuration.html" title="Filebeat quick start: installation and configuration">quick start</a> to learn
how to configure and run modules.</p>
</div>
</div>
<h4><a id="_abuseurl_fileset_settings"></a><code class="literal">abuseurl</code> fileset settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a></h4>
<p>This fileset contacts the AbuseCH API and fetches all new malicious URLs found the last 60 minutes.</p>
<p>To configure the module, please utilize the default URL unless specified as the example below:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  abuseurl:
    enabled: true
    var.input: httpjson
    var.url: https://urlhaus-api.abuse.ch/v1/urls/recent/
    var.interval: 60m</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.paths</code></strong></span>
</span>
</dt>
<dd>
An array of glob-based paths that specify where to look for the log files. All
patterns supported by <a href="https://golang.org/pkg/path/filepath/#Glob" class="ulink" target="_top">Go Glob</a>
are also supported here. For example, you can use wildcards to fetch all files
from a predefined level of subdirectories: <code class="literal">/path/to/log/*/*.log</code>. This
fetches all <code class="literal">.log</code> files from the subfolders of <code class="literal">/path/to/log</code>. It does not
fetch log files from the <code class="literal">/path/to/log</code> folder itself. If this setting is left
empty, Filebeat will choose log paths based on your operating system.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.url</code></strong></span>
</span>
</dt>
<dd>
The URL of the API endpoint to connect with.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.interval</code></strong></span>
</span>
</dt>
<dd>
How often the API is polled for updated information.
</dd>
</dl>
</div>
<p>AbuseCH URL Threat Intel is mapped to the following ECS fields</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">URL Threat Intel Fields'</th>
<th align="left" valign="top">ECS Fields</th>
<th align="left" valign="top"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>url</p></td>
<td align="left" valign="top"><p>threat.indicator.url.full</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>date_added</p></td>
<td align="left" valign="top"><p>@timestamp</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>host</p></td>
<td align="left" valign="top"><p>threat.indicator.ip/domain</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_abusemalware_fileset_settings"></a><code class="literal">abusemalware</code> fileset settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a></h4>
<p>This fileset contacts the AbuseCH API and fetches all new malicious hashes found the last 60 minutes.</p>
<p>To configure the module, please utilize the default URL unless specified as the example below:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  abusemalware:
    enabled: true
    var.input: httpjson
    var.url: https://urlhaus-api.abuse.ch/v1/payloads/recent/
    var.interval: 60m</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.paths</code></strong></span>
</span>
</dt>
<dd>
An array of glob-based paths that specify where to look for the log files. All
patterns supported by <a href="https://golang.org/pkg/path/filepath/#Glob" class="ulink" target="_top">Go Glob</a>
are also supported here. For example, you can use wildcards to fetch all files
from a predefined level of subdirectories: <code class="literal">/path/to/log/*/*.log</code>. This
fetches all <code class="literal">.log</code> files from the subfolders of <code class="literal">/path/to/log</code>. It does not
fetch log files from the <code class="literal">/path/to/log</code> folder itself. If this setting is left
empty, Filebeat will choose log paths based on your operating system.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.url</code></strong></span>
</span>
</dt>
<dd>
The URL of the API endpoint to connect with.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.interval</code></strong></span>
</span>
</dt>
<dd>
How often the API is polled for updated information.
</dd>
</dl>
</div>
<p>AbuseCH Malware Threat Intel is mapped to the following ECS fields</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Malware Threat IntelFields</th>
<th align="left" valign="top">ECS Fields</th>
<th align="left" valign="top"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>md5_hash</p></td>
<td align="left" valign="top"><p>threat.indicato.file.hash.md5</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>sha256_hash</p></td>
<td align="left" valign="top"><p>threat.indicator.file.hash.sha256</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>file_size</p></td>
<td align="left" valign="top"><p>threat.indicator.file.size</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="_misp_fileset_settings"></a><code class="literal">misp</code> fileset settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a></h4>
<p>This fileset communicates with a local or remote MISP server. Not to be confused with the older MISP Module (link here).</p>
<p>The fileset configuration allows to set the polling interval, how far back it should look initially, and optionally any filters used to filter the results.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  misp:
    enabled: true
    var.input: httpjson
    var.url: https://SERVER/events/restSearch
    var.api_token: xVfaM3DSt8QEwO2J1ix00V4ZHJs14nq5GMsHcK6Z
    var.initial_interval: 24h
    var.interval: 60m</pre>
</div>
<p>To configure the output with filters, use fields that already exist on the MISP server, and define either a single value or multiple.
By adding a filter, only events that has attributes which matches the filter will be returned.</p>
<p>The below filters is only examples, for a full list of all fields please reference the MISP fields located on the MISP server itself.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  misp:
    enabled: true
    var.input: httpjson
    var.url: https://SERVER/events/restSearch
    var.api_token: xVfaM3DSt8QEwO2J1ix00V4ZHJs14nq5GMsHcK6Z
    var.filters:
      - type: ["md5", "sha256", "url", "ip-src"]
      - threat_level: 4
    var.initial_interval: 24h
    var.interval: 60m</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.paths</code></strong></span>
</span>
</dt>
<dd>
An array of glob-based paths that specify where to look for the log files. All
patterns supported by <a href="https://golang.org/pkg/path/filepath/#Glob" class="ulink" target="_top">Go Glob</a>
are also supported here. For example, you can use wildcards to fetch all files
from a predefined level of subdirectories: <code class="literal">/path/to/log/*/*.log</code>. This
fetches all <code class="literal">.log</code> files from the subfolders of <code class="literal">/path/to/log</code>. It does not
fetch log files from the <code class="literal">/path/to/log</code> folder itself. If this setting is left
empty, Filebeat will choose log paths based on your operating system.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.url</code></strong></span>
</span>
</dt>
<dd>
The URL of the API endpoint to connect with.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.interval</code></strong></span>
</span>
</dt>
<dd>
How often the API is polled for updated information.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.first_interval</code></strong></span>
</span>
</dt>
<dd>
How far back to search when retrieving events the first time the beat starts up.
After the first interval has passed the module itself will use the timestamp from the last response as the filter when retrieving new events.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.filters</code></strong></span>
</span>
</dt>
<dd>
List of filters to apply when retrieving new events from the MISP server, this field is optional and defaults to all events.
</dd>
</dl>
</div>
<p>MISP Threat Intel is mapped to the following ECS fields</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Malware Threat IntelFields</th>
<th align="left" valign="top">ECS Fields</th>
<th align="left" valign="top"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>misp.first_seen</p></td>
<td align="left" valign="top"><p>threat.indicator.first_seen</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>misp.last_seen</p></td>
<td align="left" valign="top"><p>threat.indicator.last_seen</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>misp.tag</p></td>
<td align="left" valign="top"><p>tag</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>misp.value</p></td>
<td align="left" valign="top"><p>threat.indicator.*</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>misp.value is mapped to the appropriate field dependant on attribute type</p>
<h4><a id="_otx_fileset_settings"></a><code class="literal">otx</code> fileset settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a></h4>
<p>To configure the module, please utilize the default URL unless specified as the example below:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  otx:
    enabled: true
    var.input: httpjson
    var.url: https://otx.alienvault.com/api/v1/indicators/export
    var.api_token: 754dcaafbcb9740dc0d119e72d5eaad699cc4a5cdbc856fc6215883842ba8142
    var.first_interval: 24h
    var.lookback_range: 2h
    var.interval: 60m</pre>
</div>
<p>To filter only on specific indicator types, this is an example of some possible filters supported:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  otx:
    enabled: true
    var.input: httpjson
    var.url: https://otx.alienvault.com/api/v1/indicators/export
    var.types: "domain,IPv4,hostname,url,FileHash-SHA256"
    var.first_interval: 24h
    var.interval: 60m</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.paths</code></strong></span>
</span>
</dt>
<dd>
An array of glob-based paths that specify where to look for the log files. All
patterns supported by <a href="https://golang.org/pkg/path/filepath/#Glob" class="ulink" target="_top">Go Glob</a>
are also supported here. For example, you can use wildcards to fetch all files
from a predefined level of subdirectories: <code class="literal">/path/to/log/*/*.log</code>. This
fetches all <code class="literal">.log</code> files from the subfolders of <code class="literal">/path/to/log</code>. It does not
fetch log files from the <code class="literal">/path/to/log</code> folder itself. If this setting is left
empty, Filebeat will choose log paths based on your operating system.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.url</code></strong></span>
</span>
</dt>
<dd>
The URL of the API endpoint to connect with.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.api_token</code></strong></span>
</span>
</dt>
<dd>
The API key used to access OTX. This can be found on your <a href="https://otx.alienvault.com/api" class="ulink" target="_top">OTX API homepage</a>.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.interval</code></strong></span>
</span>
</dt>
<dd>
How often the API is polled for updated information.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.first_interval</code></strong></span>
</span>
</dt>
<dd>
How far back to search when retrieving events the first time the beat starts up.
After the first interval has passed the module itself will use the timestamp from the last response as the filter when retrieving new events.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.types</code></strong></span>
</span>
</dt>
<dd>
A comma delimited list of indicator types to include, defaults to all. A list of possible types to filter on can be found on the  <a href="https://cybersecurity.att.com/documentation/usm-appliance/otx/about-otx.htm" class="ulink" target="_top">Alienvault OTX documentation page</a>
</dd>
</dl>
</div>
<p>OTX Threat Intel is mapped to the following ECS fields</p>
<p>|======================================================|
| Malware Threat IntelFields | ECS Fields              |
| otx.type            | threat.indicator.type          |
| otx.description     | threat.indicator.description   |
| otx.indicator       | threat.indicator.*             |
|======================================================|
otx.indicator is mapped to the appropriate field dependant on attribute type.</p>
<h4><a id="_anomali_fileset_settings"></a><code class="literal">anomali</code> fileset settings<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a></h4>
<p>To configure the module please fill in the credentials, for Anomali Limo (the free Taxii service) these are usually default credentials found at the <a href="https://www.anomali.com/resources/limo" class="ulink" target="_top">Anomali Limo webpage</a>
Anomali Limo offers multiple sources called collections. Each collection has a specific ID, which then fits into the url
used in this configuration. A list of different collections can be found using the credentials at <a href="https://limo.anomali.com/api/v1/taxii2/feeds/collections/" class="ulink" target="_top">Limo Collections</a>.</p>
<p>The example below uses the collection of ID 41 as can be seen in the URL.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  anomali:
    enabled: true
    var.input: httpjson
    var.url: https://limo.anomali.com/api/v1/taxii2/feeds/collections/41/objects?match[type]=indicator
    var.username: guest
    var.password: guest
    var.interval: 60m</pre>
</div>
<p>To filter on specifc types, you can define var.types as a comma delimited list of object types. This defaults to "indicators"</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- module: threatintel
  anomali:
    enabled: true
    var.input: httpjson
    var.url: https://limo.anomali.com/api/v1/taxii2/feeds/collections/41/objects?match[type]=indicator
    var.types: "indicators,other"
    var.username: guest
    var.password: guest
    var.interval: 60m</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.paths</code></strong></span>
</span>
</dt>
<dd>
An array of glob-based paths that specify where to look for the log files. All
patterns supported by <a href="https://golang.org/pkg/path/filepath/#Glob" class="ulink" target="_top">Go Glob</a>
are also supported here. For example, you can use wildcards to fetch all files
from a predefined level of subdirectories: <code class="literal">/path/to/log/*/*.log</code>. This
fetches all <code class="literal">.log</code> files from the subfolders of <code class="literal">/path/to/log</code>. It does not
fetch log files from the <code class="literal">/path/to/log</code> folder itself. If this setting is left
empty, Filebeat will choose log paths based on your operating system.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.url</code></strong></span>
</span>
</dt>
<dd>
The URL of the API endpoint to connect with. Limo offers multiple collections of threat intelligence.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.username</code></strong></span>
</span>
</dt>
<dd>
Username used to access the API.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.password</code></strong></span>
</span>
</dt>
<dd>
Password used to access the API.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.interval</code></strong></span>
</span>
</dt>
<dd>
How often the API is polled for updated information.
</dd>
<dt>
<span class="term">
<span class="strong strong"><strong><code class="literal">var.types</code></strong></span>
</span>
</dt>
<dd>
A comma delimited list of indicator types to include, defaults to all. A list of possible types to filter on can be found on the <a href="https://oasis-open.github.io/cti-documentation/stix/intro.html#stix-21-objects" class="ulink" target="_top">Stix 2.1 Object types</a> page.
</dd>
</dl>
</div>
<p>Anomali Threat Intel is mapped to the following ECS fields</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Malware Threat IntelFields</th>
<th align="left" valign="top">ECS Fields</th>
<th align="left" valign="top"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p>anomali.description</p></td>
<td align="left" valign="top"><p>threat.indicator.description</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>anomali.created</p></td>
<td align="left" valign="top"><p>threat.indicator.first_seen</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>anomali.modified</p></td>
<td align="left" valign="top"><p>threat.indicator.last_seen</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>anomali.pattern</p></td>
<td align="left" valign="top"><p>threat.indicator.*</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
<tr>
<td align="left" valign="top"><p>anomali.labels</p></td>
<td align="left" valign="top"><p>tags</p></td>
<td align="left" valign="top"><p></p></td>
</tr>
</tbody>
</table>
</div>
<p>anomali.pattern is mapped to the appropriate field dependant on attribute type.</p>
<h3><a id="_fields_63"></a>Fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/beats/edit/master/filebeat/docs/modules/threatintel.asciidoc">edit</a></h3>
<p>For a description of each field in the module, see the
<a class="xref" href="exported-fields-threatintel.html" title="threatintel fields">exported fields</a> section.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="filebeat-module-system.html">« System module</a>
</span>
<span class="next">
<a href="filebeat-module-tomcat.html">Tomcat module »</a>
</span>
</div>
</div>
</body>
</html>
