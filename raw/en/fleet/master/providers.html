<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Providers | Fleet User Guide [master] | Elastic</title>
<link rel="home" href="index.html" title="Fleet User Guide [master]"/>
<link rel="up" href="dynamic-input-configuration.html" title="Variables and conditions in input configurations"/>
<link rel="prev" href="variable-substitution.html" title="Variable substitution"/>
<link rel="next" href="conditions.html" title="Conditions"/>
<meta name="DC.type" content="Learn/Docs/Fleet/Guide/master"/>
<meta name="DC.subject" content="Fleet"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Fleet User Guide [master]</a></span>
»
<span class="breadcrumb-link"><a href="elastic-agent-installation-configuration.html">Manage your Elastic Agents</a></span>
»
<span class="breadcrumb-link"><a href="dynamic-input-configuration.html">Variables and conditions in input configurations</a></span>
»
<span class="breadcrumb-node">Providers</span>
</div>
<div class="navheader">
<span class="prev">
<a href="variable-substitution.html">« Variable substitution</a>
</span>
<span class="next">
<a href="conditions.html">Conditions »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="providers"></a>Providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h3>
</div></div></div>
<p>Providers supply the key/values pairs that are used for variable substitution
and conditionals. Each provider&#8217;s keys are automatically prefixed with the name
of the provider in the context of the Elastic Agent.</p>
<p>For example, if a provider named <code class="literal">foo</code> provides
<code class="literal">{"key1": "value1", "key2": "value2"}</code>, the key/value pairs are placed in
<code class="literal">{"foo" : {"key1": "value1", "key2": "value2"}}</code>. To reference the keys, you
would use <code class="literal">{{foo.key1}}</code> and <code class="literal">{{foo.key2}}</code>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="_provider_configuration"></a>Provider configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h4>
</div></div></div>
<p>The provider configuration is specified under the top-level <code class="literal">providers</code>
key in the <code class="literal">elastic-agent.yml</code> configuration. By default, all registered
providers are enabled. If a provider cannot connect, it produces no mappings.</p>
<p>The following example shows two providers, <code class="literal">local</code> and <code class="literal">local_dynamic</code>, that
supply custom keys:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers:
  local:
    vars:
      foo: bar
  local_dynamic:
    vars:
      - item: key1
      - item: key2</pre>
</div>
<p>To explicitly disable a provider, set <code class="literal">enabled: false</code>. Because all providers
are prefixed and have no name collisions, the name of the provider is the key in
the configuration.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers:
  docker:
    enabled: false</pre>
</div>
<p>Elastic Agent supports two broad types of providers: <a class="xref" href="providers.html#context-providers" title="Context providers">context</a> and
<a class="xref" href="providers.html#dynamic-providers" title="Dynamic Providers">dynamic</a>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="context-providers"></a>Context providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h4>
</div></div></div>
<p>Context providers provide the current context of the running Elastic Agent, for
example, agent information (id, version), host information (hostname, IP
addresses), and environment information (environment variables).</p>
<p>They can only provide a single key/value mapping. Think of them as singletons;
an update of a key/value mapping will result in a re-evaluation of the entire
configuration. These providers are normally very static, but that&#8217;s not
required. It is possible for a value to change resulting in re-evaluation.</p>
<p>Context providers use ECS naming when possible to ensure that documentation and
understanding across projects is the same.</p>
<p>Elastic Agent supports the following context providers:</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="local-provider"></a>Local<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides custom keys to use as variables. For example:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers:
  local:
    vars:
      foo: bar</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="agent-provider"></a>Agent provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides information about the Elastic Agent. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Current agent ID</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Current agent version information object</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.version</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Current agent version</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.commit</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Version commit</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.build_time</code></p></td>
<td align="left" valign="top"><p><code class="literal">date</code></p></td>
<td align="left" valign="top"><p>Version build time</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">agent.version.snapshot</code></p></td>
<td align="left" valign="top"><p><code class="literal">boolean</code></p></td>
<td align="left" valign="top"><p>Version is snapshot build</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="host-provider"></a>Host provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides information about the current host. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">host.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Host name</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.platform</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Host platform</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.architecture</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Host architecture</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.ip[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]string</code></p></td>
<td align="left" valign="top"><p>Host IP addresses</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">host.mac[]</code></p></td>
<td align="left" valign="top"><p><code class="literal">[]string</code></p></td>
<td align="left" valign="top"><p>Host MAC addresses</p></td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="env-provider"></a>Env Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides access to the environment variables as key/values.</p>
<p>For example, if you set the variable foo:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">foo=bar elastic-agent run</pre>
</div>
<p>You can reference the environment variable as <code class="literal">${env.foo}</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="kubernetes_secrets-provider"></a>Kubernetes Secrets Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides access to the Kubernetes Secrets API.</p>
<p>Provider needs a <code class="literal">kubeconfig</code> file so as to establish connection to Kubernetes API,
or it can automatically reach the API if it runs in an inCluster environment (Agent runs as Pod).</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes_secrets:
  #kube_config: /Users/elastic-agent/.kube/config</pre>
</div>
<p>You can reference the Kubernetes Secrets variable as <code class="literal">${kubernetes_secrets.default.somesecret.value}</code>,
where <code class="literal">default</code> is the namespace of the Secret, <code class="literal">somesecret</code> is the name of the Secret and <code class="literal">value</code> the field
of the Secret to access.</p>
<p>If you run Agent on Kubernetes the proper rule in the <code class="literal">ClusterRole</code> is required so as Agent Pod to have access
to Secrets API:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- apiGroups: [""]
  resources:
    - secrets
  verbs: ["get"]</pre>
</div>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The above rule will give permission to Agent Pod to access Kubernetes Secrets API.
This means that anyone who have access to Agent Pod (<code class="literal">kubectl exec</code> for example) will be able to
access Kubernetes Secrets API and get a specific secret no matter which namespace it belongs to.
In this, this option should be carefully considered.</p>
</div>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="dynamic-providers"></a>Dynamic Providers<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h4>
</div></div></div>
<p>Dynamic providers provide an array of multiple key/value mappings. Each
key/value mapping is combined with the previous context provider&#8217;s key/value
mapping to provide a new unique key/value mapping that is used to generate a
configuration.</p>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="local-dynamic-provider"></a>Local dynamic provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Allows you to define multiple key/values to generate multiple configurations.</p>
<p>For example, the following agent policy defines a local dynamic provider that
defines 3 values for <code class="literal">item</code>:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
     - paths: "/var/${local_dynamic.my_var}/app.log"

providers:
  local_dynamic:
    items:
      - vars:
          my_var: key1
      - vars:
          my_var: key2
      - vars:
          my_var: key3</pre>
</div>
<p>The configuration generated by this policy looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
 - type: logfile
   streams:
     - paths: "/var/key1/app.log"
 - type: logfile
   streams:
     - paths: "/var/key2/app.log"
 - type: logfile
   streams:
   - paths: "/var/key3/app.log"</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="docker-provider"></a>Docker Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides inventory information from Docker. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>ID of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.cmd</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Arg path of container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.image</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Image of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.labels</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Labels of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.ports</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Ports of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.paths</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of paths for the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">docker.paths.log</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Log path of the container</p></td>
</tr>
</tbody>
</table>
</div>
<p>Imagine that the Docker provider provides the following inventory:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
    {
       "id": "1",
       "mapping:": {"id": "1", "paths": {"log": "/var/log/containers/1.log"}},
       "processors": {"add_fields": {"container.name": "my-container"}}
    },
    {
        "id": "2",
        "mapping": {"id": "2", "paths": {"log": "/var/log/containers/2.log"}},
        "processors": {"add_fields": {"container.name": "other-container"}}
    }
]</pre>
</div>
<p>Elastic Agent automatically prefixes the result with <code class="literal">docker</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">---
[
    {"docker": {"id": "1", "paths": {"log": "/var/log/containers/1.log"}}},
    {"docker": {"id": "2", "paths": {"log": "/var/log/containers/2.log"}},
]
---</pre>
</div>
<p>To set the log path dynamically in the configuration, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "${docker.paths.log}"</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: logfile
    path: "/var/log/containers/1.log"
    processors:
      - add_fields:
          container.name: my-container
  - type: logfile
    path: "/var/log/containers/2.log"
    processors:
      - add_fields:
          container.name: other-container</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="kubernetes-provider"></a>Kubernetes Provider<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h5>
</div></div></div>
<p>Provides inventory information from Kubernetes. The available keys are:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Key</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.namespace</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Namespace of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.uuid</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>UUID of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.ip</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>IP of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.pod.labels</code></p></td>
<td align="left" valign="top"><p><code class="literal">object</code></p></td>
<td align="left" valign="top"><p>Object of labels of the Pod</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.name</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Name of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.runtime</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Runtime of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.id</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>ID of the container</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">kubernetes.container.image</code></p></td>
<td align="left" valign="top"><p><code class="literal">string</code></p></td>
<td align="left" valign="top"><p>Image of the container</p></td>
</tr>
</tbody>
</table>
</div>
<p>Imagine that the Kubernetes provider provides the following inventory:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">[
    {
       "id": "1",
       "mapping:": {"namespace": "kube-system", "pod": {"name": "kube-controllermanger"}},
       "processors": {"add_fields": {"container.name": "my-container"}}
    },
    {
        "id": "2",
        "mapping:": {"namespace": "kube-system", "pod": {"name": "kube-scheduler"}},
        "processors": {"add_fields": {"kuberentes.namespace": "kube-system", "kubernetes.pod": {"name": "kube-scheduler"}}
    }
]</pre>
</div>
<p>Elastic Agent automatically prefixes the result with <code class="literal">kuberentes</code>:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">---
[
    {"kubernetes": {"id": "1", "namespace": "kube-system", "pod": {"name": "kube-controllermanger"}},
    {"kubernetes": {"id": "2", "namespace": "kube-system", "pod": {"name": "kube-scheduler"}},
]
---</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_provider_configuration_2"></a>Provider configuration<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h6>
</div></div></div>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">providers.kubernetes:
  node: ${NODE_NAME}
  scope: node
  #kube_config: /Users/elastic-agent/.kube/config
  #sync_period: 600
  #cleanup_timeout: 60</pre>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">node</code>
</span>
</dt>
<dd>
(Optional) Specify the node to scope Elastic Agent to in case it
cannot be accurately detected, as when running Elastic Agent in host network
mode.
</dd>
<dt>
<span class="term">
<code class="literal">cleanup_timeout</code>
</span>
</dt>
<dd>
(Optional) Specify the time of inactivity before stopping the
running configuration for a container, 60s by default.
</dd>
<dt>
<span class="term">
<code class="literal">sync_period</code>
</span>
</dt>
<dd>
(Optional) Specify timeout for listing historical resources.
</dd>
<dt>
<span class="term">
<code class="literal">kube_config</code>
</span>
</dt>
<dd>
(Optional) Use given config file as configuration for Kubernetes
client. If kube_config is not set, KUBECONFIG environment variable will be
checked and if not present it will fall back to InCluster.
</dd>
<dt>
<span class="term">
<code class="literal">scope</code>
</span>
</dt>
<dd>
(Optional) Specify at what level autodiscover needs to be done at. <code class="literal">scope</code> can
either take <code class="literal">node</code> or <code class="literal">cluster</code> as values. <code class="literal">node</code> scope allows discovery of resources in
the specified node. <code class="literal">cluster</code> scope allows cluster wide discovery. Only <code class="literal">pod</code> and <code class="literal">node</code> resources
can be discovered at node scope.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h6 class="title"><a id="_autodiscover_target_pods"></a>Autodiscover target Pods<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/master/docs/en/ingest-management/elastic-agent/elastic-agent-providers.asciidoc">edit</a></h6>
</div></div></div>
<p>To set the target host dynamically only for a targeted Pod based on its labels, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- data_stream:
      dataset: kubernetes.scheduler
      type: metrics
  metricsets:
    - scheduler
  hosts:
    - '${kubernetes.pod.ip}:10251'
  period: 10s
  condition: ${kubernetes.pod.labels.component} == 'kube-scheduler'</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- hosts:
  - 172.18.0.4:10251
  metricsets:
  - scheduler
  module: kubernetes
  period: 10s
  processors:
  - add_fields:
    fields:
      namespace: kube-system
      pod:
        ip: 172.18.0.4
        labels:
          component: kube-scheduler
          tier: control-plane
        name: kube-scheduler-kind-control-plane
        uid: 6da04645-04b4-4cb2-b203-2ad58abc6cdf
    target: kubernetes</pre>
</div>
<p>To set the log path of Pods dynamically in the configuration, use a variable in the
Elastic Agent policy to return path information from the provider:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">streams:
  - data_stream:
      dataset: generic
    symlinks: true
    paths:
      - /var/log/containers/*${kubernetes.container.id}.log</pre>
</div>
<p>The policy generated by this configuration looks like:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">- paths:
  - /var/log/containers/*c957652eca53594ce496c7b237d19f05be339ebfe281b99ce1c0a0401e48ce3a.log
  processors:
  - add_fields:
    fields:
      container:
        id: c957652eca53594ce496c7b237d19f05be339ebfe281b99ce1c0a0401e48ce3a
        image: k8s.gcr.io/kube-apiserver:v1.18.2
        name: kube-apiserver
        runtime: containerd
      namespace: kube-system
      pod:
        ip: 172.18.0.4
        labels:
          component: kube-apiserver
          tier: control-plane
        name: kube-apiserver-kind-control-plane
        uid: f8743f90-50a4-4ef8-9fe9-78c245eb8bf3
    target: kubernetes
  symlinks: true</pre>
</div>
</div>

</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="variable-substitution.html">« Variable substitution</a>
</span>
<span class="next">
<a href="conditions.html">Conditions »</a>
</span>
</div>
</div>
</body>
</html>
