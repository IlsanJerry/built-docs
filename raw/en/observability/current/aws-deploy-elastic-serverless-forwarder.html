<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="description" content="Deploy the Elastic Serverless Forwarder using Kibana and the AWS Serverless Application Repository (SAR).">
<meta name="keywords" content="serverless">
<title>Deploy Elastic Serverless Forwarder | Observability Guide [8.6] | Elastic</title>
<link rel="home" href="index.html" title="Observability Guide [8.6]"/>
<link rel="up" href="aws-elastic-serverless-forwarder.html" title="Elastic Serverless Forwarder for AWS"/>
<link rel="prev" href="aws-elastic-serverless-forwarder.html" title="Elastic Serverless Forwarder for AWS"/>
<link rel="next" href="aws-elastic-serverless-forwarder-configuration.html" title="Configuration options for Elastic Serverless Forwarder"/>
<meta name="DC.type" content="Learn/Docs/Observability/Guide/8.6"/>
<meta name="DC.subject" content="Observability"/>
<meta name="DC.identifier" content="8.6"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Observability Guide [8.6]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="add-observability-data.html">Send data to Elasticsearch</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="aws-elastic-serverless-forwarder.html">Elastic Serverless Forwarder for AWS</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="aws-elastic-serverless-forwarder.html">« Elastic Serverless Forwarder for AWS</a>
</span>
<span class="next">
<a href="aws-elastic-serverless-forwarder-configuration.html">Configuration options for Elastic Serverless Forwarder »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="aws-deploy-elastic-serverless-forwarder"></a>Deploy Elastic Serverless Forwarder<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h3>
</div></div></div>

<p>To deploy Elastic Serverless Forwarder, you have to:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="aws-deploy-elastic-serverless-forwarder.html#aws-serverless-forwarder-deploy-kibana" title="Install AWS integration assets in Kibana">Install AWS integration assets in Kibana</a>
</li>
<li class="listitem">
<a class="xref" href="aws-deploy-elastic-serverless-forwarder.html#sample-s3-config-file" title="Create and upload config.yaml to S3 bucket">Create and upload <code class="literal">config.yaml</code> to S3 bucket</a>
</li>
<li class="listitem">
<a class="xref" href="aws-deploy-elastic-serverless-forwarder.html#aws-serverless-forwarder-deploy-sar" title="Deploy elastic-serverless-forwarder from Serverless Application Repository">Deploy <code class="literal">elastic-serverless-forwarder</code> from Serverless Application Repository</a>
</li>
</ul>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This page describes the basic steps required to deploy Elastic Serverless
Forwarder for AWS— for additional information on configuration topics such as permissions and automatic routing, and parsing and enriching data, see <a class="xref" href="aws-elastic-serverless-forwarder-configuration.html" title="Configuration options for Elastic Serverless Forwarder">Configuration options</a>.</p>
</div>
</div>
<h6><a id="aws-serverless-forwarder-deploy-prereq"></a>Pre-requisites<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h6>
<p>This documentation assumes you have some familiarity with AWS services and you have correctly created and configured the necessary AWS objects. For example, if you want to use an Amazon S3 (via SQS event notifications) input then you must ensure that you have enabled AWS VPC flow logs to be sent to that bucket, and created an SQS queue to receive those logs. For more information, refer to the relevant <a href="https://docs.aws.amazon.com/" class="ulink" target="_top">AWS docs</a>.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="aws-serverless-forwarder-deploy-kibana"></a>Install AWS integration assets in Kibana<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h4>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Integrations</strong></span> in Kibana and search for AWS (or select the <span class="strong strong"><strong>AWS</strong></span>
category to filter the list).
</li>
<li class="listitem">
Click the AWS integration, select <span class="strong strong"><strong>Settings</strong></span> and click
<span class="strong strong"><strong>Install AWS assets</strong></span> and confirm to install all the AWS integration assets.
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/aws-serverless-forwarder-install-assets.png" alt="Find and install AWS integration assets in Kibana">
</div>
</div>
<p>Adding integrations from Kibana provides appropriate pre-built dashboards,
ingest node configurations, and other assets that help you get the most out of
the data you ingest. The integrations use <a href="/guide/en/elasticsearch/reference/current/data-streams.html" class="ulink" target="_top">data streams</a>
with specific <a href="/blog/an-introduction-to-the-elastic-data-stream-naming-scheme" class="ulink" target="_top">naming conventions</a>
that provide you with more granular controls and flexibility on managing data ingestion.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>We recommend using integration assets to get started but the forwarder supports writing to any index, alias, or custom data stream. This enables existing Elasticsearch users to re-use index templates, ingest pipelines, or dashboards that are already created and connected to existing processes or systems. If you already have an existing index or data stream you to send data to then then you can skip this deployment step.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="sample-s3-config-file"></a>Create and upload <code class="literal">config.yaml</code> to S3 bucket<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h4>
</div></div></div>
<p>Elastic Serverless Forwarder requires a <code class="literal">config.yaml</code> file to be uploaded to an S3 bucket and referenced by the <code class="literal">S3_CONFIG_FILE</code> environment variable.</p>
<p>Save the following YAML content as <code class="literal">config.yaml</code> and edit as required before uploading to an S3 bucket. You should remove any inputs or arguments you are not using, and ensure you have entered the correct URLs and credentials as per the inline comments.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">inputs:
  - type: "s3-sqs"
    id: "arn:aws:sqs:%REGION%:%ACCOUNT%:%QUEUENAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "sqs"
    id: "arn:aws:sqs:%REGION%:%ACCOUNT%:%QUEUENAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "kinesis-data-stream"
    id: "arn:aws:kinesis:%REGION%:%ACCOUNT%:stream/%STREAMNAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "cloudwatch-logs"
    id: "arn:aws:logs:%AWS_REGION%:%AWS_ACCOUNT_ID%:log-group:%LOG_GROUP_NAME%:*"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760
  - type: "cloudwatch-logs"
    id: "arn:aws:logs:%AWS_REGION%:%AWS_ACCOUNT_ID%:log-group:%LOG_GROUP_NAME%:log-stream:%LOG_STREAM_NAME%"
    outputs:
      - type: "elasticsearch"
        args:
          # either elasticsearch_url or cloud_id, elasticsearch_url takes precedence if both are included
          elasticsearch_url: "http(s)://domain.tld:port"
          cloud_id: "cloud_id:bG9jYWxob3N0OjkyMDAkMA=="
          # either api_key or username/password, username/password takes precedence if both are included
          api_key: "YXBpX2tleV9pZDphcGlfa2V5X3NlY3JldAo="
          username: "username"
          password: "password"
          es_datastream_name: "logs-generic-default"
          batch_max_actions: 500 # optional: default value is 500
          batch_max_bytes: 10485760 # optional: default value is 10485760</pre>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="s3-config-file-fields"></a>Fields<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h5>
</div></div></div>
<p><code class="literal">inputs.[]</code>:</p>
<p>A list of inputs (i.e. triggers) for the Elastic Serverless Forwarder Lambda function.</p>
<p><code class="literal">inputs.[].type</code>:</p>
<p>The type of trigger input (<code class="literal">cloudwatch-logs</code>, <code class="literal">kinesis-data-stream</code>, <code class="literal">sqs</code> and <code class="literal">s3-sqs</code> are currently supported).</p>
<p><code class="literal">inputs.[].id</code>:</p>
<p>The ARN of the trigger input according to the type. Multiple input entries can have different unique ids with the same type.
Inputs of type <code class="literal">cloudwatch-logs</code> accept both CloudWatch Logs Log Group and CloudWatch Logs Log Stream ARNs.</p>
<p><code class="literal">inputs.[].outputs</code>:</p>
<p>A list of outputs (i.e. forwarding targets) for the Elastic Serverless Forwarder Lambda function. You can have multiple outputs for an input, but only one output can be defined per type.</p>
<p><code class="literal">inputs.[].outputs.[].type</code>:</p>
<p>The type of the forwarding target output (currently only <code class="literal">elasticsearch</code> supported).</p>
<p><code class="literal">inputs.[].outputs.[].args</code>:
Custom init arguments for the specified forwarding target output.</p>
<p>For <code class="literal">elasticsearch</code> the following arguments are supported:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">args.elasticsearch_url</code>: URL of elasticsearch endpoint in the format <code class="literal">http(s)://domain.tld:port</code>. Mandatory when <code class="literal">args.cloud_id</code> is not provided. Will take precedence over <code class="literal">args.cloud_id</code> if both are defined.
</li>
<li class="listitem">
<code class="literal">args.cloud_id</code>: Cloud ID of elasticsearch endpoint. Mandatory when <code class="literal">args.elasticsearch_url</code> is not provided. Will be ignored if <code class="literal">args.elasticsearch_url</code> is defined.
</li>
<li class="listitem">
<code class="literal">args.username</code>: Username of the elasticsearch instance to connect to. Mandatory when <code class="literal">args.api_key</code> is not provided. Will take precedence over <code class="literal">args.api_key</code> if both are defined.
</li>
<li class="listitem">
<code class="literal">args.password</code> Password of the elasticsearch instance to connect to. Mandatory when <code class="literal">args.api_key</code> is not provided. Will take precedence over <code class="literal">args.api_key</code> if both are defined.
</li>
<li class="listitem">
<code class="literal">args.api_key</code>:  API key of elasticsearch endpoint in the format <span class="strong strong"><strong>base64encode(api_key_id:api_key_secret)</strong></span>. Mandatory when <code class="literal">args.username</code>  and <code class="literal">args.password</code> are not provided. Will be ignored if <code class="literal">args.username</code>/<code class="literal">args.password</code> are defined.
</li>
<li class="listitem">
<code class="literal">args.es_datastream_name</code>: Name of data stream or index where logs should be forwarded to. Lambda supports automatic routing of various AWS service logs to the corresponding data streams for further processing and storage in the Elasticsearch cluster. It supports automatic routing of <code class="literal">aws.cloudtrail</code>, <code class="literal">aws.cloudwatch_logs</code>, <code class="literal">aws.elb_logs</code>, <code class="literal">aws.firewall_logs</code>, <code class="literal">aws.vpcflow</code>, and <code class="literal">aws.waf</code> logs. For other log types, if using data streams, you can optionally set its value in the configuration file according to the naming convention for data streams and available integrations. If the <code class="literal">es_datastream_name</code> is not specified and it cannot be matched with any of the above AWS services, then the value will be set to <code class="literal">logs-generic-default</code>. In version <span class="strong strong"><strong>v0.29.1</strong></span> and earlier, this configuration parameter was named <code class="literal">es_index_or_datastream_name</code>. Rename the configuration parameter to <code class="literal">es_datastream_name</code> in your <code class="literal">config.yaml</code> file on the S3 bucket to continue using it in the future version. The older name <code class="literal">es_index_or_datastream_name</code> is deprecated as of version <span class="strong strong"><strong>v0.30.0</strong></span>. The related backward compatibility code is removed from version <span class="strong strong"><strong>v1.0.0</strong></span>.
</li>
<li class="listitem">
<code class="literal">args.batch_max_actions</code>: (Optional) Maximum number of actions to send in a single bulk request. Default value: 500.
</li>
<li class="listitem">
<code class="literal">args.batch_max_bytes</code>: (Optional) Maximum size in bytes to send in a single bulk request. Default value: 10485760 (10MB).
</li>
<li class="listitem">
<code class="literal">args.ssl_assert_fingerprint</code>: (Optional) SSL fingerprint for self-signed SSL certificate on HTTPS transport.
</li>
</ul>
</div>
</div>

</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="aws-serverless-forwarder-deploy-sar"></a>Deploy <code class="literal">elastic-serverless-forwarder</code> from Serverless Application Repository<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h4>
</div></div></div>
<p>There are several deployment methods available via the AWS Serverless Application Repository:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="aws-deploy-elastic-serverless-forwarder.html#aws-serverless-forwarder-deploy-console" title="Deploy using AWS Console">Deploy using AWS Console</a>
</li>
<li class="listitem">
<a class="xref" href="aws-deploy-elastic-serverless-forwarder.html#aws-serverless-forwarder-deploy-cloudformation" title="Deploy using Cloudformation">Deploy using Cloudformation</a>
</li>
<li class="listitem">
<a class="xref" href="aws-deploy-elastic-serverless-forwarder.html#aws-serverless-forwarder-deploy-terraform" title="Deploy using Terraform">Deploy using Terraform</a>
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="aws-serverless-forwarder-deploy-console"></a>Deploy using AWS Console<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h5>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Log in to AWS console and open <span class="strong strong"><strong>Lambda</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Applications</strong></span> and then <span class="strong strong"><strong>Create application</strong></span>.
</li>
<li class="listitem">
Click <span class="strong strong"><strong>Serverless application</strong></span> and search for <span class="strong strong"><strong>elastic-serverless-forwarder</strong></span>.
</li>
<li class="listitem">
<p>Select <span class="strong strong"><strong>elastic-serverless-forwarder</strong></span> from the search results (ignoring any application beginning <span class="strong strong"><strong>helper-</strong></span>).</p>
<div class="imageblock screenshot">
<div class="content">
<img src="images/aws-serverless-forwarder-create-function.png" alt="Create Elastic Serverless Forwarder Lambda function within SAR">
</div>
</div>
</li>
<li class="listitem">
<p>Complete the <span class="strong strong"><strong>Application settings</strong></span> as follows, making sure you reference the ARNs specified in your <code class="literal">config.yaml</code>, and leaving any settings for unused inputs blank:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">ElasticServerlessForwarderS3ConfigFile</code>: Set this value to the location of your Elastic Serverless Forwarder configuration file in S3 URL format: <code class="literal">s3://bucket-name/config-file-name</code>. This will populate the <code class="literal">S3_CONFIG_FILE</code> environment variable for the forwarder.
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderSSMSecrets</code>: Add a comma delimited list of AWS SSM Secrets ARNs (if any).
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderKMSKeys</code>: Add a comma delimited list of AWS KMS Keys ARNs to be used for decrypting AWS SSM Secrets (if any).
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderSQSEvents</code>: Add a comma delimited list of Direct SQS queues ARNs to set as event triggers for the forwarder (if any).
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderS3SQSEvents</code>: Add a comma delimited list of S3 SQS Event Notifications ARNs to set as event triggers for the forwarder (if any).
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderKinesisEvents</code>: Add a comma delimited list of Kinesis Data Stream ARNs to set as event triggers for the forwarder (if any).
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderCloudWatchLogsEvents</code>: Add a comma delimited list of Cloudwatch Logs log group ARNs to set subscription filters on the forwarder (if any).
</li>
<li class="listitem">
<code class="literal">ElasticServerlessForwarderS3Buckets</code>: Add a comma delimited list of S3 bucket ARNs that are sources for the S3 SQS Event Notifications (if any).
</li>
</ul>
</div>
</li>
<li class="listitem">
After your settings have been added, click <span class="strong strong"><strong>Deploy</strong></span>.
</li>
<li class="listitem">
On the Applications page for <span class="strong strong"><strong>serverlessrepo-elastic-serverless-forwarder</strong></span>, click <span class="strong strong"><strong>Deployments</strong></span>.
</li>
<li class="listitem">
Refresh the <span class="strong strong"><strong>Deployment history</strong></span> until you see the <code class="literal">Create complete</code> status update. It should take around 5 minutes to deploy &mdash; if the deployment fails for any reason, the create events will be rolled back and you will be able to see an explanation for which event failed.
</li>
<li class="listitem">
<p>(Optional) To enable Elastic APM instrumentation for your new deployment:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Go to <span class="strong strong"><strong>Lambda &gt; Functions</strong></span> within AWS console, and find and select the function with <span class="strong strong"><strong>serverlessrepo-</strong></span>.
</li>
<li class="listitem">
Go to <span class="strong strong"><strong>Configuration</strong></span> tab and select <span class="strong strong"><strong>Environment Variables</strong></span>
</li>
<li class="listitem">
<p>Add the following environment variables:</p>
<pre class="literallayout">| Key                       | Value  |
|---------------------------|--------|
|`ELASTIC_APM_ACTIVE`       | `true` |
|`ELASTIC_APM_SECRET_TOKEN` | token  |
|`ELASTIC_APM_SERVER_URL`	  | url    |</pre>

</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you have already successfully deployed the forwarder but want to update the application (for example, if a new version of the Lambda function is released), you should go through this deploy step again and use the same <span class="strong strong"><strong>Application name</strong></span>. This will ensure the function is updated rather than duplicated or created anew.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="aws-serverless-forwarder-deploy-cloudformation"></a>Deploy using Cloudformation<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h5>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Use the following code to get the semantic version of the latest application:</p>
<div class="pre_wrapper lang-bash">
<pre class="programlisting prettyprint lang-bash">aws serverlessrepo list-application-versions --application-id arn:aws:serverlessrepo:eu-central-1:267093732750:applications/elastic-serverless-forwarder</pre>
</div>
</li>
<li class="listitem">
<p>Save the following YAML content as <code class="literal">sar-application.yaml</code> and fill in the correct parameters:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">    Transform: AWS::Serverless-2016-10-31
    Resources:
      SarCloudformationDeployment:
        Type: AWS::Serverless::Application
        Properties:
          Location:
            ApplicationId: 'arn:aws:serverlessrepo:eu-central-1:267093732750:applications/elastic-serverless-forwarder'
            SemanticVersion: '%SEMANTICVERSION%'  ## SET TO CORRECT SEMANTIC VERSION (MUST BE GREATER THAN 0.30.0)
          Parameters:
            ElasticServerlessForwarderS3ConfigFile: ""          ## ENTER THE VALUE OF THE S3 URL IN THE FORMAT "s3://bucket-name/config-file-name" POINTING TO THE CONFIGURATION FILE FOR YOUR ELASTIC SERVERLESS FORWARDER DEPLOYMENT
            ElasticServerlessForwarderSSMSecrets: ""            ## ENTER A COMMA DELIMITED LIST OF AWS SSM SECRETS ARNS REFERENCED IN THE CONFIG YAML FILE (IF ANY).
            ElasticServerlessForwarderKMSKeys: ""               ## ENTER A COMMA DELIMITED LIST OF AWS KMS KEYS ARNS TO BE USED FOR DECRYPTING AWS SSM SECRETS REFERENCED IN THE CONFIG YAML FILE (IF ANY).
            ElasticServerlessForwarderSQSEvents: ""             ## ENTER A COMMA DELIMITED LIST OF DIRECT SQS QUEUE ARNS REFERENCED IN THE CONFIG YAML FILE TO SET AS EVENT TRIGGERS FOR THE FUNCTION (IF ANY).
            ElasticServerlessForwarderS3SQSEvents: ""           ## ENTER A COMMA DELIMITED LIST OF S3 SQS EVENT NOTIFICATION ARNS REFERENCED IN THE CONFIG YAML FILE TO SET AS EVENT TRIGGERS FOR THE FUNCTION  (IF ANY).
            ElasticServerlessForwarderKinesisEvents: ""         ## ENTER A COMMA DELIMITED LIST OF KINESIS DATA STREAM ARNS REFERENCED IN THE CONFIG YAML FILE TO SET AS EVENT TRIGGERS FOR THE FUNCTION (IF ANY).
            ElasticServerlessForwarderCloudWatchLogsEvents: ""  ## ENTER A COMMA DELIMITED LIST OF CLOUDWATCH LOGS LOG GROUPS ARNS REFERENCED IN THE CONFIG YAML FILE TO SET SUBSCRIPTION FILTERS ON THE FUNCTION (IF ANY).
            ElasticServerlessForwarderS3Buckets: ""             ## ENTER A COMMA DELIMITED LIST OF S3 BUCKETS ARNS THAT ARE THE SOURCES OF THE S3 SQS EVENT NOTIFICATIONS REFERENCED IN THE CONFIG YAML FILE (IF ANY).</pre>
</div>
</li>
<li class="listitem">
<p>Deploy the Lambda function from SAR by running the following command:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">    aws cloudformation deploy --template-file sar-application.yaml --stack-name esf-cloudformation-deployment --capabilities CAPABILITY_IAM CAPABILITY_AUTO_EXPAND</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Starting from <span class="strong strong"><strong>v1.4.0</strong></span>, if you want to update the Events settings for the forwarder, you do not need to manually delete existing settings before applying new settings.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="aws-serverless-forwarder-deploy-terraform"></a>Deploy using Terraform<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/observability-docs/edit/8.6/docs/en/observability/aws-deploy-elastic-serverless-forwarder.asciidoc">edit</a></h5>
</div></div></div>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<p>Save the following yaml content as <code class="literal">sar-application.tf</code> and fill in the correct parameters:</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">  provider "aws" {
    region = ""  ## FILL WITH THE AWS REGION WHERE YOU WANT TO DEPLOY THE ELASTIC SERVERLESS FORWARDER
  }
  data "aws_serverlessapplicationrepository_application" "esf_sar" {
    application_id = "arn:aws:serverlessrepo:eu-central-1:267093732750:applications/elastic-serverless-forwarder"
  }
  resource "aws_serverlessapplicationrepository_cloudformation_stack" "esf_cf_stak" {
    name             = "terraform-elastic-serverless-forwarder"
    application_id   = data.aws_serverlessapplicationrepository_application.esf_sar.application_id
    semantic_version = data.aws_serverlessapplicationrepository_application.esf_sar.semantic_version
    capabilities     = data.aws_serverlessapplicationrepository_application.esf_sar.required_capabilities
  parameters = {
      ElasticServerlessForwarderS3ConfigFile         = ""  ## ENTER THE VALUE OF THE S3 URL IN THE FORMAT "s3://bucket-name/config-file-name" POINTING TO THE CONFIGURATION FILE FOR YOUR ELASTIC SERVERLESS FORWARDER DEPLOYMENT
      ElasticServerlessForwarderSSMSecrets           = ""  ## ENTER A COMMA DELIMITED LIST OF AWS SSM SECRETS ARNS REFERENCED IN THE CONFIG YAML FILE (IF ANY).
      ElasticServerlessForwarderKMSKeys              = ""  ## ENTER A COMMA DELIMITED LIST OF AWS KMS KEYS ARNS REFERENCED IN THE CONFIG YAML FILE TO BE USED FOR DECRYPTING AWS SSM SECRETS (IF ANY).
      ElasticServerlessForwarderSQSEvents            = ""  ## ENTER A COMMA DELIMITED LIST OF DIRECT SQS QUEUE ARNS REFERENCED IN THE CONFIG YAML FILE TO SET AS EVENT TRIGGERS FOR THE FUNCTION (IF ANY).
      ElasticServerlessForwarderS3SQSEvents          = ""  ## ENTER A COMMA DELIMITED LIST OF S3 SQS EVENT NOTIFICATIONS ARNS REFERENCED IN THE CONFIG YAML FILE TO SET AS EVENT TRIGGERS FOR THE FUNCTION (IF ANY).
      ElasticServerlessForwarderKinesisEvents        = ""  ## ENTER A COMMA DELIMITED LIST OF KINESIS DATA STREAM ARNS REFERENCED IN THE CONFIG YAML FILE TO SET AS EVENT TRIGGERS FOR THE FUNCTION (IF ANY).
      ElasticServerlessForwarderCloudWatchLogsEvents = ""  ## ENTER A COMMA DELIMITED LIST OF CLOUDWATCH LOGS LOG GROUP ARNS REFERENCED IN THE CONFIG YAML FILE TO SET SUBSCRIPTION FILTERS ON THE FUNCTION (IF ANY).
      ElasticServerlessForwarderS3Buckets            = ""  ## ENTER A COMMA DELIMITED LIST OF S3 BUCKET ARNS REFERENCED IN THE CONFIG YAML FILE THAT ARE THE SOURCES OF THE S3 SQS EVENT NOTIFICATIONS (IF ANY).
    }
  }</pre>
</div>
</li>
<li class="listitem">
<p>Deploy the function from SAR by running the following commands:</p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">  terrafrom init
  terrafrom apply</pre>
</div>
</li>
</ol>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Starting from <span class="strong strong"><strong>v1.4.0</strong></span>, if you want to update the Events settings for the deployment, it is no longer required to manually delete existing settings before applying the new settings.</p>
<p>Due to a <a href="https://github.com/hashicorp/terraform-provider-aws/issues/24771" class="ulink" target="_top">Terraform bug</a> related to <code class="literal">aws_serverlessapplicationrepository_application</code>, if you want to delete existing Event parameters you have to set the related <code class="literal">aws_serverlessapplicationrepository_cloudformation_stack.parameters</code> to a blank space value (<code class="literal">" "</code>) instead of an empty string (<code class="literal">""</code>).</p>
</div>
</div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="aws-elastic-serverless-forwarder.html">« Elastic Serverless Forwarder for AWS</a>
</span>
<span class="next">
<a href="aws-elastic-serverless-forwarder-configuration.html">Configuration options for Elastic Serverless Forwarder »</a>
</span>
</div>
</div>
</body>
</html>
