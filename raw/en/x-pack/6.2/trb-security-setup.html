<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Setup-passwords command fails due to connection failure
        | X-Pack for the Elastic Stack [6.2]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="X-Pack for the Elastic Stack [6.2]" /><link rel="up" href="security-troubleshooting.html" title="X-Pack security Troubleshooting" /><link rel="prev" href="trb-security-internalserver.html" title="Internal Server Error in Kibana" /><link rel="next" href="watcher-troubleshooting.html" title="X-Pack Watcher Troubleshooting" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/Legacy/XPack/Reference/6.2" /><meta xmlns="" name="DC.subject" content="X-Pack" /><meta xmlns="" name="DC.identifier" content="6.2" /><meta xmlns="" name="robots" content="noindex,nofollow" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.  Not what you want? 
See the <a href="https://www.elastic.co/guide/en/elastic-stack-overview/current/index.html">current release documentation</a>.</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">X-Pack for the Elastic Stack
      [6.2]
    </a></span> » <span class="breadcrumb-link"><a href="xpack-troubleshooting.html">Troubleshooting</a></span> » <span class="breadcrumb-link"><a href="security-troubleshooting.html">X-Pack security Troubleshooting</a></span> » <span class="breadcrumb-node">Setup-passwords command fails due to connection failure</span></div><div xmlns="" class="navheader"><span class="prev"><a href="trb-security-internalserver.html">
              « 
              Internal Server Error in Kibana</a>
           
        </span><span class="next">
           
          <a href="watcher-troubleshooting.html">X-Pack Watcher Troubleshooting
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="trb-security-setup"></a>Setup-passwords command fails due to connection failure</h2></div></div></div><p>The <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/setup-passwords.html" target="_top">setup-passwords command</a> sets passwords for
the built-in users by sending user management API requests. If your cluster uses
SSL/TLS for the HTTP (REST) interface, the command attempts to establish a
connection with the HTTPS protocol. If the connection attempt fails, the
command fails.</p><p><span class="strong strong"><strong>Symptoms:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">Elasticsearch is running HTTPS, but the command fails to detect it and returns the
following errors:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">Cannot connect to elasticsearch node.
java.net.SocketException: Unexpected end of file from server
...
ERROR: Failed to connect to elasticsearch at
http://127.0.0.1:9200/_xpack/security/_authenticate?pretty.
Is the URL correct and elasticsearch running?</pre></div></li><li class="listitem"><p class="simpara">SSL/TLS is configured, but trust cannot be established. The command returns
the following errors:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">SSL connection to
https://127.0.0.1:9200/_xpack/security/_authenticate?pretty
failed: sun.security.validator.ValidatorException:
PKIX path building failed:
sun.security.provider.certpath.SunCertPathBuilderException:
unable to find valid certification path to requested target
Please check the elasticsearch SSL settings under
xpack.security.http.ssl.
...
ERROR: Failed to establish SSL connection to elasticsearch at
https://127.0.0.1:9200/_xpack/security/_authenticate?pretty.</pre></div></li><li class="listitem"><p class="simpara">The command fails because hostname verification fails, which results in the
following errors:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">SSL connection to
https://idp.localhost.test:9200/_xpack/security/_authenticate?pretty
failed: java.security.cert.CertificateException:
No subject alternative DNS name matching
elasticsearch.example.com found.
Please check the elasticsearch SSL settings under
xpack.security.http.ssl.
...
ERROR: Failed to establish SSL connection to elasticsearch at
https://elasticsearch.example.com:9200/_xpack/security/_authenticate?pretty.</pre></div></li></ol></div><p><span class="strong strong"><strong>Resolution:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">If your cluster uses TLS/SSL for the HTTP interface but the <code class="literal">setup-passwords</code>
command attempts to establish a non-secure connection, use the <code class="literal">--url</code> command
option to explicitly specify an HTTPS URL.  Alternatively, set the
<code class="literal">xpack.security.http.ssl.enabled</code> setting to <code class="literal">true</code>.</li><li class="listitem">If the command does not trust the Elasticsearch server, verify that you configured the
<code class="literal">xpack.security.http.ssl.certificate_authorities</code> setting or the
<code class="literal">xpack.security.http.ssl.truststore.path</code> setting.</li><li class="listitem">If hostname verification fails, you can disable this verification by setting
<code class="literal">xpack.security.http.ssl.verification_mode</code> to <code class="literal">certificate</code>.</li></ol></div><p>For more information about these settings, see
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/security-settings.html" target="_top">Security Settings in Elasticsearch</a>.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="trb-security-internalserver.html">
              « 
              Internal Server Error in Kibana</a>
           
        </span><span class="next">
           
          <a href="watcher-troubleshooting.html">X-Pack Watcher Troubleshooting
               »
            </a></span></div></body></html>