<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Common problems
        | APM Server Reference [6.4]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="APM Server Reference [6.4]" /><link rel="up" href="troubleshooting.html" title="Troubleshooting" /><link rel="prev" href="troubleshooting.html" title="Troubleshooting" /><link rel="next" href="getting-help.html" title="Get help" /><meta xmlns="" name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta xmlns="" name="DC.type" content="Learn/Docs/APM Server/Reference/6.4" /><meta xmlns="" name="DC.subject" content="APM" /><meta xmlns="" name="DC.identifier" content="6.4" /></head><body><div xmlns="" class="page_header">You are looking at documentation for an older release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">APM Server Reference
      [6.4]
    </a></span> » <span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshooting</a></span> » <span class="breadcrumb-node">Common problems</span></div><div xmlns="" class="navheader"><span class="prev"><a href="troubleshooting.html">
              « 
              Troubleshooting</a>
           
        </span><span class="next">
           
          <a href="getting-help.html">Get help
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="common-problems"></a>Common problems<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This section describes common problems you might encounter with APM Server.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="xref" href="common-problems.html#no-data-indexed" title="No data is indexed">No data is indexed</a></li><li class="listitem"><a class="xref" href="common-problems.html#bad-request" title="HTTP 400: Data decoding error / Data validation error">HTTP 400: Data decoding error / Data validation error</a></li><li class="listitem"><a class="xref" href="common-problems.html#unauthorized" title="HTTP 401: Invalid token">HTTP 401: Invalid token</a></li><li class="listitem"><a class="xref" href="common-problems.html#forbidden" title="HTTP 403: Forbidden request">HTTP 403: Forbidden request</a></li><li class="listitem"><a class="xref" href="common-problems.html#request-too-large" title="HTTP 413: Request body too large">HTTP 413: Request body too large</a></li><li class="listitem"><a class="xref" href="common-problems.html#queue-full" title="HTTP 503: Queue is full">HTTP 503: Queue is full</a></li><li class="listitem"><a class="xref" href="common-problems.html#request-timed-out" title="HTTP 503: Request timed out waiting to be processed">HTTP 503: Request timed out waiting to be processed</a></li><li class="listitem"><a class="xref" href="common-problems.html#ssl-client-fails" title="SSL client fails to connect">SSL client fails to connect</a></li></ul></div><h3><a id="no-data-indexed"></a>No data is indexed<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>If no data shows up in Elasticsearch, first check that the APM components are properly connected.</p><p>To ensure that APM Server configuration is valid and it can connect to the configured output, Elasticsearch by default,
run the following commands:</p><div xmlns="" class="pre_wrapper lang-sh"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-sh">apm-server test config
apm-server test output</pre></div><p>To see if the agent can connect to the APM Server, send requests to the instrumented service and look for lines
containing <code class="literal">[request]</code> in the APM Server logs.</p><p>If no requests are logged, it might be that SSL is <a class="link" href="common-problems.html#ssl-client-fails" title="SSL client fails to connect">misconfigured</a> or that the host is wrong.
Particularly, if you are using Docker, ensure to bind to the right interface (for example, set
<code class="literal">apm-server.host = 0.0.0.0:8200</code> to match any IP) and set the <code class="literal">SERVER_URL</code> setting in the agent accordingly.</p><p>If you see requests coming trough the APM Server but they are not accepted (response code other than <code class="literal">202</code>), consider
the response code to narrow down the possible causes (see sections bellow).</p><p>Another reason for data not showing up is that the agent is not auto-instrumenting something you were expecting, check
the <a class="ulink" href="https://www.elastic.co/guide/en/apm/agent/index.html" target="_top">agent documentation</a> for details on what is automatically instrumented.</p><h3><a id="bad-request"></a>HTTP 400: Data decoding error / Data validation error<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The most likely cause for this is that you are using non compatible versions of agent and APM Server.
For instance, APM Server 6.2.0 changed the Intake API spec and requires a minimum version of each agent.</p><h3><a id="unauthorized"></a>HTTP 401: Invalid token<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <a class="link" href="securing-apm-server.html#secret-token" title="Secret token">secret token</a> in the request header doesn’t match the configured in the APM Server.</p><h3><a id="forbidden"></a>HTTP 403: Forbidden request<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Either you are sending requests to a <a class="link" href="rum.html" title="Real User Monitoring (RUM)">RUM</a> endpoint without RUM enabled, or a request
is coming from an origin not whitelisted in <code class="literal">apm-server.rum.allow_origins</code>. See the <a class="link" href="configuration-rum.html" title="Set up Real User Monitoring (RUM) support">RUM configuration</a>.</p><h3><a id="request-too-large"></a>HTTP 413: Request body too large<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The agent is collecting too much data and sending it all at once. Consider increasing the <code class="literal">apm-server.max_unzipped_size</code>
setting in the APM Server, and adjust relevant settings in the agent.</p><h3><a id="queue-full"></a>HTTP 503: Queue is full<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>APM Server has an internal queue that helps to:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">buffer data temporarily if Elasticsearch is intermittently unavailable</li><li class="listitem">handle sudden large spikes of data</li><li class="listitem">send documents to Elasticsearch in bulk, instead of individually</li></ul></div><p>When the queue has reached the maximum size,
APM Server returns an HTTP 503 status with the message "Queue is full".</p><p>A full queue generally means that the agents collect more data than APM server is able to process.
This might happen when APM Server is not configured properly for the size of your Elasticsearch cluster,
or because your Elasticsearch cluster is underpowered or not configured properly for the given workload.</p><p>The queue can also fill up if Elasticsearch runs out of disk space.</p><p>If the APM Server only returns 503 responses, it indicates that an Elasticsearch disk might be full.
If the APM Server returns interleaved 503 and 202 responses, it indicates that the APM Server can’t process that much data.</p><p>You have a few options to solve this problem:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="reduce-storage.html" title="Reduce storage">Reduce storage</a></li><li class="listitem"><a class="xref" href="tune-apm-server.html#tune-output-config" title="Tune APM Server output parameters for your Elasticsearch cluster">Tune APM Server output parameters for your Elasticsearch cluster</a></li><li class="listitem"><a class="xref" href="tune-apm-server.html#adjust-queue-size" title="Adjust internal queue size">Adjust internal queue size</a></li><li class="listitem"><a class="link" href="tune-es.html" title="Tune Elasticsearch">Tune Elasticsearch for higher ingestion</a></li></ul></div><h3><a id="request-timed-out"></a>HTTP 503: Request timed out waiting to be processed<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>This happens when APM Server exceeds the maximum number of requests that it can process concurrently.
This limit is determined by the <code class="literal">apm-server.concurrent_requests</code> configuration parameter.</p><p>To alleviate this problem,
you can try to:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="xref" href="reduce-storage.html#reduce-sample-rate" title="Reduce the sample rate">Reduce the sample rate</a></li><li class="listitem"><a class="xref" href="reduce-storage.html#reduce-stacktrace" title="Reduce collected stacktrace information">Reduce collected stacktrace information</a></li><li class="listitem"><a class="xref" href="tune-apm-server.html#reduce-payload-size" title="Reduce the payload size">Reduce the payload size</a></li><li class="listitem"><a class="xref" href="tune-apm-server.html#adjust-concurrent-requests" title="Adjust concurrent requests">Adjust concurrent requests</a></li><li class="listitem"><a class="xref" href="tune-apm-server.html#add-apm-server-instances" title="Add APM Server instances">Add APM Server instances</a></li></ul></div><h3><a id="ssl-client-fails"></a>SSL client fails to connect<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The target host running might be unreachable or the certificate may not be valid. To resolve your issue:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">Make sure that server process on the target host is running and you can connect to it.
First, try to ping the target host to verify that you can reach it from the host running APM Server.
Then use either <code class="literal">nc</code> or <code class="literal">telnet</code> to make sure that the port is available. For example:</p><div xmlns="" class="pre_wrapper lang-shell"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-shell">ping &lt;hostname or IP&gt;
telnet &lt;hostname or IP&gt; 5044</pre></div></li><li class="listitem">Verify that the certificate is valid and that the hostname and IP match.</li><li class="listitem">Use OpenSSL to test connectivity to the target server and diagnose problems.
See the <a class="ulink" href="https://www.openssl.org/docs/manmaster/apps/s_client.html" target="_top">OpenSSL documentation</a> for more info.</li></ul></div><h4><a id="_common_ssl_related_errors_and_resolutions"></a>Common SSL-Related Errors and Resolutions<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Here are some common errors and ways to fix them:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><a class="link" href="common-problems.html#cannot-validate-certificate" title="x509: cannot validate certificate for &lt;IP address&gt; because it doesn’t contain any IP SANs">x509: cannot validate certificate</a></li><li class="listitem"><a class="link" href="common-problems.html#getsockopt-no-route-to-host" title="getsockopt: no route to host">getsockopt: no route to host</a></li><li class="listitem"><a class="link" href="common-problems.html#getsockopt-connection-refused" title="getsockopt: connection refused">getsockopt: connection refused</a></li><li class="listitem"><a class="link" href="common-problems.html#target-machine-refused-connection" title="No connection could be made because the target machine actively refused it">No connection could be made because the target machine actively refused it</a></li></ul></div><h5><a id="cannot-validate-certificate"></a>x509: cannot validate certificate for &lt;IP address&gt; because it doesn’t contain any IP SANs<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>This happens because your certificate is only valid for the hostname present in the Subject field.</p><p>To resolve this problem, try one of these solutions:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Create a DNS entry for the hostname mapping it to the server’s IP.</li><li class="listitem">Create an entry in <code class="literal">/etc/hosts</code> for the hostname. Or on Windows add an entry to
<code class="literal">C:\Windows\System32\drivers\etc\hosts</code>.</li><li class="listitem">Re-create the server certificate and add a SubjectAltName (SAN) for the IP address of the server. This make the
server’s certificate valid for both the hostname and the IP address.</li></ul></div><h5><a id="getsockopt-no-route-to-host"></a>getsockopt: no route to host<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>This is not a SSL problem. It’s a networking problem. Make sure the two hosts can communicate.</p><h5><a id="getsockopt-connection-refused"></a>getsockopt: connection refused<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>This is not a SSL problem. Make sure that Logstash is running and that there is no firewall blocking the traffic.</p><h5><a id="target-machine-refused-connection"></a>No connection could be made because the target machine actively refused it<a xmlns="" href="https://github.com/elastic/apm-server/edit/6.4/docs/common-problems.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>A firewall is refusing the connection. Check if a firewall is blocking the traffic on the client, the network, or the
destination host.</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="troubleshooting.html">
              « 
              Troubleshooting</a>
           
        </span><span class="next">
           
          <a href="getting-help.html">Get help
               »
            </a></span></div></body></html>