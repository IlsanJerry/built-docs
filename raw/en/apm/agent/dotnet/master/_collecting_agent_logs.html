<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Collecting agent logs | APM .NET Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM .NET Agent Reference [master]"/>
<link rel="up" href="troubleshooting.html" title="Troubleshooting"/>
<link rel="prev" href="troubleshooting.html" title="Troubleshooting"/>
<link rel="next" href="upgrading.html" title="Upgrading"/>
<meta name="DC.type" content="Learn/Docs/APM .NET Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM .NET Agent Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="troubleshooting.html">Troubleshooting</a></span>
»
<span class="breadcrumb-node">Collecting agent logs</span>
</div>
<div class="navheader">
<span class="prev">
<a href="troubleshooting.html">« Troubleshooting</a>
</span>
<span class="next">
<a href="upgrading.html">Upgrading »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_collecting_agent_logs"></a>Collecting agent logs<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-dotnet/edit/master/docs/troubleshooting.asciidoc">edit</a></h2>
</div></div></div>
<p>The way to collect logs depends on the setup of your application.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_asp_net_core"></a>ASP.NET Core<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-dotnet/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
</div></div></div>
<p>When the Agent is activated with <code class="literal">UseAllElasticApm</code> or <code class="literal">UseElasticApm</code>, it will integrate with the
<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-3.1" class="ulink" target="_top">ASP.NET Core logging infrastructure</a>.
This means the Agent will pick up the configured logging provider and log as any other component logs.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_asp_net_classic"></a>ASP.NET Classic<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-dotnet/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
</div></div></div>
<p>Unlike ASP.NET Core, ASP.NET (classic) does not have a predefined logging system.
However, if you have a logging system in place, like NLog, Serilog, or similar, you can direct the agent logs into your
logging system by creating a bridge between the agent&#8217;s internal logger and your logging system.</p>
<p>First implement the <code class="literal">IApmLogger</code> interface from the <code class="literal">Elastic.Apm.Logging</code> namespace:</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">internal class ApmLoggerBridge : IApmLogger
{
	private readonly Lazy&lt;Logger&gt; _logger;
	public bool IsEnabled(ApmLogLevel level)
	{
		// Check for log level here.
		// Typically you just compare the configured log level of your logger
		// to the input parameter of this method and return if it's the same/higher or not
	}

	public void Log&lt;TState&gt;(ApmLogLevel apmLogLevel, TState state, Exception e, Func&lt;TState, Exception, string&gt; formatter)
	{
		// You can log the given log into your logging system here.
	}
}</pre>
</div>
<p>An example implementation for NLog can be seen <a href="https://github.com/elastic/apm-agent-dotnet/blob/master/sample/AspNetFullFrameworkSampleApp/App_Start/ApmLoggerToNLog.cs" class="ulink" target="_top">in our GitHub repository</a>.</p>
<p>Then tell the agent to use the <code class="literal">ApmLoggerBridge</code>.</p>
<p>For this in ASP.NET (classic) you need to place the following code into the <code class="literal">Application_Start</code> method in the <code class="literal">HttpApplication</code> implementation of your app which is typically in the <code class="literal">Global.asx.cs</code> file:</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">AgentDependencies.Logger = new ApmLoggerBridge();</pre>
</div>
<p>The <code class="literal">AgentDependencies</code> class lives in the <code class="literal">Elastic.Apm.AspNetFullFramework</code> namespace.
During initialization, the agent checks if an additional logger was configured&#8212;&#8203;the agent only does this once, so it&#8217;s important to set it as early in the process as possible (typically in the <code class="literal">Application_Start</code> method).</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="_general_net_applications"></a>General .NET applications<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-dotnet/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
</div></div></div>
<p>If none of the above cases apply to your application, you can still use a bridge and redirect agent logs into a .NET logging system (like NLog, Serilog, or similar).</p>
<p>For this you&#8217;ll need an <code class="literal">IApmLogger</code> implementation (see above) which you need to pass to the <code class="literal">Setup</code> method during agent setup:</p>
<div class="pre_wrapper lang-csharp">
<pre class="programlisting prettyprint lang-csharp">Agent.Setup(new AgentComponents(logger: new ApmLoggerBridge()));</pre>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="troubleshooting.html">« Troubleshooting</a>
</span>
<span class="next">
<a href="upgrading.html">Upgrading »</a>
</span>
</div>
</div>
</body>
</html>
