<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Debugging the agent itself
        | APM Ruby Agent Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="APM Ruby Agent Reference [master]" /><link rel="up" href="index.html" title="APM Ruby Agent Reference [master]" /><link rel="prev" href="api.html" title="Public API" /><link rel="next" href="release-notes.html" title="Release notes" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/APM Ruby Agent/Reference/master" /><meta name="DC.subject" content="APM" /><meta name="DC.identifier" content="master" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">APM Ruby Agent Reference
      [master]
    </a></span> » <span class="breadcrumb-node">Debugging the agent itself</span></div><div class="navheader"><span class="prev"><a href="api.html">
              « 
              Public API</a>
           
        </span><span class="next">
           
          <a href="release-notes.html">Release notes
               »
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="debugging"></a>Debugging the agent itself<a href="https://github.com/elastic/apm-agent-ruby/edit/master/docs/debugging.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><p>Hopefully the agent Just Works™, but depending on your situation the agent might need some tuning.</p><p>First, to learn more about what’s going on inside the agent, you can increase the amount of log messages it writes. To do this, set the log level with the option <code class="literal">log_level = 0</code> — <code class="literal">0</code> being the level of most messages, <code class="literal">DEBUG</code>.</p><p>In your <code class="literal">config/elastic_apm.yml</code>:</p><div class="pre_wrapper lang-yaml"><pre class="programlisting prettyprint lang-yaml">log_level: &lt;%= Logger::DEBUG %&gt;</pre></div><h3><a id="debugging-log-messages"></a>Log messages<a href="https://github.com/elastic/apm-agent-ruby/edit/master/docs/debugging.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><h4><a id="debugging-errors-queue-full"></a><code class="literal">Queue is full (256 items), skipping…</code><a href="https://github.com/elastic/apm-agent-ruby/edit/master/docs/debugging.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The agent has an internal queue that holds events after they are done, and before they are safely serialized and sent to APM Server. To avoid using up all of your memory, this queue has a fixed size. Depending on your load and server setup, events may be added to the queue faster than they are consumed, hence the warning.</p><p>Things to consider:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Is <code class="literal">server_url</code> misconfigured or APM Server down? If the agent fails to connect you will also see log messages containing <code class="literal">Connection error</code> or <code class="literal">Couldn't establish connection to APM Server</code>.</li><li class="listitem">Experiencing high load? The agent can spawn multiple instances of its Workers that pick off the queue by changing the option <code class="literal">pool_size</code> (default is <code class="literal">1</code>).</li><li class="listitem">If you have high load you may also consider setting <code class="literal">transaction_sample_rate</code> to something smaller than <code class="literal">1.0</code>. This determines whether to include <span class="emphasis"><em>spans</em></span> for every <span class="emphasis"><em>transaction</em></span>. If you have enough traffic, skipping some (probably) identical spans won’t have a noticeable effect on your data.</li></ul></div></div><div class="navfooter"><span class="prev"><a href="api.html">
              « 
              Public API</a>
           
        </span><span class="next">
           
          <a href="release-notes.html">Release notes
               »
            </a></span></div></body></html>
