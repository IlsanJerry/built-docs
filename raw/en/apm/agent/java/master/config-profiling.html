<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Profiling configuration options | APM Java Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="up" href="configuration.html" title="Configuration"/>
<link rel="prev" href="config-messaging.html" title="Messaging configuration options"/>
<link rel="next" href="config-reporter.html" title="Reporter configuration options"/>
<meta name="DC.type" content="Learn/Docs/APM Java Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Java Agent Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="configuration.html">Configuration</a></span>
»
<span class="breadcrumb-node">Profiling configuration options</span>
</div>
<div class="navheader">
<span class="prev">
<a href="config-messaging.html">« Messaging configuration options</a>
</span>
<span class="next">
<a href="config-reporter.html">Reporter configuration options »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="config-profiling"></a>Profiling configuration options<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h2>
</div></div></div>
<h4><a id="config-profiling-spans-enabled"></a><code class="literal">profiling_spans_enabled</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>Set to <code class="literal">true</code> to make the agent create spans for method executions based on
<a href="https://github.com/jvm-profiling-tools/async-profiler" class="ulink" target="_top">async-profiler</a>, a sampling aka statistical profiler.</p>
<p>If this is enabled, the agent will start a profiling session every
<a class="xref" href="config-profiling.html#config-profiling-interval" title="profiling_interval ()"><code class="literal">profiling_interval</code></a> which lasts for <a class="xref" href="config-profiling.html#config-profiling-duration" title="profiling_duration ()"><code class="literal">profiling_duration</code></a>.
If a transaction happens within a profiling session,
the agent creates spans for slow methods.</p>
<p>Due to the nature of how sampling profilers work,
the duration of the inferred spans are not exact, but only estimations.
The <a class="xref" href="config-profiling.html#config-profiling-sampling-interval" title="profiling_sampling_interval ()"><code class="literal">profiling_sampling_interval</code></a> lets you fine tune the trade-off between accuracy and overhead.</p>
<p>The inferred spans are created after a profiling session has ended.
This means there is a delay between the regular and the inferred spans being visible in the UI.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This feature is not available on Windows</p>
</div>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
<td align="left" valign="top"><p>Boolean</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_spans_enabled</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_spans_enabled</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_SPANS_ENABLED</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-profiling-sampling-interval"></a><code class="literal">profiling_sampling_interval</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>The frequency at which stack traces are gathered within a profiling session.
The lower you set it, the more accurate the durations will be.
This comes at the expense of higher overhead and more spans for potentially irrelevant operations.
The minimal duration of a profiling-inferred span is the same as the value of this setting.</p>
<p>Supports the duration suffixes <code class="literal">ms</code>, <code class="literal">s</code> and <code class="literal">m</code>.
Example: <code class="literal">20ms</code>.
The default unit for this option is <code class="literal">ms</code>.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">20ms</code></p></td>
<td align="left" valign="top"><p>TimeDuration</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_sampling_interval</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_sampling_interval</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_SAMPLING_INTERVAL</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-profiling-spans-min-duration"></a><code class="literal">profiling_spans_min_duration</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>The minimum duration of an inferred span.
Note that the min duration is also implicitly set by the sampling interval.
However, increasing the sampling interval also decreases the accuracy of the duration of inferred spans.</p>
<p>Supports the duration suffixes <code class="literal">ms</code>, <code class="literal">s</code> and <code class="literal">m</code>.
Example: <code class="literal">0ms</code>.
The default unit for this option is <code class="literal">ms</code>.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">0ms</code></p></td>
<td align="left" valign="top"><p>TimeDuration</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_spans_min_duration</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_spans_min_duration</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_SPANS_MIN_DURATION</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-profiling-included-classes"></a><code class="literal">profiling_included_classes</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>If set, the agent will only create inferred spans for methods which match this list.
Setting a value may slightly increase performance and can reduce clutter by only creating spans for the classes you are interested in.
Example: <code class="literal">org.example.myapp.*</code></p>
<p>This option supports the wildcard <code class="literal">*</code>, which matches zero or more characters.
Examples: <code class="literal">/foo/*/bar/*/baz*</code>, <code class="literal">*foo*</code>.
Matching is case insensitive by default.
Prepending an element with <code class="literal">(?-i)</code> makes the matching case sensitive.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">*</code></p></td>
<td align="left" valign="top"><p>List</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_included_classes</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_included_classes</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_INCLUDED_CLASSES</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-profiling-excluded-classes"></a><code class="literal">profiling_excluded_classes</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>Excludes classes for which no profiler-inferred spans should be created.</p>
<p>This option supports the wildcard <code class="literal">*</code>, which matches zero or more characters.
Examples: <code class="literal">/foo/*/bar/*/baz*</code>, <code class="literal">*foo*</code>.
Matching is case insensitive by default.
Prepending an element with <code class="literal">(?-i)</code> makes the matching case sensitive.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">(?-i)java.*, (?-i)javax.*, (?-i)sun.*, (?-i)com.sun.*, (?-i)jdk.*, (?-i)org.apache.tomcat.*, (?-i)org.apache.catalina.*, (?-i)org.apache.coyote.*, (?-i)org.jboss.as.*, (?-i)org.glassfish.*, (?-i)org.eclipse.jetty.*, (?-i)com.ibm.websphere.*, (?-i)io.undertow.*</code></p></td>
<td align="left" valign="top"><p>List</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_excluded_classes</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_excluded_classes</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_EXCLUDED_CLASSES</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-profiling-interval"></a><code class="literal">profiling_interval</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>The interval at which profiling sessions should be started.</p>
<p>Supports the duration suffixes <code class="literal">ms</code>, <code class="literal">s</code> and <code class="literal">m</code>.
Example: <code class="literal">61s</code>.
The default unit for this option is <code class="literal">s</code>.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">61s</code></p></td>
<td align="left" valign="top"><p>TimeDuration</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_interval</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_interval</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_INTERVAL</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4><a id="config-profiling-duration"></a><code class="literal">profiling_duration</code> (<span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono">1.14.0</span>]
<span class="Admonishment-detail">
Added in 1.14.0.
</span>
</span>)<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/docs/configuration.asciidoc">edit</a></h4>
<p>The duration of a profiling session.
For sampled transactions which fall within a profiling session (they start after and end before the session),
so-called inferred spans will be created.
They appear in the trace waterfall view like regular spans.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>It is not recommended to set much higher durations as it may fill the activation events file and async-profiler&#8217;s frame buffer.
Warnings will be logged if the activation events file is full.
If you want to have more profiling coverage, try decreasing <a class="xref" href="config-profiling.html#config-profiling-interval" title="profiling_interval ()"><code class="literal">profiling_interval</code></a>.</p>
</div>
</div>
<p>Supports the duration suffixes <code class="literal">ms</code>, <code class="literal">s</code> and <code class="literal">m</code>.
Example: <code class="literal">10s</code>.
The default unit for this option is <code class="literal">s</code>.</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Default</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Dynamic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">10s</code></p></td>
<td align="left" valign="top"><p>TimeDuration</p></td>
<td align="left" valign="top"><p>true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Java System Properties</th>
<th align="left" valign="top">Property file</th>
<th align="left" valign="top">Environment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">elastic.apm.profiling_duration</code></p></td>
<td align="left" valign="top"><p><code class="literal">profiling_duration</code></p></td>
<td align="left" valign="top"><p><code class="literal">ELASTIC_APM_PROFILING_DURATION</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="config-messaging.html">« Messaging configuration options</a>
</span>
<span class="next">
<a href="config-reporter.html">Reporter configuration options »</a>
</span>
</div>
</div>
</body>
</html>
