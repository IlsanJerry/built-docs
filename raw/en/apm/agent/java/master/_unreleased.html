<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Unreleased | APM Java Agent Reference [master] | Elastic</title>
<link rel="home" href="index.html" title="APM Java Agent Reference [master]"/>
<link rel="up" href="release-notes.html" title="Release notes"/>
<link rel="prev" href="release-notes.html" title="Release notes"/>
<link rel="next" href="release-notes-1.x.html" title="Java Agent version 1.x"/>
<meta name="DC.type" content="Learn/Docs/APM Java Agent/Reference/master"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">APM Java Agent Reference [master]</a></span>
»
<span class="breadcrumb-link"><a href="release-notes.html">Release notes</a></span>
»
<span class="breadcrumb-node">Unreleased</span>
</div>
<div class="navheader">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-1.x.html">Java Agent version 1.x »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_unreleased"></a>Unreleased<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/CHANGELOG.asciidoc">edit</a></h2>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="release-notes-1.22.1"></a>1.22.1 - YYYY/MM/DD<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/CHANGELOG.asciidoc">edit</a></h3>
</div></div></div>
<h5><a id="_breaking_changes"></a>Breaking changes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
There are breaking changes in the <a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">attacher cli</a>.
See the Features section for more information.
</li>
</ul>
</div>
<h5><a id="_features"></a>Features<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<p>Overhaul of the <a class="xref" href="setup-attach-cli.html" title="Automatic setup with apm-agent-attach-cli.jar">attacher cli</a> application that allows to attach the agent to running JVMs - <a href="https://github.com/elastic/apm-agent-java/pull/1667" class="ulink" target="_top">#1667</a></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The artifact of the standalone cli applicaiton is now called <code class="literal">apm-agent-attach-cli</code>. The attacher API is still called <code class="literal">apm-agent-attach</code>.
</li>
<li class="listitem">
There is also a slim version of the cli application that does not bundle the Java agent.
It requires the <code class="literal">--agent-jar</code> option to be set.
</li>
<li class="listitem">
Improved logging<br>
The application uses <a href="/guide/en/ecs-logging/java/1.x/intro.html" class="ulink" target="_top">Java ECS logging</a> to emit JSON logs.
The log level can be configured with the <code class="literal">--log-level</code> option.
By default, the program is logging to the console but using the <code class="literal">--log-file</code> option, it can also log to a file.
</li>
<li class="listitem">
Attach to JVMs running under a different user (unix only)<br>
The JVM requires the attacher to be running under the same user as the target VM (the attachee).
The <code class="literal">apm-agent-attach-standalone.jar</code> can now be run with a user that has permissions to switch to the user that runs the target VM.
On Windows, the attacher can still only attach to JVMs that are running with under the same user.
</li>
<li class="listitem">
<p>New include/exclude discovery rules<br></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">--include-all</code>: Attach to all discovered JVMs. If no matchers are provided, it will not attach to any JVMs.
</li>
<li class="listitem">
<code class="literal">--include-user</code>/<code class="literal">--exclude-user</code>: Attach to all JVMs of a given operating system user.
</li>
<li class="listitem">
<code class="literal">--include-main</code>/<code class="literal">--exclude-main</code>: Attach to all JVMs that whose main class/jar name, or system properties match the provided regex.
</li>
<li class="listitem">
<code class="literal">--include-vmargs</code>/<code class="literal">--exclude-vmargs</code>: Attach to all JVMs that whose main class/jar name, or system properties match the provided regex.
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>Removal of options<br></p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The deprecated <code class="literal">--arg</code> option has been removed.
</li>
<li class="listitem">
The <code class="literal">-i</code>/<code class="literal">--include</code>, <code class="literal">-e</code>/<code class="literal">exclude</code> options have been removed in favor of the <code class="literal">--&lt;include|exclude&gt;-&lt;main|vmargs&gt;</code> options.
</li>
<li class="listitem">
The <code class="literal">-p</code>/<code class="literal">--pid</code> options have been removed in favor of the <code class="literal">--include-pid</code> option.
</li>
</ul>
</div>
</li>
<li class="listitem">
Changed behavior of  the <code class="literal">-l</code>/<code class="literal">--list</code> option<br>
The option now only lists JVMs that match the include/exclude discovery rules.
Thus, it can be used to do a dry-run of the matchers without actually performing an attachment.
It even works in combination with <code class="literal">--continuous</code> now.
By default, the VM arguments are not printed, but only when the <code class="literal">-a</code>/<code class="literal">--list-vmargs</code> option is set.
</li>
<li class="listitem">
Remove dependency on <code class="literal">jps</code><br>
Even when matching on the main class name or on system properties,
</li>
<li class="listitem">
Checks the Java version before attaching to avoid attachment on unsupported JVMs.
</li>
</ul>
</div>
</li>
</ul>
</div>
<h5><a id="_bug_fixes"></a>Bug fixes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-agent-java/edit/master/CHANGELOG.asciidoc">edit</a></h5>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Fixed log correlation for log4j2 - <a href="https://github.com/elastic/apm-agent-java/pull/1720" class="ulink" target="_top">#1720</a>
</li>
<li class="listitem">
Fix apm-log4j1-plugin and apm-log4j2-plugin dependency on slf4j - <a href="https://github.com/elastic/apm-agent-java/pull/1723" class="ulink" target="_top">#1723</a>
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="release-notes.html">« Release notes</a>
</span>
<span class="next">
<a href="release-notes-1.x.html">Java Agent version 1.x »</a>
</span>
</div>
</div>
</body>
</html>
