<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Logging integrations
        | APM Python Agent Reference [master]
      | Elastic
    </title><link rel="home" href="index.html" title="APM Python Agent Reference [master]" /><link rel="up" href="advanced-topics.html" title="Advanced Topics" /><link rel="prev" href="run-tests-locally.html" title="Run Tests Locally" /><link rel="next" href="log-correlation.html" title="Log correlation in Elasticsearch" /><meta name="DC.type" content="Learn/Docs/APM Python Agent/Reference/master" /><meta name="DC.subject" content="APM" /><meta name="DC.identifier" content="master" /></head><body><div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">APM Python Agent Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="advanced-topics.html">Advanced Topics</a></span> » <span class="breadcrumb-node">Logging integrations</span></div><div class="navheader"><span class="prev"><a href="run-tests-locally.html">
              « 
              Run Tests Locally</a>
           
        </span><span class="next">
           
          <a href="log-correlation.html">Log correlation in Elasticsearch
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="logging-integrations"></a>Logging integrations<a href="https://github.com/elastic/apm-agent-python/edit/master/docs/logging.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The Elastic APM agent provides integrations with both the default Python logging library,
as well as <a class="ulink" href="http://www.structlog.org/en/stable/" target="_top"><code class="literal">structlog</code></a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="logging"></a><code class="literal">logging</code><a href="https://github.com/elastic/apm-agent-python/edit/master/docs/logging.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>For Python 3.2+, we use <a class="ulink" href="https://docs.python.org/3/library/logging.html#logging.setLogRecordFactory" target="_top"><code class="literal">logging.setLogRecordFactory()</code></a>
to decorate the default LogRecordFactory to automatically add new attributes to
each LogRecord object:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">elasticapm_transaction_id</code></li><li class="listitem"><code class="literal">elasticapm_trace_id</code></li><li class="listitem"><code class="literal">elasticapm_span_id</code></li></ul></div><p>This factory also adds these fields to a dictionary attribute,
<code class="literal">elasticapm_labels</code>, using the official ECS <a class="ulink" href="https://www.elastic.co/guide/en/ecs/current/ecs-tracing.html" target="_top">tracing fields</a>.</p><p>You can disable this automatic behavior by using the
<a class="link" href="configuration.html#config-generic-disable-log-record-factory" title="disable_log_record_factory"><code class="literal">disable_log_record_factory</code></a> setting
in your configuration</p><p>For Python versions &lt;3.2, we also provide a
<a class="ulink" href="https://docs.python.org/3/library/logging.html#filter-objects" target="_top">filter</a> which will
add the same new attributes to any filtered <code class="literal">LogRecord</code>:</p><p>Note: Because <a class="ulink" href="https://docs.python.org/3/library/logging.html#filter-objects" target="_top">filters
are not propagated to descendent loggers</a>, you should add the filter to each of
your log handlers, as handlers are propagated, along with their attached filters.</p><div class="pre_wrapper lang-python"><pre class="programlisting prettyprint lang-python">import logging
from elasticapm.handlers.logging import LoggingFilter

console = logging.StreamHandler()
console.addFilter(LoggingFilter())
# add the handler to the root logger
logging.getLogger("").addHandler(console)</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="structlog"></a><code class="literal">structlog</code><a href="https://github.com/elastic/apm-agent-python/edit/master/docs/logging.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>We provide a <a class="ulink" href="http://www.structlog.org/en/stable/processors.html" target="_top">processor</a> for
<a class="ulink" href="http://www.structlog.org/en/stable/" target="_top"><code class="literal">structlog</code></a> which will add three new keys
to the event_dict of any processed event:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">transaction.id</code></li><li class="listitem"><code class="literal">trace.id</code></li><li class="listitem"><code class="literal">span.id</code></li></ul></div><div class="pre_wrapper lang-python"><pre class="programlisting prettyprint lang-python">from structlog import PrintLogger, wrap_logger
from elasticapm.handlers.structlog import structlog_processor

wrapped_logger = PrintLogger()
logger = wrap_logger(wrapped_logger, processors=[structlog_processor])
log = logger.new()
log.msg("some_event")</pre></div></div></div><div class="navfooter"><span class="prev"><a href="run-tests-locally.html">
              « 
              Run Tests Locally</a>
           
        </span><span class="next">
           
          <a href="log-correlation.html">Log correlation in Elasticsearch
               »
            </a></span></div></body></html>
