<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Step 3: Configure the Elastic APM AWS Lambda extension | Monitoring AWS Lambda Functions | Elastic</title>
<link rel="home" href="index.html" title="Monitoring AWS Lambda Functions"/>
<link rel="up" href="aws-lambda-secrets-manager.html" title="Using AWS Secrets Manager to manage APM authentication keys"/>
<link rel="prev" href="aws-lambda-secrets-manager-permissions.html" title="Step 2: Add permissions to your AWS Lambda function"/>
<meta name="DC.type" content="Learn/Docs/APM AWS Lambda extension/Reference"/>
<meta name="DC.subject" content="APM"/>
<meta name="DC.identifier" content="master"/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Monitoring AWS Lambda Functions</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="aws-lambda-secrets-manager.html">Using AWS Secrets Manager to manage APM authentication keys</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="aws-lambda-secrets-manager-permissions.html">« Step 2: Add permissions to your AWS Lambda function</a>
</span>
<span class="next">
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="_step_3_configure_the_elastic_apm_aws_lambda_extension"></a>Step 3: Configure the Elastic APM AWS Lambda extension<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/apm-aws-lambda/edit/main/docs/monitoring-aws-lambda.asciidoc">edit</a></h2>
</div></div></div>
<p>Finally, you will need to configure the Elastic APM AWS Lambda extension to use the secret from the Secrets Manager <em>instead of</em> the value provided through <a class="xref" href="aws-lambda-config-authentication-keys.html" title="ELASTIC_APM_SECRET_TOKEN or ELASTIC_APM_API_KEY"><code class="literal">ELASTIC_APM_SECRET_TOKEN</code> or <code class="literal">ELASTIC_APM_API_KEY</code></a>.</p>
<p>Provide the name of the secret you created in <a class="xref" href="aws-lambda-secrets-manager-create-secret.html" title="Step 1: Create a secret in the AWS Secrets Manager.">Step 1</a> as the value for the <a class="xref" href="aws-lambda-config-secrets-manager-options.html" title="ELASTIC_APM_SECRETS_MANAGER_SECRET_TOKEN_ID or ELASTIC_APM_SECRETS_MANAGER_API_KEY_ID"><code class="literal">ELASTIC_APM_SECRETS_MANAGER_SECRET_TOKEN_ID</code> or <code class="literal">ELASTIC_APM_SECRETS_MANAGER_API_KEY_ID</code></a> config option, respectively, depending on whether you want to use the <a href="/guide/en/apm/guide/8.4/secret-token.html" class="ulink" target="_top">APM Secret Token</a> or the <a href="/guide/en/apm/guide/8.4/api-key.html" class="ulink" target="_top">APM API key</a>.</p>
<p>The language-specific instructions describe how to set environment variables for configuring AWS Lambda for Elastic APM:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a href="/guide/en/apm/agent/nodejs/current/lambda.html#_step_3_configure_apm_on_aws_lambda" class="ulink" target="_top">Configure APM on AWS Lambda - Node.js</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/python/current/lambda-support.html#_step_3_configure_apm_on_aws_lambda" class="ulink" target="_top">Configure APM on AWS Lambda - Python</a>
</li>
<li class="listitem">
<a href="/guide/en/apm/agent/java/current/aws-lambda.html#_step_3_configure_apm_on_aws_lambda" class="ulink" target="_top">Configure APM on AWS Lambda - Java</a>
</li>
</ul>
</div>
<p>That&#8217;s it. With the first invocation (cold start) of your Lambda function you should see a log message from the Elastic APM AWS Lambda extension indicating that a secret from the secrets manager is used:</p>
<div class="pre_wrapper lang-yml">
<pre class="programlisting prettyprint lang-yml">"Using the APM secret token retrieved from Secrets Manager."</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="aws-lambda-secrets-manager-permissions.html">« Step 2: Add permissions to your AWS Lambda function</a>
</span>
<span class="next">
</span>
</div>
</div>
</body>
</html>
