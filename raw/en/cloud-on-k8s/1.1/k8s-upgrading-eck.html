<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upgrade ECK | Elastic Cloud on Kubernetes [1.1] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [1.1]"/>
<link rel="up" href="k8s-operating-eck.html" title="Operating ECK"/>
<link rel="prev" href="k8s-webhook-troubleshooting.html" title="Troubleshoot webhook"/>
<link rel="next" href="k8s-uninstalling-eck.html" title="Uninstall ECK"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/1.1"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="1.1"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [1.1]</a></span>
»
<span class="breadcrumb-link"><a href="k8s-operating-eck.html">Operating ECK</a></span>
»
<span class="breadcrumb-node">Upgrade ECK</span>
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-webhook-troubleshooting.html">« Troubleshoot webhook</a>
</span>
<span class="next">
<a href="k8s-uninstalling-eck.html">Uninstall ECK »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-upgrading-eck"></a>Upgrade ECK<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/1.1/docs/operating-eck/upgrading-eck.asciidoc">edit</a></h2>
</div></div></div>
<h3><a id="k8s-ga-upgrade"></a>Upgrade to ECK 1.1.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/1.1/docs/operating-eck/upgrading-eck.asciidoc">edit</a></h3>
<p>ECK reached general availability (GA) status with the <a href="/blog/elastic-cloud-on-kubernetes-ECK-is-now-generally-available" class="ulink" target="_top">release of version 1.0.0</a>. The latest available GA version is 1.1.0. It is compatible with the previous beta release (1.0.0-beta1) and can be upgraded in-place (<a class="xref" href="k8s-upgrading-eck.html#k8s-ga-openshift" title="Upgrade from beta to 1.1.0 in older versions of Kubernetes">with a few exceptions</a>). Previous alpha releases, up to and including version 0.9.0, are not compatible with the GA and beta releases and <a href="/guide/en/cloud-on-k8s/1.0-beta/k8s-upgrading-eck.html" class="ulink" target="_top">require extra work to upgrade</a>.</p>
<h4><a id="k8s-beta-to-ga-upgrade"></a>Upgrade from beta to 1.1.0<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/1.1/docs/operating-eck/upgrading-eck.asciidoc">edit</a></h4>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>The upgrade process results in an update to all the existing managed resources. This triggers a rolling restart of all Elasticsearch and Kibana pods. <a class="xref" href="k8s-upgrading-eck.html#k8s-beta-to-ga-rolling-restart" title="Control rolling restarts during the upgrade">Guidance</a> is available on controlling this process more gracefully.</p>
</div>
</div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>If you are running Openshift 3.11 or a Kubernetes version older than 1.13, skip to the <a class="xref" href="k8s-upgrading-eck.html#k8s-ga-openshift" title="Upgrade from beta to 1.1.0 in older versions of Kubernetes">upgrade instructions for older Kubernetes releases</a>.</p>
</div>
</div>
<p>Follow the instructions in <a class="xref" href="k8s-deploy-eck.html" title="Deploy ECK in your Kubernetes cluster"><em>Deploy ECK in your Kubernetes cluster</em></a> to upgrade from the beta version of ECK to a GA version. The versions are mostly compatible and all that is required is an update to the ECK binary and the CRDs. After the upgrade, ensure that your Elasticsearch, Kibana, and APM Server manifests are updated to use the <code class="literal">v1</code> API version instead of <code class="literal">v1beta1</code>.</p>
<h5><a id="k8s-beta-to-ga-rolling-restart"></a>Control rolling restarts during the upgrade<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/1.1/docs/operating-eck/upgrading-eck.asciidoc">edit</a></h5>
<p>Upgrading the operator results in a one-time update to existing managed resources in the cluster. This triggers a rolling restart of pods by Kubernetes to apply those changes. If you have a very large Elasticsearch cluster or multiple Elastic Stack deployments, this rolling restart might be disruptive or inconvenient. To have more control over when the pods belonging to a particular deployment should be restarted, you can <a class="xref" href="k8s-exclude-resource.html" title="Exclude resources from reconciliation">add an annotation</a> to the corresponding Elasticsearch, Kibana, or APM Server resources to temporarily exclude them from being managed by the operator. When the time is convenient, you can remove the annotation and let the rolling restart go through.</p>
<div class="caution admon">
<div class="icon"></div>
<div class="admon_content">
<p>Once a resource is excluded from being managed by ECK, you will not be able to add/remove nodes, upgrade Stack version, or perform other <a class="xref" href="k8s-orchestrating-elastic-stack-applications.html" title="Orchestrating Elastic Stack applications">orchestration tasks</a> by updating the resource manifest. You must remember to remove the exclusion to ensure that your Elastic Stack deployment is continually monitored and managed by the operator.</p>
</div>
</div>
<p><strong>Exclude Elastic resources from being managed by the operator.</strong></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">ANNOTATION='common.k8s.elastic.co/pause=true' <a id="CO3-1"></a><i class="conum" data-value="1"></i>

# Exclude a single Elasticsearch resource named "quickstart"
kubectl annotate --overwrite elasticsearch quickstart $ANNOTATION

# Exclude all resources in the current namespace
kubectl annotate --overwrite elastic --all $ANNOTATION

# Exclude all resources in all of the namespaces:
for NS in $(kubectl get ns -o=custom-columns='NAME:.metadata.name' --no-headers); do kubectl annotate --overwrite elastic --all $ANNOTATION -n $NS; done</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO3-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Since ECK 1.1.0, this annotation has been superseded by <code class="literal">eck.k8s.elastic.co/managed=false</code></p>
</td>
</tr>
</table>
</div>
<p>Once the operator has been upgraded and you are ready to let the resource become managed again (triggering a rolling restart of pods in the process), remove the annotation.</p>
<p><strong>Resume Elastic resource management by the operator.</strong></p>
<div class="pre_wrapper lang-shell">
<pre class="programlisting prettyprint lang-shell">RM_ANNOTATION='common.k8s.elastic.co/pause-' <a id="CO4-1"></a><i class="conum" data-value="1"></i>

# Resume management of a single Elasticsearch cluster named "quickstart"
kubectl annotate elasticsearch quickstart $RM_ANNOTATION</pre>
</div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO4-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Since ECK 1.1.0, this annotation has been superseded by <code class="literal">eck.k8s.elastic.co/managed-</code></p>
</td>
</tr>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>The ECK source repository contains a <a href="https://github.com/elastic/cloud-on-k8s/tree/master/hack/annotator" class="ulink" target="_top">shell script</a> to assist with mass addition/deletion of annotations.</p>
</div>
</div>
<h4><a id="k8s-ga-openshift"></a>Upgrade from beta to 1.1.0 in older versions of Kubernetes<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/1.1/docs/operating-eck/upgrading-eck.asciidoc">edit</a></h4>
<p>If you are running Openshift 3.11 or a Kubernetes version older than 1.13, in-place upgrade is not possible due to an <a href="https://github.com/kubernetes/kubernetes/issues/73752" class="ulink" target="_top">upstream bug</a>. You should backup your existing manifests, <a class="xref" href="k8s-snapshots.html" title="Create automated snapshots">take snapshots</a>, <a class="xref" href="k8s-uninstalling-eck.html" title="Uninstall ECK">uninstall ECK</a> and then <a class="xref" href="k8s-deploy-eck.html" title="Deploy ECK in your Kubernetes cluster">install the new version of ECK</a>. Afterwards, you can update your manifests to use the <code class="literal">v1</code> API version and restore state from the snapshots.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="k8s-webhook-troubleshooting.html">« Troubleshoot webhook</a>
</span>
<span class="next">
<a href="k8s-uninstalling-eck.html">Uninstall ECK »</a>
</span>
</div>
</div>
</body>
</html>
