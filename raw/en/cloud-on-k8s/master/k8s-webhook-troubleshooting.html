<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Troubleshoot webhook | Elastic Cloud on Kubernetes [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [master]"/>
<link rel="up" href="k8s-troubleshooting.html" title="Troubleshoot ECK"/>
<link rel="prev" href="k8s-exec-into-containers.html" title="Exec into containers"/>
<link rel="next" href="k8s-ask-for-help.html" title="Ask for help"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/master"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [master]</a></span>
»
<span class="breadcrumb-link"><a href="k8s-operating-eck.html">Operating ECK</a></span>
»
<span class="breadcrumb-link"><a href="k8s-troubleshooting.html">Troubleshoot ECK</a></span>
»
<span class="breadcrumb-node">Troubleshoot webhook</span>
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-exec-into-containers.html">« Exec into containers</a>
</span>
<span class="next">
<a href="k8s-ask-for-help.html">Ask for help »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-webhook-troubleshooting"></a>Troubleshoot webhook<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/master/docs/operating-eck/troubleshooting.asciidoc">edit</a></h2>
</div></div></div>
<p>On startup, the operator deploys an <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/" class="ulink" target="_top">admission webhook</a> that points to the operator&#8217;s service. If this is inaccessible, you may see errors in your Kubernetes API server logs indicating that it cannot reach the service. A common cause may be that the operator pods are failing to start for some reason, or that the control plane is isolated from the operator pod by some mechanism (for instance via network policies or running the control plane externally as in <a href="https://github.com/elastic/cloud-on-k8s/issues/896#issuecomment-507224945" class="ulink" target="_top">issue #869</a> and <a href="https://github.com/elastic/cloud-on-k8s/issues/1369" class="ulink" target="_top">issue #1369</a>).</p>
<p>For troubleshooting, you can change the <a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#failure-policy" class="ulink" target="_top"><code class="literal">failurePolicy</code></a> of the webhook configuration to <code class="literal">Fail</code>, which will cause creations and updates to error out if there is an error contacting the webhook.</p>
<p>On <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/private-cluster-concept" class="ulink" target="_top">GKE private clusters</a>, you may see requests creating or updating Elastic resources take a long time to complete or timeout. If so, you will need to add a firewall rule allowing port 9443 from the API server so that it can contact the webhook. See the <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters#add_firewall_rules" class="ulink" target="_top">GKE documentation on adding rules</a> and the <a href="https://github.com/kubernetes/kubernetes/issues/79739" class="ulink" target="_top">Kubernetes issue</a> for more detail.</p>
<p>Refer to <a class="xref" href="k8s-webhook-network-policies.html" title="Network Policies">Network Policies</a> for more information about network policies that might be preventing communication between the Kubernetes API server and the webhook server.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="k8s_validation_failures"></a>Validation failures<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/master/docs/operating-eck/troubleshooting.asciidoc">edit</a></h3>
</div></div></div>
<p>If the validation webhook is preventing you from making changes due to the unknown fields validation like below, you can force the webhook to ignore it by removing the`kubectl.kubernetes.io/last-applied-configuration` annotation from your resource.</p>
<pre class="screen">admission webhook "elastic-es-validation-v1.k8s.elastic.co" denied the request: Elasticsearch.elasticsearch.k8s.elastic.co "quickstart" is invalid: some-misspelled-field: Invalid value: "some-misspelled-field": some-misspelled-field field found in the kubectl.kubernetes.io/last-applied-configuration annotation is unknown</pre>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="k8s-exec-into-containers.html">« Exec into containers</a>
</span>
<span class="next">
<a href="k8s-ask-for-help.html">Ask for help »</a>
</span>
</div>
</div>
</body>
</html>
