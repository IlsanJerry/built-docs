<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Access the Elasticsearch endpoint | Elastic Cloud on Kubernetes [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Cloud on Kubernetes [master]"/>
<link rel="up" href="k8s-accessing-elastic-services.html" title="Access Elastic Stack services"/>
<link rel="prev" href="k8s-tls-certificates.html" title="TLS certificates"/>
<link rel="next" href="k8s-customize-pods.html" title="Customize Pods"/>
<meta name="DC.type" content="Learn/Docs/Kubernetes/Reference/master"/>
<meta name="DC.subject" content="ECK"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Cloud on Kubernetes [master]</a></span>
»
<span class="breadcrumb-link"><a href="k8s-orchestrating-elastic-stack-applications.html">Orchestrating Elastic Stack applications</a></span>
»
<span class="breadcrumb-link"><a href="k8s-accessing-elastic-services.html">Access Elastic Stack services</a></span>
»
<span class="breadcrumb-node">Access the Elasticsearch endpoint</span>
</div>
<div class="navheader">
<span class="prev">
<a href="k8s-tls-certificates.html">« TLS certificates</a>
</span>
<span class="next">
<a href="k8s-customize-pods.html">Customize Pods »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="k8s-request-elasticsearch-endpoint"></a>Access the Elasticsearch endpoint<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/cloud-on-k8s/edit/master/docs/orchestrating-elastic-stack-applications/accessing-elastic-services.asciidoc">edit</a></h2>
</div></div></div>
<p>You can access the Elasticsearch endpoint within or outside the Kubernetes cluster.</p>
<p><span class="strong strong"><strong>Within the Kubernetes cluster</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Retrieve the CA certificate.
</li>
<li class="listitem">
Retrieve the password of the <code class="literal">elastic</code> user.
</li>
</ol>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">NAME=hulk

kubectl get secret "$NAME-es-http-certs-public" -o go-template='{{index .data "tls.crt" | base64decode }}' &gt; tls.crt
PW=$(kubectl get secret "$NAME-es-elastic-user" -o go-template='{{.data.elastic | base64decode }}')

curl --cacert tls.crt -u elastic:$PW https://$NAME-es-http:9200/</pre>
</div>
<p><span class="strong strong"><strong>Outside the Kubernetes cluster</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Retrieve the CA certificate.
</li>
<li class="listitem">
Retrieve the password of the <code class="literal">elastic</code> user.
</li>
<li class="listitem">
Retrieve the IP of the <code class="literal">LoadBalancer</code> <code class="literal">Service</code>.
</li>
</ol>
</div>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">NAME=hulk

kubectl get secret "$NAME-es-http-certs-public" -o go-template='{{index .data "tls.crt" | base64decode }}' &gt; tls.crt
IP=$(kubectl get svc "$NAME-es-http" -o jsonpath='{.status.loadBalancer.ingress[].ip}')
PW=$(kubectl get secret "$NAME-es-elastic-user" -o go-template='{{.data.elastic | base64decode }}')

curl --cacert tls.crt -u elastic:$PW https://$IP:9200/</pre>
</div>
<p>Now you should get this message:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl: (51) SSL: no alternative certificate subject name matches target host name '35.198.131.115'</pre>
</div>
<p>The request failed because the IP address used to access the service does not match the subject of the certificate, which is set to the service name. We can force curl to temporarily map the IP address to the expected service name by using the <code class="literal">--resolve</code> flag as follows:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">&gt; curl --cacert tls.crt -u elastic:$PW https://$NAME-es-http:9200/ --resolve $NAME-es-http:9200:$IP
{
  "name" : "hulk-es-4qk62zd928",
  "cluster_name" : "hulk",
  "cluster_uuid" : "q6itjqFqRqW576FXF0uohg",
  "version" : {...},
  "tagline" : "You Know, for Search"
}</pre>
</div>
<p>You can add extra Subject Alternative Name (SAN)  entries to the generated certificate by setting the <code class="literal">subjectAltNames</code> field of the Elasticsearch specification, as illustrated in the example below. Adding the external IP address to the SANs eliminates the need to explicitly configure clients to override the certificate subject comparison.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">spec:
  http:
    service:
      spec:
        type: LoadBalancer
    tls:
      selfSignedCertificate:
        subjectAltNames:
        - ip: 35.198.131.115</pre>
</div>
<p>You can now reach Elasticsearch without <code class="literal">--resolve</code>:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">&gt; curl --cacert tls.crt -u elastic:$PW https://$IP:9200/
{
  "name" : "hulk-es-4qk62zd928",
  "cluster_name" : "hulk",
  "cluster_uuid" : "q6itjqFqRqW576FXF0uohg",
  "version" : {...},
  "tagline" : "You Know, for Search"
}</pre>
</div>
</div>
<div class="navfooter">
<span class="prev">
<a href="k8s-tls-certificates.html">« TLS certificates</a>
</span>
<span class="next">
<a href="k8s-customize-pods.html">Customize Pods »</a>
</span>
</div>
</div>
</body>
</html>
