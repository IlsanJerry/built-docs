<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Elastic MongoDB connector | Elastic Enterprise Search documentation [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Enterprise Search documentation [master]"/>
<link rel="up" href="connectors.html" title="Elastic connectors"/>
<link rel="prev" href="connectors-s3.html" title="Elastic Amazon S3 connector"/>
<link rel="next" href="connectors-mysql.html" title="Elastic MySQL connector"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/master"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="index.html">Elastic Enterprise Search documentation [master]</a></span><span class="chevron-right">›</span>
<span class="breadcrumb-link"><a href="connectors.html">Elastic connectors</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="connectors-s3.html">« Elastic Amazon S3 connector</a>
</span>
<span class="next">
<a href="connectors-mysql.html">Elastic MySQL connector »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="connectors-mongodb"></a>Elastic MongoDB connector<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h2>
</div></div></div>

<p>The <em>Elastic MongoDB connector</em> is a <a class="xref" href="native-connectors.html" title="Native connectors">native connector</a> for <a href="https://www.mongodb.com" class="ulink" target="_blank" rel="noopener">MongoDB</a> data sources.</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="connectors-mongodb-prerequisites"></a>Availability and prerequisites<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h3>
</div></div></div>
<p>The MongoDB connector is available in Elastic versions <span class="strong strong"><strong>8.5.0+</strong></span>.</p>
<p>Currently, this connector is available in <span class="strong strong"><strong>technical preview</strong></span>.
Features in technical preview are subject to change and are not covered by the service level agreement (SLA) of features that have reached general availability (GA).</p>
<p>To use this connector, you must satisfy all <a class="xref" href="native-connectors.html#native-connectors-prerequisites" title="Availability and prerequisites">prerequisites for native connectors</a>.
There are no additional prerequisites unique to this connector.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="connectors-mongodb-usage"></a>Usage and troubleshooting<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h3>
</div></div></div>
<p>To connect to a MongoDB data source, you will need the information described in <a class="xref" href="connectors-mongodb.html#connectors-mongodb-configuration" title="MongoDB configuration">MongoDB configuration</a>.
And the data source must satisfy the compatibility requirements described in <a class="xref" href="connectors-mongodb.html#connectors-mongodb-compatibility" title="MongoDB compatibility">MongoDB compatibility</a>.</p>
<p>Otherwise, there are no instructions unique to this connector.
Review the following documentation for native connectors:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="native-connectors.html#native-connectors-usage" title="Usage">Usage</a>
</li>
<li class="listitem">
<a class="xref" href="native-connectors.html#native-connectors-troubleshooting" title="Troubleshooting">Troubleshooting</a>
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="connectors-mongodb-reference"></a>Reference<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h3>
</div></div></div>
<p>The following sections describe technical details for this connector.</p>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="connectors-mongodb-compatibility"></a>MongoDB compatibility<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h4>
</div></div></div>
<p>The MongoDB connector is compatible with MongoDB Atlas and MongoDB 3.6+.</p>
<p>The MongoDB data source and your Elastic deployment must be able to communicate with each other over a network.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="connectors-mongodb-configuration"></a>MongoDB configuration<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h4>
</div></div></div>
<p>When <a class="xref" href="native-connectors.html#native-connectors-index-configure" title="Configure index">configuring an index</a> for use with this connector, you will need to provide some or all of the following information about the data source.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
Host
</span>
</dt>
<dd>
<p>
The URI of the MongoDB host.
Examples:
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">mongodb+srv://my_username:my_password@cluster0.mongodb.net/mydb?w=majority</code>
</li>
<li class="listitem">
<code class="literal">mongodb://127.0.0.1:27017</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Direct connection (true/false)
</span>
</dt>
<dd>
<p>
Whether to use the <a href="https://www.mongodb.com/docs/ruby-driver/current/reference/create-client/#direct-connection" class="ulink" target="_blank" rel="noopener">direct connection option for the MongoDB client</a>.
Examples.
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">true</code>
</li>
<li class="listitem">
<code class="literal">false</code>
</li>
</ul>
</div>
</dd>
<dt>
<span class="term">
Username
</span>
</dt>
<dd>
<p>
The MongoDB username the connector will use.
</p>
<p>The user must have access to the configured database and collection.
You may want to create a dedicated, read-only user for each connector.</p>
<p>See <a class="xref" href="native-connectors.html#native-connectors-security" title="Security">Security</a> for security details.</p>
</dd>
<dt>
<span class="term">
Password
</span>
</dt>
<dd>
<p>
The MongoDB password the connector will use.
</p>
<p>See <a class="xref" href="native-connectors.html#native-connectors-security" title="Security">Security</a> for security details.</p>
</dd>
<dt>
<span class="term">
Database
</span>
</dt>
<dd>
<p>
The MongoDB database to sync.
The database must be accessible using the configured username and password.
</p>
<p>See <a class="xref" href="native-connectors.html#native-connectors-security" title="Security">Security</a> for security details.</p>
</dd>
<dt>
<span class="term">
Collection
</span>
</dt>
<dd>
<p>
The MongoDB collection to sync.
The collection must exist within the configured database.
The collection must be accessible using the configured username and password.
</p>
<p>See <a class="xref" href="native-connectors.html#native-connectors-security" title="Security">Security</a> for security details.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="connectors-mongodb-documents"></a>Elasticsearch documents<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h4>
</div></div></div>
<p>All documents in the configured MongoDB database and collection are extracted and transformed into documents in your Elasticsearch index.</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
The connector creates one <span class="strong strong"><strong>Elasticsearch document</strong></span> for each MongoDB document in the configured database and collection.
</li>
<li class="listitem">
For each document, the connector transforms each MongoDB field into an <span class="strong strong"><strong>Elasticsearch field</strong></span>.
</li>
<li class="listitem">
For each field, Elasticsearch <a href="/guide/en/elasticsearch/reference/master/dynamic-mapping.html" class="ulink" target="_blank" rel="noopener">dynamically determines the <span class="strong strong"><strong>data type</strong></span></a>.
</li>
</ul>
</div>
<p>This results in Elasticsearch documents that closely match the original MongoDB documents.</p>
<p>As soon as your first documents are synced, you can <a class="xref" href="native-connectors.html#native-connectors-documents" title="View documents">view the documents</a> and inspect the mapping for the index.
This will help you understand how your data is structured in Elasticsearch, and how this differs from the structure of the original MongoDB documents.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title"><a id="connectors-mongodb-syncs"></a>Syncing<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h4>
</div></div></div>
<p>Users can <a class="xref" href="native-connectors.html#native-connectors-syncs-manual" title="Sync once">launch a sync manually</a> or <a class="xref" href="native-connectors.html#native-connectors-syncs-recurring" title="Manage recurring syncs">schedule a recurring sync</a>.</p>
<p>When you select the <span class="strong strong"><strong>Sync</strong></span> button, the sync job has to wait until the connector picks up the task.</p>
<p>Each sync is a "full" sync.
For each MongoDB document discovered:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
If it does not exist, the document is created in Elasticsearch.
</li>
<li class="listitem">
If it already exists in Elasticsearch, the Elasticsearch document is replaced and the version is incremented.
See <a class="xref" href="native-connectors.html#native-connectors-documents" title="View documents">View documents</a>.
</li>
<li class="listitem">
If an existing Elasticsearch document no longer exists in the MongoDB collection, it is deleted from Elasticsearch.
</li>
<li class="listitem">
Embedded documents are stored as an <code class="literal">object</code> field in the parent document.
This is recursive, because embedded documents can themselves contain embedded documents.
</li>
</ul>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h5 class="title"><a id="connectors-mongodb-sync-rules"></a>Sync rules<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h5>
</div></div></div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>For general details on sync rules, see: <a class="xref" href="sync-rules.html" title="Sync rules">Sync rules</a>.</p>
</div>
</div>
<h6><a id="connectors-mongodb-sync-rules-basic-remote-filtering"></a>Basic rules in remote filtering<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h6>
<p>A single basic rule translates quite cleanly to a mongodb <code class="literal">find</code> query.
For example, a single rule like:</p>
<div class="imageblock">
<div class="content">
<img src="images/basic-rule-example.png" alt="basic rule">
</div>
</div>
<p>Will translate to a mongodb <code class="literal">find</code> query of:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "bedrooms" : {
    "$gte" : 4.0
  }
}</pre>
</div>
<p>The connector makes a best effort to convert the "value" of the rule to the appropriate type.
For example, <code class="literal">true</code> would be coerced into a boolean, and <code class="literal">1234</code> would be coerced into an integer.
This may cause issues for fields that have mixed types, or unconventional representations.</p>
<p>Multiple basic sync rules are combined with an AND clause, and are executed in a <code class="literal">find</code> query.
So for example, if we have the following rules:</p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
<code class="literal">INCLUDE</code> <code class="literal">state</code> equals <code class="literal">MA</code>
</li>
<li class="listitem">
<code class="literal">EXCLUDE</code> <code class="literal">ID</code> greater than <code class="literal">1000</code>
</li>
</ol>
</div>
<p>This would result in a following mongodb <code class="literal">find</code> query:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
  "$and":[
  {"state": "MA"},
  {"ID": {"$lte": 1000}}
 ]
}</pre>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>This differs from how basic sync rules are applied in integration filtering.
In that case, a document is evaluated one rule at a time, in order, for a match, and the specified policy is applied.
This is not possible to mimic in remote filtering, as MongoDB does not offer ordered query-and-break criteria in the <code class="literal">find</code> operation.</p>
</div>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>The more clauses that are added, the more complex the query becomes.
We recommend using advanced rules when there are more than a few clauses.
This helps make the query more efficient and gives you full control over it.</p>
</div>
</div>
<h6><a id="connectors-mongodb-sync-rules-advanced-remote-filtering"></a>Advanced rules in remote filtering<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/main/enterprise-search-docs/connectors-mongodb.asciidoc">edit</a></h6>
<p>Advanced rules for MongoDB can be used to express either <code class="literal">find</code> queries or aggregation pipelines.
They can also be used to tune options available when issuing these queries/pipelines.</p>
<p><span class="strong strong"><strong><code class="literal">find</code> queries</strong></span></p>
<p>For <code class="literal">find</code> queries, the structure of this JSON DSL should look like:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
	"find":{
		"filter": {
			// find query goes here
		},
		"options":{
			// query options go here
		}
	}
}</pre>
</div>
<p>For example:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
	"find":{
		"filter": {
			"$text": {
				"$search" : "garden",
				"$caseSensitive" : false
			}
		},
		"options":{
			"skip" : 10,
			"limit" : 1000
		}
	}
}</pre>
</div>
<p>Where the available options are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">allowDiskUse</code> (true, false) — When set to true, the server can write temporary data to disk while executing the find operation. This option is only available on MongoDB server versions 4.4 and newer.
</li>
<li class="listitem">
<code class="literal">allowPartialResults</code> (true, false) — Allows the query to get partial results if some shards are down.
</li>
<li class="listitem">
<code class="literal">batchSize</code> (Integer) — The number of documents returned in each batch of results from MongoDB.
</li>
<li class="listitem">
<code class="literal">collation</code> (Object) — The collation to use.
</li>
<li class="listitem">
<code class="literal">comment</code> (string) — A user-provided comment to attach to this command.
</li>
<li class="listitem">
<code class="literal">cursorType</code> (<code class="literal">tailable</code>, <code class="literal">tailable_await</code>) — The type of cursor to use.
</li>
<li class="listitem">
<code class="literal">limit</code> (Integer) — The max number of docs to return from the query.
</li>
<li class="listitem">
<code class="literal">maxTimeMs</code> (Integer) — The maximum amount of time to allow the query to run, in milliseconds.
</li>
<li class="listitem">
<code class="literal">modifiers</code> (Object) — A document containing meta-operators modifying the output or behavior of a query.
</li>
<li class="listitem">
<code class="literal">noCursorTimeout</code> (true, false) — The server normally times out idle cursors after an inactivity period (10 minutes) to prevent excess memory use. Set this option to prevent that.
</li>
<li class="listitem">
<code class="literal">oplogReplay</code> (true, false) — For internal replication use only, applications should not set this option.
</li>
<li class="listitem">
<code class="literal">projection</code> (Object) — The fields to include or exclude from each doc in the result set.
</li>
<li class="listitem">
<code class="literal">skip</code> (Integer) — The number of docs to skip before returning results.
</li>
<li class="listitem">
<code class="literal">sort</code> (Object) — The key and direction pairs by which the result set will be sorted.
</li>
<li class="listitem">
<code class="literal">let</code> (Object) — Mapping of variables to use in the command. See the server documentation for details.
</li>
</ul>
</div>
<p><span class="strong strong"><strong>Aggregation pipelines</strong></span></p>
<p>Similarly, for aggregation pipelines, the structure of the JSON DSL should look like:</p>
<div class="pre_wrapper lang-json">
<pre class="programlisting prettyprint lang-json">{
	"aggregate":{
		"pipeline": [
			// pipeline elements go here
		],
		"options": {
            // pipeline options go here
		}
    }
}</pre>
</div>
<p>Where the available options are:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">allowDiskUse</code> (true, false) — Set to true if disk usage is allowed during the aggregation.
</li>
<li class="listitem">
<code class="literal">batchSize</code> (Integer) — The number of documents to return per batch.
</li>
<li class="listitem">
<code class="literal">bypassDocumentValidation</code> (true, false) — Whether or not to skip document level validation.
</li>
<li class="listitem">
<code class="literal">collation</code> (Object) — The collation to use.
</li>
<li class="listitem">
<code class="literal">comment</code> (String) — A user-provided comment to attach to this command.
</li>
<li class="listitem">
<code class="literal">hint</code> (String) — The index to use for the aggregation.
</li>
<li class="listitem">
<code class="literal">let</code> (Object) — Mapping of variables to use in the pipeline. See the server documentation for details.
</li>
<li class="listitem">
<code class="literal">maxTimeMs</code> (Integer) — The maximum amount of time in milliseconds to allow the aggregation to run.
</li>
</ul>
</div>
</div>

</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="connectors-s3.html">« Elastic Amazon S3 connector</a>
</span>
<span class="next">
<a href="connectors-mysql.html">Elastic MySQL connector »</a>
</span>
</div>
</div>
</body>
</html>
