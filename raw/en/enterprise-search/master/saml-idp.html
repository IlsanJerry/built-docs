<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Set up a SAML 2.0 identity provider service (SAML IdP) for Enterprise Search | Elastic Enterprise Search Documentation [master] | Elastic</title>
<link rel="home" href="index.html" title="Elastic Enterprise Search Documentation [master]"/>
<link rel="up" href="users-access.html" title="Manage users and access to Enterprise Search"/>
<link rel="prev" href="users-access.html" title="Manage users and access to Enterprise Search"/>
<link rel="next" href="license-management.html" title="Platinum features"/>
<meta name="DC.type" content="Learn/Docs/Enterprise Search/Guide/master"/>
<meta name="DC.subject" content="Enterprise Search"/>
<meta name="DC.identifier" content="master"/>
</head>
<body><div class="page_header">
You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elastic Enterprise Search Documentation [master]</a></span>
»
<span class="breadcrumb-link"><a href="users-access.html">Manage users and access to Enterprise Search</a></span>
»
<span class="breadcrumb-node">Set up a SAML 2.0 identity provider service (SAML IdP) for Enterprise Search</span>
</div>
<div class="navheader">
<span class="prev">
<a href="users-access.html">« Manage users and access to Enterprise Search</a>
</span>
<span class="next">
<a href="license-management.html">Platinum features »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="saml-idp"></a>Set up a SAML 2.0 identity provider service (SAML IdP) for Enterprise Search<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h2>
</div></div></div>

<p>This quickstart explains how to configure SAML authentication for Enterprise Search and Kibana on a local self-managed deployment.
See the end of this document for how to apply these instructions to a deployment running on Elastic Cloud or Elastic Cloud on Kubernetes.</p>
<p>This quickstart provides a concise example reference only.
For a complete reference to Elasticsearch SAML configuration, see <a href="/guide/en/elasticsearch/reference/master/saml-guide-stack.html" class="ulink" target="_blank" rel="noopener">Configuring Elasticsearch for SAML authentication</a> in the Elasticsearch documentation.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>SAML for Enterprise Search is a <a class="xref" href="license-management.html" title="Platinum features">platinum feature</a>.</p>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-elasticsearch"></a>Configure Elasticsearch for SAML authentication<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>In Elasticsearch, configure one SAML realm for Kibana and another for Enterprise Search by adding this configuration to the Elasticsearch <code class="literal">config/elasticsearch.yml</code> file.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.authc.token.enabled: true
xpack.security.authc.realms.saml.kibana-my-saml:
  order: 3
  idp.metadata.path: "https://YOUR_SAML_IDP/metadata"  # Replace with your SAML identity provider's metadata URL
  idp.entity_id: "urn:example:idp"
  sp.entity_id: "http://localhost:5601"
  sp.acs: "http://localhost:5601/api/security/v1/saml"
  sp.logout: "http://localhost:5601/logout"
  attributes:
    principal: "email"  # or another SAML provider attribute you prefer

xpack.security.authc.realms.saml.ent-search-my-saml:
  order: 2
  idp.metadata.path: "https://YOUR_SAML_IDP/metadata"  # Replace with your SAML identity provider's metadata URL
  idp.entity_id: "urn:example:idp"
  sp.entity_id: "http://localhost:3002"
  sp.acs: "http://localhost:3002/users/saml_login"
  sp.logout: "http://localhost:3002/logout"
  attributes:
    principal: "email"  # or another SAML provider attribute you prefer to map to the username</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-idp"></a>Configure your SAML identity provider to work with Enterprise Search and Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>Configure your SAML identity provider to allow authentication to Enterprise Search at <code class="literal">http://localhost:3002</code> and to Kibana at <code class="literal">http://localhost:5601</code>.
The specific configuration steps will vary for your SAML identity provider.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-enterprise-search"></a>Configure Enterprise Search to use the Elasticsearch SAML realm<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>Add this configuration to the Enterprise Search <code class="literal">config/enterprise-search.yml</code> file.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">ent_search.auth:
  ent-search-my-saml:             # match the realm name in elasticsearch.yml
    source: elasticsearch-saml    # always elasticseach-saml
    description: "My SAML"
    icon: "https://www.elastic.co/favicon.ico"
    order: 3
# Optionally also enable authentication for Elasticsearch native users
  ent-search-native:
    source: elasticsearch-native   # always elasticsearch-native
    description: "Elasticsearch"
    icon: "https://www.elastic.co/favicon.ico"
    order: 4</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-kibana"></a>Configure Kibana to use the Elasticsearch SAML realm<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>Add this configuration to the Kibana <code class="literal">config/kibana.yml</code> file.</p>
<div class="pre_wrapper lang-yaml">
<pre class="programlisting prettyprint lang-yaml">xpack.security.authc.providers:
  saml:
    kibana-my-saml:            # match the realm name in elasticsearch.yml
      order: 0
      realm: "kibana-my-saml"
# Enable authentication for Elasticsearch native users
  basic:
    basic1:
      order: 1</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-kibana-access"></a>Grant SAML users access to Kibana<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>Use the Elasticsearch role mappings API or the Kibana stack management role mappings UI to map roles to SAML realm users.</p>
<p>For example, to grant all SAML realm users access to all of Kibana using the Elasticsearch API:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl --insecure -u elastic:changeme -XPOST http://localhost:9200/_security/role_mapping/mapping1 \
-H 'Content-Type: application/json' \
-d '
{
  "roles": [ "kibana_admin" ],
  "enabled": true,
  "rules": {
    "field": { "realm.name": "kibana-my-saml" }
  }
}'</pre>
</div>
<p>Or grant only one SAML realm user access to all of Kibana:</p>
<div class="pre_wrapper lang-sh">
<pre class="programlisting prettyprint lang-sh">curl --insecure -u elastic:changeme -XPOST http://localhost:9200/_security/role_mapping/mapping2 \
-H 'Content-Type: application/json' \
-d '
{
  "roles": [ "kibana_admin" ],
  "enabled": true,
  "rules": {
    "field": { "username": "saml.jackson@example.com" }
  }
}'</pre>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-enterprise-search-access"></a>Grant SAML users access to Enterprise Search<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>By default, all users have full access to App Search and Workplace Search.
Enable role-based access controls in App Search or Workplace Search to control SAML user access.</p>
<p><span class="strong strong"><strong>Enable role-based access control in App Search and Workplace Search:</strong></span></p>
<div class="olist orderedlist">
<ol class="orderedlist">
<li class="listitem">
Launch Enterprise Search from Kibana or log in to the Enterprise Search standalone UI with any SAML user.
</li>
<li class="listitem">
Launch App Search or Workplace Search. Choose Users and Roles and enable role-based access.
</li>
<li class="listitem">
Add a SAML role mapping for the SAML user(s) who require access.
Make sure to grant owner access to at least one SAML user so that you can continue to manage users and roles.
</li>
</ol>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-elastic-cloud"></a>Configuring Elastic Cloud deployments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>The approach is similar for Elastic Cloud deployments (ESS and ECE), with the following differences:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Replace references to <code class="literal">http://localhost:3002</code> with the URL of your Enterprise Search instance on Elastic Cloud.
</li>
<li class="listitem">
Replace references to <code class="literal">http://localhost:5601</code> with the URL of your Kibana instance on Elastic Cloud.
</li>
<li class="listitem">
Add the Elasticsearch configuration settings to the <a href="/guide/en/cloud-enterprise/current/ece-add-user-settings.html" class="ulink" target="_blank" rel="noopener">Elasticsearch settings</a> in your Cloud deployment.
</li>
<li class="listitem">
Add the Enterprise Search configuration settings to the <a href="/guide/en/cloud-enterprise/current/ece-manage-enterprise-search-settings.html" class="ulink" target="_blank" rel="noopener">Enterprise Search settings</a> in your Cloud deployment.
</li>
<li class="listitem">
Add the Kibana configuration to the <a href="/guide/en/cloud-enterprise/current/ece-manage-kibana-settings.html" class="ulink" target="_blank" rel="noopener">Kibana settings</a> in your Cloud deployment.
</li>
</ul>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title"><a id="saml-idp-eck"></a>Configuring Elastic Cloud on Kubernetes deployments<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/enterprise-search-pubs/edit/master/enterprise-search-docs/saml-idp.asciidoc">edit</a></h3>
</div></div></div>
<p>The approach is similar for Elastic Cloud on Kubernetes (ECK) deployments, with the following differences:</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
Replace references to <code class="literal">http://localhost:3002</code> with the URL of your Enterprise Search instance on ECK.
</li>
<li class="listitem">
Replace references to <code class="literal">http://localhost:5601</code> with the URL of your Kibana instance on ECK.
</li>
<li class="listitem">
Add the Elasticsearch configuration settings to the ECK Elasticsearch configuration.
</li>
<li class="listitem">
Add the Enterprise Search configuration settings to the <a href="/guide/en/cloud-on-k8s/current/k8s-enterprise-search-configuration.html" class="ulink" target="_blank" rel="noopener">ECK Enterprise Search configuration</a>.
</li>
<li class="listitem">
Add the Kibana configuration settings to the <a href="/guide/en/cloud-on-k8s/current/k8s-kibana-advanced-configuration.html#k8s-kibana-configuration" class="ulink" target="_blank" rel="noopener">ECK Kibana configuration</a>.
</li>
</ul>
</div>
</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="users-access.html">« Manage users and access to Enterprise Search</a>
</span>
<span class="next">
<a href="license-management.html">Platinum features »</a>
</span>
</div>
</div>
</body>
</html>
