<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">创建基于时间序列的可视化控件
        | Kibana 用户手册
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Kibana 用户手册" /><link rel="up" href="timelion-getting-started.html" title="基础入门" /><link rel="prev" href="timelion-getting-started.html" title="基础入门" /><link rel="next" href="timelion-customize.html" title="自定义格式化控件" /><meta xmlns="" name="description" content="有关如何使用 Elasticsearch、Kibana、Logstash、Beats、X-Pack、Elastic Cloud、Elasticsearch for Apache Hadoop 及我们各种语言的客户端的文档。" /><meta xmlns="" name="DC.type" content="Learn/Docs/Kibana/Reference" /><meta xmlns="" name="DC.subject" content="Kibana" /><meta xmlns="" name="DC.identifier" content="cn" /></head><body><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Kibana 用户手册</a></span> » <span class="breadcrumb-link"><a href="timelion.html">时序控件</a></span> » <span class="breadcrumb-link"><a href="timelion-getting-started.html">基础入门</a></span> » <span class="breadcrumb-node">创建基于时间序列的可视化控件</span></div><div xmlns="" class="navheader"><span class="prev"><a href="timelion-getting-started.html">
              « 
              基础入门</a>
           
        </span><span class="next">
           
          <a href="timelion-customize.html">自定义格式化控件
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="timelion-create"></a>创建基于时间序列的可视化控件<a xmlns="" href="https://github.com/elasticsearch-cn/kibana/edit/cn/docs/timelion/getting-started/timelion-create.asciidoc" class="edit_me" title="在 GitHub 上编辑本页" rel="nofollow">编辑</a></h2></div></div></div><p>本教程会使用来自 <a class="ulink" href="https://www.elastic.co/guide/en/beats/metricbeat/current/index.html" target="_top">Metricbeat</a> 的时间序列数据为您演示 Timelion 所能提供的功能。您可以先下载 Metricbeat 并根据<a class="ulink" href="https://www.elastic.co/downloads/beats/metricbeat" target="_top">这个说明</a>在本地抽取数据。</p><p>第一个可视化控件将会对比系统用户空间 CPU 实时使用百分比和其每小时的平均偏移量。为了创建这个控件，我们需要创建两个 Timelion 表达式。第一个是实时的 <code class="literal">system.cpu.user.pct</code> 平均值，第二个是每小时的平均偏移量。</p><p>您需要在第一个表达式中定义 <code class="literal">index</code> 、 <code class="literal">timefield</code> 和 <code class="literal">metric</code> 。然后紧接着在 Timelion 查询框中输入如下表达式：</p><div xmlns="" class="pre_wrapper lang-text"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-text">.es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')</pre></div><div class="informalfigure"><div class="mediaobject"><img src="images/timelion-create01.png" alt="images/timelion-create01.png" /></div></div><p> </p><p>现在您需要添加前一个小时的数据用来对比。您需要添加一个 <code class="literal">offset</code> 参数到 <code class="literal">.es()</code> 函数。 <code class="literal">offset</code> 将会利用表达式来指定时间序列偏移量。举个例子，如果您想让时间偏移一个小时那么将会使用时间表达式 <code class="literal">-1h</code> 。 使用逗号分隔两个时间序列表达式，例如在 Timelion 查询框中输入如下表达式：</p><div xmlns="" class="pre_wrapper lang-text"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-text">.es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct'), .es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct')</pre></div><div class="informalfigure"><div class="mediaobject"><img src="images/timelion-create02.png" alt="images/timelion-create02.png" /></div></div><p> </p><p>图形上有点难区分上述两个序列表达式。我们可以通过给每个序列自定义标签来区分它们。您可以在任何一个序列后面添加 <code class="literal">.label()</code> 表达式来自定义标签。我们来看看如下自定义标签的例子：</p><div xmlns="" class="pre_wrapper lang-text"><pre xmlns="http://www.w3.org/1999/xhtml" class="programlisting prettyprint lang-text">.es(offset=-1h,index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct').label('last hour'), .es(index=metricbeat-*, timefield='@timestamp', metric='avg:system.cpu.user.pct').label('current hour')</pre></div><div class="informalfigure"><div class="mediaobject"><img src="images/timelion-create03.png" alt="images/timelion-create03.png" /></div></div><p> </p><p>保存整个 Timelion 表格为 <span class="emphasis"><em>Metricbeat Example</em></span> 。Timelion 是一个非常强大的基于时间序列的控件，您可以对本教程中的一些关键点多加练习来熟悉 Timelion。</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="timelion-getting-started.html">
              « 
              基础入门</a>
           
        </span><span class="next">
           
          <a href="timelion-customize.html">自定义格式化控件
               »
            </a></span></div></body></html>