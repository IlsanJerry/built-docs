<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title xmlns="">Ngrams 在部分匹配的应用
        | Elasticsearch: 权威指南
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch: 权威指南" /><link rel="up" href="partial-matching.html" title="部分匹配" /><link rel="prev" href="_index_time_optimizations.html" title="索引时优化" /><link rel="next" href="_index_time_search_as_you_type.html" title="索引时输入即搜索" /><meta xmlns="" name="description" content="有关如何使用 Elasticsearch、Kibana、Logstash、Beats、X-Pack、Elastic Cloud、Elasticsearch for Apache Hadoop 及我们各种语言的客户端的文档。" /><meta xmlns="" name="DC.type" content="Learn/Docs/Elasticsearch/Definitive Guide" /><meta xmlns="" name="DC.subject" content="Elasticsearch" /><meta xmlns="" name="DC.identifier" content="cn" /></head><body><div xmlns="" class="page_header"><b>请注意:</b><br/>本书基于 Elasticsearch 2.x 版本，有些内容可能已经过时。
</div><div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch: 权威指南</a></span> » <span class="breadcrumb-link"><a href="search-in-depth.html">深入搜索</a></span> » <span class="breadcrumb-link"><a href="partial-matching.html">部分匹配</a></span> » <span class="breadcrumb-node">Ngrams 在部分匹配的应用</span></div><div xmlns="" class="navheader"><span class="prev"><a href="_index_time_optimizations.html">
              « 
              索引时优化</a>
           
        </span><span class="next">
           
          <a href="_index_time_search_as_you_type.html">索引时输入即搜索
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_ngrams_for_partial_matching"></a>Ngrams 在部分匹配的应用<a xmlns="" href="https://github.com/elasticsearch-cn/elasticsearch-definitive-guide/edit/cn/130_Partial_Matching/30_Ngram_intro.asciidoc" class="edit_me" title="在 GitHub 上编辑本页" rel="nofollow">编辑</a></h2></div></div></div><p>之前提到：“只能在倒排索引中找到存在的词。” 尽管 <code class="literal">prefix</code> 、 <code class="literal">wildcard</code> 、 <code class="literal">regexp</code> 查询告诉我们这种说法并不完全正确，但单个词的查找 <span class="emphasis"><em>确实</em></span> 要比在词列表中盲目挨个查找的效率要高得多。<a id="id-1.5.7.16.2.5" class="indexterm"></a>
<a id="id-1.5.7.16.2.6" class="indexterm"></a>
<a id="id-1.5.7.16.2.7" class="indexterm"></a>在搜索之前准备好供部分匹配的数据可以提高搜索的性能。</p><p>在索引时准备数据意味着要选择合适的分析链，这里部分匹配使用的工具是 <span class="emphasis"><em>n-gram</em></span> 。<a id="id-1.5.7.16.3.2" class="indexterm"></a>可以将 <span class="emphasis"><em>n-gram</em></span> 看成一个在词语上 <span class="emphasis"><em>滑动窗口</em></span> ， <span class="emphasis"><em>n</em></span> 代表这个 “窗口” 的长度。如果我们要 n-gram <code class="literal">quick</code> 这个词 —— 它的结果取决于 <span class="emphasis"><em>n</em></span> 的选择长度：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
长度 1（unigram）：    [ <code class="literal">q</code>, <code class="literal">u</code>, <code class="literal">i</code>, <code class="literal">c</code>, <code class="literal">k</code> ]
</li><li class="listitem">
长度 2（bigram）：     [ <code class="literal">qu</code>, <code class="literal">ui</code>, <code class="literal">ic</code>, <code class="literal">ck</code> ]
</li><li class="listitem">
长度 3（trigram）：    [ <code class="literal">qui</code>, <code class="literal">uic</code>, <code class="literal">ick</code> ]
</li><li class="listitem">
长度 4（four-gram）：  [ <code class="literal">quic</code>, <code class="literal">uick</code> ]
</li><li class="listitem">
长度 5（five-gram）：  [ <code class="literal">quick</code> ]
</li></ul></div><p>朴素的 n-gram 对 <span class="emphasis"><em>词语内部的匹配</em></span> 非常有用，即在 <a class="link" href="ngrams-compound-words.html" title="Ngrams 在复合词的应用">Ngram 匹配复合词</a> 介绍的那样。但对于输入即搜索（search-as-you-type）这种应用场景，我们会使用一种特殊的 n-gram 称为 <span class="emphasis"><em>边界 n-grams</em></span> （edge n-grams）。<a id="id-1.5.7.16.5.4" class="indexterm"></a>所谓的边界 n-gram 是说它会固定词语开始的一边，以单词 <code class="literal">quick</code> 为例，它的边界 n-gram 的结果为：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">q</code>
</li><li class="listitem">
<code class="literal">qu</code>
</li><li class="listitem">
<code class="literal">qui</code>
</li><li class="listitem">
<code class="literal">quic</code>
</li><li class="listitem">
<code class="literal">quick</code>
</li></ul></div><p>可能会注意到这与用户在搜索时输入 “quick” 的字母次序是一致的，换句话说，这种方式正好满足即时搜索（instant search）！</p></div><div xmlns="" class="navfooter"><span class="prev"><a href="_index_time_optimizations.html">
              « 
              索引时优化</a>
           
        </span><span class="next">
           
          <a href="_index_time_search_as_you_type.html">索引时输入即搜索
               »
            </a></span></div></body></html>